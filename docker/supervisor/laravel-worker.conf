[supervisord]
nodaemon=true
user=root
pidfile=/var/run/supervisord.pid
logfile=/var/log/supervisor/supervisord.log

[program:laravel-queue-general]
process_name=%(program_name)s_%(process_num)02d
command=php /var/www/html/artisan queue:work redis --sleep=3 --tries=3 --max-time=3600 --memory=1024 --queue=default,tenant_isolated,critical
directory=/var/www/html
autostart=true
autorestart=true
user=www-data
numprocs=2
redirect_stderr=true
stdout_logfile=/var/www/html/storage/logs/queue-general.log
stdout_logfile_maxbytes=100MB
stdout_logfile_backups=3
priority=900
stopwaitsecs=3600

[program:laravel-queue-tenant]
process_name=%(program_name)s_%(process_num)02d
command=php /var/www/html/artisan queue:work redis --sleep=2 --tries=5 --max-time=7200 --memory=2048 --queue=tenant_isolated,tenant_critical
directory=/var/www/html
autostart=true
autorestart=true
user=www-data
numprocs=3
redirect_stderr=true
stdout_logfile=/var/www/html/storage/logs/queue-tenant.log
stdout_logfile_maxbytes=100MB
stdout_logfile_backups=3
priority=800
stopwaitsecs=7200

[program:laravel-queue-health-monitor]
process_name=%(program_name)s
command=php /var/www/html/artisan queue:health-monitor
directory=/var/www/html
autostart=true
autorestart=true
user=www-data
numprocs=1
redirect_stderr=true
stdout_logfile=/var/www/html/storage/logs/queue-health.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=2
priority=1000
stopwaitsecs=60

[program:laravel-scheduler]
process_name=%(program_name)s
command=php /var/www/html/artisan schedule:work
directory=/var/www/html
autostart=true
autorestart=true
user=www-data
numprocs=1
redirect_stderr=true
stdout_logfile=/var/www/html/storage/logs/scheduler.log
stdout_logfile_maxbytes=50MB
stdout_logfile_backups=2
priority=700
stopwaitsecs=60