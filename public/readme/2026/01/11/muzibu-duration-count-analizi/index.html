<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Muzibu Duration & Count Analizi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        slate: {
                            850: '#0f1729',
                            950: '#020617'
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Header -->
        <header class="mb-8 border-b border-slate-800 pb-6">
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center gap-3">
                    <span class="text-4xl">ğŸµ</span>
                    <div>
                        <h1 class="text-3xl font-bold text-white">Muzibu Duration & Count Analizi</h1>
                        <p class="text-slate-400 mt-1">Toplu Ã¶zelliklerin anÄ±nda gÃ¼ncelleme durumu</p>
                    </div>
                </div>
                <span class="px-4 py-2 bg-blue-600/20 text-blue-400 rounded-full text-sm font-semibold border border-blue-600/30">
                    ğŸ” Analiz
                </span>
            </div>
            <div class="flex items-center gap-6 text-sm text-slate-400">
                <span>ğŸ“… 11 Ocak 2026</span>
                <span>ğŸ¢ Tenant 1001 (muzibu.com.tr)</span>
                <span>ğŸ¤– Claude Sonnet 4.5</span>
            </div>
        </header>

        <!-- Basit AnlatÄ±m -->
        <section class="mb-8">
            <div class="bg-green-900/20 border border-green-800 rounded-lg p-6">
                <div class="flex items-start gap-4">
                    <span class="text-3xl">ğŸ“</span>
                    <div class="flex-1">
                        <h2 class="text-xl font-bold text-green-400 mb-3">Basit AnlatÄ±m (Herkes Ä°Ã§in)</h2>
                        <div class="space-y-3 text-slate-300">
                            <p>
                                <strong>Sorun:</strong> MÃ¼zik platformunda albÃ¼mlerin, sanatÃ§Ä±larÄ±n, tÃ¼rlerin ve Ã§alma listelerinin kaÃ§ ÅŸarkÄ± iÃ§erdiÄŸi ve toplam sÃ¼releri saklanÄ±yor.
                                Yeni ÅŸarkÄ± eklendiÄŸinde, dÃ¼zenlendiÄŸinde veya silindiÄŸinde bu sayÄ±lar otomatik gÃ¼ncellenmeli.
                            </p>
                            <p>
                                <strong>Ã–rnek:</strong> Bir albÃ¼me yeni ÅŸarkÄ± eklediÄŸinizde, albÃ¼mÃ¼n "5 ÅŸarkÄ±, 18 dakika" bilgisi otomatik olarak "6 ÅŸarkÄ±, 21 dakika" olmalÄ±.
                            </p>
                            <p>
                                <strong>Durum:</strong> Sistem <span class="text-yellow-400 font-semibold">KISMEN Ã‡ALIÅIYOR</span>. BazÄ± durumlar otomatik, bazÄ±larÄ± manuel gÃ¼ncelleme gerektiriyor.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Teknik Ã–zet -->
        <section class="mb-8">
            <div class="bg-blue-900/20 border border-blue-800 rounded-lg p-6">
                <div class="flex items-start gap-4">
                    <span class="text-3xl">âš™ï¸</span>
                    <div class="flex-1">
                        <h2 class="text-xl font-bold text-blue-400 mb-3">Teknik Detaylar (GeliÅŸtiriciler Ä°Ã§in)</h2>
                        <div class="space-y-2 text-slate-300">
                            <p><strong>Migration:</strong> <code class="bg-slate-800 px-2 py-1 rounded text-blue-300">2025_12_26_200000_add_cache_count_fields_to_muzibu_tables.php</code></p>
                            <p><strong>Trait:</strong> <code class="bg-slate-800 px-2 py-1 rounded text-blue-300">HasCachedCounts</code> (Modules/Muzibu/App/Traits/)</p>
                            <p><strong>Observer'lar:</strong> SongObserver, AlbumObserver, PlaylistObserver</p>
                            <p><strong>GÃ¼ncelleme YÃ¶ntemleri:</strong> incrementCachedCount(), decrementCachedCount(), recalculateCachedCounts()</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tablo Analizi -->
        <section class="mb-8">
            <h2 class="text-2xl font-bold text-white mb-4 flex items-center gap-2">
                <span>ğŸ“Š</span>
                Tablolardaki Duration & Count Field'larÄ±
            </h2>

            <div class="grid grid-cols-1 gap-4">
                <!-- Playlists -->
                <div class="bg-slate-900/50 border border-slate-700 rounded-lg p-6">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <h3 class="text-lg font-bold text-white flex items-center gap-2">
                                <span>ğŸ¶</span> muzibu_playlists
                            </h3>
                            <p class="text-sm text-slate-400 mt-1">Ã‡alma Listeleri</p>
                        </div>
                        <span class="px-3 py-1 bg-yellow-600/20 text-yellow-400 rounded-full text-xs font-semibold border border-yellow-600/30">
                            âš ï¸ Manuel
                        </span>
                    </div>
                    <div class="space-y-3">
                        <div class="bg-slate-800/50 rounded p-3">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="text-green-400">âœ…</span>
                                <code class="text-blue-300">songs_count</code>
                                <span class="text-slate-400 text-sm">(int, nullable)</span>
                            </div>
                            <p class="text-sm text-slate-300 ml-6">Playlist'teki aktif ÅŸarkÄ± sayÄ±sÄ±</p>
                        </div>
                        <div class="bg-slate-800/50 rounded p-3">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="text-green-400">âœ…</span>
                                <code class="text-blue-300">total_duration</code>
                                <span class="text-slate-400 text-sm">(int, nullable, saniye)</span>
                            </div>
                            <p class="text-sm text-slate-300 ml-6">Playlist'teki tÃ¼m ÅŸarkÄ±larÄ±n toplam sÃ¼resi</p>
                        </div>
                        <div class="bg-yellow-900/20 border border-yellow-700 rounded p-3 mt-3">
                            <p class="text-sm text-yellow-300">
                                <strong>âš ï¸ Manuel GÃ¼ncelleme Gerekli:</strong> Playlist'e ÅŸarkÄ± eklenirken/Ã§Ä±karÄ±lÄ±rken
                                <code class="bg-slate-800 px-2 py-1 rounded">attachSongWithCache()</code>,
                                <code class="bg-slate-800 px-2 py-1 rounded">detachSongWithCache()</code>,
                                <code class="bg-slate-800 px-2 py-1 rounded">syncSongsWithCache()</code> methodlarÄ± kullanÄ±lmalÄ±!
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Albums -->
                <div class="bg-slate-900/50 border border-slate-700 rounded-lg p-6">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <h3 class="text-lg font-bold text-white flex items-center gap-2">
                                <span>ğŸ’¿</span> muzibu_albums
                            </h3>
                            <p class="text-sm text-slate-400 mt-1">AlbÃ¼mler</p>
                        </div>
                        <span class="px-3 py-1 bg-green-600/20 text-green-400 rounded-full text-xs font-semibold border border-green-600/30">
                            âœ… Otomatik
                        </span>
                    </div>
                    <div class="space-y-3">
                        <div class="bg-slate-800/50 rounded p-3">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="text-green-400">âœ…</span>
                                <code class="text-blue-300">songs_count</code>
                                <span class="text-slate-400 text-sm">(int, nullable)</span>
                            </div>
                            <p class="text-sm text-slate-300 ml-6">AlbÃ¼mdeki aktif ÅŸarkÄ± sayÄ±sÄ±</p>
                        </div>
                        <div class="bg-slate-800/50 rounded p-3">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="text-green-400">âœ…</span>
                                <code class="text-blue-300">total_duration</code>
                                <span class="text-slate-400 text-sm">(int, nullable, saniye)</span>
                            </div>
                            <p class="text-sm text-slate-300 ml-6">AlbÃ¼mdeki tÃ¼m ÅŸarkÄ±larÄ±n toplam sÃ¼resi</p>
                        </div>
                        <div class="bg-green-900/20 border border-green-700 rounded p-3 mt-3">
                            <p class="text-sm text-green-300">
                                <strong>âœ… Otomatik GÃ¼ncelleme:</strong> SongObserver ÅŸarkÄ± eklendiÄŸinde/silindiÄŸinde/gÃ¼ncellendiÄŸinde
                                otomatik olarak album count'larÄ±nÄ± gÃ¼nceller.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Genres -->
                <div class="bg-slate-900/50 border border-slate-700 rounded-lg p-6">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <h3 class="text-lg font-bold text-white flex items-center gap-2">
                                <span>ğŸ¸</span> muzibu_genres
                            </h3>
                            <p class="text-sm text-slate-400 mt-1">MÃ¼zik TÃ¼rleri</p>
                        </div>
                        <span class="px-3 py-1 bg-green-600/20 text-green-400 rounded-full text-xs font-semibold border border-green-600/30">
                            âœ… Otomatik
                        </span>
                    </div>
                    <div class="space-y-3">
                        <div class="bg-slate-800/50 rounded p-3">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="text-green-400">âœ…</span>
                                <code class="text-blue-300">songs_count</code>
                                <span class="text-slate-400 text-sm">(int, nullable)</span>
                            </div>
                            <p class="text-sm text-slate-300 ml-6">Bu tÃ¼rdeki aktif ÅŸarkÄ± sayÄ±sÄ±</p>
                        </div>
                        <div class="bg-slate-800/50 rounded p-3">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="text-green-400">âœ…</span>
                                <code class="text-blue-300">total_duration</code>
                                <span class="text-slate-400 text-sm">(int, nullable, saniye)</span>
                            </div>
                            <p class="text-sm text-slate-300 ml-6">Bu tÃ¼rdeki tÃ¼m ÅŸarkÄ±larÄ±n toplam sÃ¼resi</p>
                        </div>
                        <div class="bg-green-900/20 border border-green-700 rounded p-3 mt-3">
                            <p class="text-sm text-green-300">
                                <strong>âœ… Otomatik GÃ¼ncelleme:</strong> SongObserver ÅŸarkÄ± genre_id'si deÄŸiÅŸtiÄŸinde
                                eski ve yeni genre count'larÄ±nÄ± otomatik gÃ¼nceller.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Artists -->
                <div class="bg-slate-900/50 border border-slate-700 rounded-lg p-6">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <h3 class="text-lg font-bold text-white flex items-center gap-2">
                                <span>ğŸ¤</span> muzibu_artists
                            </h3>
                            <p class="text-sm text-slate-400 mt-1">SanatÃ§Ä±lar</p>
                        </div>
                        <span class="px-3 py-1 bg-green-600/20 text-green-400 rounded-full text-xs font-semibold border border-green-600/30">
                            âœ… Otomatik
                        </span>
                    </div>
                    <div class="space-y-3">
                        <div class="bg-slate-800/50 rounded p-3">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="text-green-400">âœ…</span>
                                <code class="text-blue-300">albums_count</code>
                                <span class="text-slate-400 text-sm">(int, nullable)</span>
                            </div>
                            <p class="text-sm text-slate-300 ml-6">SanatÃ§Ä±nÄ±n aktif albÃ¼m sayÄ±sÄ±</p>
                        </div>
                        <div class="bg-slate-800/50 rounded p-3">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="text-green-400">âœ…</span>
                                <code class="text-blue-300">songs_count</code>
                                <span class="text-slate-400 text-sm">(int, nullable)</span>
                            </div>
                            <p class="text-sm text-slate-300 ml-6">SanatÃ§Ä±nÄ±n aktif ÅŸarkÄ± sayÄ±sÄ± (tÃ¼m albÃ¼mlerden)</p>
                        </div>
                        <div class="bg-slate-800/50 rounded p-3">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="text-green-400">âœ…</span>
                                <code class="text-blue-300">total_duration</code>
                                <span class="text-slate-400 text-sm">(int, nullable, saniye)</span>
                            </div>
                            <p class="text-sm text-slate-300 ml-6">SanatÃ§Ä±nÄ±n tÃ¼m ÅŸarkÄ±larÄ±nÄ±n toplam sÃ¼resi</p>
                        </div>
                        <div class="bg-green-900/20 border border-green-700 rounded p-3 mt-3">
                            <p class="text-sm text-green-300">
                                <strong>âœ… Otomatik GÃ¼ncelleme:</strong> SongObserver ve AlbumObserver sanatÃ§Ä± count'larÄ±nÄ±
                                otomatik gÃ¼nceller (Album Ã¼zerinden hasManyThrough iliÅŸkisi).
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Radios -->
                <div class="bg-slate-900/50 border border-slate-700 rounded-lg p-6">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <h3 class="text-lg font-bold text-white flex items-center gap-2">
                                <span>ğŸ“»</span> muzibu_radios
                            </h3>
                            <p class="text-sm text-slate-400 mt-1">Radyo Ä°stasyonlarÄ±</p>
                        </div>
                        <span class="px-3 py-1 bg-red-600/20 text-red-400 rounded-full text-xs font-semibold border border-red-600/30">
                            âŒ Cache Yok
                        </span>
                    </div>
                    <div class="space-y-3">
                        <div class="bg-slate-800/50 rounded p-3">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="text-red-400">âŒ</span>
                                <code class="text-slate-400">songs_count</code>
                                <span class="text-slate-400 text-sm">(field yok)</span>
                            </div>
                            <p class="text-sm text-slate-300 ml-6">Cache edilmiÅŸ field yok</p>
                        </div>
                        <div class="bg-slate-800/50 rounded p-3">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="text-red-400">âŒ</span>
                                <code class="text-slate-400">total_duration</code>
                                <span class="text-slate-400 text-sm">(field yok)</span>
                            </div>
                            <p class="text-sm text-slate-300 ml-6">Cache edilmiÅŸ field yok</p>
                        </div>
                        <div class="bg-red-900/20 border border-red-700 rounded p-3 mt-3">
                            <p class="text-sm text-red-300">
                                <strong>âŒ Runtime Hesaplama:</strong> Radio model'inde <code class="bg-slate-800 px-2 py-1 rounded">getTotalDuration()</code>
                                methodu var ama DB'de cache field'Ä± YOK. Her seferinde tÃ¼m playlist'lerden hesaplÄ±yor (YAVAÅ!).
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Sectors -->
                <div class="bg-slate-900/50 border border-slate-700 rounded-lg p-6">
                    <div class="flex items-start justify-between mb-4">
                        <div>
                            <h3 class="text-lg font-bold text-white flex items-center gap-2">
                                <span>ğŸ¢</span> muzibu_sectors
                            </h3>
                            <p class="text-sm text-slate-400 mt-1">Ä°ÅŸ SektÃ¶rleri</p>
                        </div>
                        <span class="px-3 py-1 bg-red-600/20 text-red-400 rounded-full text-xs font-semibold border border-red-600/30">
                            âŒ Cache Yok
                        </span>
                    </div>
                    <div class="space-y-3">
                        <div class="bg-slate-800/50 rounded p-3">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="text-red-400">âŒ</span>
                                <code class="text-slate-400">songs_count</code>
                                <span class="text-slate-400 text-sm">(field yok)</span>
                            </div>
                            <p class="text-sm text-slate-300 ml-6">Cache edilmiÅŸ field yok</p>
                        </div>
                        <div class="bg-slate-800/50 rounded p-3">
                            <div class="flex items-center gap-2 mb-2">
                                <span class="text-red-400">âŒ</span>
                                <code class="text-slate-400">total_duration</code>
                                <span class="text-slate-400 text-sm">(field yok)</span>
                            </div>
                            <p class="text-sm text-slate-300 ml-6">Cache edilmiÅŸ field yok</p>
                        </div>
                        <div class="bg-red-900/20 border border-red-700 rounded p-3 mt-3">
                            <p class="text-sm text-red-300">
                                <strong>âŒ Cache Sistemi Yok:</strong> Sector model'inde duration/count cache field'larÄ± eklenmemiÅŸ.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Observer Sistemi -->
        <section class="mb-8">
            <h2 class="text-2xl font-bold text-white mb-4 flex items-center gap-2">
                <span>ğŸ‘€</span>
                Observer (Otomatik GÃ¼ncelleme) Sistemi
            </h2>

            <div class="grid grid-cols-1 gap-4">
                <!-- SongObserver -->
                <div class="bg-slate-900/50 border border-slate-700 rounded-lg p-6">
                    <h3 class="text-lg font-bold text-white mb-3 flex items-center gap-2">
                        <span class="text-green-400">âœ…</span>
                        SongObserver
                    </h3>
                    <div class="space-y-2 text-sm text-slate-300">
                        <p><strong>Dosya:</strong> <code class="bg-slate-800 px-2 py-1 rounded text-blue-300">Modules/Muzibu/App/Observers/SongObserver.php</code></p>
                        <p><strong>Event'ler:</strong> created, updated, deleted, restored, forceDeleted</p>
                        <div class="mt-3 space-y-2">
                            <div class="bg-green-900/20 border border-green-700 rounded p-3">
                                <strong class="text-green-400">âœ… created:</strong>
                                <ul class="list-disc list-inside ml-4 mt-1 space-y-1">
                                    <li>Album: songs_count +1, total_duration +duration</li>
                                    <li>Genre: songs_count +1, total_duration +duration</li>
                                    <li>Artist (via Album): songs_count +1, total_duration +duration</li>
                                </ul>
                            </div>
                            <div class="bg-green-900/20 border border-green-700 rounded p-3">
                                <strong class="text-green-400">âœ… updated:</strong>
                                <ul class="list-disc list-inside ml-4 mt-1 space-y-1">
                                    <li>is_active deÄŸiÅŸirse â†’ count'larÄ± artÄ±r/azalt</li>
                                    <li>duration deÄŸiÅŸirse â†’ total_duration'Ä± gÃ¼ncelle</li>
                                    <li>album_id deÄŸiÅŸirse â†’ eski album'den Ã§Ä±kar, yeni album'e ekle</li>
                                    <li>genre_id deÄŸiÅŸirse â†’ eski genre'den Ã§Ä±kar, yeni genre'ye ekle</li>
                                </ul>
                            </div>
                            <div class="bg-green-900/20 border border-green-700 rounded p-3">
                                <strong class="text-green-400">âœ… deleted/forceDeleted:</strong>
                                <ul class="list-disc list-inside ml-4 mt-1 space-y-1">
                                    <li>Album: songs_count -1, total_duration -duration</li>
                                    <li>Genre: songs_count -1, total_duration -duration</li>
                                    <li>Artist: songs_count -1, total_duration -duration</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AlbumObserver -->
                <div class="bg-slate-900/50 border border-slate-700 rounded-lg p-6">
                    <h3 class="text-lg font-bold text-white mb-3 flex items-center gap-2">
                        <span class="text-green-400">âœ…</span>
                        AlbumObserver
                    </h3>
                    <div class="space-y-2 text-sm text-slate-300">
                        <p><strong>Dosya:</strong> <code class="bg-slate-800 px-2 py-1 rounded text-blue-300">Modules/Muzibu/App/Observers/AlbumObserver.php</code></p>
                        <p><strong>Event'ler:</strong> created, deleted, restored, forceDeleted</p>
                        <div class="mt-3 space-y-2">
                            <div class="bg-green-900/20 border border-green-700 rounded p-3">
                                <strong class="text-green-400">âœ… created:</strong>
                                <ul class="list-disc list-inside ml-4 mt-1">
                                    <li>Artist: albums_count +1</li>
                                </ul>
                            </div>
                            <div class="bg-green-900/20 border border-green-700 rounded p-3">
                                <strong class="text-green-400">âœ… deleted/forceDeleted:</strong>
                                <ul class="list-disc list-inside ml-4 mt-1">
                                    <li>Artist: albums_count -1</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PlaylistObserver -->
                <div class="bg-slate-900/50 border border-slate-700 rounded-lg p-6">
                    <h3 class="text-lg font-bold text-white mb-3 flex items-center gap-2">
                        <span class="text-yellow-400">âš ï¸</span>
                        PlaylistObserver
                    </h3>
                    <div class="space-y-2 text-sm text-slate-300">
                        <p><strong>Dosya:</strong> <code class="bg-slate-800 px-2 py-1 rounded text-blue-300">Modules/Muzibu/App/Observers/PlaylistObserver.php</code></p>
                        <p><strong>Event'ler:</strong> creating, created, updating, updated, saving, saved, deleting, deleted, restoring, restored, forceDeleting, forceDeleted</p>
                        <div class="mt-3">
                            <div class="bg-yellow-900/20 border border-yellow-700 rounded p-3">
                                <strong class="text-yellow-400">âš ï¸ Sorun:</strong>
                                <p class="mt-2">PlaylistObserver sadece cache temizleme yapÄ±yor. Playlist'e ÅŸarkÄ± eklendiÄŸinde/Ã§Ä±karÄ±ldÄ±ÄŸÄ±nda
                                <strong>songs_count ve total_duration OTOMATIK GÃœNCELLENMÄ°YOR!</strong></p>
                                <p class="mt-2">
                                    <strong>Sebep:</strong> Pivot tablo event'leri (attach/detach/sync) Observer'lar tarafÄ±ndan yakalanmÄ±yor.
                                    Laravel pivot event'leri emit etmiyor.
                                </p>
                                <p class="mt-2">
                                    <strong>Ã‡Ã¶zÃ¼m:</strong> Manuel methodlar kullanÄ±lmalÄ±:
                                </p>
                                <ul class="list-disc list-inside ml-4 mt-1 space-y-1">
                                    <li><code class="bg-slate-800 px-2 py-1 rounded">attachSongWithCache($song)</code></li>
                                    <li><code class="bg-slate-800 px-2 py-1 rounded">detachSongWithCache($song)</code></li>
                                    <li><code class="bg-slate-800 px-2 py-1 rounded">syncSongsWithCache($songIds)</code></li>
                                    <li><code class="bg-slate-800 px-2 py-1 rounded">attachManySongsWithCache($songIds)</code></li>
                                    <li><code class="bg-slate-800 px-2 py-1 rounded">detachManySongsWithCache($songIds)</code></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sorunlar ve Ã‡Ã¶zÃ¼mler -->
        <section class="mb-8">
            <h2 class="text-2xl font-bold text-white mb-4 flex items-center gap-2">
                <span>ğŸ”§</span>
                Tespit Edilen Sorunlar ve Ã‡Ã¶zÃ¼m Ã–nerileri
            </h2>

            <div class="space-y-4">
                <!-- Sorun 1 -->
                <div class="bg-red-900/20 border-l-4 border-red-600 rounded-r-lg p-6">
                    <div class="flex items-start gap-3">
                        <span class="text-2xl">âŒ</span>
                        <div class="flex-1">
                            <h3 class="text-lg font-bold text-red-400 mb-2">1. Playlist ÅarkÄ± Ekleme/Ã‡Ä±karma Otomatik DeÄŸil</h3>
                            <p class="text-slate-300 mb-3">
                                <strong>Sorun:</strong> Playlist'e ÅŸarkÄ± eklendiÄŸinde/Ã§Ä±karÄ±ldÄ±ÄŸÄ±nda songs_count ve total_duration
                                otomatik gÃ¼ncellenmiyor. Manuel methodlar kullanÄ±lmak zorunda.
                            </p>
                            <div class="bg-slate-900/50 rounded p-4 mb-3">
                                <strong class="text-blue-300">âŒ YanlÄ±ÅŸ KullanÄ±m:</strong>
                                <pre class="text-sm mt-2 text-slate-300 overflow-x-auto"><code>$playlist->songs()->attach($songId);  // Count'lar gÃ¼ncellenMÄ°YOR!</code></pre>
                            </div>
                            <div class="bg-slate-900/50 rounded p-4 mb-3">
                                <strong class="text-green-300">âœ… DoÄŸru KullanÄ±m:</strong>
                                <pre class="text-sm mt-2 text-slate-300 overflow-x-auto"><code>$playlist->attachSongWithCache($songId);  // Count'lar gÃ¼ncellenir</code></pre>
                            </div>
                            <p class="text-blue-300 mb-2"><strong>Ã‡Ã¶zÃ¼m Ã–nerileri:</strong></p>
                            <ul class="list-disc list-inside space-y-1 text-slate-300">
                                <li><strong>SeÃ§enek A:</strong> Custom Pivot Model oluÅŸtur (BelongsToMany withPivot ile) ve Pivot Model'e Observer ekle</li>
                                <li><strong>SeÃ§enek B:</strong> Playlist Model'de songs() iliÅŸkisini override et, attach/detach/sync methodlarÄ±nÄ± intercept et</li>
                                <li><strong>SeÃ§enek C:</strong> Her Playlist iÅŸleminde manuel methodlarÄ± kullanmaya devam et (mevcut durum)</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Sorun 2 -->
                <div class="bg-red-900/20 border-l-4 border-red-600 rounded-r-lg p-6">
                    <div class="flex items-start gap-3">
                        <span class="text-2xl">âŒ</span>
                        <div class="flex-1">
                            <h3 class="text-lg font-bold text-red-400 mb-2">2. Radio ve Sector'de Cache Sistemi Yok</h3>
                            <p class="text-slate-300 mb-3">
                                <strong>Sorun:</strong> Radio ve Sector tablolarÄ±nda songs_count ve total_duration field'larÄ± yok.
                                Her seferinde runtime'da hesaplama yapÄ±lÄ±yor (YAVAÅ!).
                            </p>
                            <div class="bg-slate-900/50 rounded p-4 mb-3">
                                <strong class="text-blue-300">Mevcut Durum:</strong>
                                <pre class="text-sm mt-2 text-slate-300 overflow-x-auto"><code>// Radio Model - Her Ã§aÄŸrÄ±da playlists'leri foreach ile dolaÅŸÄ±yor
public function getTotalDuration(): int {
    $totalSeconds = 0;
    foreach ($this->playlists as $playlist) {
        $totalSeconds += $playlist->getTotalDuration();
    }
    return $totalSeconds;
}</code></pre>
                            </div>
                            <p class="text-blue-300 mb-2"><strong>Ã‡Ã¶zÃ¼m Ã–nerisi:</strong></p>
                            <ul class="list-disc list-inside space-y-1 text-slate-300">
                                <li>Radio ve Sector tablolarÄ±na da songs_count ve total_duration field'larÄ±nÄ± ekle (migration)</li>
                                <li>HasCachedCounts trait'ini Radio ve Sector modellerine ekle</li>
                                <li>RadioObserver ve SectorObserver'lara cache gÃ¼ncelleme mantÄ±ÄŸÄ± ekle</li>
                                <li>Playlist deÄŸiÅŸikliklerinde Radio/Sector count'larÄ±nÄ± da gÃ¼ncelle</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Sorun 3 -->
                <div class="bg-yellow-900/20 border-l-4 border-yellow-600 rounded-r-lg p-6">
                    <div class="flex items-start gap-3">
                        <span class="text-2xl">âš ï¸</span>
                        <div class="flex-1">
                            <h3 class="text-lg font-bold text-yellow-400 mb-2">3. Bulk Ä°ÅŸlemlerde Performance Sorunu</h3>
                            <p class="text-slate-300 mb-3">
                                <strong>Sorun:</strong> attachManySongsWithCache ve detachManySongsWithCache methodlarÄ± her ÅŸarkÄ± iÃ§in
                                ayrÄ± ayrÄ± hesaplama yapÄ±yor. 100 ÅŸarkÄ± eklenirse 100 kez query Ã§alÄ±ÅŸÄ±r.
                            </p>
                            <div class="bg-slate-900/50 rounded p-4 mb-3">
                                <strong class="text-blue-300">Mevcut Kod:</strong>
                                <pre class="text-sm mt-2 text-slate-300 overflow-x-auto"><code>// Her ÅŸarkÄ± iÃ§in ayrÄ± query
$addedSongs = Song::whereIn('song_id', $newSongIds)
    ->where('is_active', true)
    ->get();
$addedCount = $addedSongs->count();
$addedDuration = (int) $addedSongs->sum('duration');</code></pre>
                            </div>
                            <p class="text-blue-300 mb-2"><strong>Ã‡Ã¶zÃ¼m Ã–nerisi:</strong></p>
                            <ul class="list-disc list-inside space-y-1 text-slate-300">
                                <li>Bulk iÅŸlemlerde tek query ile sum ve count hesapla</li>
                                <li>Transaction kullan (baÅŸarÄ±sÄ±zlÄ±kta rollback)</li>
                                <li>Queue job ile asenkron gÃ¼ncelleme (Ã§ok fazla ÅŸarkÄ± varsa)</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Kod Ã–rnekleri -->
        <section class="mb-8">
            <h2 class="text-2xl font-bold text-white mb-4 flex items-center gap-2">
                <span>ğŸ’»</span>
                KullanÄ±m SenaryolarÄ±
            </h2>

            <div class="space-y-4">
                <!-- Senaryo 1 -->
                <div class="bg-slate-900/50 border border-slate-700 rounded-lg p-6">
                    <h3 class="text-lg font-bold text-white mb-3">1. Yeni ÅarkÄ± Ekleme</h3>
                    <div class="bg-slate-800 rounded p-4">
                        <pre class="text-sm text-slate-300 overflow-x-auto"><code>// ÅarkÄ± oluÅŸtur
$song = Song::create([
    'album_id' => 5,
    'genre_id' => 3,
    'title' => ['tr' => 'Yeni ÅarkÄ±'],
    'duration' => 240, // 4 dakika
    'is_active' => true,
]);

// âœ… OTOMATIK: SongObserver tetiklenir
// - Album 5: songs_count +1, total_duration +240
// - Genre 3: songs_count +1, total_duration +240
// - Artist (Album 5'in sahibi): songs_count +1, total_duration +240</code></pre>
                    </div>
                </div>

                <!-- Senaryo 2 -->
                <div class="bg-slate-900/50 border border-slate-700 rounded-lg p-6">
                    <h3 class="text-lg font-bold text-white mb-3">2. Playlist'e ÅarkÄ± Ekleme</h3>
                    <div class="space-y-3">
                        <div>
                            <strong class="text-red-400">âŒ YANLIÅ (Count gÃ¼ncellenMÄ°YOR):</strong>
                            <div class="bg-slate-800 rounded p-4 mt-2">
                                <pre class="text-sm text-slate-300 overflow-x-auto"><code>$playlist = Playlist::find(10);
$playlist->songs()->attach($songId);  // Count'lar GÃœNCELLENMÄ°YOR!</code></pre>
                            </div>
                        </div>
                        <div>
                            <strong class="text-green-400">âœ… DOÄRU (Count gÃ¼ncellenir):</strong>
                            <div class="bg-slate-800 rounded p-4 mt-2">
                                <pre class="text-sm text-slate-300 overflow-x-auto"><code>$playlist = Playlist::find(10);
$playlist->attachSongWithCache($songId);  // songs_count ve total_duration gÃ¼ncellenir</code></pre>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Senaryo 3 -->
                <div class="bg-slate-900/50 border border-slate-700 rounded-lg p-6">
                    <h3 class="text-lg font-bold text-white mb-3">3. ÅarkÄ± SÃ¼resi DeÄŸiÅŸtirme</h3>
                    <div class="bg-slate-800 rounded p-4">
                        <pre class="text-sm text-slate-300 overflow-x-auto"><code>$song = Song::find(25);
$oldDuration = $song->duration; // 240 saniye
$song->duration = 300; // 5 dakika
$song->save();

// âœ… OTOMATIK: SongObserver tetiklenir
// Diff = 300 - 240 = +60 saniye
// - Album: total_duration +60
// - Genre: total_duration +60
// - Artist: total_duration +60</code></pre>
                    </div>
                </div>

                <!-- Senaryo 4 -->
                <div class="bg-slate-900/50 border border-slate-700 rounded-lg p-6">
                    <h3 class="text-lg font-bold text-white mb-3">4. ÅarkÄ±yÄ± FarklÄ± AlbÃ¼me TaÅŸÄ±ma</h3>
                    <div class="bg-slate-800 rounded p-4">
                        <pre class="text-sm text-slate-300 overflow-x-auto"><code>$song = Song::find(25);
$oldAlbumId = $song->album_id; // 5
$song->album_id = 8; // Yeni albÃ¼m
$song->save();

// âœ… OTOMATIK: SongObserver handleAlbumChange() tetiklenir
// Eski Album 5:
//   - songs_count -1
//   - total_duration -240
// Yeni Album 8:
//   - songs_count +1
//   - total_duration +240
// Eski ve yeni Artist'ler de gÃ¼ncellenir!</code></pre>
                    </div>
                </div>

                <!-- Senaryo 5 -->
                <div class="bg-slate-900/50 border border-slate-700 rounded-lg p-6">
                    <h3 class="text-lg font-bold text-white mb-3">5. Toplu Cache Yenileme (Null Olanlar)</h3>
                    <div class="bg-slate-800 rounded p-4">
                        <pre class="text-sm text-slate-300 overflow-x-auto"><code>// EÄŸer cache field'larÄ± NULL ise (henÃ¼z hesaplanmamÄ±ÅŸsa)
$album = Album::find(5);
if ($album->needsCachedCountRecalculation()) {
    $values = $album->recalculateCachedCounts();
    // ['songs_count' => 12, 'total_duration' => 2940]
}</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- Dosya LokasyonlarÄ± -->
        <section class="mb-8">
            <h2 class="text-2xl font-bold text-white mb-4 flex items-center gap-2">
                <span>ğŸ“</span>
                Ä°lgili Dosyalar
            </h2>

            <div class="bg-slate-900/50 border border-slate-700 rounded-lg p-6">
                <div class="space-y-3 text-sm">
                    <div>
                        <strong class="text-blue-300">Migration:</strong>
                        <code class="block bg-slate-800 px-3 py-2 rounded mt-1 text-slate-300">Modules/Muzibu/database/migrations/tenant/2025_12_26_200000_add_cache_count_fields_to_muzibu_tables.php</code>
                    </div>
                    <div>
                        <strong class="text-blue-300">Trait:</strong>
                        <code class="block bg-slate-800 px-3 py-2 rounded mt-1 text-slate-300">Modules/Muzibu/App/Traits/HasCachedCounts.php</code>
                    </div>
                    <div>
                        <strong class="text-blue-300">Model'ler:</strong>
                        <code class="block bg-slate-800 px-3 py-2 rounded mt-1 text-slate-300">Modules/Muzibu/App/Models/Playlist.php</code>
                        <code class="block bg-slate-800 px-3 py-2 rounded mt-1 text-slate-300">Modules/Muzibu/App/Models/Album.php</code>
                        <code class="block bg-slate-800 px-3 py-2 rounded mt-1 text-slate-300">Modules/Muzibu/App/Models/Genre.php</code>
                        <code class="block bg-slate-800 px-3 py-2 rounded mt-1 text-slate-300">Modules/Muzibu/App/Models/Artist.php</code>
                        <code class="block bg-slate-800 px-3 py-2 rounded mt-1 text-slate-300">Modules/Muzibu/App/Models/Song.php</code>
                        <code class="block bg-slate-800 px-3 py-2 rounded mt-1 text-slate-300">Modules/Muzibu/App/Models/Radio.php</code>
                    </div>
                    <div>
                        <strong class="text-blue-300">Observer'lar:</strong>
                        <code class="block bg-slate-800 px-3 py-2 rounded mt-1 text-slate-300">Modules/Muzibu/App/Observers/SongObserver.php</code>
                        <code class="block bg-slate-800 px-3 py-2 rounded mt-1 text-slate-300">Modules/Muzibu/App/Observers/AlbumObserver.php</code>
                        <code class="block bg-slate-800 px-3 py-2 rounded mt-1 text-slate-300">Modules/Muzibu/App/Observers/PlaylistObserver.php</code>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="mt-12 pt-6 border-t border-slate-800 text-center text-slate-400 text-sm">
            <p>ğŸ¤– Bu rapor <strong class="text-white">Claude Sonnet 4.5</strong> tarafÄ±ndan otomatik oluÅŸturulmuÅŸtur.</p>
            <p class="mt-2">ğŸ“… 11 Ocak 2026 - Muzibu Duration & Count Analizi v1</p>
        </footer>
    </div>
</body>
</html>