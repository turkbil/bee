<!DOCTYPE html>
<html lang="tr" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player Debug Sistemi - Muzibu.com</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        slate: {
                            850: '#1a202e',
                            900: '#0f1419',
                            950: '#0a0d12'
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-slate-950 text-slate-200 min-h-screen p-6">
    <div class="max-w-5xl mx-auto">
        <!-- Header -->
        <header class="mb-8 border-b border-slate-700 pb-6">
            <div class="flex items-center gap-3 mb-2">
                <span class="text-4xl">ğŸ”</span>
                <h1 class="text-3xl font-bold text-white">Player Debug Sistemi</h1>
            </div>
            <p class="text-slate-400 mt-2">MÃ¼zik Ã§alar debug log sistemi implementasyonu</p>
        </header>

        <!-- Ã–zet -->
        <section class="mb-8 bg-slate-900 rounded-lg p-6 border border-slate-800">
            <h2 class="text-xl font-semibold text-white mb-4 flex items-center gap-2">
                <span>ğŸ“‹</span> Ã–zet
            </h2>
            <div class="space-y-3 text-slate-300">
                <p>MÃ¼zik Ã§alarda Ã§alma durmasÄ±nÄ± analiz etmek iÃ§in kapsamlÄ± bir debug log sistemi eklendi.</p>
                <p><strong>Problem:</strong> Player'da 4-5 ÅŸarkÄ± Ã§aldÄ±ktan sonra bir ÅŸarkÄ±nÄ±n sonuna geldiÄŸinde Ã§alma duruyor ve Chrome console'da herhangi bir hata Ã§Ä±ktÄ±sÄ± yok.</p>
                <p><strong>Ã‡Ã¶zÃ¼m:</strong> ENV dosyasÄ±ndan kontrol edilen, renklendirilmiÅŸ konsol loglarÄ± ile her kritik fonksiyonda debug mesajlarÄ± eklendi.</p>
            </div>
        </section>

        <!-- Basit AnlatÄ±m -->
        <section class="mb-8 bg-slate-900 rounded-lg p-6 border border-slate-800">
            <h2 class="text-xl font-semibold text-white mb-4 flex items-center gap-2">
                <span>ğŸ“</span> Basit AnlatÄ±m
            </h2>
            <div class="space-y-4 text-slate-300">
                <div>
                    <h3 class="font-semibold text-white mb-2">Debug Sisteminin AmacÄ±</h3>
                    <p>MÃ¼zik Ã§alarÄ±mÄ±zda bazen ÅŸarkÄ± 4-5 tane Ã§aldÄ±ktan sonra bir anda duruyor. Ekrana da hata mesajÄ± Ã§Ä±kmadÄ±ÄŸÄ± iÃ§in nerede takÄ±ldÄ±ÄŸÄ±nÄ± anlayamÄ±yoruz. Bu yÃ¼zden oynatÄ±cÄ±nÄ±n her adÄ±mÄ±nÄ± kaydetmek iÃ§in bir sistem kurduk.</p>
                </div>

                <div>
                    <h3 class="font-semibold text-white mb-2">3 Seviye Debug Modu</h3>
                    <ul class="space-y-2 ml-4">
                        <li><strong class="text-green-400">0 - KapalÄ±:</strong> HiÃ§bir log Ã§Ä±kmaz (production - canlÄ± site iÃ§in)</li>
                        <li><strong class="text-yellow-400">1 - Root KullanÄ±cÄ±lar:</strong> Sadece admin kullanÄ±cÄ±lar loglarÄ± gÃ¶rÃ¼r</li>
                        <li><strong class="text-red-400">2 - TÃ¼m KullanÄ±cÄ±lar:</strong> Herkes loglarÄ± gÃ¶rÃ¼r (development - geliÅŸtirme iÃ§in)</li>
                    </ul>
                </div>

                <div>
                    <h3 class="font-semibold text-white mb-2">Hangi Olaylar LoglanÄ±yor?</h3>
                    <ul class="list-disc list-inside space-y-1 ml-4">
                        <li>ÅarkÄ± bittiÄŸinde (ENDED)</li>
                        <li>Sonraki ÅŸarkÄ±ya geÃ§erken (NEXT)</li>
                        <li>Queue (sÄ±ra) dolduÄŸunda (QUEUE)</li>
                        <li>ÅarkÄ± Ã§almaya baÅŸladÄ±ÄŸÄ±nda (PLAY)</li>
                        <li>Hata oluÅŸtuÄŸunda (ERROR)</li>
                        <li>Guard kontrolleri (GUARD - Ã¶rn: Ã§ok hÄ±zlÄ± tÄ±klama engelleme)</li>
                    </ul>
                </div>

                <div class="bg-slate-800 p-4 rounded-lg border border-slate-700">
                    <h3 class="font-semibold text-white mb-2">ğŸ’¡ KullanÄ±m Senaryosu</h3>
                    <p>KullanÄ±cÄ± ÅŸarkÄ± dinlerken problem yaÅŸarsa, biz ENV dosyasÄ±ndan <code class="text-cyan-400">PLAYER_DEBUG=2</code> yapÄ±p, kullanÄ±cÄ±dan Chrome Console'u aÃ§Ä±p screenshot gÃ¶ndermesini isteriz. BÃ¶ylece hangi adÄ±mda durduÄŸunu anlayabiliriz.</p>
                </div>
            </div>
        </section>

        <!-- Teknik Detaylar -->
        <section class="mb-8 bg-slate-900 rounded-lg p-6 border border-slate-800">
            <h2 class="text-xl font-semibold text-white mb-4 flex items-center gap-2">
                <span>ğŸ”§</span> Teknik Detaylar
            </h2>
            <div class="space-y-6 text-slate-300">
                <div>
                    <h3 class="font-semibold text-white mb-3">DeÄŸiÅŸtirilen Dosyalar</h3>
                    <div class="space-y-2">
                        <div class="bg-slate-800 p-3 rounded border border-slate-700 font-mono text-sm">
                            <div class="text-cyan-400 mb-1">.env</div>
                            <div class="text-slate-400">SatÄ±r 162: PLAYER_DEBUG=0 eklendi</div>
                        </div>
                        <div class="bg-slate-800 p-3 rounded border border-slate-700 font-mono text-sm">
                            <div class="text-cyan-400 mb-1">config/app.php</div>
                            <div class="text-slate-400">SatÄ±r 52: 'player_debug' config deÄŸeri eklendi</div>
                        </div>
                        <div class="bg-slate-800 p-3 rounded border border-slate-700 font-mono text-sm">
                            <div class="text-cyan-400 mb-1">resources/views/themes/muzibu/layouts/app.blade.php</div>
                            <div class="text-slate-400">SatÄ±r 93-102: PLAYER_DEBUG_LEVEL ve isRootUser deÄŸiÅŸkenleri eklendi</div>
                        </div>
                        <div class="bg-slate-800 p-3 rounded border border-slate-700 font-mono text-sm">
                            <div class="text-cyan-400 mb-1">public/themes/muzibu/js/player/core/player-core.js</div>
                            <div class="text-slate-400">
                                â€¢ SatÄ±r 83-126: playerDebug() global fonksiyonu eklendi<br>
                                â€¢ SatÄ±r 1561+: nextTrack() fonksiyonuna debug loglarÄ± eklendi<br>
                                â€¢ SatÄ±r 1700+: Queue refill mekanizmasÄ±na debug loglarÄ± eklendi<br>
                                â€¢ SatÄ±r 2508+: onTrackEnded() fonksiyonuna debug loglarÄ± eklendi<br>
                                â€¢ SatÄ±r 3516+: playSongFromQueue() fonksiyonuna debug loglarÄ± eklendi<br>
                                â€¢ SatÄ±r 5007+: Audio event handlers (onended, onerror, onstalled) debug loglarÄ± eklendi
                            </div>
                        </div>
                    </div>
                </div>

                <div>
                    <h3 class="font-semibold text-white mb-3">Debug Kategorileri ve Renkleri</h3>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="bg-slate-800 p-3 rounded border-l-4 border-red-500">
                            <div class="font-mono text-red-400">ENDED</div>
                            <div class="text-sm text-slate-400">ÅarkÄ± bitti olaylarÄ±</div>
                        </div>
                        <div class="bg-slate-800 p-3 rounded border-l-4 border-cyan-500">
                            <div class="font-mono text-cyan-400">NEXT</div>
                            <div class="text-sm text-slate-400">Sonraki ÅŸarkÄ±ya geÃ§iÅŸ</div>
                        </div>
                        <div class="bg-slate-800 p-3 rounded border-l-4 border-green-400">
                            <div class="font-mono text-green-400">QUEUE</div>
                            <div class="text-sm text-slate-400">SÄ±ra iÅŸlemleri</div>
                        </div>
                        <div class="bg-slate-800 p-3 rounded border-l-4 border-green-500">
                            <div class="font-mono text-green-500">PLAY</div>
                            <div class="text-sm text-slate-400">Ã‡alma baÅŸlatma</div>
                        </div>
                        <div class="bg-slate-800 p-3 rounded border-l-4 border-red-600">
                            <div class="font-mono text-red-600">ERROR</div>
                            <div class="text-sm text-slate-400">Hata durumlarÄ±</div>
                        </div>
                        <div class="bg-slate-800 p-3 rounded border-l-4 border-purple-500">
                            <div class="font-mono text-purple-500">SPOT</div>
                            <div class="text-sm text-slate-400">Reklam oynatma</div>
                        </div>
                        <div class="bg-slate-800 p-3 rounded border-l-4 border-blue-400">
                            <div class="font-mono text-blue-400">HLS</div>
                            <div class="text-sm text-slate-400">HLS stream olaylarÄ±</div>
                        </div>
                        <div class="bg-slate-800 p-3 rounded border-l-4 border-pink-500">
                            <div class="font-mono text-pink-500">GUARD</div>
                            <div class="text-sm text-slate-400">Koruma mekanizmalarÄ±</div>
                        </div>
                    </div>
                </div>

                <div>
                    <h3 class="font-semibold text-white mb-3">Ã–rnek Debug Ã‡Ä±ktÄ±sÄ±</h3>
                    <div class="bg-slate-950 p-4 rounded border border-slate-700 font-mono text-xs space-y-1 overflow-x-auto">
                        <div class="text-red-400">[12:34:56.789] [PLAYER:ENDED] onTrackEnded() CALLED { isPlaying: true, currentSong: "Song Title" }</div>
                        <div class="text-red-400">[12:34:56.790] [PLAYER:ENDED] onTrackEnded proceeding to nextTrack()</div>
                        <div class="text-cyan-400">[12:34:56.791] [PLAYER:NEXT] nextTrack() CALLED { fromNaturalEnd: true, queueIndex: 3 }</div>
                        <div class="text-cyan-400">[12:34:56.792] [PLAYER:NEXT] Has next song in queue { nextIndex: 4 }</div>
                        <div class="text-green-500">[12:34:56.850] [PLAYER:PLAY] playSongFromQueue() CALLED { index: 4, autoplay: true }</div>
                        <div class="text-green-500">[12:34:56.851] [PLAYER:PLAY] Setting currentSong and starting playback</div>
                    </div>
                </div>

                <div>
                    <h3 class="font-semibold text-white mb-3">Kod Ã–rneÄŸi: playerDebug Fonksiyonu</h3>
                    <div class="bg-slate-950 p-4 rounded border border-slate-700">
                        <pre class="text-xs overflow-x-auto"><code class="language-javascript">window.playerDebug = function(category, message, data = {}) {
    // Debug kapalÄ±ysa hiÃ§bir ÅŸey yapma
    if (window.PLAYER_DEBUG_LEVEL === 0) {
        return;
    }

    // Seviye 1: Sadece root kullanÄ±cÄ±lar
    if (window.PLAYER_DEBUG_LEVEL === 1) {
        if (!window.isRootUser) {
            return;
        }
    }

    // Timestamp + kategori + mesaj
    const timestamp = new Date().toISOString().substring(11, 23);
    const prefix = `[${timestamp}] [PLAYER:${category}]`;

    // Kategori bazlÄ± renklendirme
    const colors = {
        'ENDED': 'color: #ff6b6b; font-weight: bold;',
        'NEXT': 'color: #4ecdc4; font-weight: bold;',
        'ERROR': 'color: #ff0000; font-weight: bold;'
        // ... diÄŸer kategoriler
    };

    console.log(`%c${prefix} ${message}`, colors[category], data);
};</code></pre>
                    </div>
                </div>

                <div>
                    <h3 class="font-semibold text-white mb-3">KullanÄ±m Ã–rneÄŸi</h3>
                    <div class="bg-slate-950 p-4 rounded border border-slate-700">
                        <pre class="text-xs overflow-x-auto"><code class="language-javascript">// Fonksiyon baÅŸÄ±nda
playerDebug('NEXT', 'nextTrack() CALLED', {
    fromNaturalEnd: true,
    queueIndex: this.queueIndex,
    currentSong: this.currentSong?.title
});

// Guard kontrolÃ¼
if (this._nextTrackInProgress) {
    playerDebug('GUARD', 'nextTrack BLOCKED - already in progress');
    return;
}

// Hata durumu
if (!this.queue || this.queue.length === 0) {
    playerDebug('ERROR', 'No queue available - stopping playback');
    return;
}</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- KullanÄ±m KÄ±lavuzu -->
        <section class="mb-8 bg-slate-900 rounded-lg p-6 border border-slate-800">
            <h2 class="text-xl font-semibold text-white mb-4 flex items-center gap-2">
                <span>ğŸ“–</span> KullanÄ±m KÄ±lavuzu
            </h2>
            <div class="space-y-6 text-slate-300">
                <div>
                    <h3 class="font-semibold text-white mb-3">1. Debug Modunu AÃ§ma</h3>
                    <div class="bg-slate-950 p-4 rounded border border-slate-700 font-mono text-sm">
                        <div class="text-slate-400"># .env dosyasÄ±nÄ± dÃ¼zenle</div>
                        <div class="text-green-400">PLAYER_DEBUG=2  # TÃ¼m kullanÄ±cÄ±lar iÃ§in aÃ§Ä±k</div>
                        <div class="text-slate-500 mt-2"># Veya</div>
                        <div class="text-yellow-400">PLAYER_DEBUG=1  # Sadece root kullanÄ±cÄ±lar iÃ§in</div>
                    </div>
                </div>

                <div>
                    <h3 class="font-semibold text-white mb-3">2. Cache Temizleme</h3>
                    <div class="bg-slate-950 p-4 rounded border border-slate-700 font-mono text-sm">
                        <div class="text-cyan-400">/opt/plesk/php/8.3/bin/php artisan config:clear</div>
                        <div class="text-cyan-400">/opt/plesk/php/8.3/bin/php artisan config:cache</div>
                        <div class="text-cyan-400">/opt/plesk/php/8.3/bin/php artisan view:clear</div>
                    </div>
                    <p class="text-sm text-slate-400 mt-2">Not: Config deÄŸiÅŸikliÄŸi anÄ±nda aktif olur, cache temizleme opsiyoneldir.</p>
                </div>

                <div>
                    <h3 class="font-semibold text-white mb-3">3. Chrome Console'da LoglarÄ± GÃ¶rme</h3>
                    <ol class="list-decimal list-inside space-y-2 ml-4">
                        <li>Chrome'da siteyi aÃ§</li>
                        <li>F12 tuÅŸuna bas veya saÄŸ tÄ±k â†’ Inspect</li>
                        <li>Console sekmesine geÃ§</li>
                        <li>MÃ¼zik Ã§almaya baÅŸla</li>
                        <li>Renkli [PLAYER:XXX] loglarÄ±nÄ± gÃ¶r</li>
                    </ol>
                </div>

                <div>
                    <h3 class="font-semibold text-white mb-3">4. Debug Modunu Kapatma</h3>
                    <div class="bg-slate-950 p-4 rounded border border-slate-700 font-mono text-sm">
                        <div class="text-slate-400"># Production'da mutlaka kapat</div>
                        <div class="text-red-400">PLAYER_DEBUG=0</div>
                    </div>
                    <div class="bg-yellow-900/30 border border-yellow-700 p-3 rounded mt-3">
                        <p class="text-yellow-400 text-sm">âš ï¸ Dikkat: Production ortamÄ±nda PLAYER_DEBUG=2 kullanmayÄ±n! Performans kaybÄ± ve kullanÄ±cÄ± console'unda karmaÅŸa yaratÄ±r.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Problem Analizi -->
        <section class="mb-8 bg-slate-900 rounded-lg p-6 border border-slate-800">
            <h2 class="text-xl font-semibold text-white mb-4 flex items-center gap-2">
                <span>ğŸ›</span> Problem Analizi Ä°Ã§in Log NoktalarÄ±
            </h2>
            <div class="space-y-4 text-slate-300">
                <div>
                    <h3 class="font-semibold text-white mb-2">ÅarkÄ± Durma Problemini Tespit Etmek Ä°Ã§in</h3>
                    <p class="mb-3">Debug loglarÄ± ile ÅŸu sorularÄ±n cevaplarÄ±nÄ± bulabiliriz:</p>
                    <ul class="space-y-2 ml-4">
                        <li class="flex items-start gap-2">
                            <span class="text-cyan-400">1.</span>
                            <div>
                                <strong>onTrackEnded() Ã§aÄŸrÄ±lÄ±yor mu?</strong>
                                <div class="text-sm text-slate-400">ÅarkÄ± bitiÅŸi tespit edilemiyor olabilir</div>
                            </div>
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="text-cyan-400">2.</span>
                            <div>
                                <strong>nextTrack() fonksiyonu Ã§alÄ±ÅŸÄ±yor mu?</strong>
                                <div class="text-sm text-slate-400">Guard mekanizmalarÄ± yanlÄ±ÅŸlÄ±kla engelliyor olabilir</div>
                            </div>
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="text-cyan-400">3.</span>
                            <div>
                                <strong>Queue'da sonraki ÅŸarkÄ± var mÄ±?</strong>
                                <div class="text-sm text-slate-400">Queue doldurulamÄ±yor olabilir</div>
                            </div>
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="text-cyan-400">4.</span>
                            <div>
                                <strong>playSongFromQueue() Ã§aÄŸrÄ±lÄ±yor mu?</strong>
                                <div class="text-sm text-slate-400">Sonraki ÅŸarkÄ± yÃ¼klenememiÅŸ olabilir</div>
                            </div>
                        </li>
                        <li class="flex items-start gap-2">
                            <span class="text-cyan-400">5.</span>
                            <div>
                                <strong>Audio onerror veya onstalled tetikleniyor mu?</strong>
                                <div class="text-sm text-slate-400">Stream yÃ¼kleme hatasÄ± olabilir</div>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="text-center text-slate-500 text-sm pt-8 border-t border-slate-800">
            28 Ocak 2026 â€¢ Muzibu.com
        </footer>
    </div>
</body>
</html>