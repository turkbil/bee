<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”´ Settings Cache Sorunu - N+1 Query Analizi</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            line-height: 1.7;
            padding: 40px 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            margin-bottom: 50px;
            padding-bottom: 30px;
            border-bottom: 2px solid #334155;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #f59e0b, #ea580c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .meta {
            color: #94a3b8;
            font-size: 0.95rem;
        }

        .alert {
            background: linear-gradient(135deg, #ea580c 0%, #c2410c 100%);
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 40px;
            border-left: 6px solid #fed7aa;
        }

        .alert h2 {
            color: #fed7aa;
            font-size: 1.8rem;
            margin-bottom: 15px;
        }

        .alert p {
            color: #fef3c7;
            font-size: 1.1rem;
            line-height: 1.8;
        }

        section {
            margin-bottom: 40px;
        }

        h2 {
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: #60a5fa;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        h3 {
            color: #60a5fa;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .problem-box {
            background: rgba(234, 88, 12, 0.15);
            padding: 25px;
            margin-bottom: 20px;
            border-radius: 12px;
            border-left: 4px solid #ea580c;
            backdrop-filter: blur(10px);
        }

        .solution-box {
            background: rgba(34, 197, 94, 0.15);
            padding: 25px;
            margin-bottom: 20px;
            border-radius: 12px;
            border-left: 4px solid #22c55e;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .solution-box:hover {
            transform: translateX(5px);
            background: rgba(34, 197, 94, 0.25);
        }

        .info-box {
            background: rgba(59, 130, 246, 0.15);
            padding: 25px;
            margin-bottom: 20px;
            border-radius: 12px;
            border-left: 4px solid #3b82f6;
            backdrop-filter: blur(10px);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: rgba(30, 41, 59, 0.5);
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .stat-value.bad { color: #ef4444; }
        .stat-value.warning { color: #f59e0b; }
        .stat-value.good { color: #22c55e; }

        .stat-label {
            color: #94a3b8;
            font-size: 0.9rem;
        }

        .query-list {
            background: #1e293b;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            overflow-x: auto;
            border: 1px solid #334155;
        }

        .query-item {
            padding: 10px;
            margin: 5px 0;
            background: rgba(59, 130, 246, 0.1);
            border-left: 3px solid #3b82f6;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
        }

        .query-item.duplicate {
            background: rgba(239, 68, 68, 0.1);
            border-left-color: #ef4444;
        }

        .count {
            display: inline-block;
            background: #ef4444;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 10px;
        }

        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .comparison-item {
            padding: 20px;
            border-radius: 8px;
        }

        .comparison-item.before {
            background: rgba(239, 68, 68, 0.15);
            border: 2px solid #ef4444;
        }

        .comparison-item.after {
            background: rgba(34, 197, 94, 0.15);
            border: 2px solid #22c55e;
        }

        .tech-term {
            color: #fbbf24;
            font-weight: 500;
        }

        .explanation {
            display: inline-block;
            margin-left: 5px;
            color: #94a3b8;
            font-size: 0.9rem;
        }

        ul {
            list-style: none;
            padding-left: 0;
        }

        ul li {
            padding: 10px 0;
            padding-left: 30px;
            position: relative;
        }

        ul li:before {
            content: "â†’";
            position: absolute;
            left: 0;
            color: #60a5fa;
            font-weight: bold;
        }

        .priority {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-left: 10px;
        }

        .priority-critical { background: #dc2626; color: white; }
        .priority-high { background: #f59e0b; color: white; }

        footer {
            margin-top: 60px;
            padding-top: 30px;
            border-top: 1px solid #334155;
            color: #64748b;
            font-size: 0.9rem;
            text-align: center;
        }

        @media (max-width: 768px) {
            .comparison {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ”´ Settings Cache Sorunu</h1>
            <div class="meta">
                ğŸ“… Tarih: 2025-11-30 17:10 |
                ğŸ¯ Tenant: ixtif.com (Tenant 2) |
                ğŸ‘¤ Kaynak: a-html.txt debug Ã§Ä±ktÄ±sÄ± |
                ğŸŒ URL: Homepage (/)
            </div>
        </header>

        <div class="alert">
            <h2>âš ï¸ N+1 QUERY SORUNU TESPÄ°T EDÄ°LDÄ°</h2>
            <p>
                Homepage'de <strong>89 query</strong> Ã§alÄ±ÅŸÄ±yor ve <strong>74 tanesi duplicate</strong>!
                Settings cache sistemi Ã§alÄ±ÅŸmÄ±yor, her <code>setting()</code> Ã§aÄŸrÄ±sÄ± database'e gidiyor.
            </p>
        </div>

        <section>
            <h2>ğŸ“Š Mevcut Durum</h2>

            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value bad">89</div>
                    <div class="stat-label">Total Query SayÄ±sÄ±</div>
                </div>

                <div class="stat-card">
                    <div class="stat-value bad">74</div>
                    <div class="stat-label">Duplicate Query</div>
                </div>

                <div class="stat-card">
                    <div class="stat-value warning">214ms</div>
                    <div class="stat-label">Total Query SÃ¼resi</div>
                </div>

                <div class="stat-card">
                    <div class="stat-value warning">~4.5s</div>
                    <div class="stat-label">Sayfa YÃ¼kleme</div>
                </div>
            </div>

            <div class="info-box">
                <h3>âœ… Ä°yi Haber: Session Sorunu Ã‡Ã¶zÃ¼ldÃ¼!</h3>
                <ul>
                    <li>Session delete: 16.8s â†’ 0ms âœ…</li>
                    <li>Session update: 5s â†’ 0ms âœ…</li>
                    <li>Redis driver aktif âœ…</li>
                    <li>Total sÃ¼re: 23.3s â†’ 4.5s (5x hÄ±zlanma) âœ…</li>
                </ul>
            </div>
        </section>

        <section>
            <h2>ğŸ” Tekrarlanan Query'ler (N+1 Problemi)</h2>

            <div class="problem-box">
                <h3>1. site_title <span class="count">6x TEKRAR</span></h3>
                <div class="query-list">
                    <div class="query-item duplicate">
                        SELECT * FROM settings WHERE key = 'site_title' AND is_active = 1 LIMIT 1
                    </div>
                </div>
                <p>
                    <span class="tech-term">site_title</span> ayarÄ± 6 farklÄ± yerde Ã§aÄŸrÄ±lÄ±yor:
                    header, footer, meta tags, breadcrumb, title tag, copyright
                </p>
                <p><strong>Sebep:</strong> Her Ã§aÄŸrÄ±da database'e gidiyor, cache kullanÄ±lmÄ±yor!</p>
            </div>

            <div class="problem-box">
                <h3>2. site_logo <span class="count">4x TEKRAR</span></h3>
                <div class="query-list">
                    <div class="query-item duplicate">
                        SELECT * FROM settings WHERE key = 'site_logo' AND is_active = 1 LIMIT 1
                    </div>
                </div>
                <p>Logo ayarÄ± header'da 4 farklÄ± yerde Ã§aÄŸrÄ±lÄ±yor (desktop, mobile, sticky, footer)</p>
            </div>

            <div class="problem-box">
                <h3>3. site_kontrast_logo <span class="count">3x TEKRAR</span></h3>
                <div class="query-list">
                    <div class="query-item duplicate">
                        SELECT * FROM settings WHERE key = 'site_kontrast_logo' AND is_active = 1 LIMIT 1
                    </div>
                </div>
            </div>

            <div class="problem-box">
                <h3>4. settings_values <span class="count">7+ x TEKRAR</span></h3>
                <div class="query-list">
                    <div class="query-item duplicate">
                        SELECT * FROM settings_values WHERE setting_id = 1 LIMIT 1
                    </div>
                </div>
                <p>AynÄ± setting value'su defalarca sorgulanÄ±yor!</p>
            </div>
        </section>

        <section>
            <h2>ğŸ’¡ KÃ¶k Neden Analizi</h2>

            <div class="info-box">
                <h3>Neden Cache Ã‡alÄ±ÅŸmÄ±yor?</h3>
                <p>
                    CLAUDE.md'de belirtildiÄŸine gÃ¶re daha Ã¶nce
                    <span class="tech-term">Settings global cache</span> optimizasyonu yapÄ±lmÄ±ÅŸ
                    (700+ query â†’ 2 query).
                </p>

                <p style="margin-top: 15px;">
                    <strong>Ancak ÅŸu anda bu cache Ã§alÄ±ÅŸmÄ±yor!</strong>
                </p>

                <p style="margin-top: 15px;"><strong>OlasÄ± Sebepler:</strong></p>
                <ul>
                    <li>Cache sÃ¼resi dolmuÅŸ olabilir</li>
                    <li>Cache key'leri yanlÄ±ÅŸ hesaplanÄ±yor olabilir</li>
                    <li>Redis cache Ã§alÄ±ÅŸmÄ±yor olabilir (settings iÃ§in)</li>
                    <li>Helper fonksiyonu cache'i atlamÄ±ÅŸ olabilir</li>
                    <li>Tenant bazlÄ± cache key'leri dÃ¼zgÃ¼n Ã§alÄ±ÅŸmÄ±yor olabilir</li>
                </ul>
            </div>

            <div class="problem-box">
                <h3>Helper Fonksiyonu: setting()</h3>
                <p>
                    Konum: <code>Modules/SettingManagement/app/Helpers/setting_helpers.php</code>
                </p>
                <p>
                    Bu fonksiyon her Ã§aÄŸrÄ±ldÄ±ÄŸÄ±nda database'e gidiyor.
                    Oysa <span class="tech-term">global cache</span> kullanmalÄ±!
                </p>

                <p style="margin-top: 15px;"><strong>Beklenen DavranÄ±ÅŸ:</strong></p>
                <ul>
                    <li>Ä°lk Ã§aÄŸrÄ±da tÃ¼m settings'leri cache'e al (tek query)</li>
                    <li>Sonraki Ã§aÄŸrÄ±larda cache'den Ã§ek (0 query)</li>
                    <li>Cache sÃ¼resince database'e gitme!</li>
                </ul>
            </div>
        </section>

        <section>
            <h2>âœ… Ã‡Ã¶zÃ¼m Stratejisi</h2>

            <div class="solution-box">
                <h3>1. Settings Helper'Ä± Ä°ncele <span class="priority priority-critical">KRÄ°TÄ°K</span></h3>
                <p>
                    <code>Modules/SettingManagement/app/Helpers/setting_helpers.php</code> dosyasÄ±nÄ± kontrol et:
                </p>
                <ul>
                    <li>Cache mantÄ±ÄŸÄ± var mÄ±?</li>
                    <li>Cache key doÄŸru mu?</li>
                    <li>Tenant bazlÄ± cache Ã§alÄ±ÅŸÄ±yor mu?</li>
                    <li>Cache sÃ¼resi ne kadar?</li>
                </ul>
            </div>

            <div class="solution-box">
                <h3>2. Global Settings Cache Ekle <span class="priority priority-critical">KRÄ°TÄ°K</span></h3>
                <p>
                    EÄŸer cache yoksa veya bozuksa, ÅŸu mantÄ±ÄŸÄ± uygula:
                </p>

                <ul>
                    <li>Request baÅŸÄ±nda tÃ¼m settings'leri Ã§ek (tek query)</li>
                    <li>Memory'de sakla (static array veya cache)</li>
                    <li>setting() her Ã§aÄŸrÄ±ldÄ±ÄŸÄ±nda memory'den dÃ¶n</li>
                    <li>Cache lifetime: 1 saat veya kalÄ±cÄ± (settings nadiren deÄŸiÅŸir)</li>
                </ul>

                <p style="margin-top: 15px;"><strong>Beklenen SonuÃ§:</strong></p>
                <div class="comparison">
                    <div class="comparison-item before">
                        <strong>âŒ ÅÄ°MDÄ°:</strong><br>
                        site_title â†’ 6 query<br>
                        site_logo â†’ 4 query<br>
                        Toplam: 74 duplicate query
                    </div>
                    <div class="comparison-item after">
                        <strong>âœ… SONRA:</strong><br>
                        TÃ¼m settings â†’ 1 query (ilk Ã§aÄŸrÄ±)<br>
                        Sonraki Ã§aÄŸrÄ±lar â†’ 0 query<br>
                        <strong>~85-95% azalma!</strong>
                    </div>
                </div>
            </div>

            <div class="solution-box">
                <h3>3. AppServiceProvider'da Global Cache <span class="priority priority-high">YÃœKSEK</span></h3>
                <p>
                    Alternatif Ã§Ã¶zÃ¼m: Settings'leri AppServiceProvider::boot()'da yÃ¼kle
                </p>
                <ul>
                    <li>Boot metodunda tÃ¼m settings'leri Ã§ek</li>
                    <li>Cache'e veya config'e yaz</li>
                    <li>Helper fonksiyonu config'den oku</li>
                </ul>
            </div>

            <div class="solution-box">
                <h3>4. View Composer Kullan <span class="priority priority-high">YÃœKSEK</span></h3>
                <p>
                    TÃ¼m view'lerde kullanÄ±lan settings'leri View Composer ile paylaÅŸ
                </p>
                <ul>
                    <li>Tek sorguda tÃ¼m common settings'leri Ã§ek</li>
                    <li>TÃ¼m view'lere otomatik inject et</li>
                    <li>Helper Ã§aÄŸrÄ±sÄ±na gerek kalmaz</li>
                </ul>
            </div>
        </section>

        <section>
            <h2>ğŸ“ˆ Beklenen Ä°yileÅŸme</h2>

            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value good">89 â†’ ~10</div>
                    <div class="stat-label">Query SayÄ±sÄ± (%90 azalma)</div>
                </div>

                <div class="stat-card">
                    <div class="stat-value good">74 â†’ ~0</div>
                    <div class="stat-label">Duplicate Query (%100 azalma)</div>
                </div>

                <div class="stat-card">
                    <div class="stat-value good">214ms â†’ ~50ms</div>
                    <div class="stat-label">Query SÃ¼resi (%75 azalma)</div>
                </div>

                <div class="stat-card">
                    <div class="stat-value good">4.5s â†’ ~2s</div>
                    <div class="stat-label">Sayfa YÃ¼kleme (2x hÄ±zlanma)</div>
                </div>
            </div>

            <div class="comparison">
                <div class="comparison-item before">
                    <h3>âŒ ÅÄ°MDÄ°</h3>
                    <ul>
                        <li>89 query (74 duplicate)</li>
                        <li>214ms query sÃ¼resi</li>
                        <li>4.5s sayfa yÃ¼kleme</li>
                        <li>Her setting Ã§aÄŸrÄ±sÄ± â†’ DB query</li>
                    </ul>
                </div>

                <div class="comparison-item after">
                    <h3>âœ… CACHE SONRASI</h3>
                    <ul>
                        <li>~10 query (0 duplicate)</li>
                        <li>~50ms query sÃ¼resi</li>
                        <li>~2s sayfa yÃ¼kleme (hedef!)</li>
                        <li>Settings â†’ Memory/Cache'den</li>
                    </ul>
                </div>
            </div>
        </section>

        <section>
            <h2>ğŸ¯ Sonraki AdÄ±mlar</h2>

            <div class="solution-box">
                <h3>AdÄ±m 1: Helper DosyasÄ±nÄ± Ä°ncele</h3>
                <ul>
                    <li>setting_helpers.php'yi oku</li>
                    <li>Cache mantÄ±ÄŸÄ±nÄ± kontrol et</li>
                    <li>Neden Ã§alÄ±ÅŸmadÄ±ÄŸÄ±nÄ± tespit et</li>
                </ul>
            </div>

            <div class="solution-box">
                <h3>AdÄ±m 2: Cache Sistemini DÃ¼zelt veya Ekle</h3>
                <ul>
                    <li>Global settings cache ekle</li>
                    <li>Helper fonksiyonunu gÃ¼ncelle</li>
                    <li>Tenant bazlÄ± cache key'leri dÃ¼zelt</li>
                </ul>
            </div>

            <div class="solution-box">
                <h3>AdÄ±m 3: Test Et</h3>
                <ul>
                    <li>Homepage'i yenile</li>
                    <li>a-html.txt'yi kontrol et</li>
                    <li>Query sayÄ±sÄ±nÄ±n dÃ¼ÅŸtÃ¼ÄŸÃ¼nÃ¼ onayla</li>
                    <li>Duplicate query'lerin kaybolduÄŸunu doÄŸrula</li>
                </ul>
            </div>
        </section>

        <footer>
            ğŸ¤– Claude AI tarafÄ±ndan oluÅŸturuldu | 2025-11-30
        </footer>
    </div>
</body>
</html>
