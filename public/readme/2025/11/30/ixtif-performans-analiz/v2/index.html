<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ixtif.com Performans Analizi - DetaylÄ± Rapor (v2)</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: radial-gradient(circle at 20% 20%, rgba(96,165,250,0.08), transparent 40%), radial-gradient(circle at 80% 10%, rgba(94,234,212,0.08), transparent 35%), linear-gradient(135deg, #0b1224 0%, #111827 60%, #0f172a 100%); color: #e2e8f0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif; line-height: 1.7; padding: 42px 20px; }
        .container { max-width: 1140px; margin: 0 auto; }
        header { margin-bottom: 40px; padding-bottom: 24px; border-bottom: 1px solid #1f2937; }
        h1 { font-size: 2.6rem; font-weight: 800; margin-bottom: 12px; background: linear-gradient(135deg, #60a5fa, #22d3ee); -webkit-background-clip: text; -webkit-text-fill-color: transparent; letter-spacing: -0.02em; }
        .meta { color: #94a3b8; font-size: 0.95rem; }
        section { margin-bottom: 34px; }
        h2 { font-size: 1.6rem; margin-bottom: 16px; color: #7dd3fc; display: inline-flex; align-items: center; gap: 10px; letter-spacing: -0.01em; }
        .panel { background: rgba(17, 24, 39, 0.7); border: 1px solid #1f2937; border-radius: 14px; padding: 20px; margin-bottom: 12px; backdrop-filter: blur(8px); box-shadow: 0 10px 30px rgba(0,0,0,0.25); }
        .pill { display: inline-block; padding: 5px 12px; border-radius: 999px; font-size: 0.8rem; border: 1px solid #334155; background: #0f172a; color: #cbd5e1; margin-right: 8px; }
        ul { margin-left: 18px; color: #cbd5e1; }
        li { margin-bottom: 6px; }
        .plan-item { background: rgba(30,41,59,0.7); padding: 20px; border-radius: 12px; border-left: 4px solid #38bdf8; margin-bottom: 12px; }
        .plan-item h3 { margin-bottom: 8px; font-size: 1.2rem; color: #e0f2fe; display: flex; align-items: center; gap: 10px; }
        .priority { padding: 4px 12px; border-radius: 10px; font-size: 0.8rem; font-weight: 700; }
        .priority-high { background: #dc2626; color: #fff; }
        .priority-medium { background: #f59e0b; color: #fff; }
        .priority-low { background: #10b981; color: #fff; }
        .grid { display: grid; gap: 12px; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); }
        .card { background: rgba(15,23,42,0.7); border: 1px solid #1f2937; border-radius: 12px; padding: 16px; }
        .card h4 { color: #bae6fd; margin-bottom: 8px; font-size: 1rem; }
        .badge { display: inline-block; padding: 3px 10px; border-radius: 9px; font-size: 0.78rem; background: #1f2937; color: #93c5fd; border: 1px solid #334155; }
        .muted { color: #94a3b8; font-size: 0.9rem; }
        footer { margin-top: 46px; padding-top: 22px; border-top: 1px solid #1f2937; color: #64748b; font-size: 0.9rem; text-align: center; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“Š ixtif.com Performans Analizi</h1>
            <div class="meta">ğŸ“… Tarih: 2025-11-30 03:38 | ğŸ¯ Tenant: ixtif.com | ğŸ‘¤ Talep: AÅŸÄ±rÄ± yavaÅŸlÄ±k iÃ§in detaylÄ± kÃ¶k neden ve aksiyon planÄ±</div>
        </header>

        <section>
            <h2>ğŸš¦ DetaylÄ± Durum Ã–zeti</h2>
            <div class="panel">
                <div class="grid">
                    <div class="card">
                        <h4>CPU & SÃ¼reÃ§ YoÄŸunluÄŸu</h4>
                        <ul>
                            <li>Load average: 16.95 / 15.14 / 14.92 (Ã§ok yÃ¼ksek).</li>
                            <li>Aktif Horizon worker sayÄ±sÄ±: 14 adet (ek olarak birden fazla master).</li>
                            <li>En yÃ¼ksek CPU kullananlar: artisan horizon:work sÃ¼reÃ§leri %10-16 arasÄ±; Ã¼st sÄ±ralar tamamen queue worker'lar.</li>
                        </ul>
                    </div>
                    <div class="card">
                        <h4>Horizon Ã‡oÄŸalma Sorunu</h4>
                        <ul>
                            <li>ps Ã§Ä±ktÄ±sÄ± birden Ã§ok master seti gÃ¶steriyor (ZkT3, yZ59, rwGp, 6KJ6, heML, HKPJ, OLr0 ve daha fazlasÄ±).</li>
                            <li>queue:health-check komutu her dakika Ã§alÄ±ÅŸÄ±yor, QueueHealthService iÃ§inde nohup ile Horizon baÅŸlatÄ±yor â†’ sÃ¼reÃ§ler kapanmadan katlanÄ±yor.</li>
                            <li>AutoQueueHealthCheck middleware admin trafiÄŸinde dispatch ediyor; queue:ensure-workers (docker) de cronâ€™dan Ã§alÄ±ÅŸÄ±yor.</li>
                        </ul>
                    </div>
                    <div class="card">
                        <h4>VeritabanÄ±</h4>
                        <ul>
                            <li>tenant-resource-tracking.log: SQLSTATE[HY000] [1040] Too many connections (tenants tablosu okurken).</li>
                            <li>Slow queries: module_tenants join 145 ms (tenant_id + is_active filtreli), Pulse insert batch 111 ms.</li>
                        </ul>
                    </div>
                    <div class="card">
                        <h4>Debug / Ä°zleme AraÃ§larÄ±</h4>
                        <ul>
                            <li>APP_DEBUG = true, APP_DEBUG_TOOLS = true (prod'da aÃ§Ä±k).</li>
                            <li>Debugbar aktif ve storage/debugbar = 1.6 GB.</li>
                            <li>Pulse & Telescope env Ã¼zerinden aÃ§Ä±k; Pulse her istekte pulse_entries'e yazÄ±yor.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <section>
            <h2>ğŸ” KÃ¶k Neden Analizi</h2>
            <div class="panel">
                <div class="plan-item">
                    <h3>Horizon sÃ¼reÃ§ fÄ±rtÄ±nasÄ± <span class="priority priority-high">YÃ¼ksek</span></h3>
                    <p><strong>Belirti:</strong> 6+ Horizon master, 14+ worker; her biri ~%10-16 CPU. Load 15+ seviyesinde.</p>
                    <p><strong>Neden:</strong> queue:health-check komutu her dakika runInBackground; QueueHealthService iÃ§inde <code>nohup php artisan horizon &</code> Ã§aÄŸrÄ±sÄ± var. AutoQueueHealthCheck middleware admin sayfalarÄ±nda 5 dakikada bir job dispatch ediyor. queue:ensure-workers cron'u docker container kontrolÃ¼ yapÄ±yor. Terminate edilmeden yeni Horizon setleri aÃ§Ä±lÄ±yor.</p>
                    <p><strong>Etkisi:</strong> CPU tÃ¼ketimi + MySQL baÄŸlantÄ± ÅŸiÅŸmesi (1040 hatasÄ±); PHP-FPM kaynaklarÄ± kÄ±sÄ±tlanÄ±yor, yanÄ±t sÃ¼resi artÄ±yor.</p>
                </div>
                <div class="plan-item">
                    <h3>Debug/izleme Ã¼retimde aÃ§Ä±k <span class="priority priority-high">YÃ¼ksek</span></h3>
                    <p><strong>Belirti:</strong> Debugbar kayÄ±tlarÄ± 1.6 GB; Pulse slow request ve query kayÄ±tlarÄ± logda gÃ¶rÃ¼nÃ¼yor; APP_DEBUG/APP_DEBUG_TOOLS true.</p>
                    <p><strong>Neden:</strong> Prod ortamÄ±nda debug flag'leri kapatÄ±lmamÄ±ÅŸ; Debugbar tÃ¼m kolektÃ¶rlerle Ã§alÄ±ÅŸÄ±yor, Pulse/Telescope kayÄ±t yazÄ±yor.</p>
                    <p><strong>Etkisi:</strong> Her istekte ekstra disk I/O ve DB yazÄ±mÄ±; response time ve disk kullanÄ±mÄ±nÄ± artÄ±rÄ±yor.</p>
                </div>
                <div class="plan-item">
                    <h3>VeritabanÄ± baÄŸlantÄ± satÃ¼rasyonu <span class="priority priority-medium">Orta</span></h3>
                    <p><strong>Belirti:</strong> Too many connections hatasÄ±; tenant sorgularÄ± ve Pulse insert'leri gÃ¶rÃ¼ldÃ¼.</p>
                    <p><strong>Neden:</strong> Horizon Ã§oÄŸalmasÄ± + debug kayÄ±tlarÄ±nÄ±n yoÄŸun DB yazÄ±mÄ±; MySQL max_connections ile PHP/Horizon sÃ¼reÃ§ sayÄ±sÄ± uyumsuz.</p>
                    <p><strong>Etkisi:</strong> 500/1040 riskleri, geciken sorgular, kuyruklarÄ±n yavaÅŸlamasÄ±.</p>
                </div>
            </div>
        </section>

        <section>
            <h2>ğŸ¯ Aksiyon PlanÄ± (Ã–nceliklendirilmiÅŸ)</h2>
            <div class="plan-item">
                <h3>1) Horizon tekilleÅŸtirme ve sÃ¼reÃ§ temizliÄŸi <span class="priority priority-high">YÃ¼ksek</span></h3>
                <p>queue:health-check iÃ§indeki Horizon auto-start'Ä± devre dÄ±ÅŸÄ± bÄ±rak; AutoQueueHealthCheck middleware'in queue health tetiklemesini kapat veya admin dÄ±ÅŸÄ±na al; queue:ensure-workers (docker) cron'unu prodâ€™da durdur.</p>
                <p>ArdÄ±ndan tek seferlik <strong>horizon:terminate</strong> (ve gerekirse ps ile kalan worker'larÄ± sonlandÄ±r) + Supervisor/systemd ile tek master setini Ã§alÄ±ÅŸÄ±r bÄ±rak.</p>
                <p><strong>Hedef:</strong> Tek Horizon master + limitli worker (config/horizon.php prod: maxProcesses 2/1/1) â†’ CPU ve baÄŸlantÄ± tÃ¼ketimi dÃ¼ÅŸer.</p>
            </div>
            <div class="plan-item">
                <h3>2) Prod'da debug/izleme kapatma <span class="priority priority-high">YÃ¼ksek</span></h3>
                <p>APP_DEBUG=false, APP_DEBUG_TOOLS=false yap; Debugbar/Telescope/Pulse'Ä± prod iÃ§in kapat; storage/debugbar iÃ§eriÄŸini temizle; Pulse/Telescope tablolarÄ±nÄ± trim et.</p>
                <p><strong>Hedef:</strong> Ä°stek baÅŸÄ±na I/O'yu dÃ¼ÅŸÃ¼rmek, disk alanÄ±nÄ± geri kazanmak.</p>
            </div>
            <div class="plan-item">
                <h3>3) DB baÄŸlantÄ± hizalamasÄ± <span class="priority priority-medium">Orta</span></h3>
                <p>Horizon sÃ¼reÃ§ sayÄ±sÄ±nÄ± azalttÄ±ktan sonra MySQL max_connections deÄŸerini PHP-FPM + Horizon toplamÄ±na gÃ¶re ayarla; uzun sÃ¼ren queue iÅŸleri iÃ§in timeout ve maxJobs limitlerini takip et.</p>
                <p><strong>Hedef:</strong> 1040 hatalarÄ±nÄ± ortadan kaldÄ±rmak, kuyruk stabilitesini saÄŸlamak.</p>
            </div>
            <div class="plan-item">
                <h3>4) Cron sadeleÅŸmesi <span class="priority priority-medium">Orta</span></h3>
                <p>queue:health-check periyodunu dÃ¼ÅŸÃ¼r veya kapat; docker tabanlÄ± ensure-workers komutunu dev ortamÄ±na taÅŸÄ±; AutoQueueHealthCheck rate limit'ini yÃ¼kselt veya tamamen devre dÄ±ÅŸÄ± bÄ±rak.</p>
                <p><strong>Hedef:</strong> Gereksiz sÃ¼reÃ§ yaratÄ±mÄ±nÄ± ve log gÃ¼rÃ¼ltÃ¼sÃ¼nÃ¼ azaltmak.</p>
            </div>
            <div class="plan-item">
                <h3>5) Ä°zleme sonrasÄ± ince ayar <span class="priority priority-low">DÃ¼ÅŸÃ¼k</span></h3>
                <p>AltyapÄ± sakinleÅŸtikten sonra module_tenants sorgusuna uygun index (tenant_id, is_active, module_id) kontrolÃ¼; Pulse Ã¶rnekleme oranÄ±nÄ± dÃ¼ÅŸÃ¼r veya tamamen kapat.</p>
                <p><strong>Hedef:</strong> DB yanÄ±t sÃ¼resini iyileÅŸtirmek, responsecache kazancÄ±nÄ± artÄ±rmak.</p>
            </div>
        </section>

        <section>
            <h2>ğŸ§­ Uygulama SÄ±rasÄ±</h2>
            <div class="panel">
                <ol style="margin-left:18px; color:#cbd5e1;">
                    <li>queue:health-check auto Horizon start kapat; AutoQueueHealthCheck ve queue:ensure-workers cron'u devre dÄ±ÅŸÄ± bÄ±rak.</li>
                    <li>horizon:terminate ile fazla setleri sonlandÄ±r; Supervisor/systemd ile tek set baÅŸlat.</li>
                    <li>APP_DEBUG/APP_DEBUG_TOOLS=false; Debugbar/Telescope/Pulse kapat, kayÄ±tlarÄ± temizle.</li>
                    <li>MySQL baÄŸlantÄ± limitleri ve PHP-FPM/Horizon sÃ¼reÃ§ sayÄ±sÄ±nÄ± hizala; uzayan job'lar iÃ§in timeout kontrolÃ¼.</li>
                    <li>Ä°zleme: load average, MySQL connections, queue latency; ardÄ±ndan query/index iyileÅŸtirmeleri.</li>
                </ol>
            </div>
        </section>

        <footer>
            ğŸ¤– Claude AI tarafÄ±ndan oluÅŸturuldu | ixtif.com performans analizi v2
        </footer>
    </div>
</body>
</html>
