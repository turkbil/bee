# Laravel 500 Tenant System - Log Rotation Configuration

# Laravel application logs
/var/log/laravel/*.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    create 0644 www-data www-data
    postrotate
        # Reload PHP-FPM to release log file handles
        /usr/bin/pkill -USR1 php-fpm || true
    endscript
}

# Nginx logs
/var/log/nginx/*.log {
    daily
    rotate 52
    compress
    delaycompress
    missingok
    notifempty
    create 0640 www-data adm
    sharedscripts
    postrotate
        # Reload nginx
        /usr/bin/nginx -s reload > /dev/null 2>&1 || true
    endscript
}

# MySQL logs (if enabled)
/var/log/mysql/*.log {
    daily
    rotate 30
    compress
    delaycompress
    missingok
    notifempty
    create 0640 mysql mysql
    postrotate
        # Flush MySQL logs
        /usr/bin/mysqladmin -u root flush-logs 2>/dev/null || true
    endscript
}

# Redis logs
/var/log/redis/*.log {
    daily
    rotate 14
    compress
    delaycompress
    missingok
    notifempty
    create 0640 redis redis
}

# System logs
/var/log/supervisor/*.log {
    daily
    rotate 14
    compress
    delaycompress
    missingok
    notifempty
    create 0644 root root
    postrotate
        /usr/bin/supervisorctl reread && /usr/bin/supervisorctl update || true
    endscript
}