<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Muzibu Platform - Complete Technical Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .dual-column { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
        @media (max-width: 1024px) { .dual-column { grid-template-columns: 1fr; } }
        .user-side { border-left: 4px solid #22c55e; }
        .tech-side { border-left: 4px solid #3b82f6; }
        pre { white-space: pre-wrap; word-wrap: break-word; }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-slate-100 min-h-screen">
    <div class="max-w-7xl mx-auto px-4 py-12">
        <!-- Header -->
        <header class="mb-16 pb-8 border-b border-slate-700">
            <h1 class="text-4xl font-bold mb-4 bg-gradient-to-r from-green-400 to-blue-400 bg-clip-text text-transparent">
                ğŸµ Muzibu Platform - Complete Technical Guide
            </h1>
            <div class="text-slate-400 text-lg">
                Site giriÅŸinden ÅŸarkÄ± Ã§almaya, infinite scroll'a kadar tÃ¼m akÄ±ÅŸ
            </div>
            <div class="mt-4 flex flex-wrap gap-4 text-sm text-slate-500">
                <span>ğŸ“… 7 AralÄ±k 2025</span>
                <span>ğŸ¯ Tenant: muzibu.com (ID: 1001)</span>
                <span>ğŸ”§ Redis Session + Hybrid Device Tracking</span>
            </div>

            <!-- Legend -->
            <div class="mt-6 flex gap-6">
                <div class="flex items-center gap-2">
                    <div class="w-4 h-4 bg-green-500 rounded"></div>
                    <span class="text-green-400">KullanÄ±cÄ± Perspektifi (Basit)</span>
                </div>
                <div class="flex items-center gap-2">
                    <div class="w-4 h-4 bg-blue-500 rounded"></div>
                    <span class="text-blue-400">Teknik Perspektif (AI/Developer)</span>
                </div>
            </div>
        </header>

        <!-- ======================= SECTION 1: LOGIN ======================= -->
        <section class="mb-20">
            <h2 class="text-3xl font-bold mb-8 text-purple-400 flex items-center gap-3">
                <span class="bg-purple-500 text-white w-12 h-12 rounded-full flex items-center justify-center text-xl">1</span>
                Siteye GiriÅŸ (Login Flow)
            </h2>

            <div class="dual-column">
                <!-- User Side -->
                <div class="user-side bg-slate-800/50 rounded-lg p-6">
                    <h3 class="text-xl font-bold text-green-400 mb-4">ğŸ‘¤ KullanÄ±cÄ± Deneyimi</h3>

                    <div class="space-y-4 text-slate-300">
                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-white mb-2">1. GiriÅŸ SayfasÄ±</p>
                            <p>KullanÄ±cÄ± e-posta ve ÅŸifresini girer, "GiriÅŸ Yap" butonuna tÄ±klar.</p>
                        </div>

                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-white mb-2">2. BaÅŸarÄ±lÄ± GiriÅŸ</p>
                            <p>Sayfa yenilenmeden giriÅŸ yapÄ±lÄ±r, header'da kullanÄ±cÄ± adÄ± gÃ¶rÃ¼nÃ¼r.</p>
                        </div>

                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-white mb-2">3. Sidebar Durumu</p>
                            <ul class="list-disc list-inside mt-2 space-y-1">
                                <li><span class="text-yellow-300">Deneme Ãœyesi:</span> Trial aktif</li>
                                <li><span class="text-green-300">Premium Ãœye:</span> Ã–deme yapÄ±lmÄ±ÅŸ</li>
                                <li><span class="text-slate-400">Ãœcretsiz Ãœye:</span> HiÃ§ subscription yok</li>
                            </ul>
                        </div>

                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-white mb-2">4. Cihaz Limiti</p>
                            <p>Ä°lk giriÅŸte hiÃ§ modal Ã§Ä±kmaz. Sadece limit aÅŸÄ±lÄ±rsa (2+ cihaz) uyarÄ± gÃ¶sterilir.</p>
                        </div>
                    </div>
                </div>

                <!-- Tech Side -->
                <div class="tech-side bg-slate-800/50 rounded-lg p-6">
                    <h3 class="text-xl font-bold text-blue-400 mb-4">âš™ï¸ Teknik Detaylar</h3>

                    <div class="space-y-4 text-slate-300 text-sm">
                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-blue-300 mb-2">API Endpoint</p>
                            <code class="text-green-300">POST /api/auth/login</code>
                            <pre class="mt-2 text-xs bg-slate-900 p-2 rounded">
{
  "email": "user@example.com",
  "password": "******",
  "remember": true
}</pre>
                        </div>

                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-blue-300 mb-2">AuthController::login()</p>
                            <ol class="list-decimal list-inside space-y-1">
                                <li>Auth::attempt() - Credentials doÄŸrula</li>
                                <li>session()->regenerate() - Session ID yenile</li>
                                <li>Cache::forget() - Premium cache temizle</li>
                                <li>DeviceService::registerSession() - Cihaz kaydet</li>
                            </ol>
                        </div>

                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-blue-300 mb-2">DeviceService::registerSession()</p>
                            <pre class="text-xs bg-slate-900 p-2 rounded overflow-x-auto">
// 1. Session ID al (Redis'ten)
$sessionId = session()->getId();

// 2. user_active_sessions tablosuna kaydet
DB::table('user_active_sessions')
  ->updateOrInsert(
    ['session_id' => $sessionId],
    [
      'user_id' => $user->id,
      'device_name' => 'OS X - Chrome',
      'last_activity' => now()
    ]
  );

// 3. Limit kontrolÃ¼ ve cleanup
$this->handlePostLoginDeviceLimit($user);</pre>
                        </div>

                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-blue-300 mb-2">Session Storage</p>
                            <p class="text-yellow-300 font-bold">âš ï¸ Redis Session Driver Zorunlu!</p>
                            <pre class="text-xs bg-slate-900 p-2 rounded mt-2">
# .env
SESSION_DRIVER=redis
REDIS_HOST=127.0.0.1
REDIS_PORT=6379</pre>
                            <p class="mt-2 text-slate-400">Session Redis'te, device tracking DB'de (hybrid sistem)</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ======================= SECTION 2: DEVICE LIMIT ======================= -->
        <section class="mb-20">
            <h2 class="text-3xl font-bold mb-8 text-orange-400 flex items-center gap-3">
                <span class="bg-orange-500 text-white w-12 h-12 rounded-full flex items-center justify-center text-xl">2</span>
                Cihaz Limiti Sistemi
            </h2>

            <div class="dual-column">
                <!-- User Side -->
                <div class="user-side bg-slate-800/50 rounded-lg p-6">
                    <h3 class="text-xl font-bold text-green-400 mb-4">ğŸ‘¤ KullanÄ±cÄ± Deneyimi</h3>

                    <div class="space-y-4 text-slate-300">
                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-white mb-2">Ne Zaman UyarÄ± Ã‡Ä±kar?</p>
                            <ul class="list-disc list-inside space-y-1">
                                <li>BaÅŸka bir cihazdan giriÅŸ yapÄ±lÄ±rsa</li>
                                <li>Ve cihaz limiti aÅŸÄ±lÄ±rsa (genelde 1-2 cihaz)</li>
                                <li>Mevcut oturum sonlandÄ±rÄ±lÄ±rsa</li>
                            </ul>
                        </div>

                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-white mb-2">UyarÄ± ModalÄ±</p>
                            <p>Modal gÃ¶rÃ¼ndÃ¼ÄŸÃ¼nde kullanÄ±cÄ±:</p>
                            <ul class="list-disc list-inside mt-2 space-y-1">
                                <li>Hangi cihazlarÄ± kapatacaÄŸÄ±nÄ± seÃ§ebilir</li>
                                <li>Veya mevcut oturumu koruyabilir</li>
                            </ul>
                        </div>

                        <div class="bg-green-900/30 border border-green-500/30 rounded p-4">
                            <p class="font-semibold text-green-300 mb-2">âœ… Ä°lk GiriÅŸte Modal YOK!</p>
                            <p>Tek cihazdan giriÅŸ yapÄ±yorsanÄ±z hiÃ§bir uyarÄ± gÃ¶rmezsiniz. Sistem arka planda Ã§alÄ±ÅŸÄ±r.</p>
                        </div>

                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-white mb-2">Cihaz Limitleri</p>
                            <table class="w-full mt-2 text-sm">
                                <tr class="border-b border-slate-600">
                                    <td class="py-2">Ãœcretsiz Ãœye</td>
                                    <td class="py-2 text-right">1 cihaz</td>
                                </tr>
                                <tr class="border-b border-slate-600">
                                    <td class="py-2">Trial (Deneme)</td>
                                    <td class="py-2 text-right">Plan'a gÃ¶re</td>
                                </tr>
                                <tr>
                                    <td class="py-2">Premium</td>
                                    <td class="py-2 text-right">Plan'a gÃ¶re (1-5)</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Tech Side -->
                <div class="tech-side bg-slate-800/50 rounded-lg p-6">
                    <h3 class="text-xl font-bold text-blue-400 mb-4">âš™ï¸ Teknik Detaylar</h3>

                    <div class="space-y-4 text-slate-300 text-sm">
                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-blue-300 mb-2">3-Seviyeli Device Limit Hierarchy</p>
                            <pre class="text-xs bg-slate-900 p-2 rounded">
DeviceService::getDeviceLimit($user):

1. User Override (VIP/Ban)
   â†’ $user->device_limit (nullable)

2. Subscription Plan
   â†’ $subscription->plan->device_limit

3. Tenant Settings Fallback
   â†’ setting('auth_device_limit')

4. Ultimate Fallback
   â†’ return 1;</pre>
                        </div>

                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-blue-300 mb-2">Session Polling (30 saniye)</p>
                            <pre class="text-xs bg-slate-900 p-2 rounded">
// player-core.js
startSessionPolling() {
  setInterval(() => {
    fetch('/api/auth/check-session')
      .then(r => r.json())
      .then(data => {
        if (!data.valid) {
          // Session sonlandÄ±rÄ±ldÄ±
          showDeviceLimitModal();
        }
      });
  }, 30000);
}</pre>
                        </div>

                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-blue-300 mb-2">Backend Check</p>
                            <pre class="text-xs bg-slate-900 p-2 rounded">
// AuthController::checkSession()
$isValid = $deviceService
  ->updateSessionActivity($user);

if (!$isValid) {
  // Session DB'de yok = baÅŸka yerden kapatÄ±ldÄ±
  Auth::logout();
  return [
    'valid' => false,
    'reason' => 'device_limit_exceeded'
  ];
}</pre>
                        </div>

                        <div class="bg-yellow-900/30 border border-yellow-500/30 rounded p-4">
                            <p class="font-semibold text-yellow-300 mb-2">âš ï¸ Dinamik Tenant KontrolÃ¼</p>
                            <pre class="text-xs bg-slate-900 p-2 rounded">
// YANLIÅ (hardcoded)
if (tenant()->id == 1001) { ... }

// DOÄRU (dinamik)
if (tenant()) {
  // TÃ¼m tenant'lar iÃ§in Ã§alÄ±ÅŸÄ±r
  $deviceService->registerSession($user);
}</pre>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ======================= SECTION 3: PREMIUM/TRIAL STATUS ======================= -->
        <section class="mb-20">
            <h2 class="text-3xl font-bold mb-8 text-yellow-400 flex items-center gap-3">
                <span class="bg-yellow-500 text-white w-12 h-12 rounded-full flex items-center justify-center text-xl">3</span>
                Ãœyelik Durumu (Premium/Trial)
            </h2>

            <div class="dual-column">
                <!-- User Side -->
                <div class="user-side bg-slate-800/50 rounded-lg p-6">
                    <h3 class="text-xl font-bold text-green-400 mb-4">ğŸ‘¤ KullanÄ±cÄ± Deneyimi</h3>

                    <div class="space-y-4 text-slate-300">
                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-white mb-2">Sidebar'da GÃ¶rÃ¼nen Durum</p>
                            <div class="space-y-3 mt-3">
                                <div class="flex items-center gap-3 bg-slate-600/50 p-2 rounded">
                                    <span class="bg-yellow-500 text-black px-2 py-1 rounded text-xs font-bold">DENEME</span>
                                    <span>Deneme Ãœyesi (Trial aktif)</span>
                                </div>
                                <div class="flex items-center gap-3 bg-slate-600/50 p-2 rounded">
                                    <span class="bg-green-500 text-white px-2 py-1 rounded text-xs font-bold">PREMIUM</span>
                                    <span>Premium Ãœye (Ã–deme yapÄ±lmÄ±ÅŸ)</span>
                                </div>
                                <div class="flex items-center gap-3 bg-slate-600/50 p-2 rounded">
                                    <span class="bg-slate-500 text-white px-2 py-1 rounded text-xs font-bold">FREE</span>
                                    <span>Ãœcretsiz Ãœye (30sn Ã¶nizleme)</span>
                                </div>
                            </div>
                        </div>

                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-white mb-2">Ãœyelik AvantajlarÄ±</p>
                            <table class="w-full mt-2 text-sm">
                                <tr class="border-b border-slate-600">
                                    <td class="py-2">Ãœcretsiz</td>
                                    <td class="py-2 text-right">30sn Ã¶nizleme, reklamlÄ±</td>
                                </tr>
                                <tr class="border-b border-slate-600">
                                    <td class="py-2">Deneme</td>
                                    <td class="py-2 text-right">Tam eriÅŸim, sÄ±nÄ±rlÄ± sÃ¼re</td>
                                </tr>
                                <tr>
                                    <td class="py-2">Premium</td>
                                    <td class="py-2 text-right">Tam eriÅŸim, HLS streaming</td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Tech Side -->
                <div class="tech-side bg-slate-800/50 rounded-lg p-6">
                    <h3 class="text-xl font-bold text-blue-400 mb-4">âš™ï¸ Teknik Detaylar</h3>

                    <div class="space-y-4 text-slate-300 text-sm">
                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-blue-300 mb-2">User::isPremium()</p>
                            <pre class="text-xs bg-slate-900 p-2 rounded">
// 5 dakikalÄ±k cache (performans)
$cacheKey = 'user_' . $this->id .
  '_is_premium_tenant_' . tenant()->id;

return Cache::remember($cacheKey, 300, function() {
  return $this->subscriptions()
    ->where('status', 'active')
    ->where('current_period_end', '>', now())
    ->exists();
});</pre>
                        </div>

                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-blue-300 mb-2">User::isTrialActive()</p>
                            <pre class="text-xs bg-slate-900 p-2 rounded">
return $this->subscriptions()
  ->whereIn('status', ['active', 'trial'])
  ->where('has_trial', true)
  ->whereNotNull('trial_ends_at')
  ->where('trial_ends_at', '>', now())
  ->exists();</pre>
                        </div>

                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-blue-300 mb-2">Sidebar Badge Logic</p>
                            <pre class="text-xs bg-slate-900 p-2 rounded">
// sidebar-left.blade.php
@if($user->isTrialActive())
  &lt;span class="badge bg-yellow-500"&gt;
    Deneme Ãœyesi
  &lt;/span&gt;
@elseif($user->isPremium())
  &lt;span class="badge bg-green-500"&gt;
    Premium Ãœye
  &lt;/span&gt;
@else
  &lt;span class="badge bg-slate-500"&gt;
    Ãœcretsiz Ãœye
  &lt;/span&gt;
@endif</pre>
                        </div>

                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-blue-300 mb-2">Subscription Tablosu</p>
                            <pre class="text-xs bg-slate-900 p-2 rounded">
subscriptions (tenant DB):
- id
- user_id
- plan_id
- status: 'active' | 'trial' | 'canceled'
- has_trial: boolean
- trial_ends_at: datetime
- current_period_end: datetime</pre>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ======================= SECTION 4: SONG PLAYBACK ======================= -->
        <section class="mb-20">
            <h2 class="text-3xl font-bold mb-8 text-pink-400 flex items-center gap-3">
                <span class="bg-pink-500 text-white w-12 h-12 rounded-full flex items-center justify-center text-xl">4</span>
                ÅarkÄ± Ã‡alma (Playback Flow)
            </h2>

            <div class="dual-column">
                <!-- User Side -->
                <div class="user-side bg-slate-800/50 rounded-lg p-6">
                    <h3 class="text-xl font-bold text-green-400 mb-4">ğŸ‘¤ KullanÄ±cÄ± Deneyimi</h3>

                    <div class="space-y-4 text-slate-300">
                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-white mb-2">1. ÅarkÄ±ya TÄ±kla</p>
                            <p>Herhangi bir ÅŸarkÄ± kartÄ±na tÄ±klayÄ±n. Player altta belirir.</p>
                        </div>

                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-white mb-2">2. Player Kontrolleri</p>
                            <ul class="list-disc list-inside space-y-1">
                                <li>â–¶ï¸ Oynat / â¸ï¸ Duraklat</li>
                                <li>â®ï¸ Ã–nceki / â­ï¸ Sonraki</li>
                                <li>ğŸ”€ KarÄ±ÅŸtÄ±r / ğŸ” Tekrarla</li>
                                <li>ğŸ”Š Ses kontrolÃ¼</li>
                                <li>ğŸ“‹ SÄ±ra gÃ¶rÃ¼ntÃ¼le</li>
                            </ul>
                        </div>

                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-white mb-2">3. Ãœcretsiz KullanÄ±cÄ± KÄ±sÄ±tlamasÄ±</p>
                            <p class="text-red-300">âš ï¸ 30 saniye Ã¶nizleme sonrasÄ± ÅŸarkÄ± durur ve Premium upgrade modal'Ä± gÃ¶sterilir.</p>
                        </div>

                        <div class="bg-green-900/30 border border-green-500/30 rounded p-4">
                            <p class="font-semibold text-green-300 mb-2">Premium/Trial AvantajÄ±</p>
                            <ul class="list-disc list-inside space-y-1">
                                <li>Tam ÅŸarkÄ± dinleme</li>
                                <li>HLS streaming (yÃ¼ksek kalite)</li>
                                <li>SÄ±rasÄ±z atlama</li>
                                <li>Offline indirme (yakÄ±nda)</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Tech Side -->
                <div class="tech-side bg-slate-800/50 rounded-lg p-6">
                    <h3 class="text-xl font-bold text-blue-400 mb-4">âš™ï¸ Teknik Detaylar</h3>

                    <div class="space-y-4 text-slate-300 text-sm">
                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-blue-300 mb-2">player-core.js - play()</p>
                            <pre class="text-xs bg-slate-900 p-2 rounded">
async play(song) {
  // 1. Premium kontrolÃ¼
  const isPremium = await this.checkPremiumStatus();

  // 2. URL al
  const url = isPremium
    ? `/api/muzibu/songs/${song.id}/stream` // HLS
    : `/api/muzibu/songs/${song.id}/serve?force_mp3=1`;

  // 3. Howler.js ile Ã§al
  this.playWithHowler(url, song);
}</pre>
                        </div>

                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-blue-300 mb-2">Streaming Endpoints</p>
                            <table class="w-full text-xs">
                                <tr class="border-b border-slate-600">
                                    <td class="py-2"><code>/stream</code></td>
                                    <td class="py-2">HLS (.m3u8) - Premium</td>
                                </tr>
                                <tr class="border-b border-slate-600">
                                    <td class="py-2"><code>/serve</code></td>
                                    <td class="py-2">MP3 direct - Free preview</td>
                                </tr>
                                <tr>
                                    <td class="py-2"><code>/key</code></td>
                                    <td class="py-2">AES-128 decryption key</td>
                                </tr>
                            </table>
                        </div>

                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-blue-300 mb-2">Guest Preview Config</p>
                            <pre class="text-xs bg-slate-900 p-2 rounded">
guestPreviewConfig: {
  maxPreviewDuration: 30,  // saniye
  showUpgradeModal: true,
  allowSeek: false,        // Seek engelli
  previewMessage: '30 saniyelik Ã¶nizleme'
}</pre>
                        </div>

                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-blue-300 mb-2">Seek Block (Free users)</p>
                            <pre class="text-xs bg-slate-900 p-2 rounded">
// player-core.js:1085
if (!this.isPremium && seekTo > 30) {
  console.log('ğŸ”’ Seek blocked: max 30s');
  return;
}</pre>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ======================= SECTION 5: QUEUE & INFINITE SCROLL ======================= -->
        <section class="mb-20">
            <h2 class="text-3xl font-bold mb-8 text-cyan-400 flex items-center gap-3">
                <span class="bg-cyan-500 text-white w-12 h-12 rounded-full flex items-center justify-center text-xl">5</span>
                SÄ±ra Sistemi & Infinite Scroll
            </h2>

            <div class="dual-column">
                <!-- User Side -->
                <div class="user-side bg-slate-800/50 rounded-lg p-6">
                    <h3 class="text-xl font-bold text-green-400 mb-4">ğŸ‘¤ KullanÄ±cÄ± Deneyimi</h3>

                    <div class="space-y-4 text-slate-300">
                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-white mb-2">1. ÅarkÄ± SÄ±rasÄ± (Queue)</p>
                            <p>Player'da sÄ±ra ikonuna tÄ±klayÄ±nca Ã§alma listesi aÃ§Ä±lÄ±r. SÄ±radaki ÅŸarkÄ±larÄ± gÃ¶rebilir, sÃ¼rÃ¼kleyip sÄ±ralayabilirsiniz.</p>
                        </div>

                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-white mb-2">2. Otomatik Devam</p>
                            <p>Bir ÅŸarkÄ± bittiÄŸinde otomatik olarak sÄ±radaki ÅŸarkÄ± baÅŸlar. Liste sonuna gelince yenileri yÃ¼klenir.</p>
                        </div>

                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-white mb-2">3. Bitmez MÃ¼zik (Infinite)</p>
                            <p class="text-green-300">âœ¨ SÄ±ra azaldÄ±ÄŸÄ±nda sistem otomatik olarak benzer ÅŸarkÄ±lar ekler. MÃ¼zik hiÃ§ bitmez!</p>
                        </div>

                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-white mb-2">4. Play Context</p>
                            <ul class="list-disc list-inside space-y-1">
                                <li>Playlist'ten Ã§alÄ±nca â†’ O playlist'in ÅŸarkÄ±larÄ±</li>
                                <li>AlbÃ¼mden Ã§alÄ±nca â†’ O albÃ¼mÃ¼n ÅŸarkÄ±larÄ±</li>
                                <li>Genre'den Ã§alÄ±nca â†’ O tÃ¼rÃ¼n ÅŸarkÄ±larÄ±</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Tech Side -->
                <div class="tech-side bg-slate-800/50 rounded-lg p-6">
                    <h3 class="text-xl font-bold text-blue-400 mb-4">âš™ï¸ Teknik Detaylar</h3>

                    <div class="space-y-4 text-slate-300 text-sm">
                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-blue-300 mb-2">Queue State Management</p>
                            <pre class="text-xs bg-slate-900 p-2 rounded">
// muzibu-store.js
state: {
  queue: [],           // ÅarkÄ± listesi
  queueIndex: 0,       // Åu anki index
  playContext: {
    type: 'playlist',  // playlist|album|genre
    id: 123,
    name: 'Chill Vibes'
  }
}</pre>
                        </div>

                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-blue-300 mb-2">Queue Monitor (10 saniye)</p>
                            <pre class="text-xs bg-slate-900 p-2 rounded">
// player-core.js:3037
startQueueMonitor() {
  setInterval(() => {
    const remaining = queue.length - queueIndex;
    console.log(`Queue Check: ${remaining} songs`);

    if (remaining < 5) {
      this.refillQueue(); // Auto-refill
    }
  }, 10000);
}</pre>
                        </div>

                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-blue-300 mb-2">Refill API</p>
                            <pre class="text-xs bg-slate-900 p-2 rounded">
POST /api/muzibu/queue/refill
{
  "type": "genre",   // Context type
  "id": 3,           // Context ID
  "offset": 15,      // Skip already played
  "limit": 15        // How many to fetch
}

Response:
{
  "songs": [...],    // New songs
  "has_more": true
}</pre>
                        </div>

                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-blue-300 mb-2">Aggressive Preload</p>
                            <pre class="text-xs bg-slate-900 p-2 rounded">
// player-core.js:2944
aggressivePreload() {
  // Sonraki 3 ÅŸarkÄ±yÄ± Ã¶nceden yÃ¼kle
  const nextSongs = queue.slice(
    queueIndex + 1,
    queueIndex + 4
  );

  nextSongs.forEach(song => {
    this.preloadSong(song);
  });
}</pre>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ======================= SECTION 6: DATABASE ARCHITECTURE ======================= -->
        <section class="mb-20">
            <h2 class="text-3xl font-bold mb-8 text-indigo-400 flex items-center gap-3">
                <span class="bg-indigo-500 text-white w-12 h-12 rounded-full flex items-center justify-center text-xl">6</span>
                VeritabanÄ± Mimarisi
            </h2>

            <div class="dual-column">
                <!-- User Side -->
                <div class="user-side bg-slate-800/50 rounded-lg p-6">
                    <h3 class="text-xl font-bold text-green-400 mb-4">ğŸ‘¤ Basit AÃ§Ä±klama</h3>

                    <div class="space-y-4 text-slate-300">
                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-white mb-2">Multi-Tenant Sistem</p>
                            <p>Her web sitesi (tenant) kendi veritabanÄ±na sahip. Veriler birbirinden tamamen izole.</p>
                        </div>

                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-white mb-2">Central vs Tenant DB</p>
                            <ul class="list-disc list-inside space-y-1">
                                <li><span class="text-blue-300">Central:</span> KullanÄ±cÄ±lar, roller, izinler</li>
                                <li><span class="text-green-300">Tenant:</span> ÅarkÄ±lar, albÃ¼mler, abonelikler, cihazlar</li>
                            </ul>
                        </div>

                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-white mb-2">Redis Cache</p>
                            <p>HÄ±zlÄ± eriÅŸim iÃ§in sÄ±kÃ§a kullanÄ±lan veriler Redis'te saklanÄ±r. Session'lar da Redis'te.</p>
                        </div>
                    </div>
                </div>

                <!-- Tech Side -->
                <div class="tech-side bg-slate-800/50 rounded-lg p-6">
                    <h3 class="text-xl font-bold text-blue-400 mb-4">âš™ï¸ Teknik Detaylar</h3>

                    <div class="space-y-4 text-slate-300 text-sm">
                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-blue-300 mb-2">Database Mapping</p>
                            <pre class="text-xs bg-slate-900 p-2 rounded">
Central (tuufi_4ekim):
â”œâ”€â”€ users
â”œâ”€â”€ roles
â”œâ”€â”€ permissions
â”œâ”€â”€ tenants
â””â”€â”€ domains

Tenant (tenant_muzibu_1528d0):
â”œâ”€â”€ songs
â”œâ”€â”€ albums
â”œâ”€â”€ artists
â”œâ”€â”€ playlists
â”œâ”€â”€ genres
â”œâ”€â”€ subscriptions
â”œâ”€â”€ subscription_plans
â””â”€â”€ user_active_sessions  â† NEW!</pre>
                        </div>

                        <div class="bg-slate-700/50 rounded p-4">
                            <p class="font-semibold text-blue-300 mb-2">user_active_sessions Table</p>
                            <pre class="text-xs bg-slate-900 p-2 rounded">
CREATE TABLE user_active_sessions (
  id BIGINT PRIMARY KEY,
  user_id BIGINT,
  session_id VARCHAR(255) UNIQUE,
  ip_address VARCHAR(45),
  user_agent TEXT,
  device_type VARCHAR(50),
  device_name VARCHAR(255),
  browser VARCHAR(100),
  platform VARCHAR(100),
  last_activity TIMESTAMP,

  INDEX (user_id),
  INDEX (session_id)
);</pre>
                        </div>

                        <div class="bg-yellow-900/30 border border-yellow-500/30 rounded p-4">
                            <p class="font-semibold text-yellow-300 mb-2">âš ï¸ Hybrid Session System</p>
                            <pre class="text-xs bg-slate-900 p-2 rounded">
Redis (SESSION_DRIVER=redis):
â””â”€â”€ Session data, CSRF tokens, flash messages

MySQL (user_active_sessions):
â””â”€â”€ Device tracking, queryable, reportable

Why hybrid?
- Redis = Fast, ephemeral
- MySQL = Queryable, persistent tracking</pre>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- ======================= TEST RESULTS ======================= -->
        <section class="mb-20">
            <h2 class="text-3xl font-bold mb-8 text-emerald-400 flex items-center gap-3">
                <span class="bg-emerald-500 text-white w-12 h-12 rounded-full flex items-center justify-center text-xl">âœ“</span>
                Test SonuÃ§larÄ± (7 AralÄ±k 2025 - CanlÄ±)
            </h2>

            <div class="bg-slate-800/50 rounded-lg p-6">
                <div class="grid md:grid-cols-2 gap-6">
                    <!-- Test 1 -->
                    <div class="bg-green-900/30 border border-green-500/30 rounded p-4">
                        <div class="flex items-center gap-3 mb-2">
                            <span class="text-2xl">âœ…</span>
                            <span class="font-bold text-green-300">Session KaydÄ±</span>
                        </div>
                        <p class="text-sm text-slate-300">Login sonrasÄ± user_active_sessions tablosuna kayÄ±t oluÅŸturuluyor.</p>
                        <pre class="text-xs bg-slate-900 p-2 rounded mt-2">
Total Sessions: 1
ID: 3
Device: OS X - Chrome
Last: 2025-12-07 18:54:17</pre>
                    </div>

                    <!-- Test 2 -->
                    <div class="bg-green-900/30 border border-green-500/30 rounded p-4">
                        <div class="flex items-center gap-3 mb-2">
                            <span class="text-2xl">âœ…</span>
                            <span class="font-bold text-green-300">Trial Status (Tinker)</span>
                        </div>
                        <p class="text-sm text-slate-300">User::isPremium() ve isTrialActive() doÄŸru Ã§alÄ±ÅŸÄ±yor.</p>
                        <pre class="text-xs bg-slate-900 p-2 rounded mt-2">
User: nurullah@nurullah.net
is_premium: true
is_trial: true
Sub Status: active
has_trial: true
trial_ends_at: 2025-12-08 17:42:49</pre>
                    </div>

                    <!-- Test 3 -->
                    <div class="bg-green-900/30 border border-green-500/30 rounded p-4">
                        <div class="flex items-center gap-3 mb-2">
                            <span class="text-2xl">âœ…</span>
                            <span class="font-bold text-green-300">Dinamik Tenant</span>
                        </div>
                        <p class="text-sm text-slate-300">Hardcoded "1001" referanslarÄ± kaldÄ±rÄ±ldÄ±. ArtÄ±k tÃ¼m tenant'lar iÃ§in Ã§alÄ±ÅŸÄ±yor.</p>
                        <pre class="text-xs bg-slate-900 p-2 rounded mt-2">
// Ã–NCE (hardcoded)
if (tenant()->id == 1001) { ... }

// SONRA (dinamik)
if (tenant()) { ... }</pre>
                    </div>

                    <!-- Test 4 -->
                    <div class="bg-green-900/30 border border-green-500/30 rounded p-4">
                        <div class="flex items-center gap-3 mb-2">
                            <span class="text-2xl">âœ…</span>
                            <span class="font-bold text-green-300">is_trial Flag</span>
                        </div>
                        <p class="text-sm text-slate-300">Login/me response'a is_trial flag eklendi. Sidebar doÄŸru badge gÃ¶steriyor.</p>
                        <pre class="text-xs bg-slate-900 p-2 rounded mt-2">
// API Response
{
  "is_premium": true,
  "is_trial": true,  // YENÄ°!
  "trial_ends_at": "2025-12-08T..."
}</pre>
                    </div>

                    <!-- Test 5 -->
                    <div class="bg-green-900/30 border border-green-500/30 rounded p-4">
                        <div class="flex items-center gap-3 mb-2">
                            <span class="text-2xl">âœ…</span>
                            <span class="font-bold text-green-300">Redis Session</span>
                        </div>
                        <p class="text-sm text-slate-300">SESSION_DRIVER=redis, hybrid sistem Ã§alÄ±ÅŸÄ±yor. Session Redis'te, tracking DB'de.</p>
                    </div>

                    <!-- Test 6 -->
                    <div class="bg-green-900/30 border border-green-500/30 rounded p-4">
                        <div class="flex items-center gap-3 mb-2">
                            <span class="text-2xl">âœ…</span>
                            <span class="font-bold text-green-300">Device Limit</span>
                        </div>
                        <p class="text-sm text-slate-300">Ä°lk giriÅŸte modal Ã§Ä±kmÄ±yor. Sadece limit aÅŸÄ±lÄ±nca (2+ cihaz) uyarÄ± gÃ¶sterilir.</p>
                    </div>
                </div>

                <div class="mt-6 p-4 bg-slate-700/50 rounded">
                    <p class="text-sm text-slate-400">
                        <strong class="text-white">Console Log Ã–zeti:</strong>
                        Session polling baÅŸlatÄ±ldÄ± (30s), Queue monitor aktif (10s),
                        Aggressive preload Ã§alÄ±ÅŸÄ±yor (next 3 songs), HLS streaming hazÄ±r.
                    </p>
                </div>
            </div>
        </section>

        <!-- ======================= KEY FILES ======================= -->
        <section class="mb-20">
            <h2 class="text-3xl font-bold mb-8 text-rose-400 flex items-center gap-3">
                <span class="bg-rose-500 text-white w-12 h-12 rounded-full flex items-center justify-center text-xl">ğŸ“</span>
                Anahtar Dosyalar
            </h2>

            <div class="bg-slate-800/50 rounded-lg p-6">
                <div class="grid md:grid-cols-2 gap-4 text-sm">
                    <div class="space-y-2">
                        <p class="font-bold text-blue-300 mb-3">Backend (PHP/Laravel)</p>
                        <code class="block bg-slate-700 p-2 rounded">Modules/Muzibu/app/Services/DeviceService.php</code>
                        <code class="block bg-slate-700 p-2 rounded">app/Http/Controllers/Api/Auth/AuthController.php</code>
                        <code class="block bg-slate-700 p-2 rounded">app/Models/User.php</code>
                        <code class="block bg-slate-700 p-2 rounded">Modules/Subscription/app/Models/Subscription.php</code>
                    </div>
                    <div class="space-y-2">
                        <p class="font-bold text-green-300 mb-3">Frontend (JS/Blade)</p>
                        <code class="block bg-slate-700 p-2 rounded">public/themes/muzibu/js/player/core/player-core.js</code>
                        <code class="block bg-slate-700 p-2 rounded">public/themes/muzibu/js/store/muzibu-store.js</code>
                        <code class="block bg-slate-700 p-2 rounded">resources/views/themes/muzibu/components/sidebar-left.blade.php</code>
                        <code class="block bg-slate-700 p-2 rounded">resources/views/themes/muzibu/components/device-limit-modal.blade.php</code>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="mt-20 pt-8 border-t border-slate-700 text-center text-slate-500 text-sm">
            <p>ğŸ¤– Claude AI tarafÄ±ndan oluÅŸturuldu</p>
            <p class="mt-2">Muzibu Platform - Complete Technical Guide v1</p>
        </footer>
    </div>
</body>
</html>
