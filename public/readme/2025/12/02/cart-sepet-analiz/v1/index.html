<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart ModÃ¼lÃ¼ & Sepete Ekle Butonu - KapsamlÄ± Analiz</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            line-height: 1.7;
            padding: 40px 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            margin-bottom: 50px;
            padding-bottom: 30px;
            border-bottom: 2px solid #334155;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #60a5fa, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .meta {
            color: #94a3b8;
            font-size: 0.95rem;
        }

        section {
            margin-bottom: 50px;
        }

        h2 {
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: #60a5fa;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        h3 {
            font-size: 1.4rem;
            margin: 30px 0 15px 0;
            color: #818cf8;
        }

        .analysis-card {
            background: rgba(30, 41, 59, 0.5);
            padding: 30px;
            margin-bottom: 20px;
            border-radius: 12px;
            border-left: 4px solid #3b82f6;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .analysis-card:hover {
            transform: translateX(5px);
            background: rgba(30, 41, 59, 0.7);
        }

        .flow-diagram {
            background: rgba(30, 41, 59, 0.3);
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            border: 1px solid #334155;
        }

        .flow-step {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            margin: 10px 0;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 8px;
            border-left: 3px solid #60a5fa;
        }

        .flow-step .number {
            background: linear-gradient(135deg, #60a5fa, #3b82f6);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .flow-step .content {
            flex: 1;
        }

        .flow-step .title {
            color: #60a5fa;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .flow-step .description {
            color: #cbd5e1;
            font-size: 0.9rem;
        }

        .tech-term {
            color: #fbbf24;
            font-weight: 500;
        }

        .explanation {
            display: inline-block;
            margin-left: 5px;
            color: #94a3b8;
            font-size: 0.9rem;
        }

        .strength {
            background: rgba(34, 197, 94, 0.1);
            border-left-color: #22c55e;
            padding: 15px 20px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #22c55e;
        }

        .strength::before {
            content: "âœ… ";
            color: #22c55e;
            font-weight: bold;
        }

        .improvement {
            background: rgba(251, 191, 36, 0.1);
            border-left-color: #f59e0b;
            padding: 15px 20px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #f59e0b;
        }

        .improvement::before {
            content: "âš ï¸ ";
            color: #f59e0b;
            font-weight: bold;
        }

        .module-box {
            background: rgba(99, 102, 241, 0.1);
            padding: 20px;
            border-radius: 12px;
            margin: 15px 0;
            border: 1px solid #6366f1;
        }

        .module-box .module-title {
            color: #818cf8;
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .module-box .module-desc {
            color: #cbd5e1;
            margin-left: 28px;
        }

        ul {
            margin-left: 25px;
            margin-top: 10px;
        }

        ul li {
            margin-bottom: 8px;
            color: #cbd5e1;
        }

        .highlight-box {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(99, 102, 241, 0.15));
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border: 1px solid #3b82f6;
        }

        .highlight-box .title {
            color: #60a5fa;
            font-weight: 600;
            font-size: 1.2rem;
            margin-bottom: 15px;
        }

        .highlight-box p {
            color: #cbd5e1;
            margin-bottom: 10px;
        }

        footer {
            margin-top: 60px;
            padding-top: 30px;
            border-top: 1px solid #334155;
            color: #64748b;
            font-size: 0.9rem;
            text-align: center;
        }

        .icon {
            font-size: 1.2rem;
            margin-right: 5px;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ›’ Cart ModÃ¼lÃ¼ & Sepete Ekle Butonu - KapsamlÄ± Analiz</h1>
            <div class="meta">
                ğŸ“… Tarih: 2025-12-02 |
                ğŸ¯ Tenant: ixtif.com (Tenant 2 - EndÃ¼striyel Ekipman) |
                ğŸ‘¤ Talep: Cart modÃ¼lÃ¼ ve homepage add to basket butonu analizi
            </div>
        </header>

        <!-- 1. SÄ°STEM MÄ°MARÄ°SÄ° -->
        <section>
            <h2><span class="icon">ğŸ—ï¸</span> Sistem Mimarisi</h2>

            <div class="highlight-box">
                <div class="title">Multi-Tenant E-Ticaret Sistemi</div>
                <p>Sistem, <span class="tech-term">Multi-Tenant</span> <span class="explanation">(Ã‡ok kiracÄ±lÄ±)</span> mimari Ã¼zerine kurulu. Her tenant'Ä±n kendi database'i var ve sepet verileri tenant database'lerinde saklanÄ±yor.</p>
                <p><strong>ModÃ¼ler YapÄ±:</strong> Cart modÃ¼lÃ¼ ve Shop modÃ¼lÃ¼ birbirinden baÄŸÄ±msÄ±z ama <span class="tech-term">Bridge Service</span> <span class="explanation">(KÃ¶prÃ¼ Servisi)</span> ile entegre Ã§alÄ±ÅŸÄ±yor.</p>
            </div>

            <div class="grid-2">
                <div class="module-box">
                    <div class="module-title">ğŸ“¦ Cart ModÃ¼lÃ¼</div>
                    <div class="module-desc">
                        <strong>Sorumluluk:</strong> Sepet yÃ¶netimi, item ekleme/Ã§Ä±karma, fiyat hesaplama, vergi, kupon, sipariÅŸ dÃ¶nÃ¼ÅŸÃ¼mÃ¼
                        <ul>
                            <li><strong>CartService:</strong> Ä°ÅŸ mantÄ±ÄŸÄ± merkezi</li>
                            <li><strong>Cart Model:</strong> Sepet verisi (session/customer tracking)</li>
                            <li><strong>CartItem Model:</strong> Sepet iÃ§erikleri (polymorphic)</li>
                            <li><strong>CartWidget:</strong> Header'da mini sepet (Livewire)</li>
                            <li><strong>CartApiController:</strong> API endpoint'leri</li>
                        </ul>
                    </div>
                </div>

                <div class="module-box">
                    <div class="module-title">ğŸ›ï¸ Shop ModÃ¼lÃ¼</div>
                    <div class="module-desc">
                        <strong>Sorumluluk:</strong> ÃœrÃ¼n yÃ¶netimi, stok kontrolÃ¼, fiyatlandÄ±rma, cart entegrasyonu
                        <ul>
                            <li><strong>ShopProduct Model:</strong> ÃœrÃ¼n verisi</li>
                            <li><strong>ShopCartBridge:</strong> Shop â†’ Cart entegrasyonu</li>
                            <li><strong>AddToCartButton:</strong> Sepete ekle component (Livewire)</li>
                            <li><strong>Product Card:</strong> ÃœrÃ¼n kartÄ± (Alpine.js + API)</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- 2. VERÄ° AKIÅI -->
        <section>
            <h2><span class="icon">ğŸ”„</span> Veri AkÄ±ÅŸÄ± - Sepete Ekleme Ä°ÅŸlemi</h2>

            <div class="flow-diagram">
                <h3>Homepage Add to Cart Flow (Alpine.js + API)</h3>

                <div class="flow-step">
                    <div class="number">1</div>
                    <div class="content">
                        <div class="title">KullanÄ±cÄ± TÄ±klar</div>
                        <div class="description">Product card Ã¼zerindeki "Sepete Ekle" butonuna tÄ±klar. Alpine.js <code>addToCart()</code> metodu tetiklenir.</div>
                    </div>
                </div>

                <div class="flow-step">
                    <div class="number">2</div>
                    <div class="content">
                        <div class="title">localStorage Cart ID KontrolÃ¼</div>
                        <div class="description">Alpine.js, localStorage'dan <code>cart_id</code> okur. Varsa API'ye gÃ¶nderilir (persistent cart).</div>
                    </div>
                </div>

                <div class="flow-step">
                    <div class="number">3</div>
                    <div class="content">
                        <div class="title">API Request</div>
                        <div class="description"><code>POST /api/cart/add</code> endpoint'ine istek gÃ¶nderilir. Payload: <code>{ product_id, quantity, cart_id }</code></div>
                    </div>
                </div>

                <div class="flow-step">
                    <div class="number">4</div>
                    <div class="content">
                        <div class="title">CartApiController</div>
                        <div class="description">Gelen isteÄŸi alÄ±r, Ã¼rÃ¼nÃ¼ database'den Ã§eker, <span class="tech-term">ShopCartBridge</span> ile stok/fiyat kontrolÃ¼ yapar.</div>
                    </div>
                </div>

                <div class="flow-step">
                    <div class="number">5</div>
                    <div class="content">
                        <div class="title">CartService - Sepet Bulma</div>
                        <div class="description">
                            <strong>1. Ã–ncelik:</strong> localStorage'dan gelen <code>cart_id</code> ile sepet bulunur.<br>
                            <strong>2. Fallback:</strong> Session ID ile sepet bulunur.<br>
                            <strong>3. OluÅŸturma:</strong> Yoksa yeni sepet oluÅŸturulur.
                        </div>
                    </div>
                </div>

                <div class="flow-step">
                    <div class="number">6</div>
                    <div class="content">
                        <div class="title">CartService - Item Ekleme</div>
                        <div class="description">
                            <strong>AynÄ± Ã¼rÃ¼n zaten sepette mi?</strong><br>
                            â†’ Varsa: Quantity artÄ±rÄ±lÄ±r, fiyatlar yeniden hesaplanÄ±r.<br>
                            â†’ Yoksa: Yeni <span class="tech-term">CartItem</span> oluÅŸturulur. Fiyat, vergi, currency conversion hesaplanÄ±r.
                        </div>
                    </div>
                </div>

                <div class="flow-step">
                    <div class="number">7</div>
                    <div class="content">
                        <div class="title">Cart Recalculation</div>
                        <div class="description">Sepet toplamlarÄ± yeniden hesaplanÄ±r: <code>subtotal</code>, <code>tax_amount</code>, <code>total</code>, <code>items_count</code></div>
                    </div>
                </div>

                <div class="flow-step">
                    <div class="number">8</div>
                    <div class="content">
                        <div class="title">API Response</div>
                        <div class="description">BaÅŸarÄ±lÄ± response dÃ¶ner: <code>{ success: true, data: { cart_id, item_count, total } }</code></div>
                    </div>
                </div>

                <div class="flow-step">
                    <div class="number">9</div>
                    <div class="content">
                        <div class="title">Frontend Update</div>
                        <div class="description">
                            <strong>1. localStorage GÃ¼ncelleme:</strong> <code>cart_id</code> kaydedilir.<br>
                            <strong>2. Event Dispatch:</strong> <code>window.dispatchEvent('cart-updated')</code> ve <code>Livewire.dispatch('cartUpdated')</code><br>
                            <strong>3. CartWidget Refresh:</strong> Header'daki mini sepet gÃ¼ncellenir (badge + item count).
                        </div>
                    </div>
                </div>
            </div>

            <div class="flow-diagram">
                <h3>Shop Pages Add to Cart Flow (Livewire)</h3>

                <div class="flow-step">
                    <div class="number">1</div>
                    <div class="content">
                        <div class="title">KullanÄ±cÄ± TÄ±klar</div>
                        <div class="description">ÃœrÃ¼n detay/kategori sayfasÄ±nda "Sepete Ekle" butonuna tÄ±klar. Livewire <code>AddToCartButton</code> component tetiklenir.</div>
                    </div>
                </div>

                <div class="flow-step">
                    <div class="number">2</div>
                    <div class="content">
                        <div class="title">Livewire Component (AddToCartButton)</div>
                        <div class="description">Server-side iÅŸlem baÅŸlar. Session/Customer ID otomatik tanÄ±nÄ±r (Livewire native).</div>
                    </div>
                </div>

                <div class="flow-step">
                    <div class="number">3</div>
                    <div class="content">
                        <div class="title">CartService - Direct Call</div>
                        <div class="description">API kullanmadan doÄŸrudan <code>CartService::addItem()</code> Ã§aÄŸrÄ±lÄ±r. AynÄ± mantÄ±k: sepet bul/oluÅŸtur, item ekle, hesapla.</div>
                    </div>
                </div>

                <div class="flow-step">
                    <div class="number">4</div>
                    <div class="content">
                        <div class="title">Event Dispatch (Livewire)</div>
                        <div class="description"><code>$this->dispatch('cartUpdated')</code> ve <code>$this->js('window.dispatchEvent...')</code> ile CartWidget bilgilendirilir.</div>
                    </div>
                </div>

                <div class="flow-step">
                    <div class="number">5</div>
                    <div class="content">
                        <div class="title">CartWidget Refresh</div>
                        <div class="description">Livewire CartWidget component <code>#[On('cartUpdated')]</code> ile gÃ¼ncellenir.</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 3. CART MODÃœLÃœNDEKÄ° DETAYLAR -->
        <section>
            <h2><span class="icon">ğŸ”§</span> Cart ModÃ¼lÃ¼ - Teknik Detaylar</h2>

            <div class="analysis-card">
                <h3>CartService - Ä°ÅŸ MantÄ±ÄŸÄ± Merkezi</h3>
                <p><strong>Sorumluluk:</strong> TÃ¼m sepet iÅŸlemlerinin merkezi koordinasyonu.</p>
                <ul>
                    <li><strong>getCart():</strong> Session veya Customer ID ile mevcut sepeti bulur.</li>
                    <li><strong>findOrCreateCart():</strong> Sepet bulur veya oluÅŸturur (guest/registered user iÃ§in).</li>
                    <li><strong>addItem():</strong> ÃœrÃ¼nÃ¼ sepete ekler. AynÄ± Ã¼rÃ¼n varsa quantity artÄ±rÄ±r, yoksa yeni <span class="tech-term">CartItem</span> oluÅŸturur.</li>
                    <li><strong>updateItemQuantity():</strong> Sepetteki Ã¼rÃ¼n miktarÄ±nÄ± gÃ¼nceller.</li>
                    <li><strong>removeItem():</strong> Sepetten Ã¼rÃ¼n kaldÄ±rÄ±r.</li>
                    <li><strong>clearCart():</strong> Sepeti tamamen boÅŸaltÄ±r.</li>
                    <li><strong>applyCoupon():</strong> Ä°ndirim kuponu uygular.</li>
                    <li><strong>convertToOrder():</strong> Sepeti sipariÅŸe dÃ¶nÃ¼ÅŸtÃ¼rÃ¼r.</li>
                    <li><strong>mergeGuestCart():</strong> Misafir sepetini kayÄ±tlÄ± kullanÄ±cÄ± sepetine birleÅŸtirir (login sonrasÄ±).</li>
                </ul>

                <p style="margin-top: 15px;"><strong>ğŸ’¡ Ã–nemli Ã–zellik:</strong> <code>ensureTenantContext()</code> metodu sayesinde central database'de yanlÄ±ÅŸlÄ±kla cart sorgusu yapÄ±lmasÄ± engellenir. Tenant context yoksa iÅŸlem yapÄ±lmaz.</p>
            </div>

            <div class="analysis-card">
                <h3>Cart Model - Sepet Verisi</h3>
                <p><strong>Database Tablosu:</strong> <code>carts</code></p>
                <ul>
                    <li><strong>customer_id:</strong> KayÄ±tlÄ± kullanÄ±cÄ± (nullable - guest iÃ§in null)</li>
                    <li><strong>session_id:</strong> Session tracking (guest iÃ§in zorunlu)</li>
                    <li><strong>status:</strong> active, converted, abandoned, merged</li>
                    <li><strong>items_count:</strong> Toplam Ã¼rÃ¼n adedi</li>
                    <li><strong>subtotal:</strong> Ara toplam (vergi hariÃ§)</li>
                    <li><strong>tax_amount:</strong> Toplam vergi tutarÄ±</li>
                    <li><strong>total:</strong> Genel toplam (vergi dahil)</li>
                    <li><strong>coupon_code + coupon_discount:</strong> Ä°ndirim kuponu</li>
                    <li><strong>billing_address + shipping_address:</strong> Adres bilgileri (JSON)</li>
                    <li><strong>abandoned_at:</strong> Terk edilme zamanÄ±</li>
                    <li><strong>recovery_token:</strong> Sepet kurtarma linki iÃ§in</li>
                </ul>

                <p style="margin-top: 15px;"><strong>ğŸ’¡ Tenant Protection:</strong> Model'de <code>booted()</code> metodu ile global scope ekleniyor. Tenant context yoksa hiÃ§bir sorgu sonuÃ§ dÃ¶ndÃ¼rmez.</p>
            </div>

            <div class="analysis-card">
                <h3>CartItem Model - Polymorphic Items</h3>
                <p><strong>Database Tablosu:</strong> <code>cart_items</code></p>
                <ul>
                    <li><strong>cartable_type + cartable_id:</strong> <span class="tech-term">Polymorphic Relationship</span> <span class="explanation">(Esnek iliÅŸki - ShopProduct, Subscription, Service vb. olabilir)</span></li>
                    <li><strong>product_id:</strong> Backward compatibility iÃ§in (eski sistemlerle uyumluluk)</li>
                    <li><strong>quantity:</strong> ÃœrÃ¼n adedi</li>
                    <li><strong>unit_price:</strong> Birim fiyat</li>
                    <li><strong>discount_amount:</strong> Ä°ndirim miktarÄ±</li>
                    <li><strong>final_price:</strong> Ä°ndirimli fiyat (unit_price - discount)</li>
                    <li><strong>tax_rate + tax_amount:</strong> Vergi oranÄ± ve tutarÄ±</li>
                    <li><strong>subtotal:</strong> Ara toplam (final_price Ã— quantity)</li>
                    <li><strong>total:</strong> Toplam (subtotal + tax_amount)</li>
                    <li><strong>item_title, item_image, item_sku:</strong> Display bilgileri (snapshot - Ã¼rÃ¼n silinse bile sepette gÃ¶rÃ¼nÃ¼r)</li>
                    <li><strong>original_currency, original_price, conversion_rate:</strong> Para birimi dÃ¶nÃ¼ÅŸÃ¼mÃ¼ metadata</li>
                </ul>

                <p style="margin-top: 15px;"><strong>ğŸ’¡ Polymorphic Design:</strong> Bu sayede sadece Shop Ã¼rÃ¼nleri deÄŸil, Subscription planlarÄ±, Service hizmetleri de sepete eklenebilir. Esnek yapÄ±!</p>
            </div>

            <div class="analysis-card">
                <h3>CartWidget - Header Mini Sepet (Livewire)</h3>
                <p><strong>Sorumluluk:</strong> Header'da sepet badge'i ve dropdown menu.</p>
                <ul>
                    <li><strong>mount():</strong> Component baÅŸlatÄ±ldÄ±ÄŸÄ±nda sepet yÃ¼klenmez (localStorage ile senkron kalmak iÃ§in).</li>
                    <li><strong>refreshCart():</strong> <code>@On('cartUpdated')</code> event'i ile tetiklenir. Session ile cart bulup yÃ¼kler.</li>
                    <li><strong>refreshCartById():</strong> localStorage'dan gelen <code>cart_id</code> ile direkt yÃ¼kleme (performanslÄ±).</li>
                    <li><strong>removeItem():</strong> Mini sepetten Ã¼rÃ¼n silme.</li>
                    <li><strong>increaseQuantity() / decreaseQuantity():</strong> Mini sepetten miktar deÄŸiÅŸtirme.</li>
                </ul>

                <p style="margin-top: 15px;"><strong>âš ï¸ Ä°yileÅŸtirme FÄ±rsatÄ±:</strong> localStorage sync gecikmesi var. <code>@script</code> directive ile sayfa yÃ¼klendiÄŸinde cart_id localStorage'dan okunup <code>refreshCartById()</code> tetiklenmeli.</p>
            </div>
        </section>

        <!-- 4. SHOP ENTEGRASYONU -->
        <section>
            <h2><span class="icon">ğŸ”—</span> Shop ModÃ¼lÃ¼ Entegrasyonu</h2>

            <div class="analysis-card">
                <h3>ShopCartBridge - KÃ¶prÃ¼ Servisi</h3>
                <p><strong>AmaÃ§:</strong> Shop modÃ¼lÃ¼ ile Cart modÃ¼lÃ¼ arasÄ±ndaki veri dÃ¶nÃ¼ÅŸÃ¼mÃ¼ ve iÅŸ kurallarÄ±nÄ± yÃ¶netir.</p>

                <p style="margin-top: 15px;"><strong>prepareProductForCart() Metodu:</strong></p>
                <ul>
                    <li><strong>Stok KontrolÃ¼:</strong> <code>validateStock()</code> ile stok yeterliliÄŸi kontrol edilir. <code>stock_tracking</code> aktifse ve stok yetersizse, <code>allow_backorder</code> kontrolÃ¼ yapÄ±lÄ±r.</li>
                    <li><strong>Display Bilgileri:</strong> <code>getProductDisplayInfo()</code> ile Ã¼rÃ¼n baÅŸlÄ±ÄŸÄ±, resmi, SKU kodu alÄ±nÄ±r. Snapshot olarak cart_items tablosuna kaydedilir.</li>
                    <li><strong>Fiyat Bilgileri:</strong> <code>getProductPriceInfo()</code> ile final_price, currency bilgisi alÄ±nÄ±r.</li>
                    <li><strong>Vergi Bilgileri:</strong> <code>getProductTaxInfo()</code> ile tax_rate alÄ±nÄ±r (varsayÄ±lan %20 KDV).</li>
                </ul>

                <p style="margin-top: 15px;"><strong>canAddToCart() Metodu:</strong></p>
                <ul>
                    <li>ÃœrÃ¼n aktif mi? (<code>is_active</code>)</li>
                    <li>Stok yeterli mi? (stok takibi varsa)</li>
                    <li>Backorder izni var mÄ±? (stok yoksa)</li>
                </ul>

                <p style="margin-top: 15px;"><strong>getCartItemErrors() Metodu:</strong></p>
                <p>KullanÄ±cÄ±ya gÃ¶sterilecek hata mesajlarÄ±nÄ± dÃ¶ner:</p>
                <ul>
                    <li>"ÃœrÃ¼n ÅŸu anda satÄ±ÅŸta deÄŸil."</li>
                    <li>"Stok yetersiz. Mevcut stok: X"</li>
                    <li>"ÃœrÃ¼n ÅŸu anda stokta yok. SipariÅŸ verebilirsiniz, tedarik sÃ¼resi: X gÃ¼n."</li>
                </ul>
            </div>

            <div class="analysis-card">
                <h3>AddToCartButton - Livewire Component (Shop SayfalarÄ±nda)</h3>
                <p><strong>KullanÄ±m Yeri:</strong> ÃœrÃ¼n detay sayfasÄ±, kategori sayfasÄ±.</p>
                <p><strong>Ã–zellikler:</strong></p>
                <ul>
                    <li><strong>Quantity Selector:</strong> <code>showQuantity</code> prop'u ile adet seÃ§imi gÃ¶sterilebilir.</li>
                    <li><strong>Loading State:</strong> <code>isAdding</code> ile buton disable edilir, spinner gÃ¶sterilir.</li>
                    <li><strong>Event Dispatch:</strong> Sepete eklenince hem Livewire event (<code>cartUpdated</code>) hem browser event (<code>cart-updated</code>) gÃ¶nderilir.</li>
                </ul>

                <p style="margin-top: 15px;"><strong>ğŸ¯ AkÄ±ÅŸ:</strong></p>
                <ol>
                    <li>KullanÄ±cÄ± buton tÄ±klar â†’ <code>addToCart()</code> metodu Ã§aÄŸrÄ±lÄ±r.</li>
                    <li>Stok kontrolÃ¼ â†’ <code>ShopCartBridge::canAddToCart()</code></li>
                    <li>Session/Customer ID alÄ±nÄ±r.</li>
                    <li>CartService ile sepet bulunur/oluÅŸturulur.</li>
                    <li>Bridge ile Ã¼rÃ¼n bilgileri hazÄ±rlanÄ±r (<code>prepareProductForCart()</code>).</li>
                    <li>CartService ile item eklenir.</li>
                    <li>Event dispatch â†’ CartWidget refresh.</li>
                </ol>
            </div>
        </section>

        <!-- 5. HOMEPAGE PRODUCT CARD -->
        <section>
            <h2><span class="icon">ğŸ </span> Homepage Product Card - Alpine.js + API</h2>

            <div class="analysis-card">
                <h3>Product Card Component</h3>
                <p><strong>Dosya:</strong> <code>resources/views/components/ixtif/product-card.blade.php</code></p>
                <p><strong>KullanÄ±m Yeri:</strong> Homepage Ã¼rÃ¼n listesi.</p>

                <p style="margin-top: 15px;"><strong>Ã–zellikler:</strong></p>
                <ul>
                    <li><strong>Alpine.js Component:</strong> <code>x-data="productCard()"</code> ile client-side reactive state.</li>
                    <li><strong>API Call:</strong> <code>addToCart()</code> metodu <code>fetch('/api/cart/add')</code> ile API'ye istek gÃ¶nderir.</li>
                    <li><strong>localStorage Sync:</strong> <code>cart_id</code> localStorage'a kaydedilir ve API'ye gÃ¶nderilir.</li>
                    <li><strong>Loading/Success States:</strong> <code>loading</code> ve <code>success</code> reactive deÄŸiÅŸkenleri ile buton durumu kontrol edilir.</li>
                    <li><strong>Event Dispatch:</strong> API baÅŸarÄ±lÄ± response dÃ¶nÃ¼nce <code>window.dispatchEvent('cart-updated')</code> ve <code>Livewire.dispatch('cartUpdated')</code> gÃ¶nderilir.</li>
                </ul>

                <p style="margin-top: 15px;"><strong>ğŸ¯ AkÄ±ÅŸ:</strong></p>
                <ol>
                    <li>KullanÄ±cÄ± buton tÄ±klar â†’ Alpine.js <code>addToCart()</code> tetiklenir.</li>
                    <li>localStorage'dan <code>cart_id</code> okunur.</li>
                    <li><code>POST /api/cart/add</code> isteÄŸi gÃ¶nderilir (product_id, quantity, cart_id).</li>
                    <li>API response â†’ baÅŸarÄ±lÄ±ysa <code>cart_id</code> localStorage'a kaydedilir.</li>
                    <li>Event dispatch â†’ CartWidget refresh.</li>
                    <li>Success state â†’ 2 saniye sonra reset.</li>
                </ol>
            </div>

            <div class="analysis-card">
                <h3>CartApiController - API Endpoint</h3>
                <p><strong>Endpoint:</strong> <code>POST /api/cart/add</code></p>
                <p><strong>Request Validation:</strong></p>
                <ul>
                    <li><code>product_id</code> - zorunlu, integer, <code>shop_products</code> tablosunda var mÄ±?</li>
                    <li><code>quantity</code> - opsiyonel, integer, minimum 1 (varsayÄ±lan: 1)</li>
                    <li><code>variant_id</code> - opsiyonel, integer (varyant desteÄŸi)</li>
                    <li><code>cart_id</code> - opsiyonel, integer (localStorage'dan gelen persistent cart)</li>
                </ul>

                <p style="margin-top: 15px;"><strong>Ä°ÅŸlem AdÄ±mlarÄ±:</strong></p>
                <ol>
                    <li>ÃœrÃ¼nÃ¼ database'den Ã§ek (<code>ShopProduct::findOrFail()</code>).</li>
                    <li>Stok kontrolÃ¼ (<code>ShopCartBridge::canAddToCart()</code>).</li>
                    <li>Session ID ve Customer ID al.</li>
                    <li>localStorage'dan gelen <code>cart_id</code> ile sepet bul. Yoksa session ile bul/oluÅŸtur.</li>
                    <li>Bridge ile Ã¼rÃ¼n bilgilerini hazÄ±rla (<code>prepareProductForCart()</code>).</li>
                    <li>CartService ile item ekle.</li>
                    <li>Cart refresh â†’ item_count hesapla.</li>
                    <li>JSON response dÃ¶n: <code>{ success, message, data: { cart_id, item_count, total } }</code></li>
                </ol>

                <p style="margin-top: 15px;"><strong>ğŸ’¡ Ã–nemli:</strong> API, <code>cart_id</code> parametresini destekliyor. Bu sayede localStorage ile persistent cart Ã§alÄ±ÅŸÄ±yor. KullanÄ±cÄ± sayfayÄ± yenileyip sepete Ã¼rÃ¼n eklese bile aynÄ± sepet kullanÄ±lÄ±yor.</p>
            </div>
        </section>

        <!-- 6. GÃœÃ‡LÃœ YÃ–NLER -->
        <section>
            <h2><span class="icon">âœ…</span> GÃ¼Ã§lÃ¼ YÃ¶nler</h2>

            <div class="strength">
                <strong>Polymorphic Design - Esnek Item Sistemi:</strong> CartItem modeli polymorphic relationship kullanÄ±yor. Sadece Shop Ã¼rÃ¼nleri deÄŸil, Subscription, Service, Course gibi her tÃ¼rlÃ¼ item sepete eklenebilir. Gelecekte yeni item tÃ¼rleri eklemek Ã§ok kolay.
            </div>

            <div class="strength">
                <strong>Currency Conversion - DÃ¶viz DÃ¶nÃ¼ÅŸÃ¼mÃ¼:</strong> ÃœrÃ¼nler USD/EUR gibi dÃ¶vizlerle fiyatlandÄ±rÄ±labilir. CartService otomatik olarak TRY'ye Ã§evirir. <code>original_currency</code>, <code>original_price</code>, <code>conversion_rate</code> metadata olarak saklanÄ±r.
            </div>

            <div class="strength">
                <strong>Stock Validation - Stok KontrolÃ¼:</strong> ShopCartBridge servisi ile stok kontrolÃ¼ yapÄ±lÄ±yor. <code>stock_tracking</code>, <code>allow_backorder</code>, <code>lead_time_days</code> gibi Ã¶zellikler destekleniyor.
            </div>

            <div class="strength">
                <strong>Tax Calculation - Vergi Hesaplama:</strong> Her item iÃ§in ayrÄ± vergi oranÄ± (<code>tax_rate</code>) saklanÄ±yor. Sepet toplamÄ±nda vergi ayrÄ± ayrÄ± hesaplanÄ±p gÃ¶steriliyor.
            </div>

            <div class="strength">
                <strong>Guest + Registered User Support - Misafir ve Ãœye DesteÄŸi:</strong> Hem misafir kullanÄ±cÄ±lar (session_id ile) hem kayÄ±tlÄ± kullanÄ±cÄ±lar (customer_id ile) sepet oluÅŸturabiliyor. Login sonrasÄ± <code>mergeGuestCart()</code> ile sepetler birleÅŸtiriliyor.
            </div>

            <div class="strength">
                <strong>API-First Approach - API Ã–ncelikli YaklaÅŸÄ±m:</strong> Homepage product card API kullanÄ±yor. Bu sayede gelecekte mobile app, SPA, headless commerce gibi farklÄ± frontend'ler kolayca entegre edilebilir.
            </div>

            <div class="strength">
                <strong>Event-Driven Updates - Olay BazlÄ± GÃ¼ncellemeler:</strong> Sepete Ã¼rÃ¼n eklenince CartWidget otomatik gÃ¼ncelleniyor. Event sistemi sayesinde farklÄ± componentler birbirine baÄŸlÄ± Ã§alÄ±ÅŸÄ±yor.
            </div>

            <div class="strength">
                <strong>localStorage Persistence - KalÄ±cÄ± Sepet:</strong> <code>cart_id</code> localStorage'da saklanÄ±yor. KullanÄ±cÄ± sayfayÄ± yenilese bile sepet korunuyor.
            </div>

            <div class="strength">
                <strong>Tenant Context Protection - Tenant Koruma:</strong> Cart ve CartItem modellerinde global scope ile tenant context kontrolÃ¼ yapÄ±lÄ±yor. Central database'de yanlÄ±ÅŸlÄ±kla cart sorgusu yapÄ±lmasÄ± engelleniyor.
            </div>

            <div class="strength">
                <strong>Display Data Snapshot - Veri AnlÄ±k GÃ¶rÃ¼ntÃ¼sÃ¼:</strong> <code>item_title</code>, <code>item_image</code>, <code>item_sku</code> gibi display bilgileri cart_items tablosuna kaydediliyor. ÃœrÃ¼n silinse veya gÃ¼ncellense bile sepette doÄŸru bilgiler gÃ¶steriliyor.
            </div>
        </section>

        <!-- 7. Ä°YÄ°LEÅTÄ°RME FIRSATLARI -->
        <section>
            <h2><span class="icon">âš¡</span> Ä°yileÅŸtirme FÄ±rsatlarÄ±</h2>

            <div class="improvement">
                <strong>Homepage vs Shop Pages - TutarlÄ±lÄ±k EksikliÄŸi:</strong> Homepage product card Alpine.js + API kullanÄ±rken, shop sayfalarÄ± Livewire kullanÄ±yor. Ä°ki farklÄ± yaklaÅŸÄ±m kafa karÄ±ÅŸtÄ±rÄ±cÄ±. Ã–neri: TÃ¼m sayfalar API kullansÄ±n veya tÃ¼m sayfalar Livewire kullansÄ±n.
            </div>

            <div class="improvement">
                <strong>CartWidget localStorage Sync - Senkronizasyon Gecikmesi:</strong> CartWidget component mount() metodunda sepet yÃ¼klenmiyor. localStorage'da <code>cart_id</code> varsa sayfa yÃ¼klendiÄŸinde CartWidget otomatik refresh edilmeli. Ã–neri: <code>@script</code> directive ile DOMContentLoaded event'inde <code>refreshCartById()</code> Ã§aÄŸÄ±r.
            </div>

            <div class="improvement">
                <strong>Event Duplication - Olay Duplikasyonu:</strong> Hem <code>Livewire.dispatch('cartUpdated')</code> hem <code>window.dispatchEvent('cart-updated')</code> kullanÄ±lÄ±yor. Ä°ki farklÄ± event sistemi gereksiz. Ã–neri: Tek bir event sistemi seÃ§ (Livewire events daha gÃ¼Ã§lÃ¼, Alpine.js ile de uyumlu).
            </div>

            <div class="improvement">
                <strong>Error Handling - Hata YÃ¶netimi:</strong> API hata mesajlarÄ± kullanÄ±cÄ±ya <code>alert()</code> ile gÃ¶steriliyor. Modern UX iÃ§in toast notification veya inline error message kullanÄ±lmalÄ±. Ã–neri: Alpine.js notification component veya Livewire flash messages.
            </div>

            <div class="improvement">
                <strong>Optimistic Updates - Ä°yimser GÃ¼ncellemeler:</strong> Sepete Ã¼rÃ¼n eklenince buton "loading" state'e geÃ§iyor ama CartWidget hemen gÃ¼ncellenmiyor. API response beklenene kadar kullanÄ±cÄ± badge gÃ¼ncellemesini gÃ¶rmÃ¼yor. Ã–neri: Optimistic update - item_count anÄ±nda artÄ±rÄ±lsÄ±n, API fail olursa geri alÄ±nsÄ±n.
            </div>

            <div class="improvement">
                <strong>Cart Abandonment - Terk Edilen Sepet:</strong> <code>abandoned_at</code>, <code>recovery_token</code>, <code>recovery_email_sent_at</code> fieldlarÄ± var ama recovery sistemi pasif. Ã–neri: Cron job ile terk edilen sepetler tespit edilip kullanÄ±cÄ±ya e-posta gÃ¶nderilebilir.
            </div>

            <div class="improvement">
                <strong>Real-time Stock Check - GerÃ§ek ZamanlÄ± Stok KontrolÃ¼:</strong> Sepete ekleme sÄ±rasÄ±nda stok kontrolÃ¼ yapÄ±lÄ±yor ama sepet sayfasÄ±nda gÃ¼ncel stok durumu kontrol edilmiyor. KullanÄ±cÄ± 1 saat Ã¶nce eklediÄŸi Ã¼rÃ¼nÃ¼ satÄ±n almaya Ã§alÄ±ÅŸÄ±rken stok bitmiÅŸ olabilir. Ã–neri: Checkout baÅŸlamadan Ã¶nce <code>checkStock()</code> metodu Ã§aÄŸrÄ±lmalÄ±.
            </div>

            <div class="improvement">
                <strong>Coupon Validation - Kupon DoÄŸrulama:</strong> <code>applyCoupon()</code> metodu var ama kupon validasyonu yok. Kupon kodu kontrol edilmiyor, indirim miktarÄ± direk parametre olarak geliyor. Ã–neri: Coupon modÃ¼lÃ¼ eklenmeli, kupon kodlarÄ± database'de tutulmalÄ±, geÃ§erlilik, kullanÄ±m limiti, minimum tutar gibi kurallar uygulanmalÄ±.
            </div>

            <div class="improvement">
                <strong>Performance - N+1 Query Problemi:</strong> Product card'da <code>getFirstMediaWithFallback()</code> her Ã¼rÃ¼n iÃ§in ayrÄ± media sorgusu yapÄ±yor olabilir. Ã–neri: Homepage controller'da Ã¼rÃ¼nler Ã§ekilirken <code>with('media')</code> ile eager loading yapÄ±lmalÄ±.
            </div>

            <div class="improvement">
                <strong>Analytics - Sepet AnalitiÄŸi:</strong> Sepete ekleme, sepetten Ã§Ä±karma, terk edilme gibi olaylar track edilmiyor. Ã–neri: Google Analytics veya internal analytics sistemi ile sepet olaylarÄ± loglanmalÄ±. Hangi Ã¼rÃ¼nler Ã§ok sepete ekleniyor ama satÄ±n alÄ±nmÄ±yor? (conversion funnel analysis)
            </div>
        </section>

        <!-- 8. GELÄ°ÅTÄ°RME Ã–NERÄ°LERÄ° -->
        <section>
            <h2><span class="icon">ğŸš€</span> GeliÅŸtirme Ã–nerileri</h2>

            <div class="analysis-card">
                <h3>KÄ±sa Vadeli Ä°yileÅŸtirmeler (1-2 Hafta)</h3>
                <ol>
                    <li><strong>CartWidget localStorage sync dÃ¼zelt:</strong> Sayfa yÃ¼klendiÄŸinde localStorage <code>cart_id</code> ile otomatik refresh.</li>
                    <li><strong>Toast notification ekle:</strong> Alpine.js notification component ile kullanÄ±cÄ±ya baÅŸarÄ±/hata mesajlarÄ± gÃ¶ster.</li>
                    <li><strong>Optimistic update:</strong> Sepete ekleme butonunda anÄ±nda success state, API fail olursa geri al.</li>
                    <li><strong>Event sistemi standartlaÅŸtÄ±r:</strong> Sadece Livewire events kullan veya sadece browser events kullan.</li>
                    <li><strong>Homepage product card eager loading:</strong> N+1 query problemini Ã§Ã¶z.</li>
                </ol>
            </div>

            <div class="analysis-card">
                <h3>Orta Vadeli Ä°yileÅŸtirmeler (1-2 Ay)</h3>
                <ol>
                    <li><strong>Coupon modÃ¼lÃ¼:</strong> Kupon kodu validasyonu, kullanÄ±m limiti, minimum tutar, geÃ§erlilik tarihi.</li>
                    <li><strong>Real-time stock check:</strong> Checkout Ã¶ncesi sepetteki tÃ¼m Ã¼rÃ¼nlerin stok durumunu kontrol et.</li>
                    <li><strong>Cart abandonment recovery:</strong> Cron job ile terk edilen sepetler tespit et, recovery e-postasÄ± gÃ¶nder.</li>
                    <li><strong>Analytics integration:</strong> Google Analytics veya internal analytics ile sepet olaylarÄ±nÄ± track et.</li>
                    <li><strong>Homepage/Shop sayfalarÄ± tutarlÄ±lÄ±k:</strong> TÃ¼m sayfalarda aynÄ± add to cart yaklaÅŸÄ±mÄ±nÄ± kullan (API veya Livewire - birini seÃ§).</li>
                </ol>
            </div>

            <div class="analysis-card">
                <h3>Uzun Vadeli Ä°yileÅŸtirmeler (3-6 Ay)</h3>
                <ol>
                    <li><strong>Wishlist entegrasyonu:</strong> Sepet ile wishlist arasÄ±nda Ã¼rÃ¼n taÅŸÄ±ma (<code>moved_from_wishlist</code> field var ama kullanÄ±lmÄ±yor).</li>
                    <li><strong>Cart sharing:</strong> KullanÄ±cÄ± sepetini baÅŸkasÄ±yla paylaÅŸabilsin (recovery_token ile public cart URL).</li>
                    <li><strong>Saved carts:</strong> KullanÄ±cÄ± birden fazla sepet oluÅŸturabilsin ("Ofis AlÄ±ÅŸveriÅŸi", "Ev AlÄ±ÅŸveriÅŸi" gibi).</li>
                    <li><strong>Bulk operations:</strong> Sepetteki tÃ¼m Ã¼rÃ¼nleri hÄ±zlÄ±ca temizle, wishlist'e taÅŸÄ±, baÅŸka sepete kopyala.</li>
                    <li><strong>Subscription support:</strong> Subscription planlarÄ± iÃ§in recurring cart (aylÄ±k/yÄ±llÄ±k otomatik yenileme).</li>
                    <li><strong>Mobile app API:</strong> TÃ¼m cart iÅŸlemleri iÃ§in RESTful API dokÃ¼mantasyonu ve versiyonlama.</li>
                </ol>
            </div>
        </section>

        <!-- 9. SONUÃ‡ -->
        <section>
            <h2><span class="icon">ğŸ“Š</span> Genel DeÄŸerlendirme</h2>

            <div class="highlight-box">
                <div class="title">Sistem SaÄŸlamlÄ±ÄŸÄ±: 8/10</div>
                <p><strong>GÃ¼Ã§lÃ¼ YÃ¶nler:</strong> Polymorphic design, currency conversion, stock validation, tax calculation, guest/registered user support, event-driven updates.</p>
                <p><strong>Ä°yileÅŸtirme AlanlarÄ±:</strong> CartWidget localStorage sync, event duplication, error handling, optimistic updates, coupon validation, analytics.</p>
            </div>

            <div class="highlight-box">
                <div class="title">Kod Kalitesi: 7.5/10</div>
                <p><strong>Ä°yi Yanlar:</strong> ModÃ¼ler yapÄ±, service pattern, bridge pattern, tenant protection, display data snapshot.</p>
                <p><strong>Ä°yileÅŸtirilmesi Gerekenler:</strong> Homepage vs Shop tutarlÄ±lÄ±ÄŸÄ±, N+1 query problemi, error handling, analytics eksikliÄŸi.</p>
            </div>

            <div class="highlight-box">
                <div class="title">KullanÄ±cÄ± Deneyimi: 7/10</div>
                <p><strong>Ä°yi Yanlar:</strong> localStorage persistence, mini cart widget, loading states, success feedback.</p>
                <p><strong>Ä°yileÅŸtirilmesi Gerekenler:</strong> Toast notifications, optimistic updates, real-time stock check, cart abandonment recovery.</p>
            </div>

            <div class="highlight-box">
                <div class="title">Ã–lÃ§eklenebilirlik: 9/10</div>
                <p><strong>Neden YÃ¼ksek?</strong> API-first approach, polymorphic design, multi-tenant architecture, event-driven updates. Gelecekte mobile app, SPA, headless commerce kolayca entegre edilebilir.</p>
            </div>

            <div class="highlight-box">
                <div class="title">Ã–ncelikli Aksiyonlar</div>
                <ol>
                    <li>CartWidget localStorage sync dÃ¼zelt (en kritik - sayfa yenilemede sepet badge'i kaybolmasÄ±n).</li>
                    <li>Toast notification ekle (kullanÄ±cÄ± deneyimi - alert() Ã§irkin).</li>
                    <li>Homepage/Shop tutarlÄ±lÄ±ÄŸÄ± saÄŸla (kod kalitesi - iki yaklaÅŸÄ±m kafa karÄ±ÅŸtÄ±rÄ±cÄ±).</li>
                    <li>Real-time stock check ekle (iÅŸ mantÄ±ÄŸÄ± - checkout'ta stok bitmiÅŸ hatasÄ± almasÄ±n).</li>
                    <li>Analytics integration (veri odaklÄ± karar - hangi Ã¼rÃ¼nler sepete ekleniyor ama satÄ±n alÄ±nmÄ±yor?).</li>
                </ol>
            </div>
        </section>

        <footer>
            ğŸ¤– Claude AI tarafÄ±ndan oluÅŸturuldu â€¢ 2025-12-02
        </footer>
    </div>
</body>
</html>
