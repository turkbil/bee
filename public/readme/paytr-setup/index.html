<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PayTR Global Ã–deme Sistemi - Kurulum Rehberi</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            font-size: 16px;
            line-height: 1.6;
        }
        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        .header h1 {
            font-size: 42px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        .header p {
            font-size: 20px;
            opacity: 0.9;
        }

        /* TAB MENU */
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 3px solid #667eea;
        }
        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            font-weight: bold;
            font-size: 18px;
            color: #666;
            border-right: 1px solid #ddd;
            transition: all 0.3s;
        }
        .tab:hover {
            background: #667eea;
            color: white;
        }
        .tab.active {
            background: #667eea;
            color: white;
        }

        /* CONTENT */
        .tab-content {
            display: none;
            padding: 40px;
        }
        .tab-content.active {
            display: block;
        }

        /* SECTION STYLES */
        .section {
            background: white;
            padding: 30px;
            margin-bottom: 25px;
            border-radius: 12px;
            border-left: 6px solid #667eea;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .section.success {
            border-left-color: #10b981;
            background: #f0fdf4;
        }
        .section.warning {
            border-left-color: #f59e0b;
            background: #fffbeb;
        }
        .section.danger {
            border-left-color: #ef4444;
            background: #fef2f2;
        }
        .section.info {
            border-left-color: #3b82f6;
            background: #eff6ff;
        }

        .section h2 {
            font-size: 28px;
            margin-bottom: 20px;
            color: #1f2937;
        }
        .section h3 {
            font-size: 22px;
            margin-top: 20px;
            margin-bottom: 15px;
            color: #374151;
        }

        /* STEP BOXES */
        .step-box {
            background: white;
            padding: 25px;
            margin-bottom: 20px;
            border-radius: 10px;
            border: 3px solid #667eea;
            position: relative;
        }
        .step-box.completed {
            border-color: #10b981;
            opacity: 0.7;
        }
        .step-number {
            position: absolute;
            top: -15px;
            left: 20px;
            background: #667eea;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        .step-box.completed .step-number {
            background: #10b981;
        }
        .step-box h4 {
            font-size: 20px;
            margin-bottom: 15px;
            color: #1f2937;
            margin-top: 10px;
        }

        /* CODE BLOCKS */
        .code-block {
            background: #1f2937;
            color: #10b981;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 15px 0;
            border: 2px solid #374151;
        }
        .code-block.bash {
            color: #60a5fa;
        }
        .code-block.php {
            color: #a78bfa;
        }

        /* ICONS */
        .icon {
            font-size: 24px;
            margin-right: 10px;
        }

        /* GRID */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        /* CARD */
        .card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-top: 4px solid #667eea;
        }
        .card h4 {
            font-size: 20px;
            margin-bottom: 15px;
            color: #1f2937;
        }
        .card ul {
            list-style: none;
            padding-left: 0;
        }
        .card ul li {
            padding: 8px 0;
            padding-left: 30px;
            position: relative;
        }
        .card ul li:before {
            content: "âœ“";
            position: absolute;
            left: 0;
            color: #10b981;
            font-weight: bold;
            font-size: 18px;
        }

        /* BADGE */
        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            margin-right: 10px;
        }
        .badge.success { background: #d1fae5; color: #065f46; }
        .badge.warning { background: #fef3c7; color: #92400e; }
        .badge.info { background: #dbeafe; color: #1e40af; }
        .badge.danger { background: #fee2e2; color: #991b1b; }

        /* TIMELINE */
        .timeline {
            position: relative;
            padding-left: 40px;
            margin: 30px 0;
        }
        .timeline:before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 3px;
            background: #667eea;
        }
        .timeline-item {
            position: relative;
            margin-bottom: 30px;
        }
        .timeline-item:before {
            content: '';
            position: absolute;
            left: -35px;
            top: 5px;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            background: #667eea;
            border: 3px solid white;
            box-shadow: 0 0 0 3px #667eea;
        }
        .timeline-item.completed:before {
            background: #10b981;
            box-shadow: 0 0 0 3px #10b981;
        }

        /* HIGHLIGHT BOX */
        .highlight {
            background: #fef3c7;
            border-left: 5px solid #f59e0b;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .highlight.success {
            background: #d1fae5;
            border-left-color: #10b981;
        }
        .highlight.danger {
            background: #fee2e2;
            border-left-color: #ef4444;
        }

        /* TABLE */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        table th {
            background: #667eea;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: bold;
        }
        table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e5e7eb;
        }
        table tr:hover {
            background: #f9fafb;
        }

        /* BUTTON */
        .btn {
            display: inline-block;
            padding: 12px 30px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.3s;
        }
        .btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        .btn.success {
            background: #10b981;
        }
        .btn.success:hover {
            background: #059669;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <h1>ğŸ’³ PayTR Global Ã–deme Sistemi</h1>
            <p>Polymorphic Ä°liÅŸki ile Merkezi Ã–deme AltyapÄ±sÄ± - Kurulum Rehberi</p>
        </div>

        <!-- TABS -->
        <div class="tabs">
            <div class="tab active" onclick="showTab(1)">
                <span class="icon">ğŸ¯</span> 1. NE YAPIYORUZ?
            </div>
            <div class="tab" onclick="showTab(2)">
                <span class="icon">ğŸ—ï¸</span> 2. MÄ°MARÄ°
            </div>
            <div class="tab" onclick="showTab(3)">
                <span class="icon">ğŸ“‹</span> 3. ADIMLAR
            </div>
            <div class="tab" onclick="showTab(4)">
                <span class="icon">ğŸ’»</span> 4. KOD Ã–RNEKLERÄ°
            </div>
            <div class="tab" onclick="showTab(5)">
                <span class="icon">ğŸ”</span> 5. PAYTR API
            </div>
        </div>

        <!-- TAB 1: NE YAPIYORUZ? -->
        <div class="tab-content active" id="tab1">
            <div class="section success">
                <h2><span class="icon">âœ…</span> Hedef: Global Ã–deme Sistemi</h2>
                <p style="font-size: 20px; line-height: 1.8;">
                    <strong>Åu an Shop modÃ¼lÃ¼ var ve sadece Ã¼rÃ¼n satÄ±ÅŸlarÄ± iÃ§in Ã¶deme alabiliyorsun.</strong><br><br>

                    <strong style="color: #10b981; font-size: 24px;">YENÄ° SÄ°STEM:</strong><br>
                    Tek Ã¶deme altyapÄ±sÄ± ile <strong>herhangi bir modÃ¼lden</strong> Ã¶deme alabileceksin:
                </p>
            </div>

            <div class="grid">
                <div class="card">
                    <h4>ğŸ›’ Shop ModÃ¼lÃ¼</h4>
                    <ul>
                        <li>ÃœrÃ¼n satÄ±ÅŸlarÄ±</li>
                        <li>Sepet Ã¶demeleri</li>
                        <li>Taksitli alÄ±ÅŸveriÅŸ</li>
                    </ul>
                </div>
                <div class="card">
                    <h4>ğŸ‘¤ Membership ModÃ¼lÃ¼</h4>
                    <ul>
                        <li>Ãœyelik Ã¶demeleri</li>
                        <li>Abonelik sistemi</li>
                        <li>AylÄ±k/yÄ±llÄ±k paketler</li>
                    </ul>
                </div>
                <div class="card">
                    <h4>ğŸ“… Booking ModÃ¼lÃ¼</h4>
                    <ul>
                        <li>Rezervasyon Ã¶demeleri</li>
                        <li>Kapora sistemi</li>
                        <li>Otel, araÃ§ kiralama</li>
                    </ul>
                </div>
                <div class="card">
                    <h4>ğŸ’° DiÄŸer ModÃ¼ller</h4>
                    <ul>
                        <li>BaÄŸÄ±ÅŸ sistemi</li>
                        <li>Fatura Ã¶demeleri</li>
                        <li>Gelecekteki modÃ¼ller</li>
                    </ul>
                </div>
            </div>

            <div class="highlight success">
                <h3><span class="icon">ğŸ‰</span> EN BÃœYÃœK AVANTAJ:</h3>
                <p style="font-size: 18px;">
                    <strong>Tek bir yerde tÃ¼m Ã¶demeler!</strong><br><br>
                    PayTR, Stripe, Iyzico gibi gateway'leri eklemek Ã§ok kolay.<br>
                    Yeni modÃ¼l eklersen, Ã¶deme altyapÄ±sÄ± hazÄ±r!
                </p>
            </div>

            <div class="section info">
                <h2><span class="icon">ğŸ”</span> Polymorphic Ä°liÅŸki Nedir?</h2>
                <p style="font-size: 18px; line-height: 1.8;">
                    <strong>Basit TÃ¼rkÃ§e:</strong><br><br>

                    <span class="badge info">ESKI YÃ–NTEM</span> Her modÃ¼l kendi Ã¶deme tablosunu yapÄ±yor:<br>
                    â€¢ shop_payments<br>
                    â€¢ membership_payments<br>
                    â€¢ booking_payments<br>
                    <strong style="color: #ef4444;">âŒ AynÄ± kod 3 kere yazÄ±lÄ±yor!</strong><br><br>

                    <span class="badge success">YENÄ° YÃ–NTEM</span> Tek tablo, tÃ¼m modÃ¼ller kullanÄ±yor:<br>
                    â€¢ <strong>payments</strong> (payable_type, payable_id)<br>
                    <strong style="color: #10b981;">âœ… Kod bir kere, her yerde kullan!</strong><br><br>

                    <strong style="font-size: 20px; color: #667eea;">
                    payments tablosu â†’ "Ben ShopOrder'dan mÄ±, Subscription'dan mÄ± geliyorum?" biliyor!
                    </strong>
                </p>
            </div>
        </div>

        <!-- TAB 2: MÄ°MARÄ° -->
        <div class="tab-content" id="tab2">
            <div class="section">
                <h2><span class="icon">ğŸ—ï¸</span> Yeni KlasÃ¶r YapÄ±sÄ±</h2>
                <div class="code-block">
Modules/Payment/                           â† YENÄ° MODÃœL (global)
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ Models/
â”‚   â”‚   â”œâ”€â”€ Payment.php                    â† Ana Ã¶deme kaydÄ± (polymorphic)
â”‚   â”‚   â””â”€â”€ PaymentMethod.php              â† PayTR, Stripe, Iyzico tanÄ±mlarÄ±
â”‚   â”‚
â”‚   â”œâ”€â”€ Services/
â”‚   â”‚   â”œâ”€â”€ PaymentService.php             â† Ana servis (her modÃ¼l bunu kullanÄ±r)
â”‚   â”‚   â””â”€â”€ Gateways/
â”‚   â”‚       â”œâ”€â”€ PaymentGatewayInterface.php â† Contract
â”‚   â”‚       â”œâ”€â”€ PayTRGateway.php           â† PayTR implementasyonu
â”‚   â”‚       â””â”€â”€ StripeGateway.php          â† Stripe (gelecekte)
â”‚   â”‚
â”‚   â””â”€â”€ Contracts/
â”‚       â””â”€â”€ Payable.php                    â† ShopOrder, Subscription implement eder
â”‚
â””â”€â”€ database/
    â””â”€â”€ migrations/
        â”œâ”€â”€ 001_create_payment_methods_table.php
        â””â”€â”€ 002_create_payments_table.php  â† payable_type, payable_id
                </div>
            </div>

            <div class="section warning">
                <h2><span class="icon">ğŸ—„ï¸</span> VeritabanÄ± TablolarÄ±</h2>

                <h3>1. payment_methods (Ã–deme YÃ¶ntemleri)</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Kolon</th>
                            <th>AÃ§Ä±klama</th>
                            <th>Ã–rnek</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>payment_method_id</code></td>
                            <td>ID</td>
                            <td>1, 2, 3...</td>
                        </tr>
                        <tr>
                            <td><code>gateway</code></td>
                            <td>Hangi gateway?</td>
                            <td>paytr, stripe, iyzico</td>
                        </tr>
                        <tr>
                            <td><code>title</code></td>
                            <td>BaÅŸlÄ±k (JSON Ã§oklu dil)</td>
                            <td>{"tr":"Kredi KartÄ±","en":"Credit Card"}</td>
                        </tr>
                        <tr>
                            <td><code>gateway_config</code></td>
                            <td>API keys (JSON)</td>
                            <td>{merchant_id, merchant_key, merchant_salt}</td>
                        </tr>
                        <tr>
                            <td><code>supports_installment</code></td>
                            <td>Taksit var mÄ±?</td>
                            <td>true / false</td>
                        </tr>
                    </tbody>
                </table>

                <h3>2. payments (TÃ¼m Ã–demeler - Polymorphic)</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Kolon</th>
                            <th>AÃ§Ä±klama</th>
                            <th>Ã–rnek</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>payment_id</code></td>
                            <td>ID</td>
                            <td>1, 2, 3...</td>
                        </tr>
                        <tr>
                            <td><code>payable_type</code></td>
                            <td><strong>Hangi model?</strong></td>
                            <td>Modules\Shop\App\Models\ShopOrder</td>
                        </tr>
                        <tr>
                            <td><code>payable_id</code></td>
                            <td><strong>Hangi kayÄ±t?</strong></td>
                            <td>123 (ShopOrder ID: 123)</td>
                        </tr>
                        <tr>
                            <td><code>amount</code></td>
                            <td>Tutar</td>
                            <td>150.00 TRY</td>
                        </tr>
                        <tr>
                            <td><code>status</code></td>
                            <td>Durum</td>
                            <td>pending, completed, failed</td>
                        </tr>
                        <tr>
                            <td><code>gateway</code></td>
                            <td>Hangi gateway kullanÄ±ldÄ±?</td>
                            <td>paytr</td>
                        </tr>
                        <tr>
                            <td><code>gateway_transaction_id</code></td>
                            <td>PayTR merchant_oid</td>
                            <td>ORD-2024-001</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="highlight">
                <h3><span class="icon">ğŸ’¡</span> Polymorphic NasÄ±l Ã‡alÄ±ÅŸÄ±yor?</h3>
                <div class="code-block php">
// Ã–RNEK 1: Shop Order Ã–deme
payable_type: "Modules\Shop\App\Models\ShopOrder"
payable_id: 123
â†’ ShopOrder ID: 123 iÃ§in Ã¶deme

// Ã–RNEK 2: Membership Ã–deme
payable_type: "Modules\Membership\App\Models\Subscription"
payable_id: 45
â†’ Subscription ID: 45 iÃ§in Ã¶deme

// Ã–RNEK 3: Booking Ã–deme
payable_type: "Modules\Booking\App\Models\Reservation"
payable_id: 67
â†’ Reservation ID: 67 iÃ§in Ã¶deme
                </div>
            </div>
        </div>

        <!-- TAB 3: ADIMLAR -->
        <div class="tab-content" id="tab3">
            <div class="section">
                <h2><span class="icon">ğŸ“‹</span> Entegrasyon AdÄ±mlarÄ± (10 AdÄ±m)</h2>
                <p style="font-size: 18px; margin-bottom: 30px;">Her adÄ±mÄ± iÅŸaretleyerek ilerle:</p>
            </div>

            <div class="timeline">
                <div class="timeline-item completed">
                    <div class="step-box completed">
                        <div class="step-number">âœ“</div>
                        <h4>AdÄ±m 1: Analiz ve HazÄ±rlÄ±k</h4>
                        <p><span class="badge success">TAMAMLANDI</span></p>
                        <ul>
                            <li>âœ… Shop modÃ¼lÃ¼ incelendi</li>
                            <li>âœ… Mevcut Ã¶deme altyapÄ±sÄ± kontrol edildi</li>
                            <li>âœ… Global mimari tasarlandÄ±</li>
                            <li>âœ… DokÃ¼mantasyon hazÄ±rlandÄ±</li>
                        </ul>
                    </div>
                </div>

                <div class="timeline-item">
                    <div class="step-box">
                        <div class="step-number">1</div>
                        <h4>AdÄ±m 2: Payment ModÃ¼lÃ¼nÃ¼ OluÅŸtur</h4>
                        <div class="code-block bash">
# ModÃ¼l oluÅŸtur
php artisan module:make Payment

# KlasÃ¶r yapÄ±sÄ±nÄ± kontrol et
ls -la Modules/Payment/
                        </div>
                    </div>
                </div>

                <div class="timeline-item">
                    <div class="step-box">
                        <div class="step-number">2</div>
                        <h4>AdÄ±m 3: Migration'larÄ± OluÅŸtur</h4>
                        <div class="code-block bash">
# Central migration
php artisan make:migration create_payment_methods_table --path=Modules/Payment/database/migrations

php artisan make:migration create_payments_table --path=Modules/Payment/database/migrations

# Tenant migration (kopyala)
cp Modules/Payment/database/migrations/*.php Modules/Payment/database/migrations/tenant/
                        </div>
                        <div class="highlight warning">
                            <strong>âš ï¸ Ã–NEMLÄ°:</strong> Her migration hem central hem tenant klasÃ¶rÃ¼nde olmalÄ±!
                        </div>
                    </div>
                </div>

                <div class="timeline-item">
                    <div class="step-box">
                        <div class="step-number">3</div>
                        <h4>AdÄ±m 4: Model'leri OluÅŸtur</h4>
                        <div class="code-block bash">
# Payment model
php artisan make:model Payment --path=Modules/Payment/app/Models

# PaymentMethod model
php artisan make:model PaymentMethod --path=Modules/Payment/app/Models
                        </div>
                    </div>
                </div>

                <div class="timeline-item">
                    <div class="step-box">
                        <div class="step-number">4</div>
                        <h4>AdÄ±m 5: PayTRService OluÅŸtur</h4>
                        <p>
                            <code>Modules/Payment/app/Services/Gateways/PayTRGateway.php</code> dosyasÄ±nÄ± oluÅŸtur.<br>
                            <span class="badge info">KOD Ã–RNEÄÄ°</span> Tab 4'te var!
                        </p>
                    </div>
                </div>

                <div class="timeline-item">
                    <div class="step-box">
                        <div class="step-number">5</div>
                        <h4>AdÄ±m 6: PaymentController OluÅŸtur</h4>
                        <div class="code-block bash">
php artisan make:controller PaymentController --path=Modules/Payment/app/Http/Controllers
                        </div>
                    </div>
                </div>

                <div class="timeline-item">
                    <div class="step-box">
                        <div class="step-number">6</div>
                        <h4>AdÄ±m 7: Route'larÄ± Ekle</h4>
                        <p><code>routes/web.php</code> dosyasÄ±na ekle:</p>
                        <div class="code-block php">
Route::middleware(['tenant'])->prefix('payment')->group(function () {
    Route::get('/frame/{payment_number}', [PaymentController::class, 'frame'])
        ->name('payment.frame');

    Route::post('/callback', [PaymentController::class, 'callback'])
        ->name('payment.callback');

    Route::get('/success', [PaymentController::class, 'success'])
        ->name('payment.success');

    Route::get('/failed', [PaymentController::class, 'failed'])
        ->name('payment.failed');
});
                        </div>
                        <div class="highlight danger">
                            <strong>ğŸš¨ CSRF EXEMPT:</strong> <code>app/Http/Middleware/VerifyCsrfToken.php</code><br>
                            <code>payment/callback</code> route'unu CSRF'den muaf tut!
                        </div>
                    </div>
                </div>

                <div class="timeline-item">
                    <div class="step-box">
                        <div class="step-number">7</div>
                        <h4>AdÄ±m 8: ShopOrder'a Payable Ekle</h4>
                        <p><code>Modules/Shop/app/Models/ShopOrder.php</code> gÃ¼ncelle:</p>
                        <div class="code-block php">
use Modules\Payment\App\Contracts\Payable;

class ShopOrder extends Model implements Payable
{
    public function payments()
    {
        return $this->morphMany(Payment::class, 'payable');
    }

    public function getPaymentAmount(): int
    {
        return (int) ($this->total_amount * 100); // KuruÅŸ
    }

    // DiÄŸer interface metodlarÄ±...
}
                        </div>
                    </div>
                </div>

                <div class="timeline-item">
                    <div class="step-box">
                        <div class="step-number">8</div>
                        <h4>AdÄ±m 9: .env AyarlarÄ±</h4>
                        <div class="code-block bash">
# PayTR Test Credentials
PAYTR_MERCHANT_ID=test_xxxxx
PAYTR_MERCHANT_KEY=test_xxxxx
PAYTR_MERCHANT_SALT=test_xxxxx
PAYTR_MODE=test
                        </div>
                    </div>
                </div>

                <div class="timeline-item">
                    <div class="step-box">
                        <div class="step-number">9</div>
                        <h4>AdÄ±m 10: Test Et!</h4>
                        <p><span class="badge warning">TEST KARTI</span></p>
                        <table>
                            <tr>
                                <td><strong>Kart No:</strong></td>
                                <td>4355 0843 5508 4358</td>
                            </tr>
                            <tr>
                                <td><strong>Tarih:</strong></td>
                                <td>12/26</td>
                            </tr>
                            <tr>
                                <td><strong>CVV:</strong></td>
                                <td>000</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>

            <div class="highlight success">
                <h3><span class="icon">ğŸ‰</span> TamamlandÄ±ÄŸÄ±nda:</h3>
                <p style="font-size: 18px;">
                    âœ… Shop sipariÅŸleri PayTR ile Ã¶deme alabilecek<br>
                    âœ… AynÄ± altyapÄ± ile Membership, Booking eklenebilecek<br>
                    âœ… Yeni gateway (Stripe, Iyzico) eklemek kolay olacak
                </p>
            </div>
        </div>

        <!-- TAB 4: KOD Ã–RNEKLERÄ° -->
        <div class="tab-content" id="tab4">
            <div class="section">
                <h2><span class="icon">ğŸ’»</span> HazÄ±r Kod Ã–rnekleri</h2>
                <p style="font-size: 18px;">Kopyala-yapÄ±ÅŸtÄ±r ile kullanabilirsin:</p>
            </div>

            <div class="section info">
                <h3>1. Payable Interface</h3>
                <p><code>Modules/Payment/app/Contracts/Payable.php</code></p>
                <div class="code-block php">
<?php

namespace Modules\Payment\App\Contracts;

interface Payable
{
    public function getPaymentAmount(): int;
    public function getPaymentCurrency(): string;
    public function getPaymentDescription(): string;
    public function getPaymentCustomer(): array;
    public function getPaymentBasket(): array;
    public function onPaymentCompleted(Payment $payment): void;
    public function onPaymentFailed(Payment $payment): void;
}
                </div>
            </div>

            <div class="section warning">
                <h3>2. ShopOrder â†’ Payable Implementation</h3>
                <p><code>Modules/Shop/app/Models/ShopOrder.php</code></p>
                <div class="code-block php">
use Modules\Payment\App\Contracts\Payable;

class ShopOrder extends Model implements Payable
{
    public function payments()
    {
        return $this->morphMany(Payment::class, 'payable');
    }

    public function getPaymentAmount(): int
    {
        return (int) ($this->total_amount * 100); // TRY â†’ KuruÅŸ
    }

    public function getPaymentCurrency(): string
    {
        return 'TRY';
    }

    public function getPaymentDescription(): string
    {
        return "SipariÅŸ: {$this->order_number}";
    }

    public function getPaymentCustomer(): array
    {
        return [
            'name' => $this->customer_name,
            'email' => $this->customer_email,
            'phone' => $this->customer_phone,
            'address' => $this->shipping_address,
        ];
    }

    public function getPaymentBasket(): array
    {
        $basket = [];
        foreach ($this->items as $item) {
            $basket[] = [
                $item->product_title,
                number_format($item->unit_price, 2, '.', ''),
                $item->quantity,
            ];
        }
        return $basket;
    }

    public function onPaymentCompleted(Payment $payment): void
    {
        $this->update([
            'payment_status' => 'paid',
            'status' => 'confirmed',
        ]);

        // Sepeti temizle
        app(ShopCartService::class)->clearCart();
    }

    public function onPaymentFailed(Payment $payment): void
    {
        $this->update(['payment_status' => 'failed']);
    }
}
                </div>
            </div>

            <div class="section success">
                <h3>3. Checkout'ta KullanÄ±m</h3>
                <p><code>CheckoutPageNew.php</code> submitOrder() metodunda:</p>
                <div class="code-block php">
public function submitOrder()
{
    // ... order oluÅŸtur ...

    $paymentService = app(PaymentService::class);
    $paymentMethod = PaymentMethod::where('gateway', 'paytr')->first();

    $result = $paymentService->initiatePayment($order, $paymentMethod, [
        'payment_type' => 'purchase',
        'no_installment' => 0,
        'max_installment' => 12,
    ]);

    if ($result['success']) {
        return redirect($result['redirect_url']); // PayTR iframe
    } else {
        session()->flash('error', $result['error']);
    }
}
                </div>
            </div>

            <div class="highlight">
                <h3><span class="icon">ğŸ“</span> Tam Kod Ã–rnekleri</h3>
                <p>DetaylÄ± kod Ã¶rnekleri iÃ§in:</p>
                <a href="../../readme/paytr-setup/PAYTR-CODE-TEMPLATES.md" class="btn" target="_blank">
                    TÃ¼m Kod ÅablonlarÄ±nÄ± GÃ¶r (28 KB)
                </a>
            </div>
        </div>

        <!-- TAB 5: PAYTR API -->
        <div class="tab-content" id="tab5">
            <div class="section danger">
                <h2><span class="icon">ğŸ”</span> PayTR API - Ã–nemli Detaylar</h2>
                <p style="font-size: 18px;">PayTR entegrasyonunda mutlaka bilmen gerekenler:</p>
            </div>

            <div class="section warning">
                <h3>1. Hash Hesaplama (Token Ä°steÄŸi)</h3>
                <div class="code-block php">
$hash_str = $merchant_id .
            $user_ip .
            $merchant_oid .
            $email .
            $payment_amount .      // âš ï¸ KURUÅ CÄ°NSÄ°NDEN!
            $user_basket .
            $no_installment .
            $max_installment .
            $currency .
            $test_mode .
            $merchant_salt;        // âš ï¸ EN SONDA!

$paytr_token = base64_encode(
    hash_hmac('sha256', $hash_str, $merchant_key, true)
);                                  // âš ï¸ raw_output = true
                </div>

                <div class="highlight danger">
                    <h4>ğŸš¨ KRÄ°TÄ°K NOKTALAR:</h4>
                    <ul>
                        <li><code>payment_amount</code> <strong>KURUÅ</strong> cinsinden (100.00 TRY = 10000)</li>
                        <li><code>merchant_salt</code> en sonda eklenir</li>
                        <li><code>merchant_key</code> HMAC key olarak kullanÄ±lÄ±r</li>
                        <li><code>raw_output = true</code> parametresi zorunlu</li>
                        <li>SonuÃ§ <code>base64_encode</code> ile encode edilir</li>
                    </ul>
                </div>
            </div>

            <div class="section info">
                <h3>2. user_basket FormatÄ±</h3>
                <div class="code-block php">
// Sepet bilgisi (JSON Array)
$basket = [
    ["Transpalet Forklift", "1500.00", 1],
    ["Kargo Ãœcreti", "50.00", 1]
];

// JSON encode â†’ base64 encode
$user_basket = base64_encode(json_encode($basket));
                </div>
                <p style="margin-top: 15px;">
                    <span class="badge warning">UYARI</span> Birim fiyat <strong>string</strong> olmalÄ±!
                </p>
            </div>

            <div class="section success">
                <h3>3. Callback Hash DoÄŸrulama</h3>
                <div class="code-block php">
// PayTR'den gelen POST verileri
$merchant_oid = $_POST['merchant_oid'];
$status = $_POST['status'];              // "success" veya "failed"
$total_amount = $_POST['total_amount'];  // KuruÅŸ cinsinden
$hash = $_POST['hash'];

// Hash hesapla
$hash_str = $merchant_oid . $merchant_salt . $status . $total_amount;
$calculated_hash = base64_encode(
    hash_hmac('sha256', $hash_str, $merchant_key, true)
);

// DoÄŸrula
if ($calculated_hash !== $hash) {
    echo "FAILED: Invalid hash";
    exit;
}

// âœ… Hash doÄŸru, iÅŸleme devam et
echo "OK";  // âš ï¸ MUTLAKA "OK" DÃ–NDÃœR!
                </div>

                <div class="highlight danger">
                    <h4>ğŸš¨ CALLBACK KURALLARI:</h4>
                    <ul>
                        <li>Hash mutlaka doÄŸrulanmalÄ±</li>
                        <li>Response "OK" olmalÄ± (yoksa PayTR tekrar gÃ¶nderir)</li>
                        <li>Duplicate callback handle edilmeli</li>
                        <li>200 OK HTTP status dÃ¶nÃ¼lmeli</li>
                        <li>Max 30 saniye timeout</li>
                    </ul>
                </div>
            </div>

            <div class="section">
                <h3>4. Test KartlarÄ±</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Durum</th>
                            <th>Kart No</th>
                            <th>Tarih</th>
                            <th>CVV</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="background: #d1fae5;">
                            <td><strong>âœ… BaÅŸarÄ±lÄ±</strong></td>
                            <td>4355 0843 5508 4358</td>
                            <td>12/26</td>
                            <td>000</td>
                        </tr>
                        <tr style="background: #fee2e2;">
                            <td><strong>âŒ BaÅŸarÄ±sÄ±z</strong></td>
                            <td>5406 6754 0667 5403</td>
                            <td>12/26</td>
                            <td>000</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="section warning">
                <h3>5. Hata KodlarÄ± (SÄ±k KarÅŸÄ±laÅŸÄ±lanlar)</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Kod</th>
                            <th>AÃ§Ä±klama</th>
                            <th>Ã‡Ã¶zÃ¼m</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>2</code></td>
                            <td>GeÃ§ersiz token</td>
                            <td>Hash yanlÄ±ÅŸ hesaplanmÄ±ÅŸ</td>
                        </tr>
                        <tr>
                            <td><code>10</code></td>
                            <td>GeÃ§ersiz tutar</td>
                            <td>payment_amount kuruÅŸ cinsinden olmalÄ±</td>
                        </tr>
                        <tr>
                            <td><code>20</code></td>
                            <td>Kart reddedildi</td>
                            <td>MÃ¼ÅŸteri bankasÄ±yla iletiÅŸime geÃ§meli</td>
                        </tr>
                        <tr>
                            <td><code>21</code></td>
                            <td>Yetersiz bakiye</td>
                            <td>BaÅŸka kart denenmeli</td>
                        </tr>
                        <tr>
                            <td><code>22</code></td>
                            <td>3D Secure baÅŸarÄ±sÄ±z</td>
                            <td>SMS kodu yanlÄ±ÅŸ girilmiÅŸ</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="highlight">
                <h3><span class="icon">ğŸ“š</span> DetaylÄ± API DÃ¶kÃ¼manÄ±</h3>
                <p>TÃ¼m API detaylarÄ±, parametreler, Ã¶rnekler iÃ§in:</p>
                <a href="../../readme/paytr-setup/PAYTR-API-REFERENCE.md" class="btn info" target="_blank">
                    PayTR API ReferansÄ±nÄ± GÃ¶r (16 KB)
                </a>
            </div>
        </div>

    </div>

    <script>
        function showTab(tabNumber) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Show selected tab
            document.getElementById('tab' + tabNumber).classList.add('active');
            document.querySelectorAll('.tab')[tabNumber - 1].classList.add('active');
        }
    </script>
</body>
</html>
