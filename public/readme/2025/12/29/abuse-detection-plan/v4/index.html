<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abuse Detection - GERÇEK VERİ SİMÜLASYONU</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        .timeline-bar { height: 44px; border-radius: 8px; position: relative; }
        .timeline-overlap {
            background: repeating-linear-gradient(45deg, #ef4444, #ef4444 10px, #dc2626 10px, #dc2626 20px);
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .data-row { display: flex; align-items: center; gap: 8px; padding: 6px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .data-label { color: #64748b; font-size: 12px; min-width: 100px; }
        .data-value { color: #e2e8f0; font-family: monospace; font-size: 13px; }
        .highlight { background: rgba(234, 179, 8, 0.1); padding: 2px 6px; border-radius: 4px; color: #fbbf24; }
    </style>
</head>
<body class="bg-slate-900 text-white min-h-screen">
    <!-- Header -->
    <header class="bg-gradient-to-r from-red-900/50 to-orange-900/50 border-b border-red-800/50">
        <div class="max-w-6xl mx-auto px-6 py-8">
            <div class="flex items-center gap-3 mb-4">
                <span class="px-3 py-1 bg-red-500 text-white text-xs font-bold rounded-full">v4</span>
                <span class="px-3 py-1 bg-yellow-500/20 text-yellow-400 text-xs font-bold rounded-full border border-yellow-500/30">
                    <i class="fas fa-database mr-1"></i>GERÇEK VERİ
                </span>
                <span class="px-3 py-1 bg-green-500/20 text-green-400 text-xs font-bold rounded-full border border-green-500/30">
                    <i class="fas fa-check mr-1"></i>CANLI TEST
                </span>
            </div>
            <h1 class="text-3xl font-bold mb-2">
                <i class="fas fa-shield-alt text-red-400 mr-3"></i>
                Abuse Detection - Gerçek Veri Simülasyonu
            </h1>
            <p class="text-slate-400">Veritabanından çekilen gerçek verilerle eş zamanlı dinleme tespiti</p>
            <div class="mt-4 text-sm text-slate-500">
                <i class="fas fa-calendar mr-2"></i>29 Aralık 2025 - 17:15-17:18 arası
                <span class="mx-3">|</span>
                <i class="fas fa-music mr-2"></i>Muzibu B2B
            </div>
        </div>
    </header>

    <main class="max-w-6xl mx-auto px-6 py-8 space-y-8">

        <!-- GERÇEK VERİ KARTI -->
        <section class="bg-yellow-900/20 border border-yellow-700/50 rounded-xl p-6">
            <h2 class="text-xl font-bold text-yellow-400 mb-4">
                <i class="fas fa-database mr-2"></i>Veritabanından Çekilen Gerçek Veriler
            </h2>
            <p class="text-slate-400 text-sm mb-4">
                Bu veriler <code class="bg-slate-800 px-2 py-1 rounded text-yellow-400">tenant_muzibu_1528d0.muzibu_song_plays</code> tablosundan canlı olarak çekilmiştir.
            </p>

            <!-- Özet Kartları -->
            <div class="grid grid-cols-2 md:grid-cols-6 gap-3 mb-6">
                <div class="bg-slate-800/70 rounded-lg p-3 text-center border border-slate-700">
                    <div class="text-xl font-bold text-white">1</div>
                    <div class="text-xs text-slate-500">User ID</div>
                </div>
                <div class="bg-slate-800/70 rounded-lg p-3 text-center border border-slate-700">
                    <div class="text-xl font-bold text-blue-400">#477</div>
                    <div class="text-xs text-slate-500">Song ID</div>
                </div>
                <div class="bg-slate-800/70 rounded-lg p-3 text-center border border-slate-700">
                    <div class="text-xl font-bold text-purple-400">156 sn</div>
                    <div class="text-xs text-slate-500">Süre</div>
                </div>
                <div class="bg-slate-800/70 rounded-lg p-3 text-center border border-slate-700">
                    <div class="text-xl font-bold text-red-400">8 sn</div>
                    <div class="text-xs text-slate-500">Çakışma</div>
                </div>
                <div class="bg-slate-800/70 rounded-lg p-3 text-center border border-slate-700">
                    <div class="text-xl font-bold text-green-400">677</div>
                    <div class="text-xs text-slate-500">Play ID 1</div>
                </div>
                <div class="bg-slate-800/70 rounded-lg p-3 text-center border border-slate-700">
                    <div class="text-xl font-bold text-blue-400">678</div>
                    <div class="text-xs text-slate-500">Play ID 2</div>
                </div>
            </div>
        </section>

        <!-- ŞARKI BİLGİSİ -->
        <section class="bg-purple-900/20 border border-purple-700/50 rounded-xl p-6">
            <h2 class="text-lg font-bold text-purple-400 mb-4">
                <i class="fas fa-music mr-2"></i>Şarkı Bilgisi
            </h2>
            <div class="flex items-center gap-4">
                <div class="w-20 h-20 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl flex items-center justify-center shadow-lg">
                    <i class="fas fa-music text-3xl text-white"></i>
                </div>
                <div class="flex-1">
                    <h3 class="text-2xl font-bold text-white">Give Me the Power</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-3 text-sm">
                        <div>
                            <span class="text-slate-500">Song ID:</span>
                            <span class="ml-2 font-mono text-purple-400">#477</span>
                        </div>
                        <div>
                            <span class="text-slate-500">Süre:</span>
                            <span class="ml-2 font-mono text-green-400">2:36 (156 sn)</span>
                        </div>
                        <div>
                            <span class="text-slate-500">Artist:</span>
                            <span class="ml-2 text-slate-300">-</span>
                        </div>
                        <div>
                            <span class="text-slate-500">Album:</span>
                            <span class="ml-2 text-slate-300">-</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- CİHAZ DETAYLARI - GERÇEK VERİ -->
        <div class="grid md:grid-cols-2 gap-6">
            <!-- PLAY #677 - Mobile -->
            <section class="bg-green-900/20 border border-green-700/50 rounded-xl overflow-hidden">
                <div class="bg-green-800/30 px-4 py-3 border-b border-green-700/50">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-green-500/20 rounded-full flex items-center justify-center">
                                <i class="fas fa-mobile-alt text-green-400"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-green-400">Cihaz 1: Mobile</h3>
                                <div class="text-xs text-slate-400">İlk dinleme başlatan</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-xs text-slate-500">Play ID</div>
                            <div class="font-mono text-green-400 font-bold">#677</div>
                        </div>
                    </div>
                </div>
                <div class="p-4 space-y-1">
                    <div class="data-row">
                        <i class="fas fa-clock w-5 text-slate-600"></i>
                        <span class="data-label">Başlangıç</span>
                        <span class="data-value highlight">17:15:41</span>
                    </div>
                    <div class="data-row">
                        <i class="fas fa-flag-checkered w-5 text-slate-600"></i>
                        <span class="data-label">Hesaplanan Bitiş</span>
                        <span class="data-value text-green-400">17:18:17</span>
                        <span class="text-xs text-slate-500">(+156 sn)</span>
                    </div>
                    <div class="data-row">
                        <i class="fas fa-network-wired w-5 text-slate-600"></i>
                        <span class="data-label">IP Adresi</span>
                        <span class="data-value text-yellow-400">92.44.171.31</span>
                    </div>
                    <div class="data-row">
                        <i class="fas fa-tablet-alt w-5 text-slate-600"></i>
                        <span class="data-label">Cihaz Tipi</span>
                        <span class="data-value">mobile</span>
                    </div>
                    <div class="data-row">
                        <i class="fab fa-apple w-5 text-slate-600"></i>
                        <span class="data-label">İşletim Sistemi</span>
                        <span class="data-value">iOS 18.7</span>
                    </div>
                    <div class="data-row">
                        <i class="fas fa-mobile w-5 text-slate-600"></i>
                        <span class="data-label">Cihaz</span>
                        <span class="data-value">iPhone</span>
                    </div>
                    <div class="data-row">
                        <i class="fab fa-safari w-5 text-slate-600"></i>
                        <span class="data-label">Tarayıcı</span>
                        <span class="data-value">Safari Mobile 26.2</span>
                    </div>
                    <div class="mt-3 p-3 bg-slate-900/50 rounded-lg">
                        <div class="text-xs text-slate-500 mb-1">User Agent (tam):</div>
                        <div class="text-xs text-slate-400 font-mono break-all leading-relaxed">
                            Mozilla/5.0 (iPhone; CPU iPhone OS 18_7 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/26.2 Mobile/15E148 Safari/604.1
                        </div>
                    </div>
                </div>
            </section>

            <!-- PLAY #678 - Desktop -->
            <section class="bg-blue-900/20 border border-blue-700/50 rounded-xl overflow-hidden">
                <div class="bg-blue-800/30 px-4 py-3 border-b border-blue-700/50">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-blue-500/20 rounded-full flex items-center justify-center">
                                <i class="fas fa-desktop text-blue-400"></i>
                            </div>
                            <div>
                                <h3 class="font-bold text-blue-400">Cihaz 2: Desktop</h3>
                                <div class="text-xs text-slate-400">Çakışma yaratan</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-xs text-slate-500">Play ID</div>
                            <div class="font-mono text-blue-400 font-bold">#678</div>
                        </div>
                    </div>
                </div>
                <div class="p-4 space-y-1">
                    <div class="data-row">
                        <i class="fas fa-clock w-5 text-slate-600"></i>
                        <span class="data-label">Başlangıç</span>
                        <span class="data-value highlight">17:18:09</span>
                    </div>
                    <div class="data-row">
                        <i class="fas fa-flag-checkered w-5 text-slate-600"></i>
                        <span class="data-label">Hesaplanan Bitiş</span>
                        <span class="data-value text-blue-400">17:20:45</span>
                        <span class="text-xs text-slate-500">(+156 sn)</span>
                    </div>
                    <div class="data-row">
                        <i class="fas fa-network-wired w-5 text-slate-600"></i>
                        <span class="data-label">IP Adresi</span>
                        <span class="data-value text-yellow-400">92.44.171.31</span>
                    </div>
                    <div class="data-row">
                        <i class="fas fa-tablet-alt w-5 text-slate-600"></i>
                        <span class="data-label">Cihaz Tipi</span>
                        <span class="data-value">desktop</span>
                    </div>
                    <div class="data-row">
                        <i class="fab fa-apple w-5 text-slate-600"></i>
                        <span class="data-label">İşletim Sistemi</span>
                        <span class="data-value">macOS 10.15.7</span>
                    </div>
                    <div class="data-row">
                        <i class="fas fa-laptop w-5 text-slate-600"></i>
                        <span class="data-label">Cihaz</span>
                        <span class="data-value">MacBook</span>
                    </div>
                    <div class="data-row">
                        <i class="fab fa-chrome w-5 text-slate-600"></i>
                        <span class="data-label">Tarayıcı</span>
                        <span class="data-value">Chrome 143.0.0.0</span>
                    </div>
                    <div class="mt-3 p-3 bg-slate-900/50 rounded-lg">
                        <div class="text-xs text-slate-500 mb-1">User Agent (tam):</div>
                        <div class="text-xs text-slate-400 font-mono break-all leading-relaxed">
                            Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- GÖRSEL TİMELINE -->
        <section class="bg-slate-800/50 border border-slate-700 rounded-xl p-6">
            <h2 class="text-xl font-bold text-white mb-6">
                <i class="fas fa-chart-gantt mr-2 text-purple-400"></i>
                Görsel Zaman Çizelgesi
            </h2>

            <div class="bg-slate-900 rounded-lg p-6">
                <!-- Zaman Ekseni -->
                <div class="relative mb-3 ml-32">
                    <div class="flex justify-between text-xs">
                        <span class="text-green-400 font-bold">17:15:41</span>
                        <span class="text-red-400 font-bold">17:18:09</span>
                        <span class="text-red-400 font-bold">17:18:17</span>
                        <span class="text-blue-400 font-bold">17:20:45</span>
                    </div>
                    <div class="absolute top-5 left-0 right-0 h-px bg-slate-700"></div>
                </div>

                <!-- Mobile Bar -->
                <div class="flex items-center gap-4 mb-4">
                    <div class="w-28 text-right">
                        <div class="flex items-center justify-end gap-2">
                            <i class="fas fa-mobile-alt text-green-400"></i>
                            <span class="text-sm text-green-400 font-medium">Mobile</span>
                        </div>
                        <div class="text-xs text-slate-500">iPhone Safari</div>
                        <div class="text-xs text-slate-600">Play #677</div>
                    </div>
                    <div class="flex-1 relative h-11">
                        <div class="timeline-bar bg-gradient-to-r from-green-600 to-green-500 border-2 border-green-400 shadow-lg shadow-green-500/20" style="width: 51%; position: absolute; left: 0;">
                            <div class="absolute inset-0 flex items-center justify-between px-3">
                                <span class="text-xs text-white font-bold">17:15:41</span>
                                <span class="text-xs text-white font-bold">17:18:17</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Desktop Bar -->
                <div class="flex items-center gap-4 mb-4">
                    <div class="w-28 text-right">
                        <div class="flex items-center justify-end gap-2">
                            <i class="fas fa-desktop text-blue-400"></i>
                            <span class="text-sm text-blue-400 font-medium">Desktop</span>
                        </div>
                        <div class="text-xs text-slate-500">Mac Chrome</div>
                        <div class="text-xs text-slate-600">Play #678</div>
                    </div>
                    <div class="flex-1 relative h-11">
                        <div class="timeline-bar bg-gradient-to-r from-blue-600 to-blue-500 border-2 border-blue-400 shadow-lg shadow-blue-500/20" style="width: 51%; position: absolute; left: 49%;">
                            <div class="absolute inset-0 flex items-center justify-between px-3">
                                <span class="text-xs text-white font-bold">17:18:09</span>
                                <span class="text-xs text-white font-bold">17:20:45</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Overlap Bar -->
                <div class="flex items-center gap-4">
                    <div class="w-28 text-right">
                        <div class="flex items-center justify-end gap-2">
                            <i class="fas fa-exclamation-triangle text-red-400"></i>
                            <span class="text-sm text-red-400 font-bold">ÇAKIŞMA</span>
                        </div>
                        <div class="text-xs text-red-300">8 saniye</div>
                    </div>
                    <div class="flex-1 relative h-11">
                        <div class="timeline-overlap border-2 border-red-400 shadow-lg shadow-red-500/30" style="width: 2%; position: absolute; left: 49%; height: 100%; border-radius: 8px;">
                        </div>
                        <!-- Çakışma işaretçileri -->
                        <div class="absolute text-red-400" style="left: 48%; top: -8px;">
                            <i class="fas fa-caret-down"></i>
                        </div>
                        <div class="absolute text-red-400" style="left: 51%; top: -8px;">
                            <i class="fas fa-caret-down"></i>
                        </div>
                    </div>
                </div>

                <!-- Açıklama -->
                <div class="mt-8 p-4 bg-red-500/10 border border-red-500/30 rounded-lg">
                    <div class="flex items-start gap-4">
                        <div class="w-12 h-12 bg-red-500/20 rounded-full flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-gavel text-red-400 text-xl"></i>
                        </div>
                        <div>
                            <h4 class="font-bold text-red-400 text-lg mb-2">Eş Zamanlı Dinleme Tespit Edildi</h4>
                            <div class="space-y-2 text-sm text-red-200">
                                <p>
                                    <strong>17:18:09 - 17:18:17</strong> arasında (toplam <strong>8 saniye</strong>)
                                    aynı kullanıcı hesabı iki farklı cihazdan aynı anda müzik dinledi.
                                </p>
                                <p class="text-red-300/70">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    Mobile cihazda "Give Me the Power" şarkısı henüz bitmeden (17:18:17),
                                    Desktop cihazdan aynı şarkı 17:18:09'da başlatıldı.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- HESAPLAMA DETAYI -->
        <section class="bg-slate-800/30 border border-slate-700 rounded-xl p-6">
            <h2 class="text-lg font-bold text-slate-300 mb-4">
                <i class="fas fa-calculator mr-2 text-cyan-400"></i>
                Çakışma Hesaplama Detayı
            </h2>
            <div class="bg-slate-900 rounded-lg p-4 font-mono text-sm">
                <div class="text-green-400 mb-2">// Girdi verileri (DB'den)</div>
                <div class="text-slate-300">mobile_start  = "17:15:41"</div>
                <div class="text-slate-300">desktop_start = "17:18:09"</div>
                <div class="text-slate-300">song_duration = 156 saniye</div>
                <div class="text-slate-500 mt-3 mb-2">// Hesaplama</div>
                <div class="text-slate-300">mobile_end = mobile_start + song_duration</div>
                <div class="text-slate-300">mobile_end = 17:15:41 + 156 sn = <span class="text-yellow-400">17:18:17</span></div>
                <div class="text-slate-500 mt-3 mb-2">// Çakışma kontrolü</div>
                <div class="text-slate-300">if (mobile_end > desktop_start)</div>
                <div class="text-slate-300 pl-4">overlap = mobile_end - desktop_start</div>
                <div class="text-slate-300 pl-4">overlap = 17:18:17 - 17:18:09 = <span class="text-red-400 font-bold">8 saniye</span></div>
            </div>
        </section>

        <!-- JSON ÇIKTISI -->
        <section class="bg-blue-900/20 border border-blue-700/50 rounded-xl p-6">
            <h2 class="text-lg font-bold text-blue-400 mb-4">
                <i class="fas fa-code mr-2"></i>
                Veritabanına Kaydedilecek JSON
            </h2>
            <div class="bg-slate-900 rounded-lg p-4 overflow-x-auto">
                <pre class="text-sm text-slate-300 font-mono"><code>{
  "report_id": "abuse-2025-12-29-001",
  "user_id": 1,
  "analyzed_at": "2025-12-29T17:35:00Z",
  "period": {
    "start": "2025-12-29 17:00:00",
    "end": "2025-12-29 18:00:00"
  },
  "song": {
    "id": 477,
    "title": "Give Me the Power",
    "duration": 156
  },
  "overlaps": [{
    "overlap_seconds": 8,
    "overlap_start": "17:18:09",
    "overlap_end": "17:18:17",
    "devices": [{
      "play_id": 677,
      "role": "first",
      "device_type": "mobile",
      "start_time": "17:15:41",
      "end_time": "17:18:17",
      "ip_address": "92.44.171.31",
      "os": "iOS 18.7",
      "device": "iPhone",
      "browser": "Safari Mobile 26.2",
      "user_agent": "Mozilla/5.0 (iPhone; CPU iPhone OS 18_7..."
    }, {
      "play_id": 678,
      "role": "overlapping",
      "device_type": "desktop",
      "start_time": "17:18:09",
      "end_time": "17:20:45",
      "ip_address": "92.44.171.31",
      "os": "macOS 10.15.7",
      "device": "MacBook",
      "browser": "Chrome 143.0.0.0",
      "user_agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7..."
    }]
  }],
  "summary": {
    "total_overlaps": 1,
    "total_overlap_seconds": 8,
    "unique_ips": 1,
    "unique_devices": 2,
    "severity": "low"
  }
}</code></pre>
            </div>
        </section>

        <!-- SQL SORGUSU -->
        <section class="bg-slate-800/30 border border-slate-700 rounded-xl p-6">
            <h2 class="text-lg font-bold text-slate-300 mb-4">
                <i class="fas fa-database mr-2 text-green-400"></i>
                Kullanılan SQL Sorgusu
            </h2>
            <div class="bg-slate-900 rounded-lg p-4 overflow-x-auto">
                <pre class="text-sm text-green-400 font-mono"><code>SELECT
    id, song_id, ip_address, device_type,
    user_agent, created_at
FROM tenant_muzibu_1528d0.muzibu_song_plays
WHERE id IN (677, 678)
ORDER BY id;</code></pre>
            </div>
        </section>

        <!-- Versiyon Geçmişi -->
        <section class="bg-slate-800/30 rounded-xl p-6">
            <h2 class="text-lg font-bold text-slate-400 mb-3">
                <i class="fas fa-history mr-2"></i>Versiyon Geçmişi
            </h2>
            <div class="flex flex-wrap gap-2">
                <a href="../v1/" class="px-3 py-1 bg-slate-700/50 text-slate-400 text-sm rounded hover:bg-slate-700">v1 - İlk Plan</a>
                <a href="../v2/" class="px-3 py-1 bg-slate-700/50 text-slate-400 text-sm rounded hover:bg-slate-700">v2 - 1:1 Kuralı</a>
                <a href="../v3/" class="px-3 py-1 bg-slate-700/50 text-slate-400 text-sm rounded hover:bg-slate-700">v3 - Kanıt Sistemi</a>
                <span class="px-3 py-1 bg-yellow-500/20 text-yellow-400 text-sm rounded border border-yellow-500/30">v4 - Gerçek Veri (Şu an)</span>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="border-t border-slate-800 mt-12">
        <div class="max-w-6xl mx-auto px-6 py-6 text-center text-slate-500 text-sm">
            <i class="fas fa-robot mr-2"></i>Claude AI
            <span class="mx-2">|</span>
            <i class="fas fa-database mr-2"></i>Gerçek DB Verileri
            <span class="mx-2">|</span>
            <i class="fas fa-calendar mr-2"></i>29 Aralık 2025
        </div>
    </footer>
</body>
</html>
