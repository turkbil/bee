<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Performans Analizi - 21 Ocak 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen">
    <div class="max-w-5xl mx-auto px-4 py-8">

        <!-- Header -->
        <header class="mb-8 border-b border-slate-700 pb-6">
            <h1 class="text-3xl font-bold text-white mb-2">Sistem Performans Analizi</h1>
            <p class="text-slate-400">21-22 Ocak 2026 | Donma ve YavaÅŸlama SorunlarÄ±</p>
        </header>

        <!-- Ã–zet KartlarÄ± -->
        <div class="grid md:grid-cols-3 gap-4 mb-8">
            <div class="bg-green-900/30 border border-green-700 rounded-lg p-4">
                <div class="text-green-400 text-sm font-medium">Ã‡Ã–ZÃœLDÃœ</div>
                <div class="text-2xl font-bold text-white">3</div>
                <div class="text-slate-400 text-sm">Kritik Sorun</div>
            </div>
            <div class="bg-yellow-900/30 border border-yellow-700 rounded-lg p-4">
                <div class="text-yellow-400 text-sm font-medium">OPTÄ°MÄ°ZASYON</div>
                <div class="text-2xl font-bold text-white">2</div>
                <div class="text-slate-400 text-sm">Ã–nerilen Ä°yileÅŸtirme</div>
            </div>
            <div class="bg-blue-900/30 border border-blue-700 rounded-lg p-4">
                <div class="text-blue-400 text-sm font-medium">NORMAL</div>
                <div class="text-2xl font-bold text-white">Sunucu</div>
                <div class="text-slate-400 text-sm">Kaynak KullanÄ±mÄ±</div>
            </div>
        </div>

        <!-- Basit AnlatÄ±m -->
        <section class="bg-slate-800 rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-white mb-4 flex items-center gap-2">
                <span class="text-2xl">ğŸ“</span> Basit AnlatÄ±m (Herkes Ä°Ã§in)
            </h2>
            <div class="space-y-4 text-slate-300">
                <p><strong class="text-white">Ne oldu?</strong> AkÅŸam saatlerinde site yavaÅŸladÄ± ve ÅŸarkÄ±lar dondu.</p>

                <p><strong class="text-white">Neden oldu?</strong></p>
                <ul class="list-disc list-inside space-y-2 ml-4">
                    <li><strong>GÃ¼venlik duvarÄ± sorunu:</strong> ÅarkÄ± dosyalarÄ±nÄ±n ÅŸifreleme anahtarlarÄ± (.key dosyalarÄ±) gÃ¼venlik sistemi tarafÄ±ndan engelleniyordu. ÅarkÄ± Ã§alÄ±namÄ±yordu Ã§Ã¼nkÃ¼ ÅŸifre Ã§Ã¶zÃ¼lemiyordu.</li>
                    <li><strong>AÅŸÄ±rÄ± log gÃ¶nderimi:</strong> MÃ¼zik Ã§alar her iÅŸlemde sunucuya bilgi gÃ¶nderiyordu (saniyede 7+ istek). Bu gereksiz yÃ¼k oluÅŸturuyordu.</li>
                    <li><strong>Cache sorunu:</strong> Playlist dosyalarÄ± (.m3u8) her seferinde sunucudan alÄ±nÄ±yordu, Ã¶nbellekten gelmiyordu.</li>
                </ul>

                <p><strong class="text-white">Ne yaptÄ±k?</strong></p>
                <ul class="list-disc list-inside space-y-2 ml-4">
                    <li>.key, .m3u8, .ts dosyalarÄ±nÄ± gÃ¼venlik duvarÄ± beyaz listesine ekledik</li>
                    <li>Cloudflare'da HLS cache kuralÄ±na .key dosyalarÄ± eklendi</li>
                    <li>ArtÄ±k ÅŸarkÄ±lar dÃ¼zgÃ¼n Ã§alÄ±yor</li>
                </ul>
            </div>
        </section>

        <!-- Teknik Detaylar -->
        <section class="bg-slate-800 rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-white mb-4 flex items-center gap-2">
                <span class="text-2xl">ğŸ”§</span> Teknik Detaylar (GeliÅŸtiriciler Ä°Ã§in)
            </h2>

            <!-- Sorun 1 -->
            <div class="border-l-4 border-green-500 pl-4 mb-6">
                <h3 class="text-lg font-medium text-green-400 mb-2">âœ… ModSecurity .key Engeli (Ã‡Ã–ZÃœLDÃœ)</h3>
                <div class="text-sm text-slate-400 space-y-2">
                    <p><strong>Sorun:</strong> COMODO WAF Rule ID 210730, .key uzantÄ±lÄ± dosyalarÄ± 403 ile blokluyordu.</p>
                    <p><strong>Etki:</strong> 5,692 bloklanmÄ±ÅŸ istek. HLS ÅŸifreleme anahtarlarÄ± eriÅŸilemez â†’ ÅŸarkÄ± decode edilemiyor â†’ donma.</p>
                    <p><strong>Ã‡Ã¶zÃ¼m:</strong></p>
                    <pre class="bg-slate-900 p-3 rounded text-xs overflow-x-auto mt-2">
# /etc/httpd/conf/modsecurity.d/rules/comodo_free/userdata_wl_extensions
# Eklenen uzantÄ±lar:
.key/
.m3u8/
.ts/</pre>
                    <p class="mt-2"><strong>DoÄŸrulama:</strong> <code class="bg-slate-900 px-2 py-1 rounded">curl https://www.muzibu.com/storage/muzibu/hls/33594/enc.key</code> â†’ 200 OK</p>
                </div>
            </div>

            <!-- Sorun 2 -->
            <div class="border-l-4 border-green-500 pl-4 mb-6">
                <h3 class="text-lg font-medium text-green-400 mb-2">âœ… Cloudflare HLS Cache Rule (Ã‡Ã–ZÃœLDÃœ)</h3>
                <div class="text-sm text-slate-400 space-y-2">
                    <p><strong>GÃ¼ncellenen Kural:</strong></p>
                    <pre class="bg-slate-900 p-3 rounded text-xs overflow-x-auto mt-2">
KoÅŸullar: URI Path contains "/hls/" OR ".ts" OR ".m3u8" OR ".key"
Edge TTL: 1 year
Browser TTL: 1 month
cf-cache-status: HIT âœ…</pre>
                </div>
            </div>

            <!-- Sorun 3 -->
            <div class="border-l-4 border-yellow-500 pl-4 mb-6">
                <h3 class="text-lg font-medium text-yellow-400 mb-2">âš ï¸ AÅŸÄ±rÄ± Debug Log Ä°stekleri (OPTÄ°MÄ°ZASYON Ã–NERÄ°SÄ°)</h3>
                <div class="text-sm text-slate-400 space-y-2">
                    <p><strong>Sorun:</strong> <code class="bg-slate-900 px-2 py-1 rounded">/api/muzibu/debug-log</code> endpoint'i 3 saatte 75,108 istek aldÄ±.</p>
                    <p><strong>Sebep:</strong> <code class="bg-slate-900 px-2 py-1 rounded">player-core.js</code> iÃ§inde <code>serverLog()</code> fonksiyonu 32 farklÄ± yerde Ã§aÄŸrÄ±lÄ±yor:</p>
                    <ul class="list-disc list-inside ml-4 mt-2">
                        <li>scriptLoaded (her sayfa yÃ¼klemesi)</li>
                        <li>playSong, nextTrack, onTrackEnded</li>
                        <li>crossfade, genreRefill</li>
                        <li>Safari timeUpdate event'leri</li>
                        <li>ve daha fazlasÄ±...</li>
                    </ul>
                    <p class="mt-2"><strong>Ã–neri:</strong></p>
                    <ul class="list-disc list-inside ml-4">
                        <li>Production'da sadece kritik hatalarÄ± logla</li>
                        <li>Rate limiting ekle (Ã¶rn: 1 istek/10 saniye)</li>
                        <li>Batch logging yap (biriktir, toplu gÃ¶nder)</li>
                    </ul>
                </div>
            </div>

            <!-- Sorun 4 -->
            <div class="border-l-4 border-yellow-500 pl-4 mb-6">
                <h3 class="text-lg font-medium text-yellow-400 mb-2">âš ï¸ .m3u8 Cache Bypass (OPTÄ°MÄ°ZASYON Ã–NERÄ°SÄ°)</h3>
                <div class="text-sm text-slate-400 space-y-2">
                    <p><strong>Sorun:</strong> Playlist dosyalarÄ± Cloudflare'da BYPASS oluyor.</p>
                    <pre class="bg-slate-900 p-3 rounded text-xs overflow-x-auto mt-2">
curl -I https://www.muzibu.com/storage/muzibu/hls/33594/output.m3u8
cf-cache-status: BYPASS  âŒ
set-cookie: XSRF-TOKEN=...
set-cookie: muzibu_session=...</pre>
                    <p class="mt-2"><strong>Sebep:</strong> Laravel session middleware aktif â†’ Set-Cookie header'Ä± â†’ Cloudflare cache'lemiyor.</p>
                    <p><strong>Ã–neri:</strong> HLS dosyalarÄ±nÄ± Laravel routing'den geÃ§irme, statik olarak serve et.</p>
                </div>
            </div>
        </section>

        <!-- Sunucu Durumu -->
        <section class="bg-slate-800 rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-white mb-4 flex items-center gap-2">
                <span class="text-2xl">ğŸ“Š</span> Sunucu Durumu (21 Ocak 20:00-23:00)
            </h2>
            <div class="grid md:grid-cols-2 gap-4">
                <div class="bg-slate-900 p-4 rounded">
                    <h4 class="text-sm font-medium text-slate-400 mb-2">Kaynak KullanÄ±mÄ±</h4>
                    <ul class="text-sm space-y-1">
                        <li>CPU: <span class="text-green-400">%0.7 (Normal)</span></li>
                        <li>RAM: <span class="text-green-400">25GB / 251GB (Normal)</span></li>
                        <li>Disk: <span class="text-green-400">%42 (Normal)</span></li>
                        <li>Load Average: <span class="text-green-400">1.90 (Normal)</span></li>
                    </ul>
                </div>
                <div class="bg-slate-900 p-4 rounded">
                    <h4 class="text-sm font-medium text-slate-400 mb-2">HTTP Ä°stekleri (Origin)</h4>
                    <ul class="text-sm space-y-1">
                        <li>20:00 â†’ 86,671 istek</li>
                        <li>21:00 â†’ <span class="text-blue-400">102,822 istek (pik)</span></li>
                        <li>22:00 â†’ 89,103 istek</li>
                        <li>5xx Hata: <span class="text-green-400">1 adet (ihmal edilebilir)</span></li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Cloudflare Analizi -->
        <section class="bg-slate-800 rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-white mb-4 flex items-center gap-2">
                <span class="text-2xl">â˜ï¸</span> Cloudflare Cache Drop Analizi
            </h2>
            <div class="text-sm text-slate-400 space-y-3">
                <p><strong>Grafikteki dÃ¼ÅŸÃ¼ÅŸ:</strong> ~21:00 civarÄ±nda cache hit 7GB â†’ ~0</p>

                <div class="bg-slate-900 p-4 rounded mt-3">
                    <h4 class="text-white mb-2">Elenen OlasÄ±lÄ±klar:</h4>
                    <ul class="space-y-1">
                        <li>âŒ Cache Purge yapÄ±lmadÄ± (audit log temiz)</li>
                        <li>âŒ Cache Rule deÄŸiÅŸikliÄŸi yok</li>
                        <li>âŒ Origin 5xx hatasÄ± yok</li>
                    </ul>
                </div>

                <div class="bg-slate-900 p-4 rounded mt-3">
                    <h4 class="text-white mb-2">OlasÄ± Sebepler:</h4>
                    <ul class="space-y-1">
                        <li>â€¢ DoÄŸal trafik dÃ¼ÅŸÃ¼ÅŸÃ¼ (gece saatleri)</li>
                        <li>â€¢ Cloudflare edge cache geÃ§ici sorunu</li>
                        <li>â€¢ Development Mode geÃ§ici aktifleÅŸmesi</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- GÃ¼venlik -->
        <section class="bg-slate-800 rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-white mb-4 flex items-center gap-2">
                <span class="text-2xl">ğŸ›¡ï¸</span> GÃ¼venlik KontrolÃ¼
            </h2>
            <div class="grid md:grid-cols-2 gap-4 text-sm">
                <div class="bg-green-900/20 border border-green-800 p-4 rounded">
                    <h4 class="text-green-400 font-medium mb-2">âœ… Hotlinking</h4>
                    <p class="text-slate-400">Tespit edilmedi. TrafiÄŸin %99'u kendi sitesinden.</p>
                </div>
                <div class="bg-green-900/20 border border-green-800 p-4 rounded">
                    <h4 class="text-green-400 font-medium mb-2">âœ… Malware KalÄ±ntÄ±sÄ±</h4>
                    <p class="text-slate-400">8 Ocak'taki dosyalar silinmiÅŸ. Aktif tehdit yok.</p>
                </div>
            </div>
        </section>

        <!-- Sonraki AdÄ±mlar -->
        <section class="bg-slate-800 rounded-lg p-6 mb-6">
            <h2 class="text-xl font-semibold text-white mb-4 flex items-center gap-2">
                <span class="text-2xl">ğŸ“‹</span> Sonraki AdÄ±mlar (Opsiyonel)
            </h2>
            <div class="space-y-3 text-sm text-slate-400">
                <div class="flex items-start gap-3">
                    <input type="checkbox" class="mt-1">
                    <div>
                        <strong class="text-white">serverLog() optimizasyonu</strong>
                        <p>Production'da gereksiz loglarÄ± kapat, rate limiting ekle.</p>
                    </div>
                </div>
                <div class="flex items-start gap-3">
                    <input type="checkbox" class="mt-1">
                    <div>
                        <strong class="text-white">.m3u8 statik serve</strong>
                        <p>Laravel session middleware'ini HLS route'larÄ±ndan kaldÄ±r.</p>
                    </div>
                </div>
                <div class="flex items-start gap-3">
                    <input type="checkbox" class="mt-1">
                    <div>
                        <strong class="text-white">Cloudflare Development Mode kontrolÃ¼</strong>
                        <p>Audit log'da bu ayarÄ±n deÄŸiÅŸip deÄŸiÅŸmediÄŸini detaylÄ± incele.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="text-center text-slate-500 text-sm pt-6 border-t border-slate-700">
            22 Ocak 2026 â€¢ Muzibu.com
        </footer>
    </div>
</body>
</html>
