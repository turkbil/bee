<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HLS Kontrollerini Geri Alma KÄ±lavuzu</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        slate: {
                            850: '#1a202e',
                            950: '#0f1419'
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen">
    <div class="max-w-5xl mx-auto px-4 py-8">
        <!-- Header -->
        <header class="mb-8 border-b border-slate-800 pb-6">
            <div class="flex items-center gap-3 mb-4">
                <span class="px-3 py-1 bg-blue-900/30 text-blue-400 border border-blue-800 rounded-full text-sm font-medium">
                    ğŸ“‹ Geri Alma KÄ±lavuzu
                </span>
                <span class="px-3 py-1 bg-slate-800 text-slate-400 rounded-full text-sm">
                    v1
                </span>
            </div>
            <h1 class="text-4xl font-bold text-slate-100 mb-2">
                HLS Kontrollerini Geri Alma
            </h1>
            <p class="text-slate-400 text-lg">
                HLS conversion tamamlandÄ±ÄŸÄ±nda eski haline nasÄ±l alÄ±nÄ±r?
            </p>
            <div class="flex gap-4 mt-4 text-sm text-slate-500">
                <span>ğŸ“… 8 Ocak 2026</span>
                <span>â±ï¸ 22:46</span>
                <span>ğŸ·ï¸ Muzibu, HLS, Song Filter</span>
            </div>
        </header>

        <!-- Basit AnlatÄ±m -->
        <div class="bg-green-900/20 border border-green-800 rounded-lg p-6 mb-6">
            <h3 class="text-xl font-bold text-green-400 mb-4 flex items-center gap-2">
                <span>ğŸ“</span> Basit AnlatÄ±m (Herkes Ä°Ã§in)
            </h3>
            <div class="space-y-4 text-slate-300">
                <p>
                    <strong>Ne YapÄ±ldÄ±?</strong><br>
                    MÃ¼zik platformunda ÅŸarkÄ±lar gÃ¶rÃ¼nmÃ¼yordu Ã§Ã¼nkÃ¼ sistem sadece HLS formatÄ±na Ã§evrilmiÅŸ ÅŸarkÄ±larÄ± gÃ¶steriyordu.
                    HLS henÃ¼z hazÄ±r olmadÄ±ÄŸÄ± iÃ§in tÃ¼m ÅŸarkÄ±lar gizli kalÄ±yordu.
                </p>
                <p>
                    <strong>Ã‡Ã¶zÃ¼m:</strong><br>
                    HLS kontrolÃ¼ geÃ§ici olarak devre dÄ±ÅŸÄ± bÄ±rakÄ±ldÄ±. Åimdi ÅŸarkÄ±lar MP3 formatÄ±yla Ã§alÄ±ÅŸÄ±yor ve gÃ¶rÃ¼nÃ¼yor.
                </p>
                <p>
                    <strong>Ne Zaman Geri AlÄ±nacak?</strong><br>
                    HLS formatÄ±na dÃ¶nÃ¼ÅŸÃ¼m tamamlandÄ±ÄŸÄ±nda (tÃ¼m ÅŸarkÄ±lar HLS'ye Ã§evrilince) bu deÄŸiÅŸiklik geri alÄ±nacak
                    ve sistem yeniden HLS kontrolÃ¼ yapacak.
                </p>
                <p class="bg-slate-900/50 border border-slate-700 rounded p-4">
                    <strong>ğŸ’¡ Neden Ã–nemli?</strong><br>
                    28,208 ÅŸarkÄ± MP3 formatÄ±nda hazÄ±r ama hiÃ§biri HLS'ye Ã§evrilmemiÅŸ. HLS kontrolÃ¼ aÃ§Ä±kken
                    kullanÄ±cÄ±lar hiÃ§bir ÅŸarkÄ± gÃ¶rmÃ¼yor. Bu deÄŸiÅŸiklik sayesinde platformdaki tÃ¼m ÅŸarkÄ±lar
                    kullanÄ±labilir hale geldi.
                </p>
            </div>
        </div>

        <!-- Teknik Detaylar -->
        <div class="bg-blue-900/20 border border-blue-800 rounded-lg p-6 mb-6">
            <h3 class="text-xl font-bold text-blue-400 mb-4 flex items-center gap-2">
                <span>ğŸ”§</span> Teknik Detaylar (GeliÅŸtiriciler Ä°Ã§in)
            </h3>
            <div class="space-y-4 text-slate-300">
                <div>
                    <h4 class="font-semibold text-slate-200 mb-2">DeÄŸiÅŸtirilen Dosyalar:</h4>
                    <ul class="list-disc list-inside space-y-1 text-sm font-mono bg-slate-900/50 p-4 rounded">
                        <li>Modules/Muzibu/app/Http/Controllers/Front/HomeController.php</li>
                        <li>Modules/Muzibu/app/Http/Controllers/Api/QueueRefillController.php</li>
                    </ul>
                </div>

                <div>
                    <h4 class="font-semibold text-slate-200 mb-2">YapÄ±lan DeÄŸiÅŸiklik:</h4>
                    <pre class="bg-slate-900 p-4 rounded border border-slate-700 overflow-x-auto text-sm"><code class="text-red-400">// Ã–NCE (HLS Zorunlu):
->whereNotNull('hls_path')</code>

<code class="text-green-400">// SONRA (HLS Opsiyonel):
// ->whereNotNull('hls_path') // GEÃ‡Ä°CÄ°: HLS hazÄ±r deÄŸil, MP3 ile Ã§alÄ±ÅŸÄ±yor</code></pre>
                </div>

                <div>
                    <h4 class="font-semibold text-slate-200 mb-2">Etkilenen Sorgulamalar:</h4>
                    <ul class="list-disc list-inside space-y-2 bg-slate-900/50 p-4 rounded">
                        <li><strong>HomeController:</strong> Popular Songs (1 adet)</li>
                        <li><strong>QueueRefillController:</strong> TÃ¼m queue refill endpoint'leri (10+ adet)</li>
                    </ul>
                </div>

                <div>
                    <h4 class="font-semibold text-slate-200 mb-2">Database Durumu:</h4>
                    <div class="bg-slate-900/50 p-4 rounded space-y-1 text-sm">
                        <p>âœ… Toplam aktif ÅŸarkÄ±: 28,211</p>
                        <p>âœ… file_path var: 28,208</p>
                        <p>âŒ hls_path var: 0</p>
                    </div>
                </div>

                <div>
                    <h4 class="font-semibold text-slate-200 mb-2">Ek DÃ¼zeltmeler:</h4>
                    <ul class="list-disc list-inside space-y-2 bg-slate-900/50 p-4 rounded">
                        <li><strong>Album songs_count:</strong> 650 album iÃ§in yeniden hesaplandÄ±</li>
                        <li><strong>Playlist songs_count:</strong> 399 system playlist iÃ§in yeniden hesaplandÄ±</li>
                        <li><strong>Cache:</strong> TÃ¼m cache katmanlarÄ± temizlendi</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Geri Alma AdÄ±mlarÄ± -->
        <div class="bg-slate-900 border border-slate-700 rounded-lg p-6 mb-6">
            <h3 class="text-2xl font-bold text-slate-100 mb-6">
                ğŸ”„ Geri Alma AdÄ±mlarÄ± (HLS HazÄ±r Olunca)
            </h3>

            <!-- AdÄ±m 1 -->
            <div class="mb-6 pb-6 border-b border-slate-800">
                <div class="flex items-start gap-4">
                    <span class="flex-shrink-0 w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold">
                        1
                    </span>
                    <div class="flex-1">
                        <h4 class="text-lg font-semibold text-slate-200 mb-3">HLS Conversion Durumunu Kontrol Et</h4>
                        <p class="text-slate-400 mb-4">
                            Ã–ncelikle kaÃ§ ÅŸarkÄ±da HLS path'i olduÄŸunu kontrol et. TÃ¼m ÅŸarkÄ±lar HLS'ye Ã§evrilmiÅŸ olmalÄ±.
                        </p>
                        <div class="bg-slate-950 p-4 rounded border border-slate-700">
                            <p class="text-xs text-slate-500 mb-2">Terminal Komutu:</p>
                            <pre class="text-sm text-green-400 overflow-x-auto"><code>/opt/plesk/php/8.3/bin/php artisan tinker --execute="
\$domain = \App\Models\Domain::where('domain', 'muzibu.com')->first();
\$tenant = \$domain->tenant;
tenancy()->initialize(\$tenant);

\$total = \Modules\Muzibu\App\Models\Song::where('is_active', 1)->count();
\$withHls = \Modules\Muzibu\App\Models\Song::where('is_active', 1)->whereNotNull('hls_path')->count();
\$withMp3 = \Modules\Muzibu\App\Models\Song::where('is_active', 1)->whereNotNull('file_path')->count();

echo 'Toplam aktif: ' . \$total . PHP_EOL;
echo 'HLS var: ' . \$withHls . PHP_EOL;
echo 'MP3 var: ' . \$withMp3 . PHP_EOL;
echo 'Conversion oranÄ±: ' . round((\$withHls / \$total) * 100, 2) . '%' . PHP_EOL;
"</code></pre>
                        </div>
                        <div class="mt-3 bg-yellow-900/20 border border-yellow-700 rounded p-3">
                            <p class="text-sm text-yellow-400">
                                âš ï¸ <strong>UyarÄ±:</strong> Conversion oranÄ± %100'e ulaÅŸmadan devam etme!
                                Aksi takdirde ÅŸarkÄ±lar tekrar gÃ¶rÃ¼nmez hale gelir.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AdÄ±m 2 -->
            <div class="mb-6 pb-6 border-b border-slate-800">
                <div class="flex items-start gap-4">
                    <span class="flex-shrink-0 w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold">
                        2
                    </span>
                    <div class="flex-1">
                        <h4 class="text-lg font-semibold text-slate-200 mb-3">HomeController'Ä± DÃ¼zelt</h4>
                        <p class="text-slate-400 mb-4">
                            Popular Songs sorgusunda HLS kontrolÃ¼nÃ¼ yeniden aktif et.
                        </p>
                        <div class="bg-slate-950 p-4 rounded border border-slate-700 mb-3">
                            <p class="text-xs text-slate-500 mb-2">Dosya:</p>
                            <pre class="text-sm text-blue-400"><code>Modules/Muzibu/app/Http/Controllers/Front/HomeController.php</code></pre>
                        </div>
                        <div class="bg-slate-950 p-4 rounded border border-slate-700">
                            <p class="text-xs text-slate-500 mb-2">SatÄ±r 43'teki comment'i kaldÄ±r:</p>
                            <pre class="text-sm overflow-x-auto"><code class="text-red-400">// ->whereNotNull('hls_path') // GEÃ‡Ä°CÄ°: HLS hazÄ±r deÄŸil, MP3 ile Ã§alÄ±ÅŸÄ±yor</code>

<code class="text-green-400">->whereNotNull('hls_path')</code></pre>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AdÄ±m 3 -->
            <div class="mb-6 pb-6 border-b border-slate-800">
                <div class="flex items-start gap-4">
                    <span class="flex-shrink-0 w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold">
                        3
                    </span>
                    <div class="flex-1">
                        <h4 class="text-lg font-semibold text-slate-200 mb-3">QueueRefillController'Ä± DÃ¼zelt</h4>
                        <p class="text-slate-400 mb-4">
                            TÃ¼m queue refill endpoint'lerinde HLS kontrolÃ¼nÃ¼ yeniden aktif et.
                        </p>
                        <div class="bg-slate-950 p-4 rounded border border-slate-700 mb-3">
                            <p class="text-xs text-slate-500 mb-2">Dosya:</p>
                            <pre class="text-sm text-blue-400"><code>Modules/Muzibu/app/Http/Controllers/Api/QueueRefillController.php</code></pre>
                        </div>
                        <div class="bg-slate-950 p-4 rounded border border-slate-700">
                            <p class="text-xs text-slate-500 mb-2">Otomatik DeÄŸiÅŸtirme Komutu:</p>
                            <pre class="text-sm text-green-400 overflow-x-auto"><code>sed -i 's|// ->whereNotNull('\''hls_path'\'') // GEÃ‡Ä°CÄ°.*|->whereNotNull('\''hls_path'\'')|g' \
  /var/www/vhosts/muzibu.com/httpdocs/Modules/Muzibu/app/Http/Controllers/Api/QueueRefillController.php

sed -i 's|// ->whereNotNull('\''muzibu_songs.hls_path'\'') // GEÃ‡Ä°CÄ°|->whereNotNull('\''muzibu_songs.hls_path'\'')|g' \
  /var/www/vhosts/muzibu.com/httpdocs/Modules/Muzibu/app/Http/Controllers/Api/QueueRefillController.php

echo "âœ… QueueRefillController gÃ¼ncellendi"</code></pre>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AdÄ±m 4 -->
            <div class="mb-6 pb-6 border-b border-slate-800">
                <div class="flex items-start gap-4">
                    <span class="flex-shrink-0 w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold">
                        4
                    </span>
                    <div class="flex-1">
                        <h4 class="text-lg font-semibold text-slate-200 mb-3">Cache Temizle</h4>
                        <p class="text-slate-400 mb-4">
                            TÃ¼m cache katmanlarÄ±nÄ± temizle ki deÄŸiÅŸiklikler hemen yansÄ±sÄ±n.
                        </p>
                        <div class="bg-slate-950 p-4 rounded border border-slate-700">
                            <p class="text-xs text-slate-500 mb-2">Terminal Komutu:</p>
                            <pre class="text-sm text-green-400 overflow-x-auto"><code>/opt/plesk/php/8.3/bin/php artisan cache:clear
/opt/plesk/php/8.3/bin/php artisan view:clear
/opt/plesk/php/8.3/bin/php artisan responsecache:clear
curl -s -k https://ixtif.com/opcache-reset.php > /dev/null

echo "âœ… TÃ¼m cache temizlendi"</code></pre>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AdÄ±m 5 -->
            <div class="mb-6">
                <div class="flex items-start gap-4">
                    <span class="flex-shrink-0 w-10 h-10 bg-blue-600 text-white rounded-full flex items-center justify-center font-bold">
                        5
                    </span>
                    <div class="flex-1">
                        <h4 class="text-lg font-semibold text-slate-200 mb-3">Test Et</h4>
                        <p class="text-slate-400 mb-4">
                            Ana sayfa ve player'Ä±n dÃ¼zgÃ¼n Ã§alÄ±ÅŸtÄ±ÄŸÄ±nÄ± doÄŸrula.
                        </p>
                        <div class="bg-slate-950 p-4 rounded border border-slate-700">
                            <p class="text-xs text-slate-500 mb-2">Test AdÄ±mlarÄ±:</p>
                            <ul class="list-disc list-inside space-y-2 text-sm text-slate-300">
                                <li>Ana sayfayÄ± aÃ§: <a href="https://muzibu.com/" target="_blank" class="text-blue-400 hover:underline">https://muzibu.com/</a></li>
                                <li>"Yeni Eklenenler" bÃ¶lÃ¼mÃ¼nde albumler gÃ¶rÃ¼nÃ¼yor mu?</li>
                                <li>"En Ã‡ok Dinlenenler" bÃ¶lÃ¼mÃ¼nde ÅŸarkÄ±lar gÃ¶rÃ¼nÃ¼yor mu?</li>
                                <li>Bir ÅŸarkÄ± Ã§almayÄ± dene - HLS stream Ã§alÄ±ÅŸÄ±yor mu?</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tek Komut (Hepsi Birden) -->
        <div class="bg-gradient-to-r from-purple-900/30 to-blue-900/30 border border-purple-700 rounded-lg p-6 mb-6">
            <h3 class="text-xl font-bold text-purple-300 mb-4 flex items-center gap-2">
                <span>âš¡</span> Tek Komut (TÃ¼m AdÄ±mlar Birden)
            </h3>
            <p class="text-slate-300 mb-4">
                YukarÄ±daki tÃ¼m adÄ±mlarÄ± tek komutla Ã§alÄ±ÅŸtÄ±r (AdÄ±m 1 hariÃ§ - HLS kontrolÃ¼ manuel yapÄ±lmalÄ±):
            </p>
            <div class="bg-slate-950 p-4 rounded border border-slate-700">
                <pre class="text-sm text-green-400 overflow-x-auto"><code>#!/bin/bash
# HLS Kontrollerini Geri Al (Tek Komut)

# 1. HomeController dÃ¼zelt
sed -i 's|// ->whereNotNull('\''hls_path'\'') // GEÃ‡Ä°CÄ°.*|->whereNotNull('\''hls_path'\'')|g' \
  /var/www/vhosts/muzibu.com/httpdocs/Modules/Muzibu/app/Http/Controllers/Front/HomeController.php

# 2. QueueRefillController dÃ¼zelt
sed -i 's|// ->whereNotNull('\''hls_path'\'') // GEÃ‡Ä°CÄ°.*|->whereNotNull('\''hls_path'\'')|g' \
  /var/www/vhosts/muzibu.com/httpdocs/Modules/Muzibu/app/Http/Controllers/Api/QueueRefillController.php

sed -i 's|// ->whereNotNull('\''muzibu_songs.hls_path'\'') // GEÃ‡Ä°CÄ°|->whereNotNull('\''muzibu_songs.hls_path'\'')|g' \
  /var/www/vhosts/muzibu.com/httpdocs/Modules/Muzibu/app/Http/Controllers/Api/QueueRefillController.php

# 3. Cache temizle
/opt/plesk/php/8.3/bin/php artisan cache:clear
/opt/plesk/php/8.3/bin/php artisan view:clear
/opt/plesk/php/8.3/bin/php artisan responsecache:clear
curl -s -k https://ixtif.com/opcache-reset.php > /dev/null

echo ""
echo "âœ… HLS kontrolleri geri alÄ±ndÄ±!"
echo "âœ… Cache temizlendi!"
echo ""
echo "ğŸ“‹ Åimdi test et:"
echo "   https://muzibu.com/"</code></pre>
            </div>
            <div class="mt-4 bg-red-900/20 border border-red-700 rounded p-4">
                <p class="text-sm text-red-400">
                    <strong>âš ï¸ UYARI:</strong> Bu komutu Ã§alÄ±ÅŸtÄ±rmadan Ã¶nce mutlaka AdÄ±m 1'deki HLS conversion
                    kontrolÃ¼nÃ¼ yap! HLS'ye Ã§evrilmemiÅŸ ÅŸarkÄ±lar varsa platforma zarar verir.
                </p>
            </div>
        </div>

        <!-- SonuÃ§ Ã–zeti -->
        <div class="bg-slate-900 border border-slate-700 rounded-lg p-6">
            <h3 class="text-xl font-bold text-slate-100 mb-4">
                ğŸ“Š Ã–zet
            </h3>
            <div class="grid md:grid-cols-2 gap-4">
                <div class="bg-slate-950 p-4 rounded border border-slate-800">
                    <h4 class="font-semibold text-green-400 mb-2">âœ… Åu Anda Aktif</h4>
                    <ul class="text-sm text-slate-300 space-y-1">
                        <li>â€¢ MP3 ile Ã§alÄ±ÅŸma modu</li>
                        <li>â€¢ HLS kontrolÃ¼ devre dÄ±ÅŸÄ±</li>
                        <li>â€¢ 28,208 ÅŸarkÄ± eriÅŸilebilir</li>
                        <li>â€¢ TÃ¼m playlist/album gÃ¶rÃ¼nÃ¼r</li>
                    </ul>
                </div>
                <div class="bg-slate-950 p-4 rounded border border-slate-800">
                    <h4 class="font-semibold text-blue-400 mb-2">ğŸ¯ Hedef Durum (HLS SonrasÄ±)</h4>
                    <ul class="text-sm text-slate-300 space-y-1">
                        <li>â€¢ HLS ile Ã§alÄ±ÅŸma modu</li>
                        <li>â€¢ HLS kontrolÃ¼ aktif</li>
                        <li>â€¢ Sadece HLS'li ÅŸarkÄ±lar gÃ¶rÃ¼nÃ¼r</li>
                        <li>â€¢ Daha iyi performans/gÃ¼venlik</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="mt-8 pt-6 border-t border-slate-800 text-center text-slate-500 text-sm">
            <p>ğŸ¤– Claude AI tarafÄ±ndan oluÅŸturuldu</p>
            <p class="mt-1">8 Ocak 2026 - Muzibu Music Platform</p>
        </footer>
    </div>
</body>
</html>