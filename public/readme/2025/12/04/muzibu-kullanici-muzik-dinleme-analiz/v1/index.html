<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Muzibu KullanÄ±cÄ± & MÃ¼zik Dinleme Sistemi - Analiz</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e2e8f0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            line-height: 1.7;
            padding: 40px 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            margin-bottom: 50px;
            padding-bottom: 30px;
            border-bottom: 2px solid #334155;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #60a5fa, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .meta {
            color: #94a3b8;
            font-size: 0.95rem;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        section {
            margin-bottom: 50px;
        }

        h2 {
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: #60a5fa;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        h3 {
            font-size: 1.4rem;
            margin-top: 30px;
            margin-bottom: 15px;
            color: #8b5cf6;
        }

        .info-card {
            background: rgba(30, 41, 59, 0.5);
            padding: 25px;
            margin-bottom: 20px;
            border-radius: 12px;
            border-left: 4px solid #3b82f6;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .info-card:hover {
            transform: translateX(5px);
            background: rgba(30, 41, 59, 0.7);
        }

        .user-type {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 25px;
            border: 2px solid rgba(59, 130, 246, 0.3);
        }

        .user-type h3 {
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-left: 10px;
        }

        .badge-guest { background: #64748b; color: white; }
        .badge-member { background: #3b82f6; color: white; }
        .badge-premium { background: linear-gradient(135deg, #f59e0b, #eab308); color: white; }
        .badge-trial { background: #10b981; color: white; }

        .feature-list {
            list-style: none;
            margin-top: 15px;
        }

        .feature-list li {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 12px;
            color: #cbd5e1;
        }

        .feature-icon {
            color: #10b981;
            font-size: 1.2rem;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .feature-icon.limited {
            color: #f59e0b;
        }

        .feature-icon.blocked {
            color: #ef4444;
        }

        .flow-diagram {
            background: rgba(15, 23, 42, 0.6);
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
        }

        .flow-step {
            display: flex;
            align-items: center;
            margin: 15px 0;
            gap: 15px;
        }

        .flow-step-number {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            flex-shrink: 0;
        }

        .flow-step-content {
            flex: 1;
        }

        .code-term {
            background: rgba(59, 130, 246, 0.2);
            padding: 3px 8px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            color: #60a5fa;
        }

        .highlight {
            background: rgba(251, 191, 36, 0.2);
            padding: 2px 6px;
            border-radius: 4px;
            color: #fbbf24;
            font-weight: 600;
        }

        .warning-box {
            background: rgba(239, 68, 68, 0.1);
            border-left: 4px solid #ef4444;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .warning-box h4 {
            color: #ef4444;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .info-box {
            background: rgba(59, 130, 246, 0.1);
            border-left: 4px solid #3b82f6;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .info-box h4 {
            color: #60a5fa;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 12px;
            overflow: hidden;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #334155;
        }

        .comparison-table th {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
            font-weight: 600;
        }

        .comparison-table tr:last-child td {
            border-bottom: none;
        }

        .check {
            color: #10b981;
            font-size: 1.2rem;
        }

        .cross {
            color: #ef4444;
            font-size: 1.2rem;
        }

        footer {
            margin-top: 60px;
            padding-top: 30px;
            border-top: 1px solid #334155;
            color: #64748b;
            font-size: 0.9rem;
            text-align: center;
        }

        @media (max-width: 768px) {
            h1 { font-size: 2rem; }
            h2 { font-size: 1.5rem; }
            .meta { flex-direction: column; gap: 10px; }
            .flow-step { flex-direction: column; align-items: flex-start; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸµ Muzibu KullanÄ±cÄ± & MÃ¼zik Dinleme Sistemi</h1>
            <div class="meta">
                <div class="meta-item">ğŸ“… Tarih: 2025-12-04 15:30</div>
                <div class="meta-item">ğŸ¯ Tenant: 1001 (muzibu.com.tr)</div>
                <div class="meta-item">ğŸ‘¤ Talep: Sistem Ã§alÄ±ÅŸma mantÄ±ÄŸÄ± analizi</div>
            </div>
        </header>

        <section>
            <h2>ğŸ“Š Sistem Genel BakÄ±ÅŸ</h2>
            <div class="info-card">
                <p>
                    Muzibu, <strong>tenant 1001</strong> Ã¼zerinde Ã§alÄ±ÅŸan bir <span class="highlight">mÃ¼zik streaming platformu</span>dur. 
                    Sistem, <strong>3 farklÄ± kullanÄ±cÄ± tipi</strong> iÃ§in farklÄ± dinleme deneyimleri sunar:
                </p>
                <ul class="feature-list">
                    <li>
                        <span class="feature-icon">ğŸ‘¥</span>
                        <span><strong>Ãœye Olmayan (Guest):</strong> KayÄ±t olmadan mÃ¼zik keÅŸfi</span>
                    </li>
                    <li>
                        <span class="feature-icon">ğŸ”</span>
                        <span><strong>Ãœye (Normal Member):</strong> KayÄ±tlÄ± hesap ile sÄ±nÄ±rlÄ± dinleme</span>
                    </li>
                    <li>
                        <span class="feature-icon">â­</span>
                        <span><strong>Premium Ãœye:</strong> Aktif abonelik ile sÄ±nÄ±rsÄ±z dinleme</span>
                    </li>
                </ul>
            </div>

            <div class="info-box">
                <h4>ğŸ’¡ Ã–nemli Bilgi</h4>
                <p>
                    Sistem, <span class="code-term">User</span> modelindeki <span class="code-term">isPremium()</span> metodu ile 
                    kullanÄ±cÄ±nÄ±n premium durumunu kontrol eder. Bu method, <span class="code-term">subscriptions</span> tablosunda 
                    aktif bir abonelik olup olmadÄ±ÄŸÄ±nÄ± sorgualar.
                </p>
            </div>
        </section>

        <section>
            <h2>ğŸ‘¥ KullanÄ±cÄ± Tipleri ve Yetkiler</h2>

            <div class="user-type">
                <h3>
                    <span>ğŸ‘¤ Ãœye Olmayan (Guest)</span>
                    <span class="badge badge-guest">Misafir</span>
                </h3>
                <p><strong>TanÄ±m:</strong> KayÄ±t olmadan siteye eriÅŸen ziyaretÃ§iler. Authentication sistemi ile iliÅŸkilendirilmemiÅŸ kullanÄ±cÄ±lar.</p>
                
                <h4 style="margin-top: 20px; color: #cbd5e1;">Dinleme HaklarÄ±:</h4>
                <ul class="feature-list">
                    <li>
                        <span class="feature-icon limited">â±ï¸</span>
                        <span><strong>30 saniye Ã¶nizleme:</strong> Her ÅŸarkÄ±dan sadece ilk 30 saniye dinlenebilir</span>
                    </li>
                    <li>
                        <span class="feature-icon limited">ğŸ”’</span>
                        <span><strong>Tam dinleme yok:</strong> ÅarkÄ±yÄ± sonuna kadar dinleyemez</span>
                    </li>
                    <li>
                        <span class="feature-icon">ğŸ§</span>
                        <span><strong>SÄ±nÄ±rsÄ±z Ã¶nizleme:</strong> Ä°stediÄŸi kadar farklÄ± ÅŸarkÄ±yÄ± 30 saniye Ã¶nizleyebilir</span>
                    </li>
                    <li>
                        <span class="feature-icon blocked">âŒ</span>
                        <span><strong>Analytics kaydÄ± yok:</strong> Dinleme geÃ§miÅŸi tutulmaz</span>
                    </li>
                </ul>

                <div class="flow-diagram">
                    <p style="color: #94a3b8; margin-bottom: 15px;"><strong>Frontend DavranÄ±ÅŸÄ±:</strong></p>
                    <div class="flow-step">
                        <div class="flow-step-number">1</div>
                        <div class="flow-step-content">ÅarkÄ± baÅŸlar ve 30 saniye oynar</div>
                    </div>
                    <div class="flow-step">
                        <div class="flow-step-number">2</div>
                        <div class="flow-step-content">30. saniyede player otomatik durur</div>
                    </div>
                    <div class="flow-step">
                        <div class="flow-step-number">3</div>
                        <div class="flow-step-content">Ekranda mesaj gÃ¶sterilir: <em>"KayÄ±t olun, tam dinleyin"</em></div>
                    </div>
                </div>

                <div class="warning-box">
                    <h4>âš ï¸ Backend KontrolÃ¼</h4>
                    <p>
                        <span class="code-term">SongStreamController::stream()</span> methodu, <span class="code-term">auth()->user()</span> 
                        kontrolÃ¼ yapar. Guest iÃ§in <span class="code-term">null</span> dÃ¶ner ve <span class="highlight">status: preview</span> 
                        response dÃ¶ndÃ¼rÃ¼r.
                    </p>
                </div>
            </div>

            <div class="user-type">
                <h3>
                    <span>ğŸ” Ãœye (Normal Member)</span>
                    <span class="badge badge-member">KayÄ±tlÄ±</span>
                </h3>
                <p><strong>TanÄ±m:</strong> KayÄ±t olmuÅŸ ancak <strong>premium aboneliÄŸi olmayan</strong> kullanÄ±cÄ±lar. Email/ÅŸifre ile giriÅŸ yapmÄ±ÅŸ durumda.</p>
                
                <h4 style="margin-top: 20px; color: #cbd5e1;">Dinleme HaklarÄ±:</h4>
                <ul class="feature-list">
                    <li>
                        <span class="feature-icon limited">â±ï¸</span>
                        <span><strong>30 saniye Ã¶nizleme:</strong> Guest ile aynÄ± - tam dinleme hakkÄ± yok</span>
                    </li>
                    <li>
                        <span class="feature-icon">ğŸ“Š</span>
                        <span><strong>Analytics kaydÄ±:</strong> Dinleme geÃ§miÅŸi <span class="code-term">muzibu_song_plays</span> tablosunda tutulur</span>
                    </li>
                    <li>
                        <span class="feature-icon">â­</span>
                        <span><strong>Favoriler:</strong> ÅarkÄ±larÄ± favorilere ekleyebilir</span>
                    </li>
                    <li>
                        <span class="feature-icon">ğŸµ</span>
                        <span><strong>Playlist oluÅŸturma:</strong> Kendi playlist'lerini oluÅŸturabilir</span>
                    </li>
                </ul>

                <div class="info-box">
                    <h4>ğŸ’¡ Eski Kural (Åu An Devre DÄ±ÅŸÄ±)</h4>
                    <p>
                        Eskiden <strong>gÃ¼nde 3 ÅŸarkÄ±</strong> limiti vardÄ±. KullanÄ±cÄ± 60+ saniye dinlediÄŸi her ÅŸarkÄ± sayÄ±lÄ±rdÄ±. 
                        Bu kural <span class="code-term">SongStreamController</span> iÃ§inde <strong>comment out edilmiÅŸ durumda</strong>.
                    </p>
                    <p style="margin-top: 10px;">
                        <span class="code-term">canPlaySong()</span> ve <span class="code-term">getRemainingPlays()</span> methodlarÄ± 
                        hala mevcut ancak kullanÄ±lmÄ±yor. Backend ÅŸu an <span class="highlight">tÃ¼m Ã¼yelere 30 saniye preview</span> veriyor.
                    </p>
                </div>

                <div class="flow-diagram">
                    <p style="color: #94a3b8; margin-bottom: 15px;"><strong>Frontend DavranÄ±ÅŸÄ±:</strong></p>
                    <div class="flow-step">
                        <div class="flow-step-number">1</div>
                        <div class="flow-step-content">ÅarkÄ± baÅŸlar ve 30 saniye oynar</div>
                    </div>
                    <div class="flow-step">
                        <div class="flow-step-number">2</div>
                        <div class="flow-step-content">30. saniyede player otomatik durur</div>
                    </div>
                    <div class="flow-step">
                        <div class="flow-step-number">3</div>
                        <div class="flow-step-content">Ekranda mesaj gÃ¶sterilir: <em>"Premium'a geÃ§in, sÄ±nÄ±rsÄ±z dinleyin"</em></div>
                    </div>
                </div>
            </div>

            <div class="user-type">
                <h3>
                    <span>â­ Premium Ãœye</span>
                    <span class="badge badge-premium">Premium</span>
                    <span class="badge badge-trial">Trial</span>
                </h3>
                <p><strong>TanÄ±m:</strong> Aktif <strong>subscription</strong> olan kullanÄ±cÄ±lar. Ä°ki tip premium durumu var:</p>
                
                <div style="margin: 20px 0;">
                    <h4 style="color: #cbd5e1; margin-bottom: 10px;">Premium Tipleri:</h4>
                    <ul class="feature-list">
                        <li>
                            <span class="feature-icon">ğŸ’³</span>
                            <span><strong>Active Subscription:</strong> <span class="code-term">status = 'active'</span> ve <span class="code-term">ends_at > now()</span></span>
                        </li>
                        <li>
                            <span class="feature-icon">ğŸ</span>
                            <span><strong>Trial Period:</strong> <span class="code-term">status = 'trial'</span> ve <span class="code-term">trial_ends_at > now()</span></span>
                        </li>
                    </ul>
                </div>

                <h4 style="margin-top: 20px; color: #cbd5e1;">Dinleme HaklarÄ±:</h4>
                <ul class="feature-list">
                    <li>
                        <span class="feature-icon">ğŸµ</span>
                        <span><strong>SÄ±nÄ±rsÄ±z dinleme:</strong> TÃ¼m ÅŸarkÄ±larÄ± sonuna kadar dinleyebilir</span>
                    </li>
                    <li>
                        <span class="feature-icon">ğŸš€</span>
                        <span><strong>YÃ¼ksek kalite HLS stream:</strong> Adaptif bitrate ile kesintisiz deneyim</span>
                    </li>
                    <li>
                        <span class="feature-icon">ğŸ“Š</span>
                        <span><strong>DetaylÄ± analytics:</strong> Dinleme geÃ§miÅŸi tam detaylÄ± tutulur</span>
                    </li>
                    <li>
                        <span class="feature-icon">ğŸ’¾</span>
                        <span><strong>Offline dinleme:</strong> (Planlanan - ÅŸu an aktif deÄŸil)</span>
                    </li>
                    <li>
                        <span class="feature-icon">âš¡</span>
                        <span><strong>Rate limit:</strong> Dakikada 300 stream request (Guest: 30, Member: 120)</span>
                    </li>
                </ul>

                <div class="flow-diagram">
                    <p style="color: #94a3b8; margin-bottom: 15px;"><strong>Frontend DavranÄ±ÅŸÄ±:</strong></p>
                    <div class="flow-step">
                        <div class="flow-step-number">1</div>
                        <div class="flow-step-content">ÅarkÄ± baÅŸlar ve sonuna kadar oynar</div>
                    </div>
                    <div class="flow-step">
                        <div class="flow-step-number">2</div>
                        <div class="flow-step-content">Limit kontrolÃ¼ yok - sÄ±nÄ±rsÄ±z dinleme</div>
                    </div>
                    <div class="flow-step">
                        <div class="flow-step-number">3</div>
                        <div class="flow-step-content">ÅarkÄ± bittiÄŸinde otomatik sÄ±radaki ÅŸarkÄ±ya geÃ§er</div>
                    </div>
                </div>

                <div class="info-box">
                    <h4>ğŸ’¡ Premium KontrolÃ¼</h4>
                    <p>
                        <span class="code-term">User::isPremium()</span> methodu, <strong>1 saatlik cache</strong> ile optimize edilmiÅŸ. 
                        Her stream request'inde database'ye gitmeden cache'den kontrol eder. Bu sayede performans optimize edilmiÅŸ.
                    </p>
                </div>
            </div>
        </section>

        <section>
            <h2>ğŸ“Š KullanÄ±cÄ± KarÅŸÄ±laÅŸtÄ±rma Tablosu</h2>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>Ã–zellik</th>
                        <th>ğŸ‘¤ Guest</th>
                        <th>ğŸ” Ãœye</th>
                        <th>â­ Premium</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Tam Dinleme</strong></td>
                        <td><span class="cross">âœ—</span> 30 saniye</td>
                        <td><span class="cross">âœ—</span> 30 saniye</td>
                        <td><span class="check">âœ“</span> SÄ±nÄ±rsÄ±z</td>
                    </tr>
                    <tr>
                        <td><strong>Analytics</strong></td>
                        <td><span class="cross">âœ—</span> KayÄ±t yok</td>
                        <td><span class="check">âœ“</span> KayÄ±t var</td>
                        <td><span class="check">âœ“</span> DetaylÄ±</td>
                    </tr>
                    <tr>
                        <td><strong>Favoriler</strong></td>
                        <td><span class="cross">âœ—</span></td>
                        <td><span class="check">âœ“</span></td>
                        <td><span class="check">âœ“</span></td>
                    </tr>
                    <tr>
                        <td><strong>Playlist OluÅŸturma</strong></td>
                        <td><span class="cross">âœ—</span></td>
                        <td><span class="check">âœ“</span></td>
                        <td><span class="check">âœ“</span></td>
                    </tr>
                    <tr>
                        <td><strong>GÃ¼nlÃ¼k Limit</strong></td>
                        <td><span class="check">âœ“</span> SÄ±nÄ±rsÄ±z preview</td>
                        <td><span class="check">âœ“</span> SÄ±nÄ±rsÄ±z preview</td>
                        <td><span class="check">âœ“</span> SÄ±nÄ±rsÄ±z</td>
                    </tr>
                    <tr>
                        <td><strong>Stream Kalitesi</strong></td>
                        <td>MP3 (standart)</td>
                        <td>MP3 (standart)</td>
                        <td>HLS (adaptif)</td>
                    </tr>
                    <tr>
                        <td><strong>Rate Limit</strong></td>
                        <td>30 req/dakika</td>
                        <td>120 req/dakika</td>
                        <td>300 req/dakika</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section>
            <h2>ğŸ”„ MÃ¼zik Dinleme AkÄ±ÅŸÄ±</h2>
            
            <h3>1ï¸âƒ£ Stream URL Alma</h3>
            <div class="flow-diagram">
                <div class="flow-step">
                    <div class="flow-step-number">1</div>
                    <div class="flow-step-content">
                        <strong>Frontend â†’ Backend:</strong> <span class="code-term">GET /api/muzibu/songs/{id}/stream</span>
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-number">2</div>
                    <div class="flow-step-content">
                        <strong>Backend:</strong> KullanÄ±cÄ± tipini kontrol eder (<span class="code-term">auth()->user()</span>)
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-number">3</div>
                    <div class="flow-step-content">
                        <strong>Backend:</strong> Premium kontrolÃ¼ yapar (<span class="code-term">isPremium()</span>)
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-number">4</div>
                    <div class="flow-step-content">
                        <strong>Response:</strong> Stream URL dÃ¶ner (signed URL - gÃ¼venlik iÃ§in)
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-number">5</div>
                    <div class="flow-step-content">
                        <strong>Response:</strong> <span class="code-term">preview_duration</span> alanÄ± ile limit bilgisi gelir (Guest/Ãœye iÃ§in 30)
                    </div>
                </div>
            </div>

            <h3>2ï¸âƒ£ MÃ¼zik Ã‡alma (Frontend)</h3>
            <div class="flow-diagram">
                <div class="flow-step">
                    <div class="flow-step-number">1</div>
                    <div class="flow-step-content">
                        <strong>Player:</strong> Stream URL ile mÃ¼zik Ã§almaya baÅŸlar (HLS veya MP3)
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-number">2</div>
                    <div class="flow-step-content">
                        <strong>Timer:</strong> EÄŸer <span class="code-term">preview_duration</span> varsa, sayaÃ§ baÅŸlar
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-number">3</div>
                    <div class="flow-step-content">
                        <strong>30. saniye:</strong> Guest/Ãœye iÃ§in player otomatik durur, premium iÃ§in devam eder
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-number">4</div>
                    <div class="flow-step-content">
                        <strong>Her 5 saniyede:</strong> Progress tracking yapÄ±lÄ±r (backend'e sinyal gÃ¶nderilir)
                    </div>
                </div>
            </div>

            <h3>3ï¸âƒ£ Analytics KaydÄ±</h3>
            <div class="flow-diagram">
                <div class="flow-step">
                    <div class="flow-step-number">1</div>
                    <div class="flow-step-content">
                        <strong>Frontend:</strong> 60+ saniye dinleme sonrasÄ± <span class="code-term">POST /api/muzibu/songs/{id}/track-progress</span> Ã§aÄŸrÄ±lÄ±r
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-number">2</div>
                    <div class="flow-step-content">
                        <strong>Backend:</strong> <span class="code-term">muzibu_song_plays</span> tablosuna kayÄ±t ekler
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-number">3</div>
                    <div class="flow-step-content">
                        <strong>Bilgiler:</strong> user_id, song_id, ip_address, device_type, created_at
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-number">4</div>
                    <div class="flow-step-content">
                        <strong>Analytics:</strong> Daha sonra raporlama iÃ§in kullanÄ±lÄ±r (en Ã§ok dinlenenler, gÃ¼nlÃ¼k istatistik vb.)
                    </div>
                </div>
            </div>

            <div class="warning-box">
                <h4>âš ï¸ Ã–nemli: Guest KullanÄ±cÄ±lar iÃ§in Analytics Yok</h4>
                <p>
                    Guest kullanÄ±cÄ±lar iÃ§in <span class="code-term">track-progress</span> endpoint'i 
                    <span class="code-term">auth:sanctum</span> middleware ile korunuyor. Guest'ler dinleme kaydÄ± oluÅŸturamazlar.
                </p>
            </div>
        </section>

        <section>
            <h2>ğŸ’³ Premium Ãœyelik Sistemi</h2>
            
            <div class="info-card">
                <h3>Subscription Model</h3>
                <p>
                    Premium Ã¼yelik, <span class="code-term">subscriptions</span> tablosunda tutulur. 
                    Her subscription bir kullanÄ±cÄ±ya (<span class="code-term">user_id</span>) ve bir plana 
                    (<span class="code-term">plan_id</span>) baÄŸlÄ±dÄ±r.
                </p>
            </div>

            <h3>Subscription DurumlarÄ±</h3>
            <div class="flow-diagram">
                <div class="flow-step">
                    <div class="flow-step-number">âœ“</div>
                    <div class="flow-step-content">
                        <strong>active:</strong> Aktif abonelik - <span class="code-term">ends_at > now()</span> kontrolÃ¼ yapÄ±lÄ±r
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-number">ğŸ</div>
                    <div class="flow-step-content">
                        <strong>trial:</strong> Deneme sÃ¼resi - <span class="code-term">trial_ends_at > now()</span> kontrolÃ¼ yapÄ±lÄ±r
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-number">â¸ï¸</div>
                    <div class="flow-step-content">
                        <strong>expired:</strong> SÃ¼resi dolmuÅŸ abonelik - artÄ±k premium deÄŸil
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-number">âŒ</div>
                    <div class="flow-step-content">
                        <strong>cancelled:</strong> Ä°ptal edilmiÅŸ abonelik - artÄ±k premium deÄŸil
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-number">â³</div>
                    <div class="flow-step-content">
                        <strong>pending:</strong> Ã–deme bekleyen abonelik - henÃ¼z aktif deÄŸil
                    </div>
                </div>
            </div>

            <h3>Premium KontrolÃ¼ (isPremium Method)</h3>
            <div class="info-card">
                <p><strong>Kontrol SÄ±rasÄ±:</strong></p>
                <ol style="margin-left: 20px; margin-top: 10px;">
                    <li style="margin-bottom: 10px;">
                        <strong>Tenant KontrolÃ¼:</strong> Sadece tenant 1001 (Muzibu) iÃ§in Ã§alÄ±ÅŸÄ±r, diÄŸer tenant'lar iÃ§in direkt <span class="code-term">false</span>
                    </li>
                    <li style="margin-bottom: 10px;">
                        <strong>Cache KontrolÃ¼:</strong> 1 saatlik cache varsa, oradan dÃ¶ner (performans iÃ§in)
                    </li>
                    <li style="margin-bottom: 10px;">
                        <strong>Database KontrolÃ¼:</strong> <span class="code-term">subscriptions</span> tablosunda <span class="code-term">status = 'active'</span> ve <span class="code-term">ends_at > now()</span> sorgusu
                    </li>
                    <li style="margin-bottom: 10px;">
                        <strong>Fallback:</strong> Eski sistem iÃ§in <span class="code-term">is_premium</span> kolonu kontrolÃ¼ (artÄ±k kullanÄ±lmÄ±yor)
                    </li>
                </ol>
            </div>

            <div class="warning-box">
                <h4>âš ï¸ Cache Sistemi</h4>
                <p>
                    Premium kontrolÃ¼, her stream request'inde Ã§aÄŸrÄ±ldÄ±ÄŸÄ± iÃ§in <strong>1 saatlik cache</strong> kullanÄ±lÄ±yor. 
                    Bu sayede database yÃ¼kÃ¼ azaltÄ±lÄ±yor. Ancak bu, kullanÄ±cÄ± premium'a geÃ§tikten sonra <strong>en fazla 1 saat</strong> 
                    gecikmeli gÃ¼ncelleme olabileceÄŸi anlamÄ±na gelir.
                </p>
                <p style="margin-top: 10px;">
                    <strong>Ã‡Ã¶zÃ¼m:</strong> Subscription oluÅŸturulunca/gÃ¼ncellenince cache temizlenir.
                </p>
            </div>
        </section>

        <section>
            <h2>ğŸ§ MÃ¼zik Stream Teknolojisi</h2>
            
            <h3>HLS (HTTP Live Streaming)</h3>
            <div class="info-card">
                <p>
                    Premium kullanÄ±cÄ±lar iÃ§in <strong>HLS streaming</strong> kullanÄ±lÄ±r. HLS, mÃ¼zik dosyasÄ±nÄ± kÃ¼Ã§Ã¼k parÃ§alara bÃ¶ler 
                    ve adaptif bitrate ile kullanÄ±cÄ±ya sunar. Bu sayede:
                </p>
                <ul class="feature-list" style="margin-top: 15px;">
                    <li>
                        <span class="feature-icon">ğŸ“¶</span>
                        <span><strong>Adaptif kalite:</strong> Ä°nternet hÄ±zÄ±na gÃ¶re otomatik kalite ayarÄ±</span>
                    </li>
                    <li>
                        <span class="feature-icon">âš¡</span>
                        <span><strong>HÄ±zlÄ± baÅŸlangÄ±Ã§:</strong> TÃ¼m dosya indirilmeden mÃ¼zik baÅŸlar</span>
                    </li>
                    <li>
                        <span class="feature-icon">ğŸ”’</span>
                        <span><strong>GÃ¼venlik:</strong> Dosya direkt indirilemez, sadece stream edilir</span>
                    </li>
                    <li>
                        <span class="feature-icon">ğŸ’¾</span>
                        <span><strong>DÃ¼ÅŸÃ¼k bant geniÅŸliÄŸi:</strong> Sadece oynatÄ±lan kÄ±sÄ±m indirilir</span>
                    </li>
                </ul>
            </div>

            <h3>MP3 Direct Stream</h3>
            <div class="info-card">
                <p>
                    Guest ve normal Ã¼yeler iÃ§in <strong>MP3 direct stream</strong> kullanÄ±lÄ±r. Basit HTTP stream ile mÃ¼zik servis edilir. 
                    Frontend, 30. saniyede otomatik durdurur.
                </p>
            </div>

            <h3>Lazy HLS Conversion</h3>
            <div class="flow-diagram">
                <div class="flow-step">
                    <div class="flow-step-number">1</div>
                    <div class="flow-step-content">
                        ÅarkÄ± ilk kez Ã§alÄ±nmak istendiÄŸinde, HLS'e dÃ¶nÃ¼ÅŸmemiÅŸ mi kontrol edilir
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-number">2</div>
                    <div class="flow-step-content">
                        EÄŸer dÃ¶nÃ¼ÅŸmemiÅŸse, <span class="code-term">ConvertToHLSJob</span> queue'ya eklenir
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-number">3</div>
                    <div class="flow-step-content">
                        KullanÄ±cÄ±ya geÃ§ici olarak MP3 stream URL dÃ¶ndÃ¼rÃ¼lÃ¼r
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-number">4</div>
                    <div class="flow-step-content">
                        Job arka planda Ã§alÄ±ÅŸÄ±r, FFmpeg ile ÅŸarkÄ±yÄ± HLS'e Ã§evirir
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-number">5</div>
                    <div class="flow-step-content">
                        DÃ¶nÃ¼ÅŸÃ¼m tamamlandÄ±ktan sonra, <span class="code-term">hls_converted = true</span> iÅŸaretlenir
                    </div>
                </div>
                <div class="flow-step">
                    <div class="flow-step-number">6</div>
                    <div class="flow-step-content">
                        Bir sonraki Ã§alÄ±ÅŸta HLS URL dÃ¶ndÃ¼rÃ¼lÃ¼r
                    </div>
                </div>
            </div>

            <div class="info-box">
                <h4>ğŸ’¡ Neden Lazy Loading?</h4>
                <p>
                    TÃ¼m ÅŸarkÄ±larÄ± Ã¶nceden HLS'e Ã§evirmek hem disk alanÄ± hem de iÅŸlemci aÃ§Ä±sÄ±ndan maliyetli. 
                    Lazy loading sayesinde, sadece <strong>gerÃ§ekten dinlenen ÅŸarkÄ±lar</strong> dÃ¶nÃ¼ÅŸtÃ¼rÃ¼lÃ¼r.
                </p>
            </div>
        </section>

        <section>
            <h2>ğŸ” GÃ¼venlik & Rate Limiting</h2>
            
            <div class="info-card">
                <h3>Signed URLs</h3>
                <p>
                    TÃ¼m stream URL'leri <span class="code-term">SignedUrlService</span> ile imzalanÄ±r. Bu sayede:
                </p>
                <ul class="feature-list" style="margin-top: 15px;">
                    <li>
                        <span class="feature-icon">ğŸ”’</span>
                        <span><strong>Tahmin edilemezlik:</strong> URL'ler hash iÃ§erir, tahmin edilemez</span>
                    </li>
                    <li>
                        <span class="feature-icon">â±ï¸</span>
                        <span><strong>ZamanlÄ± geÃ§erlilik:</strong> URL'ler belirli sÃ¼re sonra geÃ§ersiz olur (MP3: 30dk, HLS: 60dk)</span>
                    </li>
                    <li>
                        <span class="feature-icon">ğŸš«</span>
                        <span><strong>Kopyalanamaz:</strong> URL kopyalanÄ±p paylaÅŸÄ±lsa bile, sÃ¼re dolunca geÃ§ersiz olur</span>
                    </li>
                </ul>
            </div>

            <div class="info-card">
                <h3>Rate Limiting (throttle.user:stream)</h3>
                <table class="comparison-table" style="margin-top: 15px;">
                    <thead>
                        <tr>
                            <th>KullanÄ±cÄ± Tipi</th>
                            <th>Request Limiti</th>
                            <th>AÃ§Ä±klama</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>ğŸ‘¤ Guest</td>
                            <td><strong>30 req/dakika</strong></td>
                            <td>Bot korumasÄ± ve sunucu yÃ¼kÃ¼nÃ¼ azaltma</td>
                        </tr>
                        <tr>
                            <td>ğŸ” Ãœye</td>
                            <td><strong>120 req/dakika</strong></td>
                            <td>Normal kullanÄ±m iÃ§in yeterli</td>
                        </tr>
                        <tr>
                            <td>â­ Premium</td>
                            <td><strong>300 req/dakika</strong></td>
                            <td>YÃ¼ksek kalite stream iÃ§in yeterli</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="warning-box">
                <h4>âš ï¸ Rate Limit AÅŸÄ±mÄ±</h4>
                <p>
                    KullanÄ±cÄ± rate limit'i aÅŸarsa, <strong>429 Too Many Requests</strong> hatasÄ± dÃ¶ner. 
                    Frontend, bu durumda kullanÄ±cÄ±ya uygun mesaj gÃ¶sterir ve 1 dakika bekler.
                </p>
            </div>
        </section>

        <footer>
            ğŸ¤– Claude AI tarafÄ±ndan oluÅŸturuldu | ğŸ“… 2025-12-04
        </footer>
    </div>
</body>
</html>
