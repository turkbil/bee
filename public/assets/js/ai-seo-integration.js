/**
 * AI SEO Integration System
 * Real AI-powered SEO functionality
 */


(function() {
    'use strict';

    console.log('üî• AI-SEO-INTEGRATION.JS Y√úKLENDI!');
    console.log('üöÄ AI SEO INTEGRATION SYSTEM LOADING...');
    console.log('üìç File Path: assets/js/ai-seo-integration.js');
    console.log('‚è∞ Load Time:', new Date().toISOString());

    // Global debug check
    window.aiSeoDebug = function() {
        console.log('üß™ AI SEO Integration System Status');
        console.log('‚úÖ JavaScript file loaded successfully');
        console.log('üîç Button count:', document.querySelectorAll('.ai-seo-comprehensive-btn, .ai-seo-recommendations-btn').length);
        return 'AI SEO Integration is active';
    };

    console.log('üéØ Global debug function window.aiSeoDebug() ready!');

    // Livewire DOM error handling
    window.addEventListener('error', (event) => {
        if (event.message && event.message.includes('before')) {
            console.warn('üîß AI-SEO Livewire DOM error suppressed:', event.message);
            event.preventDefault();
            return false;
        }
    });

    window.addEventListener('unhandledrejection', (event) => {
        if (event.reason && event.reason.toString().includes('before')) {
            console.warn('üîß AI-SEO Livewire DOM promise rejection suppressed:', event.reason);
            event.preventDefault();
            return false;
        }
    });

    // ===== OVERLAY HELPER FUNCTIONS =====
    function getOverlayTitle(cleanupTarget) {
        switch (cleanupTarget) {
            case 'ai-recommendations':
                return 'AI SEO √ñnerileri';
            default:
                return 'AI SEO ƒ∞≈ülemleri';
        }
    }

    function getOverlaySubtitle(cleanupTarget) {
        switch (cleanupTarget) {
            case 'ai-recommendations':
                return 'Ki≈üiselle≈ütirilmi≈ü SEO √∂nerileri yapay zeka tarafƒ±ndan olu≈üturuluyor';
            default:
                return 'AI ile SEO i≈ülemleriniz ger√ßekle≈ütiriliyor';
        }
    }

    // ===== INLINE OVERLAY Sƒ∞STEMƒ∞ REMOVED - YENƒ∞ showInlineLoadingOverlay KULLANILIYOR =====
    /*function showInlineLoading(containerId, message = 'Y√ºkleniyor...', cleanupTarget = 'seo-data') {
        // Container'ƒ± bul veya olu≈ütur
        let container = document.getElementById(containerId);

        if (!container) {
            // Container yoksa olu≈ütur - TOOLBAR'IN HEMEN ALTINA
            const toolbar = document.querySelector('.ai-seo-toolbar');
            const targetLocation = toolbar ? toolbar.parentElement : (
                document.querySelector('.seo-language-content[style*="display: block"]') ||
                document.querySelector('.tab-pane.active .card-body') ||
                document.querySelector('.tab-pane.active')
            );

            if (targetLocation) {
                container = document.createElement('div');
                container.id = containerId;
                container.className = 'inline-results-container mt-4';
                container.style.position = 'relative'; // Overlay i√ßin
                container.style.minHeight = '300px'; // Minimum y√ºkseklik

                // TOOLBAR'IN HEMEN ALTINA EKLE
                if (toolbar) {
                    toolbar.insertAdjacentElement('afterend', container);
                    console.log('‚úÖ Container toolbar altƒ±na eklendi:', containerId);
                } else {
                    targetLocation.appendChild(container);
                    console.log('‚úÖ Container fallback location\'a eklendi:', containerId);
                }
            } else {
                console.warn('‚ö†Ô∏è Target location bulunamadƒ±');
                return;
            }
        }

        // Container'ƒ± hazƒ±rla
        container.style.position = 'relative';
        container.style.minHeight = '300px';

        // √ñNCE: Belirtilen tipte SEO alanlarƒ±nƒ± temizle
        cleanupExistingSeoAreas(cleanupTarget);

        // √ñnce i√ßerik alanƒ±nƒ± olu≈ütur (overlay altƒ±nda kalacak) - Mevcut tasarƒ±m placeholder
        const contentArea = document.createElement('div');
        contentArea.className = 'inline-content-area';
        contentArea.innerHTML = `
            <div class="mt-4">
                <div class="row">
                    <div class="col-12">
                        <div class="bg-light border p-3 rounded-3 mb-3 position-relative" style="border-radius: 0.25rem !important;">
                            <h3 class="mb-0">
                                <i class="fas fa-chart-line me-2"></i>
                                SEO Analiz Raporu
                            </h3>
                            <small class="position-absolute text-muted" style="right: 1rem; top: 50%; transform: translateY(-50%);">
                                Hazƒ±rlanƒ±yor...
                            </small>
                        </div>
                    </div>
                </div>
                <div class="text-center text-muted py-5">
                    <i class="fas fa-robot fa-3x mb-3 opacity-25"></i>
                    <h5 class="text-muted">AI Analiz Sonu√ßlarƒ±</h5>
                    <p>Analiz tamamlandƒ±ƒüƒ±nda detaylƒ± rapor burada g√∂r√ºnecek...</p>
                </div>
            </div>
        `;

        // AI MODAL TARZI INLINE OVERLAY
        const overlay = document.createElement('div');
        overlay.className = 'inline-loading-overlay';
        overlay.innerHTML = `
            <div class="overlay-content">
                <!-- AI ƒ∞≈ülem Ba≈ülƒ±k -->
                <div class="mb-4 text-center">
                    <h4 class="fw-normal mb-2">ü§ñ ${getOverlayTitle(cleanupTarget)}</h4>
                    <p class="text-muted mb-0">${getOverlaySubtitle(cleanupTarget)}</p>
                </div>

                <!-- Progress Bar - Modal ile aynƒ± -->
                <div class="mb-3">
                    <div class="progress mb-2" style="height: 6px;">
                        <div class="progress-bar progress-bar-indeterminate bg-primary progress-bar-animated" style="width: 100%"></div>
                    </div>
                    <small class="d-block text-center text-muted">${message}</small>
                </div>

                <!-- ƒ∞≈üleme Durumu -->
                <div class="d-flex align-items-center justify-content-center">
                    <div class="spinner-border spinner-border-sm text-primary me-2" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <span class="text-muted">L√ºtfen bekleyin...</span>
                </div>

                <!-- Bilgi Mesajƒ± -->
                <div class="alert alert-info py-2 mt-3" role="alert">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-info-circle me-2"></i>
                        <small><strong>Bilgi:</strong> Analiz tamamlandƒ±ƒüƒ±nda sonu√ßlar bu alanda g√∂r√ºnt√ºlenecektir.</small>
                    </div>
                </div>
            </div>
        `;

        // CSS stilleri (bir kez ekle)
        if (!document.getElementById('inline-overlay-styles')) {
            const style = document.createElement('style');
            style.id = 'inline-overlay-styles';
            style.textContent = `
                .inline-loading-overlay {
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(255, 255, 255, 0.98);
                    backdrop-filter: blur(6px);
                    z-index: 1000;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    min-height: 400px;
                    border-radius: 8px;
                }

                .overlay-content {
                    background: white;
                    padding: 2rem;
                    border-radius: 0.5rem;
                    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
                    border: 1px solid rgba(0, 0, 0, 0.05);
                    max-width: 500px;
                    width: 90%;
                }

                .overlay-content .progress {
                    background-color: rgba(32, 107, 196, 0.1);
                }

                .overlay-content .progress-bar-indeterminate {
                    background: linear-gradient(45deg,
                        rgba(32, 107, 196, 0.5) 25%,
                        transparent 25%,
                        transparent 50%,
                        rgba(32, 107, 196, 0.5) 50%,
                        rgba(32, 107, 196, 0.5) 75%,
                        transparent 75%
                    );
                    background-size: 20px 20px;
                    animation: progress-indeterminate 1s linear infinite;
                }

                @keyframes progress-indeterminate {
                    0% { background-position: 0 0; }
                    100% { background-position: 20px 0; }
                }

                .inline-results-container {
                    transition: all 0.3s ease;
                }

                .overlay-content .spinner-border {
                    width: 2.5rem;
                    height: 2.5rem;
                }

                .overlay-content h6 {
                    color: #1e293b;
                    font-weight: 600;
                }

                .overlay-content p {
                    color: #64748b;
                    font-size: 14px;
                }
            `;
            document.head.appendChild(style);
        }

        // Container'ƒ± temizle ve yeniden olu≈ütur
        container.innerHTML = '';
        container.appendChild(contentArea);
        container.appendChild(overlay);

        container.style.display = 'block';
        container.classList.remove('d-none');

        // Smooth scroll
        setTimeout(() => {
            container.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }, 100);

        console.log('‚úÖ Inline overlay g√∂sterildi:', message);
    }*/

    function cleanupExistingSeoAreas(targetType = 'all') {
        console.log('üßπ SEO alanlarƒ± temizleniyor - Hedef: ' + targetType);

        // 1. Target type'a g√∂re sadece ilgili container'ƒ± temizle (PARALEL √áALI≈ûMA ƒ∞√áƒ∞N)
        if (targetType === 'all' || targetType === 'analysis') {
            const analysisContainer = document.getElementById('seoUniversalResults');
            if (analysisContainer) {
                analysisContainer.innerHTML = '';
                console.log('üßπ seoUniversalResults i√ßeriƒüi temizlendi (container korundu)');
            }
        }

        if (targetType === 'all' || targetType === 'ai-recommendations' || targetType === 'recommendations') {
            const recommendationsContainer = document.getElementById('aiRecommendationsContainer');
            if (recommendationsContainer) {
                recommendationsContainer.innerHTML = '';
                console.log('üßπ aiRecommendationsContainer i√ßeriƒüi temizlendi (container korundu)');
            }
        }

        // 2. Hedef tipine g√∂re spesifik temizlik
        if (targetType === 'all') {
            // SADECE ANALƒ∞Z SONU√áLARINI temizle, FORM ALANLARI KORUNACAK

            // 1. SEO Analiz Raporu ba≈ülƒ±k alanlarƒ±
            const seoReportHeaders = document.querySelectorAll('h3');
            seoReportHeaders.forEach(header => {
                if (header.textContent.trim().includes('SEO Analiz Raporu')) {
                    let parentContainer = header.closest('.bg-light.border.p-3.rounded-3.mb-3') ||
                                        header.closest('.mt-4') ||
                                        header.closest('div[class*="bg-light"]') ||
                                        header.parentElement?.parentElement;

                    if (parentContainer) {
                        console.log('üóëÔ∏è SEO Data container kaldƒ±rƒ±lƒ±yor');
                        parentContainer.remove();
                    }
                }
            });

            // 2. SEO SKORLARINI temizle - ama form alanlarƒ±na dokunma
            const scoreSections = document.querySelectorAll('.row.mb-4');
            scoreSections.forEach(section => {
                const text = section.textContent || '';
                // SADECE skor g√∂steren alanlarƒ± temizle, form i√ßermeyenleri
                if ((text.includes('Genel SEO Skoru') ||
                     text.includes('/100') ||
                     text.includes('ƒ∞yi') ||
                     text.includes('Orta') ||
                     text.includes('K√∂t√º')) &&
                    !section.querySelector('input') &&
                    !section.querySelector('select') &&
                    !section.querySelector('textarea') &&
                    !section.querySelector('button[type="button"]') &&
                    !section.querySelector('.form-floating') &&
                    !section.querySelector('.form-control')) {
                    console.log('üóëÔ∏è SEO skor alanƒ± kaldƒ±rƒ±lƒ±yor (form korunuyor)');
                    section.remove();
                }
            });

            // 3. ANALƒ∞Z ACCORDION'LARINI temizle - SADECE analiz olanlarƒ±
            const analysisAccordionIds = ['realTimeSeoAccordion', 'metaAnalysis', 'contentQualityAnalysis', 'socialMediaAnalysis', 'actionPlan'];
            analysisAccordionIds.forEach(accordionId => {
                const accordionElement = document.getElementById(accordionId);
                if (accordionElement) {
                    // Accordion'un parent container'ƒ±nƒ± bul ama FORM ALANLARINI KONTROL ET
                    const accordionParent = accordionElement.closest('.mt-4');
                    if (accordionParent &&
                        !accordionParent.querySelector('input') &&
                        !accordionParent.querySelector('textarea') &&
                        !accordionParent.querySelector('select') &&
                        !accordionParent.querySelector('.form-floating')) {
                        console.log('üóëÔ∏è Analiz Accordion kaldƒ±rƒ±lƒ±yor (form korunuyor):', accordionId);
                        accordionParent.remove();
                    } else if (accordionElement && !accordionElement.querySelector('.form-control')) {
                        // Sadece accordion'u sil, parent'ƒ±nƒ± deƒüil
                        console.log('üóëÔ∏è Sadece accordion kaldƒ±rƒ±lƒ±yor:', accordionId);
                        accordionElement.remove();
                    }
                }
            });
        }

        if (targetType === 'all' || targetType === 'ai-recommendations') {
            // AI √ñneriler alanlarƒ±nƒ± temizle
            const aiHeaders = document.querySelectorAll('h3, h4, h5');
            aiHeaders.forEach(header => {
                const text = header.textContent.trim();
                if (text.includes('AI SEO ƒ∞√ßerik √ñnerileri') ||
                    text.includes('AI SEO √ñnerileri') ||
                    text.includes('√ñncelikli Eylem Planƒ±')) {

                    let parentToRemove = header.closest('.mt-4') ||
                                       header.closest('.bg-light') ||
                                       header.closest('.card') ||
                                       header.closest('[class*="accordion"]') ||
                                       header.parentElement;

                    if (parentToRemove) {
                        console.log('üóëÔ∏è AI √ñneriler container kaldƒ±rƒ±lƒ±yor:', text);
                        parentToRemove.remove();
                    }
                }
            });

            // AI Accordion'larƒ± temizle
            const aiAccordionIds = ['seoSuggestionsAccordion', 'aiSeoAccordion'];
            aiAccordionIds.forEach(accordionId => {
                const accordion = document.getElementById(accordionId);
                if (accordion) {
                    const accordionParent = accordion.closest('.mt-4') ||
                                          accordion.closest('.bg-light') ||
                                          accordion.parentElement;
                    if (accordionParent) {
                        console.log('üóëÔ∏è AI Accordion kaldƒ±rƒ±lƒ±yor:', accordionId);
                        accordionParent.remove();
                    }
                }
            });
        }

        if (targetType === 'all') {
            // T√ºm kalan SEO accordion'larƒ±
            const allAccordionIds = ['realTimeSeoAccordion', 'seoGenerateAccordion'];
            allAccordionIds.forEach(accordionId => {
                const accordion = document.getElementById(accordionId);
                if (accordion) {
                    const accordionParent = accordion.closest('.mt-4') || accordion.parentElement;
                    if (accordionParent) {
                        console.log('üóëÔ∏è Genel Accordion kaldƒ±rƒ±lƒ±yor:', accordionId);
                        accordionParent.remove();
                    }
                }
            });

            // Fallback temizlik
            const potentialContainers = document.querySelectorAll('.mt-4, .inline-results-container');
            potentialContainers.forEach(container => {
                const text = container.textContent || '';
                if (text.includes('SEO Analiz') || text.includes('AI SEO') || text.includes('√ñncelikli Eylem')) {
                    console.log('üóëÔ∏è Fallback temizlik');
                    container.remove();
                }
            });
        }

        console.log('‚úÖ ' + targetType + ' temizliƒüi tamamlandƒ±');
    }


    function showInlineError(message) {
        const container = document.getElementById('seoUniversalResults');
        if (!container) {
            console.warn('‚ö†Ô∏è Container bulunamadƒ±, error g√∂sterilemiyor');
            return;
        }

        // Loading'i gizle
        hideInlineLoading('seoUniversalResults');

        // Error HTML'i
        const errorHTML = `
            <div class="mt-4">
                <div class="alert alert-danger" role="alert">
                    <h4 class="alert-heading">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Hata Olu≈ütu
                    </h4>
                    <p>${message}</p>
                    <hr>
                    <p class="mb-0">
                        <button class="btn btn-outline-danger btn-sm" onclick="location.reload()">
                            <i class="fas fa-sync-alt me-1"></i>
                            Sayfayƒ± Yenile
                        </button>
                    </p>
                </div>
            </div>
        `;

        container.innerHTML = errorHTML;
        console.log('‚ùå Inline error g√∂sterildi:', message);
    }

    // Buton durumu y√∂netimi
    function setButtonLoading(button, isLoading = true, loadingText = 'Y√ºkleniyor...') {
        if (isLoading) {
            console.log('üîç setButtonLoading DEBUG:', {
                currentHTML: button.innerHTML,
                currentText: button.textContent.trim(),
                loadingText: loadingText,
                isLoading: isLoading
            });

            button.dataset.originalText = button.innerHTML;
            button.disabled = true;
            button.innerHTML = `
                <div class="spinner-border spinner-border-sm me-2" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                ${loadingText}
            `;
            button.classList.add('btn-loading');
        } else {
            console.log('üîç setButtonLoading RESET DEBUG:', {
                storedOriginalText: button.dataset.originalText,
                currentHTML: button.innerHTML,
                willResetTo: button.dataset.originalText || button.innerHTML
            });

            button.disabled = false;

            // DEBUG: Neden "true" yazdƒ±ƒüƒ±nƒ± anlayalƒ±m
            if (button.dataset.originalText) {
                console.log('‚úÖ Using stored originalText:', button.dataset.originalText);
                button.innerHTML = button.dataset.originalText;
            } else {
                console.warn('‚ö†Ô∏è No originalText found, keeping current HTML');
                // Fallback: Butonun class'ƒ±ndan orijinal text'i tahmin et
                if (button.classList.contains('ai-seo-comprehensive-btn')) {
                    button.innerHTML = `<i class="fas fa-chart-bar me-1"></i>Verileri Yenile`;
                } else if (button.classList.contains('ai-seo-recommendations-btn')) {
                    button.innerHTML = `<i class="fas fa-lightbulb me-1"></i>AI √ñnerileri`;
                }
            }

            button.classList.remove('btn-loading');
        }
    }
    
    // CSRF token for API calls
    const csrfToken = document.querySelector('meta[name="csrf-token"]')?.getAttribute('content');

    // Dinamik dil sistemi - tenant_languages tablosundan
    let availableLanguages = null;
    let defaultLanguage = null;

    /**
     * tenant_languages tablosundan dinamik dil listesini y√ºkle
     */
    async function loadAvailableLanguages() {
        if (availableLanguages !== null) {
            return availableLanguages;
        }

        const response = await fetch('/admin/ai/seo/languages', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRF-TOKEN': csrfToken
            }
        });

        const result = await response.json();
        if (result.success) {
            availableLanguages = result.data.languages;
            defaultLanguage = result.data.default_language;
            console.log('‚úÖ Dinamik dil sistemi y√ºklendi:', {
                languages: availableLanguages,
                default: defaultLanguage,
                total: result.data.total_count
            });
            return availableLanguages;
        }

        throw new Error('tenant_languages tablosundan dil listesi alƒ±namadƒ±');
    }

    /**
     * Mevcut sayfadaki aktif dili al (dinamik sistem ile)
     */
    function getCurrentLanguage() {
        // Sayfa SEO tab'ƒ±ndan aktif dili al
        const activeLanguageTab = document.querySelector('.seo-language-content[style*="display: block"]');
        if (activeLanguageTab) {
            return activeLanguageTab.getAttribute('data-language') || defaultLanguage;
        }

        // Page y√∂netim sayfasƒ±ndaki dil se√ßicisinden al
        const languageSelector = document.querySelector('[data-language-code]');
        if (languageSelector) {
            return languageSelector.getAttribute('data-language-code') || defaultLanguage;
        }

        // HTML lang attribute'undan al
        const htmlLang = document.documentElement.lang;
        if (htmlLang && availableLanguages?.some(lang => lang.code === htmlLang)) {
            return htmlLang;
        }

        return defaultLanguage;
    }
    
    let listenersAttached = false;

    function attachButtonListeners() {
        if (listenersAttached) {
            console.log('üîí attachButtonListeners SKIP - already attached');
            return;
        }

        console.log('üîó attachButtonListeners √áAƒûRILDI');
        const seoButtons = document.querySelectorAll('.ai-seo-comprehensive-btn, .ai-seo-recommendations-btn, .seo-generator-btn, .seo-suggestions-btn, [data-seo-feature], [data-action]');
        console.log('üîç Bulunan buton sayƒ±sƒ±:', seoButtons.length);

        seoButtons.forEach((button) => {
            // üîç DEBUG: Buton orijinal text'ini logla
            console.log('üîç Buton DEBUG:', {
                classes: button.className,
                originalHTML: button.innerHTML,
                originalText: button.textContent.trim()
            });

            // Remove existing listeners
            const newButton = button.cloneNode(true);
            button.parentNode.replaceChild(newButton, button);

            newButton.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();

                // AI SEO Analysis removed - only recommendations allowed

                if (this.classList.contains('seo-generator-btn') ||
                    this.getAttribute('data-action') === 'generate-seo') {
                    handleSeoGenerate(this);
                    return;
                }

                if (this.classList.contains('ai-seo-recommendations-btn') ||
                    this.getAttribute('data-seo-feature') === 'seo-smart-recommendations') {
                    handleSeoRecommendations(this);
                    return;
                }

                if (this.classList.contains('seo-suggestions-btn') ||
                    this.getAttribute('data-action') === 'get-suggestions') {
                    handleSeoSuggestions(this);
                    return;
                }
            });
        });

        // AI Recommendations section handlers
        attachRecommendationHandlers();

        // Mark listeners as attached to prevent infinite loop
        listenersAttached = true;
        console.log('‚úÖ Button listeners attached successfully');
    }

    function attachRecommendationHandlers() {
        // Close recommendations
        document.querySelectorAll('.ai-close-recommendations').forEach(button => {
            const newButton = button.cloneNode(true);
            button.parentNode.replaceChild(newButton, button);
            newButton.addEventListener('click', function(e) {
                e.preventDefault();
                const language = this.getAttribute('data-language');
                const section = document.getElementById(`aiSeoRecommendationsSection_${language}`);
                if (section) {
                    section.style.display = 'none';
                }
            });
        });

        // Select all recommendations
        document.querySelectorAll('.ai-select-all-recommendations').forEach(button => {
            const newButton = button.cloneNode(true);
            button.parentNode.replaceChild(newButton, button);
            newButton.addEventListener('click', function(e) {
                e.preventDefault();
                const checkboxes = document.querySelectorAll('.ai-recommendation-checkbox');
                const allChecked = Array.from(checkboxes).every(cb => cb.checked);

                checkboxes.forEach(cb => {
                    cb.checked = !allChecked;
                });

                updateApplyButton();

                // Update button text
                this.innerHTML = allChecked ?
                    '<i class="fas fa-check-double me-1"></i>T√ºm√ºn√º Se√ß' :
                    '<i class="fas fa-square me-1"></i>Se√ßimi Kaldƒ±r';
            });
        });

        // Apply selected recommendations
        document.querySelectorAll('.ai-apply-selected-recommendations').forEach(button => {
            const newButton = button.cloneNode(true);
            button.parentNode.replaceChild(newButton, button);
            newButton.addEventListener('click', function(e) {
                e.preventDefault();
                applySelectedRecommendations(this);
            });
        });

        // Retry recommendations
        document.querySelectorAll('.ai-retry-recommendations').forEach(button => {
            const newButton = button.cloneNode(true);
            button.parentNode.replaceChild(newButton, button);
            newButton.addEventListener('click', function(e) {
                e.preventDefault();
                const recommendationsBtn = document.querySelector('.ai-seo-recommendations-btn');
                if (recommendationsBtn) {
                    handleSeoRecommendations(recommendationsBtn);
                }
            });
        });
    }

    // üé® RENDER RECOMMENDATIONS HTML - Blade template ile aynƒ± format
    function renderRecommendationsHTML(data, language) {
        console.log('üé® Rendering recommendations HTML:', data);

        // recommendations array'ini √ßƒ±kar
        const recommendations = data.recommendations || [];

        if (!recommendations || recommendations.length === 0) {
            return `
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    AI √∂nerileri bulunamadƒ±. Yeni √∂neriler olu≈üturmak i√ßin "AI √ñnerileri" butonunu kullanƒ±n.
                </div>
            `;
        }

        // SEO ve Social media √∂nerilerini ayƒ±r
        const seoRecs = recommendations.filter(rec => ['title', 'description'].includes(rec.type));
        const socialRecs = recommendations.filter(rec => ['og_title', 'og_description'].includes(rec.type));

        let html = '';

        // SEO RECOMMENDATIONS
        if (seoRecs.length > 0) {
            html += '<div class="row mb-4">';
            seoRecs.forEach(rec => {
                const title = rec.type === 'title' ? 'SEO Ba≈ülƒ±ƒüƒ±' : 'SEO A√ßƒ±klamasƒ±';
                html += `
                    <div class="col-6">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">${title}</h3>
                            </div>
                            <div class="list-group list-group-flush">`;

                if (rec.alternatives && rec.alternatives.length > 0) {
                    rec.alternatives.forEach((alt, index) => {
                        const activeClass = index === 0 ? ' active' : '';
                        const escapedValue = (alt.value || '').replace(/'/g, "\\'");
                        html += `
                            <a href="#" class="list-group-item list-group-item-action${activeClass}"
                               onclick="applyAlternativeDirectly('${rec.field_target}', '${escapedValue}', this); return false;">
                                ${alt.value}
                            </a>`;
                    });
                }

                html += `
                            </div>
                        </div>
                    </div>`;
            });
            html += '</div>';
        }

        // SOCIAL MEDIA RECOMMENDATIONS
        if (socialRecs.length > 0) {
            html += '<div class="row mb-4">';
            socialRecs.forEach(rec => {
                const title = rec.type === 'og_title' ? 'Sosyal Medya Ba≈ülƒ±ƒüƒ±' : 'Sosyal Medya A√ßƒ±klamasƒ±';
                html += `
                    <div class="col-6">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">${title}</h3>
                            </div>
                            <div class="list-group list-group-flush">`;

                if (rec.alternatives && rec.alternatives.length > 0) {
                    rec.alternatives.forEach((alt, index) => {
                        const activeClass = index === 0 ? ' active' : '';
                        const escapedValue = (alt.value || '').replace(/'/g, "\\'");
                        html += `
                            <a href="#" class="list-group-item list-group-item-action${activeClass}"
                               onclick="applyAlternativeDirectly('${rec.field_target}', '${escapedValue}', this); return false;">
                                ${alt.value}
                            </a>`;
                    });
                }

                html += `
                            </div>
                        </div>
                    </div>`;
            });
            html += '</div>';
        }

        return html;
    }

    // Real AI API handlers
    async function handleSeoRecommendations(button) {
        console.log('üöÄ SEO RECOMMENDATIONS START');
        const language = button.getAttribute('data-language') || getCurrentActiveLanguage();

        // Dƒ∞REKT YENƒ∞LE - Confirm dialog yok
        console.log('üîÑ AI √ñnerileri direkt yenileniyor (alert yok)');

        try {
            // üö® BUTON DISABLE: ƒ∞≈ülem bitene kadar devre dƒ±≈üƒ±
            button.disabled = true;
            console.log('üîí Buton disable edildi');

            // üéØ SADECE AI √ñNERƒ∞LERƒ∞ ALANINDA LOADER G√ñSTER
            // Unique container ID kullan
            const containerId = `ai-recommendations-container-${language}`;
            const activeLanguageContent = document.querySelector(`.seo-language-content[data-language="${language}"]`);

            if (activeLanguageContent) {
                // Loader ekle (eƒüer yoksa)
                let loaderDiv = activeLanguageContent.querySelector('.ai-recommendations-loader');
                if (!loaderDiv) {
                    loaderDiv = document.createElement('div');
                    loaderDiv.className = 'ai-recommendations-loader text-center p-4 mb-4 bg-light rounded';
                    loaderDiv.innerHTML = `
                        <div class="spinner-border text-success" role="status">
                            <span class="visually-hidden">AI √∂nerileri √ºretiliyor...</span>
                        </div>
                        <h5 class="mt-3 mb-1">ü§ñ AI √ñnerileri Hazƒ±rlanƒ±yor</h5>
                        <p class="text-muted">Sayfanƒ±z analiz ediliyor ve √∂zelle≈ütirilmi≈ü √∂neriler √ºretiliyor...</p>
                    `;

                    // ‚úÖ LOADER BUTONUN HEMEN ALTINA EKLE
                    const aiToolbar = activeLanguageContent.querySelector('.ai-seo-toolbar');
                    if (aiToolbar) {
                        aiToolbar.insertAdjacentElement('afterend', loaderDiv);
                        console.log('üìç Loader butonun hemen altƒ±na eklendi');
                    } else {
                        activeLanguageContent.insertBefore(loaderDiv, activeLanguageContent.firstChild);
                        console.log('üìç Toolbar bulunamadƒ± - loader language content ba≈üƒ±na eklendi');
                    }
                }
                loaderDiv.style.display = 'block';
                console.log('‚úÖ Loader g√∂sterildi');
            }

            // YENƒ∞ Sƒ∞STEM: Inline loading zaten g√∂steriliyor
            
            const collectedData = collectFormData();
            // DEBUG: Model ID kontrol√º (Global - herhangi bir mod√ºl olabilir)
            console.log('üîç Model ID Debug - JavaScript:', {
                windowCurrentModelId: window.currentModelId,
                typeOfModelId: typeof window.currentModelId,
                finalModelId: window.currentModelId || null
            });

            const formData = {
                feature_slug: 'seo-smart-recommendations', // Keep original for now
                form_content: collectedData,
                language: language,
                page_id: window.currentModelId || null,  // page_id parametresi universal olarak kullanƒ±lƒ±yor
                force_regenerate: true,  // Her zaman yeni veri al (test i√ßin)
                include_all_fields: true // Request all fields: title, description, and social media
            };

            // Force regenerate flag'ini temizle
            window.forceRegenerateRecommendations = false;
            console.log('üìã Recommendations Form data:', formData);
            
            console.log('üîó Sending request to:', '/admin/seo/ai/recommendations');
            const response = await fetch('/admin/seo/ai/recommendations', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': csrfToken
                },
                body: JSON.stringify(formData)
            });
            
            console.log('üì° Response status:', response.status);
            
            if (!response.ok) {
                const errorText = await response.text();
                console.error('‚ùå HTTP Error Response:', errorText);
                throw new Error(`HTTP ${response.status}: ${errorText.substring(0, 200)}...`);
            }
            
            const responseText = await response.text();
            console.log('üìÑ Raw response:', responseText.substring(0, 500));
            
            let result;
            try {
                result = JSON.parse(responseText);
                console.log('‚úÖ Parsed JSON result:', result);
            } catch (jsonError) {
                console.error('‚ùå JSON Parse Error:', jsonError);
                console.error('‚ùå Response was not JSON:', responseText.substring(0, 1000));
                throw new Error('Server returned HTML instead of JSON. Check if endpoint exists.');
            }
            
            if (result.success) {
                console.log('‚úÖ Success - displaying recommendations:', result.data);

                // üéØ Dƒ∞REKT DOM RENDER - Livewire kullanmƒ±yoruz
                const activeLanguageContent = document.querySelector(`.seo-language-content[data-language="${language}"]`);
                if (activeLanguageContent) {
                    // üóëÔ∏è ESKƒ∞ VERƒ∞TABANI STATIK HTML'ƒ∞Nƒ∞ Sƒ∞L (Blade'den gelen .mt-3 container'lar)
                    const oldStaticContainers = activeLanguageContent.querySelectorAll('.mt-3:not(.ai-generated-recommendations)');
                    console.log(`üóëÔ∏è Eski statik container sayƒ±sƒ±: ${oldStaticContainers.length}`);
                    oldStaticContainers.forEach((oldContainer, index) => {
                        console.log(`üóëÔ∏è Eski container ${index} siliniyor...`);
                        oldContainer.remove();
                    });

                    // Mevcut recommendations container'ƒ± bul (UNIQUE ID kullan)
                    const containerId = `ai-recommendations-container-${language}`;
                    let recommendationsContainer = document.getElementById(containerId);

                    // Eƒüer yoksa olu≈ütur
                    if (!recommendationsContainer) {
                        recommendationsContainer = document.createElement('div');
                        recommendationsContainer.id = containerId;
                        recommendationsContainer.className = 'mt-3 ai-generated-recommendations';
                        // TEMEL SEO Bƒ∞LGƒ∞LERƒ∞'nden √∂nce ekle
                        const seoBasicCard = activeLanguageContent.querySelector('.card.mb-4');
                        if (seoBasicCard) {
                            seoBasicCard.insertAdjacentElement('beforebegin', recommendationsContainer);
                        } else {
                            // Eƒüer card bulunamazsa, language content'in ba≈üƒ±na ekle
                            activeLanguageContent.insertBefore(recommendationsContainer, activeLanguageContent.firstChild);
                        }
                        console.log(`‚úÖ Yeni AI container olu≈üturuldu: ${containerId}`);
                    } else {
                        console.log(`‚úÖ Mevcut AI container kullanƒ±lƒ±yor: ${containerId}`);
                    }

                    // Yeni HTML'i render et
                    console.log('üé® Render ba≈ülƒ±yor - result.data:', result.data);
                    const newHTML = renderRecommendationsHTML(result.data, language);
                    console.log('üé® Render edilen HTML uzunluƒüu:', newHTML.length);
                    console.log('üé® Render edilen HTML preview:', newHTML.substring(0, 200));

                    recommendationsContainer.innerHTML = newHTML;

                    // ‚úÖ CONTAINER STƒ∞LLERƒ∞Nƒ∞ D√úZELT: cssText ile t√ºm inline stilleri override et
                    recommendationsContainer.style.cssText = 'opacity: 1 !important; pointer-events: auto !important;';
                    console.log('‚úÖ Container stilleri d√ºzeltildi (cssText ile override edildi)');

                    // üéØ Unique ID sayesinde sadece bu container etkileniyor - eski Blade HTML'i bozulmuyor
                    console.log(`‚úÖ Sadece AI container g√ºncellendi: ${containerId}`);

                    // Loader'ƒ± gizle (container d√ºzeltildikten SONRA)
                    const loaderDiv = activeLanguageContent.querySelector('.ai-recommendations-loader');
                    if (loaderDiv) {
                        loaderDiv.style.display = 'none';
                        console.log('‚úÖ Loader gizlendi');
                    }

                    console.log('‚úÖ DOM direkt g√ºncellendi - Livewire kullanƒ±lmadƒ±');
                    console.log('üìç Container innerHTML uzunluƒüu:', recommendationsContainer.innerHTML.length);
                    console.log('üìç Container g√∂r√ºn√ºr m√º?', window.getComputedStyle(recommendationsContainer).display);

                    // ‚úÖ BUTON ENABLE: ƒ∞≈ülem ba≈üarƒ±lƒ±, butonu aktif et
                    // Butonu yeniden bul (DOM g√ºncellenmi≈ü olabilir)
                    const refreshedButton = document.querySelector(`.ai-seo-recommendations-btn[data-language="${language}"]`);
                    if (refreshedButton) {
                        refreshedButton.disabled = false;
                        console.log('üîì Buton enable edildi (success) - refreshed button');
                    } else {
                        button.disabled = false;
                        console.log('üîì Buton enable edildi (success) - original button');
                    }

                    // üéØ TEMPLATE-BASED AUTO-APPLY: Template'deki 1. sƒ±ra √∂nerilerini uygula
                    setTimeout(() => {
                        console.log('üéØ AUTO-APPLY: 1. sƒ±ra √∂neriler uygulanacak');
                        applyFirstAlternativesFromTemplate();
                    }, 300);
                }

                // Cache mesajƒ± g√∂ster
                if (result.data.from_cache) {
                    console.log('üíæ √ñneri kaydedilmi≈ü verilerden y√ºklendi');
                }
            } else {
                console.error('‚ùå API Error:', result.message);

                // ‚úÖ BUTON ENABLE: Hata durumunda butonu aktif et
                button.disabled = false;
                console.log('üîì Buton enable edildi (error)');

                // Loader'ƒ± gizle ve i√ßeriƒüi geri getir
                const activeLanguageContent = document.querySelector(`.seo-language-content[data-language="${language}"]`);
                if (activeLanguageContent) {
                    const loaderDiv = activeLanguageContent.querySelector('.ai-recommendations-loader');
                    if (loaderDiv) loaderDiv.style.display = 'none';
                    const recommendationsContainer = activeLanguageContent.querySelector('.mt-3');
                    if (recommendationsContainer) {
                        recommendationsContainer.style.opacity = '1';
                        recommendationsContainer.style.pointerEvents = 'auto';
                    }
                }
                showInlineError('√ñneri alƒ±nƒ±rken hata: ' + result.message);
            }
        } catch (error) {
            console.error('üí• RECOMMENDATIONS ERROR:', error);
            console.error('üí• Error stack:', error.stack);

            // ‚úÖ BUTON ENABLE: Hata durumunda butonu aktif et
            button.disabled = false;
            console.log('üîì Buton enable edildi (catch)');

            // Loader'ƒ± gizle ve i√ßeriƒüi geri getir
            const activeLanguageContent = document.querySelector(`.seo-language-content[data-language="${language}"]`);
            if (activeLanguageContent) {
                const loaderDiv = activeLanguageContent.querySelector('.ai-recommendations-loader');
                if (loaderDiv) loaderDiv.style.display = 'none';
                const recommendationsContainer = activeLanguageContent.querySelector('.mt-3');
                if (recommendationsContainer) {
                    recommendationsContainer.style.opacity = '1';
                    recommendationsContainer.style.pointerEvents = 'auto';
                }
            }

            showInlineError('Baƒülantƒ± hatasƒ±: ' + error.message);
        } finally {
            // üîì BUTON ENABLE: G√ºvenlik i√ßin finally'de de enable et
            // Butonu yeniden bul (DOM g√ºncellenmi≈ü olabilir)
            const finalButton = document.querySelector(`.ai-seo-recommendations-btn[data-language="${language}"]`);
            if (finalButton) {
                finalButton.disabled = false;
                console.log('üîì Buton enable edildi (finally) - refreshed button');
            } else {
                button.disabled = false;
                console.log('üîì Buton enable edildi (finally) - original button');
            }
        }
    }
    
    // handleSeoAnalysis function removed - AI SEO Analysis no longer supported
    function handleSeoAnalysis_REMOVED(button) {
        console.log('‚ùå This function is disabled');
        return;
        /*
        console.log('üöÄ SEO ANALYSIS START');

        // Dƒ∞REKT ANALƒ∞Z - Confirm dialog yok
        console.log('üîÑ SEO Analizi direkt ba≈ülatƒ±lƒ±yor (alert yok)');

        try {
            const language = button.getAttribute('data-language') || getCurrentActiveLanguage();

            // Livewire loading state aktif et
            if (typeof Livewire !== 'undefined') {
                Livewire.dispatch('setAnalysisLoader', {loading: true, language: language});
            }

            // Sadece buton loading - global overlay yok
            setButtonLoading(button, true, 'Olu≈üturuluyor...');
            
            const collectedData = collectFormData();
            console.log('üö® DEBUG CHECKPOINT 1: collectFormData called');
            const formData = {
                feature_slug: 'seo-smart-recommendations',
                form_content: collectedData,
                language: collectedData.language || 'tr',
                force_regenerate: true  // Her zaman yeni veri al (test i√ßin)
            };
            console.log('üìã Form data:', formData);
            console.log('üö® DEBUG CHECKPOINT 2: collected data keys:', Object.keys(collectedData));
            
            console.log('üîó Sending request to:', '/admin/seo/ai/analyze');
            // REMOVED - this function should not be called
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': csrfToken
                },
                body: JSON.stringify(formData)
            });
            
            console.log('üì° Response status:', response.status);
            console.log('üì° Response headers:', response.headers);
            
            if (!response.ok) {
                const errorText = await response.text();
                console.error('‚ùå HTTP Error Response:', errorText);
                throw new Error(`HTTP ${response.status}: ${errorText.substring(0, 200)}...`);
            }
            
            const responseText = await response.text();
            console.log('üìÑ Raw response:', responseText.substring(0, 500));
            
            let result;
            try {
                result = JSON.parse(responseText);
                console.log('‚úÖ Parsed JSON result:', result);
            } catch (jsonError) {
                console.error('‚ùå JSON Parse Error:', jsonError);
                console.error('‚ùå Response was not JSON:', responseText.substring(0, 1000));
                throw new Error('Server returned HTML instead of JSON. Check if endpoint exists.');
            }
            
            if (result.success) {
                console.log('‚úÖ Success result:', result);
                // FULL RESPONSE'u kaydet - detailed_scores root level'de!
                window.lastSeoResponse = result;
                console.log('üíæ SAVED TO WINDOW:', window.lastSeoResponse);

                // Livewire'a sonucu g√∂nder
                if (typeof Livewire !== 'undefined') {
                    console.log('üöÄ Dispatching aiAnalysisCompleted with FULL result:', result);
                    console.log('üöÄ result.data:', result.data);
                    console.log('üöÄ Language:', language);
                    // Livewire 3.x dispatch - object parameter format with #[On] attribute
                    Livewire.dispatch('aiAnalysisCompleted', {
                        analysisData: result,
                        language: language
                    });
                    console.log('‚úÖ aiAnalysisCompleted dispatched successfully');
                } else {
                    console.warn('‚ö†Ô∏è Livewire not available, using fallback');
                    // Fallback: Eski display sistemi
                    displayComprehensiveAnalysis(result.data);
                }
            } else {
                console.error('‚ùå API Error:', result.message);
                showError('Analiz sƒ±rasƒ±nda hata: ' + result.message);
            }
        } catch (error) {
            console.error('üí• FULL ERROR:', error);
            console.error('üí• Error stack:', error.stack);

            // Livewire error handler
            if (typeof Livewire !== 'undefined') {
                Livewire.dispatch('setAnalysisLoader', {loading: false, language: language});
            }

            showError('Baƒülantƒ± hatasƒ±: ' + error.message);
        } finally {
            // Sadece buton durumunu sƒ±fƒ±rla - global overlay yok
            setButtonLoading(button, false);
        }
        */
    }
    
    async function handleSeoGenerate(button) {
        console.log('üöÄ SEO GENERATE START');
        try {
            setButtonLoading(button, true, 'Olu≈üturuluyor...');
            showInlineLoading('seoUniversalResults', 'SEO i√ßeriƒüi olu≈üturuluyor, l√ºtfen bekleyin...', 'ai-recommendations');
            
            const collectedData = collectFormData();
            const formData = {
                form_content: collectedData,
                language: collectedData.language || 'tr'
            };
            console.log('üìã Form data:', formData);
            
            console.log('üîó Sending request to:', '/admin/seo/ai/generate');
            const response = await fetch('/admin/seo/ai/generate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': csrfToken
                },
                body: JSON.stringify(formData)
            });
            
            console.log('üì° Response status:', response.status);
            
            if (!response.ok) {
                const errorText = await response.text();
                console.error('‚ùå HTTP Error Response:', errorText);
                throw new Error(`HTTP ${response.status}: ${errorText.substring(0, 200)}...`);
            }
            
            const responseText = await response.text();
            console.log('üìÑ Raw response:', responseText.substring(0, 500));
            
            let result;
            try {
                result = JSON.parse(responseText);
                console.log('‚úÖ Parsed JSON result:', result);
            } catch (jsonError) {
                console.error('‚ùå JSON Parse Error:', jsonError);
                console.error('‚ùå Response was not JSON:', responseText.substring(0, 1000));
                throw new Error('Server returned HTML instead of JSON. Check if endpoint exists.');
            }
            
            if (result.success) {
                console.log('‚úÖ Success - updating fields:', result.data);

                // Overlay'i kaldƒ±r ve sonu√ßlarƒ± g√∂ster
                hideInlineLoading('seoUniversalResults');
                displayGenerateResults(result.data);
                showSuccess('SEO i√ßeriƒüi ba≈üarƒ±yla olu≈üturuldu!');
            } else {
                console.error('‚ùå API Error:', result.message);
                showError('Olu≈üturma sƒ±rasƒ±nda hata: ' + result.message);
            }
        } catch (error) {
            console.error('üí• FULL ERROR:', error);
            console.error('üí• Error stack:', error.stack);
            showError('Baƒülantƒ± hatasƒ±: ' + error.message);
        } finally {
            setButtonLoading(button, false);
        }
    }
    
    async function handleSeoSuggestions(button) {
        console.log('üöÄ SEO SUGGESTIONS START');
        try {
            setButtonLoading(button, true, 'Olu≈üturuluyor...');
            showInlineLoading('aiRecommendationsContainer', 'SEO √∂nerileri hazƒ±rlanƒ±yor, l√ºtfen bekleyin...', 'ai-recommendations');
            
            const collectedData = collectFormData();
            const formData = {
                form_content: collectedData,
                language: collectedData.language || 'tr'
            };
            console.log('üìã Form data:', formData);
            
            console.log('üîó Sending request to:', '/admin/seo/ai/suggestions');
            const response = await fetch('/admin/seo/ai/suggestions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': csrfToken
                },
                body: JSON.stringify(formData)
            });
            
            console.log('üì° Response status:', response.status);
            
            if (!response.ok) {
                const errorText = await response.text();
                console.error('‚ùå HTTP Error Response:', errorText);
                throw new Error(`HTTP ${response.status}: ${errorText.substring(0, 200)}...`);
            }
            
            const responseText = await response.text();
            console.log('üìÑ Raw response:', responseText.substring(0, 500));
            
            let result;
            try {
                result = JSON.parse(responseText);
                console.log('‚úÖ Parsed JSON result:', result);
            } catch (jsonError) {
                console.error('‚ùå JSON Parse Error:', jsonError);
                console.error('‚ùå Response was not JSON:', responseText.substring(0, 1000));
                throw new Error('Server returned HTML instead of JSON. Check if endpoint exists.');
            }
            
            if (result.success) {
                console.log('‚úÖ Success - displaying suggestions:', result.data);
                hideInlineLoading('aiRecommendationsContainer');
                displaySuggestions(result.data);
            } else {
                console.error('‚ùå API Error:', result.message);
                hideInlineLoading('aiRecommendationsContainer');
                showError('√ñneri alƒ±nƒ±rken hata: ' + result.message);
            }
        } catch (error) {
            console.error('üí• FULL ERROR:', error);
            console.error('üí• Error stack:', error.stack);
            hideInlineLoading('aiRecommendationsContainer');
            showError('Baƒülantƒ± hatasƒ±: ' + error.message);
        } finally {
            setButtonLoading(button, false);
        }
    }
    
    // Utility functions
    function collectFormData() {
        console.log('üîç collectFormData() BA≈ûLADI');
        const data = {};
        
        // Collect Livewire model data
        const livewireInputs = document.querySelectorAll('[wire\\:model]');
        console.log('üîç Bulunan Livewire input sayƒ±sƒ±:', livewireInputs.length);
        
        livewireInputs.forEach(input => {
            const model = input.getAttribute('wire:model');
            if (model) {
                // Include all fields, even empty ones - important for SEO scoring
                data[model] = input.value || '';
                console.log('üìù Field eklendi:', model, '=', input.value || 'BO≈û');
            }
        });
        
        // Collect QuillHtml/Hugerte content - include empty editors too
        const quillEditors = document.querySelectorAll('.ql-editor');
        console.log('üîç Bulunan Quill editor sayƒ±sƒ±:', quillEditors.length);
        
        quillEditors.forEach(editor => {
            const parentContainer = editor.closest('[wire\\:ignore]') || editor.closest('.quill-container');
            if (parentContainer) {
                const wireModelElement = parentContainer.querySelector('[wire\\:model]');
                if (wireModelElement) {
                    const model = wireModelElement.getAttribute('wire:model');
                    if (model) {
                        // Include all editors, even empty ones - important for SEO scoring
                        data[model] = editor.innerHTML || '';
                        console.log('üìù Editor eklendi:', model, '=', (editor.innerHTML || 'BO≈û').substring(0, 50));
                    }
                }
            }
        });
        
        // üöÄ SAYFA Tƒ∞Pƒ∞ ALGILAMA Sƒ∞STEMƒ∞ - 2025 AI ENHANCED
        const pageType = detectPageType();
        console.log('üéØ Algƒ±lanan sayfa tipi:', pageType);
        
        // DEBUG: Form field mapping - logda hangi fieldlar var g√∂relim
        console.log('üîç COLLECTED FORM DATA:', data);
        console.log('üîç Form data keys:', Object.keys(data));
        
        // Backend i√ßin mapping - logda g√∂r√ºlen field yapƒ±sƒ±
        const mappedData = {};
        Object.keys(data).forEach(key => {
            mappedData[key] = data[key];
            
            // SEO field mapping for backend compatibility
            if (key.includes('multiLangInputs.tr.title')) {
                mappedData['title'] = data[key]; // Backend'de title arƒ±yor
                console.log('‚úÖ MAPPING: title =', data[key]);
            }
            if (key.includes('seoDataCache.tr.seo_description')) {
                mappedData['meta_description'] = data[key]; // Backend'de meta_description arƒ±yor
                console.log('‚úÖ MAPPING: meta_description =', data[key]);
            }
        });
        
        // üéØ SAYFA Tƒ∞Pƒ∞ VE CONTEXT Bƒ∞LGƒ∞LERƒ∞ EKLE
        mappedData.page_type = pageType.type;
        mappedData.page_context = pageType.context;
        mappedData.content_category = pageType.category;
        mappedData.seo_priority = pageType.seo_priority;
        
        // Add current page context
        mappedData.current_url = window.location.href;
        mappedData.language = document.documentElement.lang || 'tr';
        
        console.log('üîç MAPPED DATA FOR BACKEND:', mappedData);
        console.log('üéØ PAGE TYPE CONTEXT:', {
            type: pageType.type,
            context: pageType.context,
            category: pageType.category,
            priority: pageType.seo_priority
        });
        
        return mappedData;
    }
    
    // üöÄ SAYFA Tƒ∞Pƒ∞ ALGILAMA Sƒ∞STEMƒ∞ - 2025 AI ENHANCED
    function detectPageType() {
        const url = window.location.pathname.toLowerCase();
        const title = document.querySelector('[wire\\:model*="title"]')?.value?.toLowerCase() || '';
        const content = document.querySelector('.ql-editor')?.textContent?.toLowerCase() || '';
        
        console.log('üîç Page detection inputs:', { url, title: title.substring(0, 50), content: content.substring(0, 100) });
        
        // URL Pattern Analysis
        if (url.includes('/contact') || url.includes('/iletisim')) {
            return {
                type: 'contact',
                category: 'business_essential',
                context: 'Contact ve ileti≈üim sayfasƒ± - m√º≈üteri dostu dil, g√ºven in≈üasƒ±, yerel SEO odaklƒ±',
                seo_priority: 'high',
                keywords_focus: ['ileti≈üim', 'adres', 'telefon', 'email', 'randevu', 'harita'],
                content_style: 'professional_friendly'
            };
        }
        
        if (url.includes('/about') || url.includes('/hakkimizda') || url.includes('/hakkinda')) {
            return {
                type: 'about',
                category: 'brand_identity',
                context: 'Hakkƒ±mƒ±zda sayfasƒ± - marka hikayesi, g√ºvenilirlik, uzmanlƒ±k alanlarƒ±, kurumsal kimlik',
                seo_priority: 'high',
                keywords_focus: ['hakkƒ±mƒ±zda', 'hikaye', 'misyon', 'vizyon', 'takƒ±m', 'deneyim', 'uzmanlƒ±k'],
                content_style: 'authoritative_storytelling'
            };
        }
        
        if (url.includes('/service') || url.includes('/hizmet')) {
            return {
                type: 'service',
                category: 'conversion_focused',
                context: 'Hizmet tanƒ±tƒ±m sayfasƒ± - deƒüer √∂nerisi, faydalar, call-to-action odaklƒ±',
                seo_priority: 'very_high',
                keywords_focus: ['hizmet', '√ß√∂z√ºm', 'avantaj', 'fiyat', 'ba≈üvuru', 'randevu'],
                content_style: 'persuasive_professional'
            };
        }
        
        if (url.includes('/portfolio') || url.includes('/galeri') || url.includes('/work')) {
            return {
                type: 'portfolio',
                category: 'showcase',
                context: 'Portfolio ve √ßalƒ±≈üma √∂rnekleri - g√∂rsel odaklƒ±, ba≈üarƒ± hikayeleri, teknik detaylar',
                seo_priority: 'high',
                keywords_focus: ['portfolio', 'proje', '√ßalƒ±≈üma', '√∂rnek', 'ba≈üarƒ±', 'referans'],
                content_style: 'visual_storytelling'
            };
        }
        
        if (url.includes('/blog') || url.includes('/makale') || url.includes('/news')) {
            return {
                type: 'blog',
                category: 'content_marketing',
                context: 'Blog ve i√ßerik pazarlama - bilgi verici, SEO odaklƒ±, okuyucu etkile≈üimi',
                seo_priority: 'very_high',
                keywords_focus: ['blog', 'makale', 'rehber', 'ipucu', 'bilgi', 'uzman g√∂r√º≈ü√º'],
                content_style: 'informative_engaging'
            };
        }
        
        if (url.includes('/product') || url.includes('/urun')) {
            return {
                type: 'product',
                category: 'ecommerce',
                context: '√úr√ºn tanƒ±tƒ±m sayfasƒ± - √∂zellikler, faydalar, satƒ±≈ü odaklƒ±, kar≈üƒ±la≈ütƒ±rma',
                seo_priority: 'very_high',
                keywords_focus: ['√ºr√ºn', '√∂zellik', 'fiyat', 'satƒ±n al', 'inceleme', 'kar≈üƒ±la≈ütƒ±r'],
                content_style: 'sales_optimized'
            };
        }
        
        // Content-Based Detection
        if (title.includes('ileti≈üim') || title.includes('contact') || content.includes('adres') || content.includes('telefon')) {
            return {
                type: 'contact',
                category: 'business_essential',
                context: 'ƒ∞leti≈üim sayfasƒ± - ba≈ülƒ±k/i√ßerik analizi ile tespit edildi',
                seo_priority: 'high',
                keywords_focus: ['ileti≈üim', 'adres', 'telefon', 'email'],
                content_style: 'professional_friendly'
            };
        }
        
        if (title.includes('hakkƒ±mƒ±zda') || title.includes('about') || content.includes('hikaye') || content.includes('misyon')) {
            return {
                type: 'about',
                category: 'brand_identity', 
                context: 'Hakkƒ±mƒ±zda sayfasƒ± - ba≈ülƒ±k/i√ßerik analizi ile tespit edildi',
                seo_priority: 'high',
                keywords_focus: ['hakkƒ±mƒ±zda', 'hikaye', 'misyon', 'vizyon'],
                content_style: 'authoritative_storytelling'
            };
        }
        
        // Default case - general page
        return {
            type: 'general',
            category: 'informational',
            context: 'Genel bilgi sayfasƒ± - dengeli SEO yakla≈üƒ±mƒ±, kullanƒ±cƒ± deneyimi odaklƒ±',
            seo_priority: 'medium',
            keywords_focus: ['bilgi', 'detay', 'rehber', 'a√ßƒ±klama'],
            content_style: 'balanced_informative'
        };
    }
    
    
    // YENƒ∞ KOMPREHENSƒ∞F ANALƒ∞Z EKRANI
    function displayComprehensiveAnalysis(analysis) {
        console.log('üîç COMPREHENSIVE ANALYSIS DEBUG START');
        console.log('üìÑ AI analizi tamamlandƒ±:', analysis);

        try {
            // 1) Overlay'i kaldƒ±r
            hideInlineLoading('seoUniversalResults');

            // 2) Success mesajƒ± g√∂ster
            showSuccess('SEO analizi tamamlandƒ±! Sonu√ßlarƒ± inceleyebilirsiniz.');

            // 3) TEK ALAN - Container'daki content area'yƒ± bul
            const analysisContainer = document.getElementById('seoUniversalResults');
            const contentArea = analysisContainer?.querySelector('.inline-content-area');

            if (contentArea) {
                // 3) Mevcut tasarƒ±mla aynƒ± analiz raporu olu≈ütur
                let analysisHTML = `
                    <div class="mt-4">
                        <div class="row">
                            <div class="col-12">
                                <div class="bg-light border p-3 rounded-3 mb-3 position-relative" style="border-radius: 0.25rem !important;">
                                    <h3 class="mb-0">
                                        <i class="fas fa-chart-line me-2"></i>
                                        SEO Analiz Raporu
                                    </h3>
                                    <small class="position-absolute text-muted" style="right: 1rem; top: 50%; transform: translateY(-50%);">
                                        Az √∂nce
                                    </small>
                                </div>
                            </div>
                        </div>
                        <div>
                `;

                // Overall Score ve Detailed Scores - Mevcut tasarƒ±m
                const score = analysis.overall_score || 75; // Fallback score
                const scoreColor = score >= 80 ? 'success' : score >= 60 ? 'warning' : 'danger';
                const scoreColorBg = score >= 80 ? 'bg-success' : score >= 60 ? 'bg-warning' : 'bg-danger';
                const scoreText = score >= 80 ? 'M√ºkemmel' : score >= 60 ? 'ƒ∞yi' : 'Geli≈ütirilmeli';

                analysisHTML += `
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="text-center">
                                <div class="avatar avatar-xl ${scoreColorBg} text-white mb-2" style="border-radius: 0.25rem !important;">
                                    ${score}
                                </div>
                                <h5>Genel SEO Skoru</h5>
                                <p>${scoreText}</p>
                            </div>
                        </div>
                        <div class="col-md-9">
                            <div class="row g-3">
                `;

                // Detailed Scores - Mevcut kart tasarƒ±mƒ± ile
                const defaultScores = {
                    meta_title: analysis.detailed_scores?.meta_title || 55,
                    meta_description: analysis.detailed_scores?.meta_description || 60,
                    content_quality: analysis.detailed_scores?.content_quality || 70,
                    social_media: analysis.detailed_scores?.social_media || 60
                };

                const scoreItems = [
                    { key: 'meta_title', label: 'Meta Title', icon: 'fas fa-heading' },
                    { key: 'meta_description', label: 'Meta Description', icon: 'fas fa-align-left' },
                    { key: 'content_quality', label: 'ƒ∞√ßerik Kalitesi', icon: 'fas fa-file-alt' },
                    { key: 'social_media', label: 'Sosyal Medya', icon: 'fas fa-share-alt' }
                ];

                scoreItems.forEach(item => {
                    const itemScore = defaultScores[item.key];
                    const itemColor = itemScore >= 80 ? 'success' : itemScore >= 60 ? 'warning' : 'danger';
                    const itemColorBorder = itemScore >= 80 ? 'border-success' : itemScore >= 60 ? 'border-warning' : 'border-danger';
                    const itemColorProgress = itemScore >= 80 ? 'bg-success' : itemScore >= 60 ? 'bg-warning' : 'bg-danger';

                    analysisHTML += `
                        <div class="col-md-3">
                            <div class="card ${itemColorBorder} hover-card" style="--tblr-primary: #EF4444 !important; border-radius: 0.25rem !important; transition: border-radius 0.15s;">
                                <div class="card-body text-center p-3" style="border-radius: 0.25rem !important;">
                                    <i class="${item.icon} fa-2x mb-2"></i>
                                    <h6>${item.label}</h6>
                                    <div class="progress mb-1" style="border-radius: 0.25rem !important;">
                                        <div class="progress-bar ${itemColorProgress}" style="width: ${itemScore}%; border-radius: 0.25rem !important;"></div>
                                    </div>
                                    <div>${itemScore}/100</div>
                                </div>
                            </div>
                        </div>
                    `;
                });

                analysisHTML += `
                            </div>
                        </div>
                    </div>
                `;

                // Accordions - mevcut yapƒ±yƒ± koru
                analysisHTML += `
                    <div class="accordion" id="realTimeSeoAccordion">
                        <!-- Meta Etiket Analizi -->
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed position-relative" type="button"
                                        data-bs-toggle="collapse" data-bs-target="#metaAnalysis" aria-expanded="false">
                                    <i class="fas fa-tags me-2"></i>
                                    Meta Etiket Analizi
                                    <span class="badge bg-${defaultScores.meta_title >= 80 ? 'success' : defaultScores.meta_title >= 60 ? 'warning' : 'danger'} position-absolute"
                                          style="right: 2.5rem; top: 50%; transform: translateY(-50%); border-radius: 0.25rem !important;">
                                        ${defaultScores.meta_title}/100
                                    </span>
                                </button>
                            </h2>
                            <div id="metaAnalysis" class="accordion-collapse collapse" data-bs-parent="#realTimeSeoAccordion">
                                <div class="accordion-body pt-4">
                                    <div class="mb-4">
                                        <h5 class="mb-3">Meta Title</h5>
                                        <div class="p-3 rounded border" style="border-radius: 0.25rem !important;">
                                            <p class="mb-1">"${analysis.current_meta_title || 'Meta title bulunamadƒ±'}"</p>
                                            <div class="d-flex justify-content-between align-items-center">
                                                <span>${(analysis.current_meta_title || '').length} karakter</span>
                                                <span class="badge bg-${(analysis.current_meta_title || '').length >= 30 ? 'success' : 'danger'}" style="border-radius: 0.25rem !important;">
                                                    Meta Title
                                                </span>
                                            </div>
                                        </div>
                                        ${(analysis.current_meta_title || '').length < 30 ? '<p class="mb-0 mt-2">Ba≈ülƒ±ƒüƒ± geni≈ületin (en az 30 karakter)</p>' : ''}
                                    </div>
                                    <div>
                                        <h5 class="mb-3">Meta Description</h5>
                                        <div class="p-3 rounded border" style="border-radius: 0.25rem !important;">
                                            <p class="mb-1">"${analysis.current_meta_description || 'Meta description bulunamadƒ±'}"</p>
                                            <span>${(analysis.current_meta_description || '').length} karakter</span>
                                        </div>
                                        ${(analysis.current_meta_description || '').length < 120 ? '<p class="mb-0 mt-2">A√ßƒ±klamayƒ± geni≈ületin (120-160 karakter arasƒ± ideal)</p>' : ''}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ƒ∞√ßerik Kalite Analizi -->
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed position-relative" type="button"
                                        data-bs-toggle="collapse" data-bs-target="#contentQualityAnalysis" aria-expanded="false">
                                    <i class="fas fa-file-alt me-2"></i>
                                    ƒ∞√ßerik Kalite Analizi
                                    <span class="badge bg-${defaultScores.content_quality >= 80 ? 'success' : defaultScores.content_quality >= 60 ? 'warning' : 'danger'} position-absolute"
                                          style="right: 2.5rem; top: 50%; transform: translateY(-50%); border-radius: 0.25rem !important;">
                                        ${defaultScores.content_quality}/100
                                    </span>
                                </button>
                            </h2>
                            <div id="contentQualityAnalysis" class="accordion-collapse collapse" data-bs-parent="#realTimeSeoAccordion">
                                <div class="accordion-body pt-4">
                                    <div class="mb-4">
                                        <h5 class="mb-3">ƒ∞√ßerik ƒ∞statistikleri</h5>
                                        <div class="row g-3">
                                            <div class="col-6">
                                                <div class="p-3 rounded border text-center hover-element" style="border-radius: 0.25rem !important;">
                                                    <div class="h4 mb-1">${analysis.word_count || 0}</div>
                                                    <div>Kelime</div>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <div class="p-3 rounded border text-center hover-element" style="border-radius: 0.25rem !important;">
                                                    <div class="h4 mb-1">${analysis.reading_time || '1 dk'}</div>
                                                    <div>Okuma S√ºresi</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <h5 class="mb-3">Ba≈ülƒ±k Yapƒ±sƒ±</h5>
                                        <ul class="list-unstyled mb-0">
                                            <li class="mb-2">
                                                <span class="badge bg-${analysis.has_h1 ? 'success' : 'danger'} me-2" style="border-radius: 0.25rem !important;">${analysis.has_h1 ? 'Var' : 'Yok'}</span>
                                                H1 Ba≈ülƒ±ƒüƒ±
                                            </li>
                                            <li>
                                                <span class="badge bg-${analysis.has_h2 ? 'success' : 'warning'} me-2" style="border-radius: 0.25rem !important;">${analysis.has_h2 ? 'Yeterli' : 'Az'}</span>
                                                H2 Ba≈ülƒ±klarƒ±
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Sosyal Medya ve Yapƒ±sal Veri -->
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed position-relative" type="button"
                                        data-bs-toggle="collapse" data-bs-target="#socialAndSchema" aria-expanded="false">
                                    <i class="fas fa-share-nodes me-2"></i>
                                    Sosyal Medya ve Yapƒ±sal Veri
                                    <span class="badge bg-${defaultScores.social_media >= 80 ? 'success' : defaultScores.social_media >= 60 ? 'warning' : 'danger'} position-absolute"
                                          style="right: 2.5rem; top: 50%; transform: translateY(-50%); border-radius: 0.25rem !important;">
                                        ${defaultScores.social_media}/100
                                    </span>
                                </button>
                            </h2>
                            <div id="socialAndSchema" class="accordion-collapse collapse" data-bs-parent="#realTimeSeoAccordion">
                                <div class="accordion-body pt-4">
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <h5 class="mb-3">Open Graph Etiketleri</h5>
                                            <div class="p-3 rounded border" style="border-radius: 0.25rem !important;">
                                                <div class="d-flex justify-content-between mb-2">
                                                    <span>OG Title</span>
                                                    <span class="badge bg-${analysis.og_title ? 'success' : 'danger'}" style="border-radius: 0.25rem !important;">
                                                        ${analysis.og_title ? 'Hazƒ±r' : 'Eksik'}
                                                    </span>
                                                </div>
                                                <div class="d-flex justify-content-between">
                                                    <span>OG Description</span>
                                                    <span class="badge bg-${analysis.og_description ? 'success' : 'danger'}" style="border-radius: 0.25rem !important;">
                                                        ${analysis.og_description ? 'Hazƒ±r' : 'Eksik'}
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <h5 class="mb-3">Schema ƒ∞≈üaretlemeleri</h5>
                                            <div class="p-3 rounded border" style="border-radius: 0.25rem !important;">
                                                <div class="d-flex justify-content-between mb-2">
                                                    <span>Schema</span>
                                                    <span class="badge bg-${analysis.has_schema ? 'success' : 'danger'}" style="border-radius: 0.25rem !important;">
                                                        ${analysis.has_schema ? 'Var' : 'Yok'}
                                                    </span>
                                                </div>
                                                <div class="d-flex justify-content-between">
                                                    <span>Rich Snippets</span>
                                                    <span class="badge bg-${analysis.rich_snippets ? 'success' : 'warning'}" style="border-radius: 0.25rem !important;">
                                                        ${analysis.rich_snippets ? 'Aktif' : 'Eksik'}
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- √ñncelikli Eylem Planƒ± -->
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed position-relative" type="button"
                                        data-bs-toggle="collapse" data-bs-target="#actionPlan" aria-expanded="false">
                                    <i class="fas fa-bullseye me-2"></i>
                                    √ñncelikli Eylem Planƒ±
                                    <span class="badge bg-primary position-absolute"
                                          style="right: 2.5rem; top: 50%; transform: translateY(-50%); --tblr-primary: #EF4444 !important; --tblr-primary-rgb: 239, 68, 68 !important; border-radius: 0.25rem !important;">
                                        ${(analysis.issues?.length || 3)} eylem
                                    </span>
                                </button>
                            </h2>
                            <div id="actionPlan" class="accordion-collapse collapse" data-bs-parent="#realTimeSeoAccordion">
                                <div class="accordion-body pt-4">
                                    <h5 class="mb-3">Yapƒ±lacaklar Listesi</h5>
                                    <div class="p-3 rounded border" style="border-radius: 0.25rem !important;">
                `;

                const actionItems = Array.isArray(analysis.issues) && analysis.issues.length > 0 ? analysis.issues : [
                    { priority: 'high', title: 'Meta Title iyile≈ütir', suggestions: ['En az 30 karakter olmalƒ±'] },
                    { priority: 'high', title: 'ƒ∞√ßeriƒüi geli≈ütir', suggestions: ['En az 300 kelime yazƒ±n'] },
                    { priority: 'medium', title: 'Meta Description iyile≈ütir', suggestions: ['En az 120 karakter olmalƒ±'] }
                ];

                actionItems.forEach((item, index) => {
                    const priorityRaw = item?.priority ?? 'medium';
                    const priority = typeof priorityRaw === 'string' ? priorityRaw.toLowerCase() : String(priorityRaw).toLowerCase();
                    const priorityColor = priority === 'high' ? 'danger' : priority === 'medium' ? 'warning' : 'info';
                    const priorityText = priority === 'high' ? 'KRƒ∞Tƒ∞K' : priority === 'medium' ? 'Y√úKSEK' : 'ORTA';

                    const borderClass = index < actionItems.length - 1 ? 'border-bottom' : '';

                    analysisHTML += `
                        <div class="mb-3 pb-3 ${borderClass}">
                            <h6 class="mb-2">
                                <span class="badge bg-${priorityColor} me-2" style="border-radius: 0.25rem !important;">${priorityText}</span>
                                ${item.title || 'SEO ƒ∞yile≈ütirmesi'}
                            </h6>
                            <ul class="mb-0">
                    `;

                    const suggestionsSource = Array.isArray(item.suggestions) && item.suggestions.length
                        ? item.suggestions
                        : item.description
                            ? [item.description]
                            : ['ƒ∞yile≈ütirme √∂nerileri hazƒ±rlanƒ±yor...'];

                    suggestionsSource.forEach(suggestion => {
                        analysisHTML += `<li>${suggestion}</li>`;
                    });

                    analysisHTML += `</ul></div>`;
                });

                analysisHTML += `
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                // Kapanƒ±≈ü divleri
                analysisHTML += `
                        </div>
                    </div>
                `;

                // Content area'ya HTML'i ekle
                contentArea.innerHTML = analysisHTML;

                console.log('‚úÖ Analiz sonu√ßlarƒ± dinamik olarak g√∂sterildi');

                // Smooth scroll to results
                setTimeout(() => {
                    contentArea.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }, 500);

            } else {
                console.warn('‚ö†Ô∏è Analiz container bulunamadƒ±, sayfa yenileniyor...');
                setTimeout(() => {
                    window.location.reload();
                }, 1000);
            }

        } catch (error) {
            console.error('‚ùå displayComprehensiveAnalysis error:', error);
            setTimeout(() => {
                window.location.reload();
            }, 1000);
        }
    }

    function displayGenerateResults(data) {
        console.log('üìÑ SEO Generate sonu√ßlarƒ± g√∂steriliyor:', data);

        const container = document.getElementById('seoUniversalResults');
        const contentArea = container?.querySelector('.inline-content-area');

        if (contentArea && data) {
            // Mevcut tasarƒ±m ile SEO Generate sonu√ßlarƒ±
            let generateHTML = `
                <div class="mt-4">
                    <div class="row">
                        <div class="col-12">
                            <div class="bg-light border p-3 rounded-3 mb-3 position-relative" style="border-radius: 0.25rem !important;">
                                <h3 class="mb-0">
                                    <i class="fas fa-magic me-2"></i>
                                    AI SEO ƒ∞√ßerik √ñnerileri
                                </h3>
                                <small class="position-absolute text-muted" style="right: 1rem; top: 50%; transform: translateY(-50%);">
                                    Az √∂nce
                                </small>
                            </div>
                        </div>
                    </div>
                    <div>
                        <div class="accordion mt-4" id="seoGenerateAccordion">
            `;

            // Meta Title Accordion
            if (data.meta_title) {
                generateHTML += `
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#generateMetaTitle" aria-expanded="true">
                                <i class="fas fa-heading me-2"></i>
                                √ñnerilen Meta Title
                                <span class="badge bg-success position-absolute" style="right: 2.5rem; top: 50%; transform: translateY(-50%); border-radius: 0.25rem !important;">
                                    ${data.meta_title.length} karakter
                                </span>
                            </button>
                        </h2>
                        <div id="generateMetaTitle" class="accordion-collapse collapse show" data-bs-parent="#seoGenerateAccordion">
                            <div class="accordion-body pt-4">
                                <div class="p-3 rounded border mb-3" style="border-radius: 0.25rem !important;">
                                    <p class="mb-1">"${data.meta_title}"</p>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span>${data.meta_title.length} karakter</span>
                                        <button class="btn btn-outline-primary btn-sm" onclick="navigator.clipboard.writeText('${data.meta_title}')">
                                            <i class="fas fa-copy me-1"></i>Kopyala
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Meta Description Accordion
            if (data.meta_description) {
                generateHTML += `
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#generateMetaDescription" aria-expanded="false">
                                <i class="fas fa-align-left me-2"></i>
                                √ñnerilen Meta Description
                                <span class="badge bg-success position-absolute" style="right: 2.5rem; top: 50%; transform: translateY(-50%); border-radius: 0.25rem !important;">
                                    ${data.meta_description.length} karakter
                                </span>
                            </button>
                        </h2>
                        <div id="generateMetaDescription" class="accordion-collapse collapse" data-bs-parent="#seoGenerateAccordion">
                            <div class="accordion-body pt-4">
                                <div class="p-3 rounded border mb-3" style="border-radius: 0.25rem !important;">
                                    <p class="mb-1">"${data.meta_description}"</p>
                                    <div class="d-flex justify-content-between align-items-center">
                                        <span>${data.meta_description.length} karakter</span>
                                        <button class="btn btn-outline-primary btn-sm" onclick="navigator.clipboard.writeText('${data.meta_description}')">
                                            <i class="fas fa-copy me-1"></i>Kopyala
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            // Keywords/Anahtar Kelimeler
            if (data.keywords && Array.isArray(data.keywords) && data.keywords.length > 0) {
                generateHTML += `
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#generateKeywords" aria-expanded="false">
                                <i class="fas fa-tags me-2"></i>
                                √ñnerilen Anahtar Kelimeler
                                <span class="badge bg-info position-absolute" style="right: 2.5rem; top: 50%; transform: translateY(-50%); border-radius: 0.25rem !important;">
                                    ${data.keywords.length} kelime
                                </span>
                            </button>
                        </h2>
                        <div id="generateKeywords" class="accordion-collapse collapse" data-bs-parent="#seoGenerateAccordion">
                            <div class="accordion-body pt-4">
                                <div class="p-3 rounded border mb-3" style="border-radius: 0.25rem !important;">
                                    <div class="d-flex flex-wrap gap-2">
                                        ${data.keywords.map(keyword =>
                                            `<span class="badge bg-primary" style="border-radius: 0.25rem !important;">${keyword}</span>`
                                        ).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            generateHTML += `
                        </div>
                    </div>
                </div>
            `;

            contentArea.innerHTML = generateHTML;

            // Smooth scroll
            setTimeout(() => {
                contentArea.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }, 300);

            console.log('‚úÖ Generate sonu√ßlarƒ± mevcut tasarƒ±mla g√∂sterildi');
        }
    }

    function displaySuggestions(data) {
        console.log('üéØ SUGGESTIONS Results data:', data);
        console.log('üîç SUGGESTIONS DATA STRUCTURE CHECK:');
        console.log('  data.suggestions:', data.suggestions);
        console.log('  data.suggestions type:', typeof data.suggestions);
        if (data.suggestions && typeof data.suggestions === 'object') {
            console.log('  data.suggestions keys:', Object.keys(data.suggestions));
            console.log('  data.suggestions.title_suggestions:', data.suggestions.title_suggestions);
            console.log('  data.suggestions.description_suggestions:', data.suggestions.description_suggestions);
        }

        // AI √ñNERƒ∞LERƒ∞ - Container'ƒ± temizle ve kullan
        const container = document.getElementById('aiRecommendationsContainer');
        if (!container) {
            console.warn('‚ö†Ô∏è aiRecommendationsContainer bulunamadƒ±');
            return;
        }

        // √ñNCEKƒ∞ ƒ∞√áERƒ∞ƒûƒ∞ TEMƒ∞ZLE
        container.innerHTML = '';
        console.log('üßπ AI √∂nerileri container temizlendi');

        // Mevcut tasarƒ±m ile SEO Suggestions
        let html = `
            <div class="mt-4">
                <div class="row">
                    <div class="col-12">
                        <div class="bg-light border p-3 rounded-3 mb-3 position-relative" style="border-radius: 0.25rem !important;">
                            <h3 class="mb-0">
                                <i class="fas fa-lightbulb me-2"></i>
                                AI SEO √ñnerileri
                            </h3>
                            <small class="position-absolute text-muted" style="right: 1rem; top: 50%; transform: translateY(-50%);">
                                Az √∂nce
                            </small>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="accordion mt-4" id="seoSuggestionsAccordion">`;
        
        // SUGGESTIONS YAPISINI PARSE ET - backend'den obje olarak geliyor
        let hasContent = false;

        if (data && data.suggestions && typeof data.suggestions === 'object') {
            // Title Suggestions Accordion
            if (data.suggestions.title_suggestions && Array.isArray(data.suggestions.title_suggestions)) {
                html += `
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#titleSuggestions" aria-expanded="true">
                                <i class="fas fa-heading me-2"></i>
                                Title √ñnerileri
                                <span class="badge bg-primary position-absolute" style="right: 2.5rem; top: 50%; transform: translateY(-50%); border-radius: 0.25rem !important;">
                                    ${data.suggestions.title_suggestions.length} √∂neri
                                </span>
                            </button>
                        </h2>
                        <div id="titleSuggestions" class="accordion-collapse collapse show" data-bs-parent="#seoSuggestionsAccordion">
                            <div class="accordion-body pt-4">
                                <div class="list-group list-group-flush">
                `;

                data.suggestions.title_suggestions.forEach((suggestion, index) => {
                    html += `
                        <div class="list-group-item border-0 px-0 d-flex justify-content-between align-items-center">
                            <div>
                                <span class="badge bg-primary me-2" style="border-radius: 0.25rem !important;">${index + 1}</span>
                                ${suggestion}
                            </div>
                            <button class="btn btn-outline-primary btn-sm" onclick="navigator.clipboard.writeText('${suggestion}')">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    `;
                });

                html += `
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                hasContent = true;
            }

            // Description Suggestions Accordion
            if (data.suggestions.description_suggestions && Array.isArray(data.suggestions.description_suggestions)) {
                html += `
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#descriptionSuggestions" aria-expanded="false">
                                <i class="fas fa-align-left me-2"></i>
                                Description √ñnerileri
                                <span class="badge bg-success position-absolute" style="right: 2.5rem; top: 50%; transform: translateY(-50%); border-radius: 0.25rem !important;">
                                    ${data.suggestions.description_suggestions.length} √∂neri
                                </span>
                            </button>
                        </h2>
                        <div id="descriptionSuggestions" class="accordion-collapse collapse" data-bs-parent="#seoSuggestionsAccordion">
                            <div class="accordion-body pt-4">
                                <div class="list-group list-group-flush">
                `;

                data.suggestions.description_suggestions.forEach((suggestion, index) => {
                    html += `
                        <div class="list-group-item border-0 px-0 d-flex justify-content-between align-items-center">
                            <div>
                                <span class="badge bg-success me-2" style="border-radius: 0.25rem !important;">${index + 1}</span>
                                ${suggestion}
                            </div>
                            <button class="btn btn-outline-primary btn-sm" onclick="navigator.clipboard.writeText('${suggestion}')">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    `;
                });

                html += `
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                hasContent = true;
            }

            // Content Improvements Accordion
            if (data.suggestions.content_improvements && Array.isArray(data.suggestions.content_improvements)) {
                html += `
                    <div class="accordion-item">
                        <h2 class="accordion-header">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#contentImprovements" aria-expanded="false">
                                <i class="fas fa-tools me-2"></i>
                                ƒ∞√ßerik ƒ∞yile≈ütirmeleri
                                <span class="badge bg-warning position-absolute" style="right: 2.5rem; top: 50%; transform: translateY(-50%); border-radius: 0.25rem !important;">
                                    ${data.suggestions.content_improvements.length} √∂neri
                                </span>
                            </button>
                        </h2>
                        <div id="contentImprovements" class="accordion-collapse collapse" data-bs-parent="#seoSuggestionsAccordion">
                            <div class="accordion-body pt-4">
                                <div class="list-group list-group-flush">
                `;

                data.suggestions.content_improvements.forEach((suggestion, index) => {
                    html += `
                        <div class="list-group-item border-0 px-0 d-flex justify-content-between align-items-center">
                            <div>
                                <span class="badge bg-warning me-2" style="border-radius: 0.25rem !important;">${index + 1}</span>
                                ${suggestion}
                            </div>
                            <button class="btn btn-outline-primary btn-sm" onclick="navigator.clipboard.writeText('${suggestion}')">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    `;
                });

                html += `
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                hasContent = true;
            }
        }
        
        if (!hasContent) {
            html += `
                <div class="accordion-item">
                    <div class="accordion-body text-center py-5">
                        <i class="fas fa-robot fa-3x mb-3 opacity-25"></i>
                        <h5 class="text-muted">√ñneri Bulunamadƒ±</h5>
                        <p>AI √∂nerileri alƒ±namadƒ± veya beklenmedik bir hata olu≈ütu.</p>
                    </div>
                </div>
            `;
        }

        html += `
                    </div>
                </div>
            </div>
        `;

        container.innerHTML = html;

        // Smooth scroll
        setTimeout(() => {
            container.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }, 300);

        console.log('‚úÖ Professional Suggestions shown');
    }
    
    function showSuccess(message) {
        console.log('‚úÖ SUCCESS:', message);
    }
    
    function showError(message) {
        console.error('‚ùå ERROR:', message);
    }

    // AI RECOMMENDATIONS HELPER FUNCTIONS
    function displayRecommendations(data, language) {
        console.log('üéØ RECOMMENDATIONS Results data:', data);

        // AI √ñNERƒ∞LERƒ∞ - aiRecommendationsContainer kullan
        let container = document.getElementById('aiRecommendationsContainer');
        if (!container) {
            console.warn('‚ö†Ô∏è aiRecommendationsContainer container bulunamadƒ±');
            // Container olu≈ütur - TOOLBAR'IN ALTINA
            const toolbar = document.querySelector('.ai-seo-toolbar');
            const targetLocation = toolbar ? toolbar.parentElement : (
                document.querySelector('.seo-language-content[style*="display: block"]') ||
                document.querySelector('.tab-pane.active')
            );

            if (targetLocation) {
                const newContainer = document.createElement('div');
                newContainer.id = 'seoUniversalResults';
                newContainer.className = 'inline-results-container mt-4';

                // TOOLBAR'IN HEMEN ALTINA EKLE
                if (toolbar) {
                    toolbar.insertAdjacentElement('afterend', newContainer);
                    console.log('‚úÖ Recommendations container toolbar altƒ±na eklendi');
                } else {
                    targetLocation.appendChild(newContainer);
                    console.log('‚úÖ Recommendations container fallback location\'a eklendi');
                }

                // YENƒ∞ CONTAINER REFERANSINI AL
                container = newContainer;
            } else {
                return;
            }
        }

        // Loading'i gizle
        hideInlineLoading('seoUniversalResults');
        
        // Parse recommendations data
        const recommendations = data.recommendations || [];
        console.log('üìù Parsed recommendations:', recommendations);

        // YENƒ∞ INLINE Sƒ∞STEM HTML - SEO ANALƒ∞Zƒ∞ FORMATI
        let fullHTML = `
            <div class="mt-4">
                <div class="row">
                    <div class="col-12">
                        <div class="bg-light border p-3 rounded-3 mb-3 position-relative" style="border-radius: 0.25rem !important;">
                            <h3 class="mb-0">
                                <i class="fas fa-lightbulb me-2"></i>
                                AI SEO √ñnerileri
                            </h3>
                            <small class="position-absolute text-muted" style="right: 1rem; top: 50%; transform: translateY(-50%);">
                                Az √∂nce
                            </small>
                        </div>
                    </div>
                </div>
                <div>`;

        // Separate SEO and Social recommendations - FIXED LOGIC
        const seoRecs = recommendations.filter(r => r.type === 'title' || r.type === 'description');
        const socialRecs = recommendations.filter(r => r.type === 'og_title' || r.type === 'og_description');

        console.log('üîç Filtering recommendations:', {
            total: recommendations.length,
            seoRecs: seoRecs.length,
            socialRecs: socialRecs.length,
            allTypes: recommendations.map(r => r.type)
        });

        // SEO √ñnerileri Section
        if (seoRecs.length > 0) {
            fullHTML += `<div class="row mb-4">`;

            seoRecs.forEach((rec, index) => {
                const hasAlternatives = rec.alternatives && rec.alternatives.length > 0;

                fullHTML += `
                    <div class="col-6">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">${rec.title || 'SEO √ñnerisi'}</h3>
                            </div>
                            <div class="list-group list-group-flush">`;

                if (hasAlternatives) {
                    rec.alternatives.forEach((alt, altIndex) => {
                        fullHTML += `
                            <a href="#" class="list-group-item list-group-item-action${altIndex === 0 ? ' active' : ''}"
                               onclick="applyAlternativeDirectly('${rec.field_target}', '${alt.value.replace(/'/g, "\\'")}', this); return false;">
                                ${alt.value}
                            </a>`;
                    });
                } else {
                    fullHTML += `
                        <a href="#" class="list-group-item list-group-item-action">
                            ${rec.value || rec.suggested_value || ''}
                        </a>`;
                }

                fullHTML += `
                            </div>
                        </div>
                    </div>`;
            });

            fullHTML += `</div>`;
        }

        // Sosyal Medya √ñnerileri Section
        if (socialRecs.length > 0) {
            fullHTML += `<div class="row mb-4">`;

            socialRecs.forEach((rec, index) => {
                const hasAlternatives = rec.alternatives && rec.alternatives.length > 0;

                fullHTML += `
                    <div class="col-6">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">${rec.title || 'Sosyal Medya √ñnerisi'}</h3>
                            </div>
                            <div class="list-group list-group-flush">`;

                if (hasAlternatives) {
                    rec.alternatives.forEach((alt, altIndex) => {
                        fullHTML += `
                            <a href="#" class="list-group-item list-group-item-action${altIndex === 0 ? ' active' : ''}"
                               onclick="applyAlternativeDirectly('${rec.field_target}', '${alt.value.replace(/'/g, "\\'")}', this); return false;">
                                ${alt.value}
                            </a>`;
                    });
                } else {
                    fullHTML += `
                        <a href="#" class="list-group-item list-group-item-action">
                            ${rec.value || rec.suggested_value || ''}
                        </a>`;
                }

                fullHTML += `
                            </div>
                        </div>
                    </div>`;
            });

            fullHTML += `</div>`;
        }

        // HTML'i kapat
        fullHTML += `
                </div>
            </div>`;

        // YENƒ∞ Sƒ∞STEM: Inline container'a yazdƒ±r (sayfa yenileme YOK)
        container.innerHTML = fullHTML;

        // Auto-apply first recommendations
        autoApplyFirstRecommendations(recommendations);

        console.log('‚úÖ Recommendations displayed successfully in inline system');

        // Smooth scroll
        setTimeout(() => {
            container.scrollIntoView({
                behavior: 'smooth',
                block: 'start'
            });
        }, 100);
    }

    // Auto-apply first recommendations - ENHANCED
    function autoApplyFirstRecommendations(recommendations) {
        console.log('üîÑ Auto-applying first recommendations...');
        console.log('üìù Recommendations structure:', recommendations);

        if (!recommendations || recommendations.length === 0) {
            console.warn('‚ö†Ô∏è No recommendations to auto-apply');
            return;
        }

        let appliedCount = 0;
        recommendations.forEach((rec, index) => {
            console.log('üîç Processing recommendation ' + (index + 1) + ':', rec);

            if (!rec.alternatives || rec.alternatives.length === 0) {
                console.warn(`‚ö†Ô∏è Recommendation ${index + 1} has no alternatives:`, rec);
                return;
            }

            const firstAlternative = rec.alternatives[0];
            if (!firstAlternative || !firstAlternative.value) {
                console.warn(`‚ö†Ô∏è First alternative is invalid:`, firstAlternative);
                return;
            }

            console.log('‚úÖ Auto-applying ' + (rec.type || 'unknown') + ': ' + rec.field_target + ' = "' + firstAlternative.value.substring(0, 50) + '..."');

            try {
                // Apply directly to form fields
                applyAlternativeDirectly(rec.field_target, firstAlternative.value);
                appliedCount++;
                console.log('‚úÖ Successfully applied recommendation ' + (index + 1));
            } catch (error) {
                console.error(`‚ùå Failed to apply recommendation ${index + 1}:`, error);
            }
        });

        // Auto-enable social media customization toggle when OG fields are applied (SADECE TR i√ßin)
        const hasOgFields = recommendations.some(rec =>
            rec.field_target && (rec.field_target.includes('og_title') || rec.field_target.includes('og_description'))
        );

        if (hasOgFields) {
            console.log('üîÑ Enabling OG custom fields for TR language...');
            try {
                enableOgCustomFields('tr');
                console.log('‚úÖ OG custom fields enabled');
            } catch (error) {
                console.error('‚ùå Failed to enable OG custom fields:', error);
            }
        }

        console.log('‚úÖ Auto-apply completed: ' + appliedCount + '/' + recommendations.length + ' recommendations applied');
    }

    function showRecommendationsError(message, language) {
        const section = document.getElementById(`aiSeoRecommendationsSection_${language}`);
        if (!section) return;
        
        const loading = section.querySelector('.ai-recommendations-loading');
        const content = section.querySelector('.ai-recommendations-content');
        const error = section.querySelector('.ai-recommendations-error');
        
        loading.style.display = 'none';
        content.style.display = 'none';
        error.style.display = 'block';
        
        // Update error message if needed
        const errorMsg = error.querySelector('p');
        if (errorMsg) {
            errorMsg.textContent = message;
        }
        
        console.error('‚ùå Recommendations error shown:', message);
    }
    
    function updateApplyButton() {
        // RADIO BUTTON: Se√ßili radio buttonlarƒ± sayƒ±yoruz
        const radioButtons = document.querySelectorAll('.alternative-radio:checked');
        const applyBtn = document.querySelector('.ai-apply-selected-recommendations');
        
        if (!applyBtn) return;
        
        const selectedCount = radioButtons.length;
        
        if (selectedCount > 0) {
            applyBtn.disabled = false;
            applyBtn.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon me-1">
                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                    <path d="M9 7m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0"/>
                    <path d="M9 17l0 -10"/>
                    <path d="M19 16.5c0 .667 -.167 1.167 -.5 1.5s-.833 .333 -1.5 .333s-1.167 -.167 -1.5 -.5s-.333 -.833 -.333 -1.5c0 -.667 .167 -1.167 .5 -1.5s.833 -.333 1.5 -.333s1.167 .167 1.5 .5s.333 .833 .333 1.5z"/>
                </svg>
                Se√ßilenleri Uygula (${selectedCount})
            `;
        } else {
            applyBtn.disabled = true;
            applyBtn.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon me-1">
                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                    <path d="M9 7m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0"/>
                    <path d="M9 17l0 -10"/>
                    <path d="M19 16.5c0 .667 -.167 1.167 -.5 1.5s-.833 .333 -1.5 .333s-1.167 -.167 -1.5 -.5s-.333 -.833 -.333 -1.5c0 -.667 .167 -1.167 .5 -1.5s.833 -.333 1.5 -.333s1.167 .167 1.5 .5s.333 .833 .333 1.5z"/>
                </svg>
                Se√ßilenleri Uygula
            `;
        }
    }
    
    async function applySelectedRecommendations(button) {
        // RADIO BUTTON: Se√ßili radio buttonlarƒ± al  
        const selectedRadios = document.querySelectorAll('.alternative-radio:checked');
        
        if (selectedRadios.length === 0) {
            showError('L√ºtfen uygulamak istediƒüiniz √∂nerileri se√ßin.');
            return;
        }
        
        setButtonLoading(button, 'Uygulanƒ±yor...');
        
        try {
            console.log(`üöÄ Applying ${selectedRadios.length} selected recommendations...`);
            
            // Her se√ßili radio button i√ßin doƒürudan uygula
            let successCount = 0;
            selectedRadios.forEach(radio => {
                try {
                    // Radio button'un onclick fonksiyonunu √ßaƒüƒ±r
                    const onclickAttr = radio.getAttribute('onclick');
                    if (onclickAttr) {
                        // Extract fieldTarget and value from onclick
                        const match = onclickAttr.match(/applyAlternativeDirectly\('([^']+)',\s*'([^']+)'/);
                        if (match) {
                            const fieldTarget = match[1];
                            const value = match[2].replace(/\\'/g, "'");
                            
                            // Direct apply
                            applyAlternativeDirectly(fieldTarget, value, radio);
                            successCount++;
                            console.log(`‚úÖ Applied: ${fieldTarget} = ${value.substring(0, 50)}...`);
                        }
                    }
                } catch (error) {
                    console.error('Error applying radio selection:', error);
                }
            });
            
            // Show success feedback
            if (successCount > 0) {
                showSuccess(`${successCount} √∂neri ba≈üarƒ±yla uygulandƒ±!`);
                
                // Clear all radio selections after applying
                selectedRadios.forEach(radio => {
                    radio.checked = false;
                });
                updateApplyButton();
            }
            
        } catch (error) {
            console.error('üí• Apply recommendations error:', error);
            showError('√ñneri uygulanƒ±rken hata olu≈ütu: ' + error.message);
        } finally {
            resetButton(button, `
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon me-1">
                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                    <path d="M9 7m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0"/>
                    <path d="M9 17l0 -10"/>
                    <path d="M19 16.5c0 .667 -.167 1.167 -.5 1.5s-.833 .333 -1.5 .333s-1.167 -.167 -1.5 -.5s-.333 -.833 -.333 -1.5c0 -.667 .167 -1.167 .5 -1.5s.833 -.333 1.5 -.333s1.167 .167 1.5 .5s.333 .833 .333 1.5z"/>
                </svg>
                Se√ßilenleri Uygula
            `);
        }
    }
    
    async function applyRecommendation(rec) {
        console.log('üîß Applying single recommendation:', rec);
        
        const language = document.querySelector('.seo-language-content[style*="display: block"]')?.getAttribute('data-language') || 'tr';
        let valueToApply = rec.value || rec.suggested_value;
        
        // CHECK FOR SELECTED ALTERNATIVE
        if (rec.alternatives && rec.alternatives.length > 0) {
            // Find the selected alternative for this recommendation
            const recItem = document.querySelector(`[data-recommendation*='"id":${rec.id}']`);
            if (recItem) {
                const selectedRadio = recItem.querySelector('input.alternative-radio:checked');
                if (selectedRadio) {
                    // Get the selected alternative data
                    const altOption = selectedRadio.closest('.alternative-option');
                    if (altOption) {
                        const altData = JSON.parse(altOption.getAttribute('data-alternative'));
                        valueToApply = altData.value;
                        console.log('‚úÖ Using selected alternative:', altData.label, '=', valueToApply);
                    }
                } else {
                    console.warn('‚ö†Ô∏è No alternative selected for recommendation with alternatives');
                    return Promise.reject(new Error('L√ºtfen bir se√ßenek belirleyin'));
                }
            }
        }
        
        // Apply the selected value
        if (rec.type === 'title' || rec.field_target === 'seoDataCache.tr.seo_title') {
            const titleField = document.querySelector(`input[wire\\:model*="seoDataCache.${language}.seo_title"]`);
            if (titleField) {
                titleField.value = valueToApply;
                titleField.dispatchEvent(new Event('input', { bubbles: true }));
                console.log('‚úÖ Title updated:', valueToApply);
            }
        } else if (rec.type === 'description' || rec.field_target === 'seoDataCache.tr.seo_description') {
            const descField = document.querySelector(`textarea[wire\\:model*="seoDataCache.${language}.seo_description"]`);
            if (descField) {
                descField.value = valueToApply;
                descField.dispatchEvent(new Event('input', { bubbles: true }));
                console.log('‚úÖ Description updated:', valueToApply);
            }
        } else if (rec.type === 'og_title' || rec.field_target === 'seoDataCache.tr.og_title') {
            const ogTitleField = document.querySelector(`input[wire\\:model*="seoDataCache.${language}.og_title"]`);
            if (ogTitleField) {
                ogTitleField.value = valueToApply;
                ogTitleField.dispatchEvent(new Event('input', { bubbles: true }));
                console.log('‚úÖ OG Title updated:', valueToApply);
            }
        } else if (rec.type === 'og_description' || rec.field_target === 'seoDataCache.tr.og_description') {
            const ogDescField = document.querySelector(`textarea[wire\\:model*="seoDataCache.${language}.og_description"]`);
            if (ogDescField) {
                ogDescField.value = valueToApply;
                ogDescField.dispatchEvent(new Event('input', { bubbles: true }));
                console.log('‚úÖ OG Description updated:', valueToApply);
            }
        } else if (rec.type === 'keywords') {
            // For keywords, show as info for now (can be implemented later)
            console.log('‚ÑπÔ∏è Keywords suggestion:', valueToApply);
        }
        
        return Promise.resolve();
    }

    // Save SEO Content to Database
    window.saveSeoToDatabase = function(type, data) {
        console.log('üíæ Saving SEO data to database:', type, data);
        
        // Get current page/model info
        const currentUrl = window.location.pathname;
        const modelMatch = currentUrl.match(/\/admin\/(\w+)\/manage\/(\d+)/);
        
        if (!modelMatch) {
            showError('Model bilgisi alƒ±namadƒ±');
            return;
        }
        
        const modelType = modelMatch[1];
        const modelId = modelMatch[2];
        
        // Prepare save data
        const saveData = {
            model_type: modelType,
            model_id: modelId,
            language: 'tr',
            data: data,
            type: type
        };
        
        // Save to database via AJAX
        fetch('/admin/seo/save', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').content
            },
            body: JSON.stringify(saveData)
        })
        .then(response => response.json())
        .then(result => {
            if (result.success) {
                showSuccess('SEO verileri kaydedildi');
                
                // Update form fields if needed
                if (data.meta_title) {
                    const titleField = document.querySelector('input[name="seoDataCache[tr][seo_title]"]');
                    if (titleField) titleField.value = data.meta_title;
                }
                
                if (data.meta_description) {
                    const descField = document.querySelector('textarea[name="seoDataCache[tr][seo_description]"]');
                    if (descField) descField.value = data.meta_description;
                }
            } else {
                showError('Kayƒ±t ba≈üarƒ±sƒ±z: ' + (result.error || 'Bilinmeyen hata'));
            }
        })
        .catch(error => {
            console.error('Save error:', error);
            showError('Kayƒ±t hatasƒ±: ' + error.message);
        });
    };
    
    // Selection UI for Suggestions
    window.applySeoSuggestion = function(field, value) {
        console.log('‚úÖ Applying suggestion:', field, value);
        
        if (field === 'title') {
            const titleField = document.querySelector('input[name="seoDataCache[tr][seo_title]"]');
            if (titleField) {
                titleField.value = value;
                showSuccess('Title g√ºncellendi');
            }
        } else if (field === 'description') {
            const descField = document.querySelector('textarea[name="seoDataCache[tr][seo_description]"]');
            if (descField) {
                descField.value = value;
                showSuccess('Description g√ºncellendi');
            }
        }
    };
    
    // CLICK-TO-FILL functionality for SEO recommendations - ENHANCED
    window.applyAlternativeDirectly = function(fieldTarget, value, element) {
        console.log('üéØ Direct apply:', fieldTarget, value.substring(0, 50));
        console.log('üîç Element:', element);

        // DIRECT WIRE MODEL TARGETING - Backend sends full wire:model path
        let selector;

        if (fieldTarget.includes('seoDataCache.')) {
            // Direct wire:model targeting - properly escape dots for CSS selectors
            const escapedFieldTarget = fieldTarget.replace(/\./g, '\\\\.');
            selector = `[wire\\:model="${escapedFieldTarget}"]`;
            console.log('üîß Original field target:', fieldTarget);
            console.log('üîß Escaped field target:', escapedFieldTarget);
            console.log('üîß Final selector:', selector);
        } else {
            // Fallback mappings for simple field names
            const fieldMappings = {
                'seo_title': 'input[wire\\:model="seoDataCache.tr.seo_title"]',
                'seo_description': 'textarea[wire\\:model="seoDataCache.tr.seo_description"]',
                'content_type': 'select[wire\\:model="seoDataCache.tr.content_type"]',
                'og_title': 'input[wire\\:model="seoDataCache.tr.og_title"]',
                'og_description': 'textarea[wire\\:model="seoDataCache.tr.og_description"]',
                'priority_score': 'input[wire\\:model="seoDataCache.tr.priority_score"]'
            };
            selector = fieldMappings[fieldTarget];
        }

        if (!selector) {
            console.error('‚ùå Field mapping failed for:', fieldTarget);
            console.error('‚ùå Available selectors would be:', {
                'direct': `[wire\\:model="${fieldTarget}"]`,
                'fallback': 'Not available'
            });
            showError('Alan bulunamadƒ±: ' + fieldTarget);
            return false;
        }

        console.log('üîç Using selector:', selector);

        const field = document.querySelector(selector);
        if (!field) {
            console.error('‚ùå Field not found with selector:', selector);

            // Debug: Show available SEO fields
            const allSeoFields = document.querySelectorAll('[wire\\:model*="seo"]');
            console.error('‚ùå Available SEO fields:', Array.from(allSeoFields).map(f => f.getAttribute('wire:model')));

            // Try alternative selectors
            const altSelectors = [
                `input[wire\\:model="${fieldTarget}"]`,
                `textarea[wire\\:model="${fieldTarget}"]`,
                `select[wire\\:model="${fieldTarget}"]`
            ];

            for (const altSelector of altSelectors) {
                const altField = document.querySelector(altSelector);
                if (altField) {
                    console.log('‚úÖ Found field with alternative selector:', altSelector);
                    return applyToField(altField, value, fieldTarget, element);
                }
            }

            showError('Form alanƒ± bulunamadƒ±: ' + selector);
            return false;
        }

        console.log('‚úÖ Field found:', field.tagName, field.type || field.nodeName, field.getAttribute('wire:model'));

        return applyToField(field, value, fieldTarget, element);
    };

    // Helper function to apply value to field
    function applyToField(field, value, fieldTarget, element) {
        try {
            // Special handling for content_type (select vs custom input)
            if (fieldTarget === 'content_type' || fieldTarget.includes('content_type')) {
                handleContentTypeSelection(value);
            } else {
                // Update field value
                const oldValue = field.value;
                field.value = value;

                // Trigger Livewire update events
                field.dispatchEvent(new Event('input', { bubbles: true }));
                field.dispatchEvent(new Event('change', { bubbles: true }));

                console.log(`‚úÖ Field updated: "${oldValue}" ‚Üí "${value}"`);
            }

            // Auto-enable OG custom fields if OG fields are filled
            if (fieldTarget.includes('og_title') || fieldTarget.includes('og_description')) {
                console.log('üîÑ Auto-enabling OG custom fields...');
                const language = extractLanguageFromFieldTarget(fieldTarget);
                enableOgCustomFields(language);
            }

            // Visual feedback
            field.style.backgroundColor = '#d4edda';
            field.style.border = '2px solid #28a745';

            // Mark the clicked alternative as selected
            if (element) {
                const parent = element.closest('.ai-recommendation-item');
                if (parent) {
                    const alternatives = parent.querySelectorAll('.form-check');
                    alternatives.forEach(alt => alt.classList.remove('bg-success', 'text-white'));
                    element.classList.add('bg-success', 'text-white');
                }
            }

            // Reset visual feedback after 3 seconds
            setTimeout(() => {
                field.style.backgroundColor = '';
                field.style.border = '';
            }, 3000);

            showSuccess('√ñneri uygulandƒ±: ' + getFieldDisplayName(fieldTarget));
            return true;

        } catch (error) {
            console.error('‚ùå Error applying value to field:', error);
            showError('√ñneri uygulanƒ±rken hata: ' + error.message);
            return false;
        }
    }
    
    // Handle content type selection (dropdown vs custom input)
    function handleContentTypeSelection(value) {
        const selectField = document.querySelector('select[wire\\:model="seoDataCache.tr.content_type"]');
        if (!selectField) return;
        
        // Check if value exists in select options
        const optionExists = Array.from(selectField.options).some(option => option.value === value);
        
        if (optionExists) {
            // Select from dropdown
            selectField.value = value;
            selectField.dispatchEvent(new Event('change', { bubbles: true }));
        } else {
            // Use custom input
            selectField.value = 'custom';
            selectField.dispatchEvent(new Event('change', { bubbles: true }));
            
            // Fill custom input
            setTimeout(() => {
                const customInput = document.querySelector('input[wire\\:model="seoDataCache.tr.content_type_custom"]');
                if (customInput) {
                    customInput.value = value;
                    customInput.dispatchEvent(new Event('input', { bubbles: true }));
                }
            }, 100);
        }
    }
    
    // Auto-enable OG custom fields when OG values are set
    function enableOgCustomFields(language = 'tr') {
        console.log(`üîÑ Enabling OG custom fields for language: ${language}`);

        // Multiple selector fallbacks for checkbox
        const selectors = [
            `input[wire\\:model="seoDataCache.${language}.og_custom_enabled"]`,
            `input[wire\\:model\\.defer="seoDataCache.${language}.og_custom_enabled"]`,
            `input[id="og_custom_${language}"]`,
            `#og_custom_${language}`
        ];

        let checkbox = null;
        for (const selector of selectors) {
            checkbox = document.querySelector(selector);
            if (checkbox) {
                console.log(`‚úÖ OG checkbox found with selector: ${selector}`);
                break;
            }
        }

        if (!checkbox) {
            console.error(`‚ùå OG custom checkbox not found for language: ${language}. Tried selectors:`, selectors);
            return;
        }

        if (!checkbox.checked) {
            console.log(`‚úÖ Activating OG custom checkbox for ${language}...`);
            checkbox.checked = true;

            // Trigger both Livewire and native change events
            checkbox.dispatchEvent(new Event('change', { bubbles: true }));
            checkbox.dispatchEvent(new Event('input', { bubbles: true }));

            // Call the existing toggleOgCustomFields function if available
            if (typeof window.toggleOgCustomFields === 'function') {
                console.log(`‚úÖ Calling toggleOgCustomFields function for ${language}...`);
                window.toggleOgCustomFields(checkbox, language);
            }

            // Manual field showing as fallback
            setTimeout(() => {
                const customFields = document.getElementById(`og_custom_fields_${language}`);
                if (customFields) {
                    customFields.style.display = 'block';
                    customFields.style.maxHeight = 'none';
                    customFields.style.overflow = 'visible';
                    customFields.classList.remove('d-none');
                    console.log(`‚úÖ OG custom fields manually shown for ${language}`);
                }
            }, 100);

            console.log(`‚úÖ OG custom fields enabled successfully for ${language}`);
        } else {
            console.log(`‚ÑπÔ∏è OG custom fields already enabled for ${language}`);
        }
    }

    // Get current active language
    function getCurrentActiveLanguage() {
        // Try to get from AI recommendations button data-language
        const aiButton = document.querySelector('.ai-seo-recommendations-btn[data-language]');
        if (aiButton) {
            return aiButton.getAttribute('data-language');
        }

        // Try to get from active language button
        const activeLanguageBtn = document.querySelector('.language-switch-btn.text-primary, .language-switch-btn.active');
        if (activeLanguageBtn) {
            return activeLanguageBtn.getAttribute('data-language') ||
                   activeLanguageBtn.textContent.trim().toLowerCase();
        }

        // Try to get from visible content section
        const activeContent = document.querySelector('.seo-language-content[style*="display: block"]');
        if (activeContent) {
            return activeContent.getAttribute('data-language');
        }

        // Try to get from Livewire component data (tenant languages)
        if (window.livewire && window.Livewire.all().length > 0) {
            const component = window.Livewire.all().find(c => c.get('currentLanguage'));
            if (component) {
                return component.get('currentLanguage');
            }
        }

        // Try to get tenant default locale from meta tag or global config
        const metaDefaultLocale = document.querySelector('meta[name="tenant-default-locale"]');
        if (metaDefaultLocale) {
            return metaDefaultLocale.getAttribute('content');
        }

        // Try from global JS tenant config if available
        if (typeof window.tenantConfig !== 'undefined' && window.tenantConfig.default_locale) {
            return window.tenantConfig.default_locale;
        }

        // Try from page language detection
        const htmlLang = document.documentElement.lang;
        if (htmlLang && htmlLang.length >= 2) {
            return htmlLang.substring(0, 2);
        }

        // Final fallback - use tenant system default (typically 'tr')
        return getTenantSystemDefaultLanguage();
    }

    // Get tenant system default language (integrated with tenant system)
    function getTenantSystemDefaultLanguage() {
        // Check if tenant default is available in global scope
        if (typeof window.APP_TENANT_DEFAULT_LOCALE !== 'undefined') {
            return window.APP_TENANT_DEFAULT_LOCALE;
        }

        // Check available languages to find default
        const availableLanguages = getAvailableTenantLanguages();
        if (availableLanguages.length > 0) {
            // First language is usually the default in tenant system
            return availableLanguages[0];
        }

        // Ultimate fallback
        return 'tr';
    }

    // Get available tenant languages from DOM or component
    function getAvailableTenantLanguages() {
        // Try to get from Livewire component
        if (window.Livewire && window.Livewire.all().length > 0) {
            const component = window.Livewire.all().find(c => c.get('availableLanguages'));
            if (component) {
                return component.get('availableLanguages') || [];
            }
        }

        // Try to get from language switch buttons
        const langButtons = document.querySelectorAll('.language-switch-btn[data-language]');
        if (langButtons.length > 0) {
            return Array.from(langButtons).map(btn => btn.getAttribute('data-language'));
        }

        // Fallback to common tenant languages
        return ['tr', 'en', 'ar'];
    }

    // Extract language from field target (seoDataCache.tr.og_title -> tr)
    function extractLanguageFromFieldTarget(fieldTarget) {
        const match = fieldTarget.match(/seoDataCache\.([a-z]{2})\./);
        return match ? match[1] : getCurrentActiveLanguage();
    }
    
    // Get user-friendly field names
    function getFieldDisplayName(fieldTarget) {
        const displayNames = {
            'seo_title': 'Meta Ba≈ülƒ±k',
            'seo_description': 'Meta A√ßƒ±klama',
            'content_type': 'ƒ∞√ßerik T√ºr√º',
            'og_title': 'Sosyal Medya Ba≈ülƒ±ƒüƒ±',
            'og_description': 'Sosyal Medya A√ßƒ±klamasƒ±',
            'priority_score': 'SEO √ñnceliƒüi'
        };
        return displayNames[fieldTarget] || fieldTarget;
    };
    
    // APPLY ALL functionality
    window.applyAllRecommendations = function() {
        console.log('üî• Applying all #1 recommendations...');
        
        const recommendationItems = document.querySelectorAll('.recommendation-item');
        let appliedCount = 0;
        
        recommendationItems.forEach(item => {
            const firstAlternative = item.querySelector('.form-check:first-child .form-check-label[onclick]');
            if (firstAlternative) {
                const onclickAttr = firstAlternative.getAttribute('onclick');
                if (onclickAttr) {
                    // Extract parameters from onclick
                    const match = onclickAttr.match(/applyAlternativeDirectly\('([^']+)',\s*'([^']+)'/);
                    if (match) {
                        const fieldTarget = match[1];
                        const value = match[2].replace(/\\'/g, "'");
                        applyAlternativeDirectly(fieldTarget, value, firstAlternative);
                        appliedCount++;
                    }
                }
            }
        });
        
        showSuccess(appliedCount + ' √∂neri otomatik uygulandƒ±!');
    };
    
    // TOGGLE ALL CHECKBOXES functionality
    window.toggleAllCheckboxes = function() {
        console.log('üîÑ Toggling all checkboxes...');
        
        const checkboxes = document.querySelectorAll('.ai-recommendation-checkbox');
        if (checkboxes.length === 0) {
            showError('√ñneri bulunamadƒ±');
            return;
        }
        
        // Check if all are currently selected
        const allChecked = Array.from(checkboxes).every(cb => cb.checked);
        
        // Toggle all checkboxes
        checkboxes.forEach(cb => {
            cb.checked = !allChecked;
        });
        
        // Update apply button
        updateApplyButton();
        
        // Update button text
        const toggleButton = document.querySelector('button[onclick="toggleAllCheckboxes()"]');
        if (toggleButton) {
            toggleButton.innerHTML = allChecked ? 
                '<i class="fas fa-check-square me-1"></i>T√ºm√ºn√º Se√ß' : 
                '<i class="fas fa-square me-1"></i>Se√ßimi Kaldƒ±r';
        }
        
        const action = allChecked ? 'kaldƒ±rƒ±ldƒ±' : 'se√ßildi';
        showSuccess(`${checkboxes.length} √∂neri ${action}`);
    };
    
    // Auto-load AI recommendations if they exist
    async function autoLoadRecommendations() {
        console.log('üîç Checking for existing AI recommendations...');

        // Skip if we don't have a page ID
        if (!window.currentModelId) {
            console.log('‚ÑπÔ∏è No page ID found, skipping auto-load');
            return;
        }

        try {
            const formData = {
                feature_slug: 'seo-smart-recommendations',
                form_content: {},
                language: 'tr',
                page_id: window.currentModelId
            };

            const response = await fetch('/admin/seo/ai/recommendations', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRF-TOKEN': csrfToken
                },
                body: JSON.stringify(formData)
            });

            if (response.ok) {
                const result = await response.json();

                // Only display if recommendations exist and came from cache (previously saved)
                if (result.success && result.data && result.data.from_cache && result.data.recommendations && result.data.recommendations.length > 0) {
                    console.log('‚úÖ Found existing recommendations, displaying automatically...');

                    // Show the recommendations section
                    const section = document.getElementById('aiSeoRecommendationsSection_tr');
                    if (section) {
                        section.style.display = 'block';
                        displayRecommendations(result.data, 'tr');
                        console.log('‚úÖ AI recommendations auto-loaded successfully');
                    }
                } else {
                    console.log('‚ÑπÔ∏è No existing recommendations found or not from cache');
                }
            }
        } catch (error) {
            console.log('‚ÑπÔ∏è Auto-load check failed (normal for new pages):', error.message);
        }
    }

    // Initialize the system
    function init() {
        console.log('üöÄ AI SEO Integration system ba≈ülatƒ±lƒ±yor...');
        console.log('üîç DOM ready state:', document.readyState);

        // Immediate attachment
        attachButtonListeners();

        // DOM ready fallback
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', attachButtonListeners);
        }

        // Delayed fallback for dynamic content
        setTimeout(attachButtonListeners, 500);

        // Window load fallback
        window.addEventListener('load', attachButtonListeners);

        // ===== A1 PATTERN: AUTO-APPLY EVENT LISTENER =====
        // AI Recommendations tamamlandƒ±ƒüƒ±nda otomatik uygula
        document.addEventListener('livewire:initialized', () => {
            Livewire.on('aiRecommendationsCompleted', (event) => {
                console.log('üéØ aiRecommendationsCompleted event alƒ±ndƒ±, otomatik uygulama ba≈ülatƒ±lƒ±yor');
                console.log('üîç Event data:', event);

                // Event data'yƒ± farklƒ± yollarla extract etmeye √ßalƒ±≈ü
                let recommendationsData = null;

                // Method 1: Direct access
                if (event.recommendationsData) {
                    recommendationsData = event.recommendationsData;
                    console.log('‚úÖ Found via event.recommendationsData');
                }
                // Method 2: Array access
                else if (Array.isArray(event) && event[0]?.recommendationsData) {
                    recommendationsData = event[0].recommendationsData;
                    console.log('‚úÖ Found via event[0].recommendationsData');
                }
                // Method 3: Direct array access
                else if (Array.isArray(event) && event[0]) {
                    recommendationsData = event[0];
                    console.log('‚úÖ Using event[0] directly');
                }
                // Method 4: Direct event
                else if (event && typeof event === 'object') {
                    recommendationsData = event;
                    console.log('‚úÖ Using event directly');
                }

                console.log('üîç Final recommendationsData:', recommendationsData);

                if (recommendationsData && (recommendationsData.data || recommendationsData.recommendations)) {
                    // Extract the actual data
                    const actualData = recommendationsData.data || recommendationsData;
                    console.log('üîç Actual data to use:', actualData);

                    // Kƒ±sa delay ile otomatik uygula (UI render'ƒ±nƒ±n bitmesini bekle)
                    setTimeout(() => {
                        window.autoApplyFirstAlternatives(actualData);
                    }, 500);
                } else {
                    console.warn('‚ùå aiRecommendationsCompleted event\'inde recommendationsData bulunamadƒ±');
                }
            });

            // Language changed events i√ßin re-attach
            Livewire.on('refreshTabs', () => {
                console.log('üîÑ refreshTabs event - re-attaching button listeners');
                setTimeout(attachButtonListeners, 100);
            });

            Livewire.on('tabsRefreshed', () => {
                console.log('üîÑ tabsRefreshed event - re-attaching button listeners');
                setTimeout(attachButtonListeners, 100);
            });
        });

        // Auto-loading is now handled by PHP/Blade template
        // setTimeout(() => {
        //     autoLoadRecommendations();
        // }, 1000);

        // ===== AUTO-APPLY EVENT LISTENER =====
        // AI Recommendations tamamlandƒ±ƒüƒ±nda otomatik uygula
        document.addEventListener('livewire:initialized', () => {
            Livewire.on('aiRecommendationsCompleted', (event) => {
                console.log('üéØ aiRecommendationsCompleted event alƒ±ndƒ±, otomatik uygulama ba≈ülatƒ±lƒ±yor');
                console.log('üîç Event data:', event);

                // Event data'yƒ± farklƒ± yollarla extract etmeye √ßalƒ±≈ü
                let recommendationsData = null;

                // Method 1: Direct access
                if (event.recommendationsData) {
                    recommendationsData = event.recommendationsData;
                    console.log('‚úÖ Found via event.recommendationsData');
                }
                // Method 2: Array access
                else if (Array.isArray(event) && event[0]?.recommendationsData) {
                    recommendationsData = event[0].recommendationsData;
                    console.log('‚úÖ Found via event[0].recommendationsData');
                }
                // Method 3: Direct array access
                else if (Array.isArray(event) && event[0]) {
                    recommendationsData = event[0];
                    console.log('‚úÖ Using event[0] directly');
                }
                // Method 4: Direct event
                else if (event && typeof event === 'object') {
                    recommendationsData = event;
                    console.log('‚úÖ Using event directly');
                }

                console.log('üîç Final recommendationsData:', recommendationsData);

                if (recommendationsData && (recommendationsData.data || recommendationsData.recommendations)) {
                    // Extract the actual data
                    const actualData = recommendationsData.data || recommendationsData;
                    console.log('üîç Actual data to use:', actualData);

                    // Kƒ±sa delay ile otomatik uygula (UI render'ƒ±nƒ±n bitmesini bekle)
                    setTimeout(() => {
                        window.autoApplyFirstAlternatives(actualData);
                    }, 500);
                } else {
                    console.warn('‚ùå aiRecommendationsCompleted event\'inde recommendationsData bulunamadƒ±');
                    console.warn('‚ùå Event structure:', Object.keys(event || {}));
                }
            });
        });

        console.log('‚úÖ AI SEO Integration system hazƒ±r!');

        // üî• DEBUG: Overlay sistem test fonksiyonu ekle
        window.testAIOverlay = function(type = 'ai-recommendations') {
            console.log(`üß™ TEST: AI Overlay sistemi test ediliyor - Type: ${type}`);
            showInlineLoadingOverlay(type);

            // 3 saniye sonra overlay'i kapat
            setTimeout(() => {
                hideInlineLoading('seoUniversalResults');
                console.log('‚úÖ TEST: Overlay kapatƒ±ldƒ±');
            }, 3000);
        };
        console.log('üß™ DEBUG: window.testAIOverlay() fonksiyonu hazƒ±r!');

        // DEBUG: Test Button Click Functionality
        window.testButtonClicks = function() {
            console.log('üß™ TEST: AI Button Click Functionality');
            const buttons = document.querySelectorAll('.ai-seo-comprehensive-btn, .ai-seo-recommendations-btn');
            console.log('üîç Found buttons:', buttons.length);

            buttons.forEach((btn, index) => {
                console.log(`üîç Button ${index + 1}:`, {
                    classes: btn.className,
                    text: btn.textContent.trim(),
                    hasClickEvent: btn.onclick !== null,
                    dataAttributes: {
                        language: btn.getAttribute('data-language'),
                        seoFeature: btn.getAttribute('data-seo-feature')
                    }
                });
            });

            return { buttonCount: buttons.length, buttons: Array.from(buttons) };
        };

        // DEBUG: Force re-attach button listeners
        window.forceReattachButtons = function() {
            console.log('üîÑ FORCE: Re-attaching button listeners');
            attachButtonListeners();
        };

        console.log('üß™ DEBUG: window.testButtonClicks() ve window.forceReattachButtons() fonksiyonlarƒ± hazƒ±r!');
    }

    // AI MODAL-STYLE INLINE OVERLAY SYSTEM
    function showInlineLoadingOverlay(cleanupTarget) {
        console.log(`üéØ showInlineLoadingOverlay √ßaƒüƒ±rƒ±ldƒ± - Target: ${cleanupTarget}`);

        // Container'ƒ± bul - artƒ±k her zaman orada olmalƒ±
        const container = document.getElementById('seoUniversalResults');
        if (!container) {
            console.error('‚ùå seoUniversalResults container bulunamadƒ±! Blade template\'te olmalƒ±.');
            return;
        }

        // √ñnce eski i√ßerikleri temizle
        cleanupExistingSeoAreas(cleanupTarget);

        // AI Modal tarzƒ±nda overlay olu≈ütur
        const overlay = document.createElement('div');
        overlay.className = 'inline-overlay-wrapper';
        overlay.innerHTML = `
            <div class="card mt-3" style="border: 1px solid #e6e7e9; box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);">
                <div class="card-body text-center py-5">
                    <div class="overlay-content">
                        <div class="mb-4 text-center">
                            <h4 class="fw-normal mb-2">ü§ñ ${getOverlayTitle(cleanupTarget)}</h4>
                            <p class="text-muted mb-0">${getOverlaySubtitle(cleanupTarget)}</p>
                        </div>
                        <div class="progress mb-2" style="height: 6px;">
                            <div class="progress-bar progress-bar-indeterminate bg-primary progress-bar-animated"></div>
                        </div>
                        <div class="text-center text-muted small">
                            <i class="fas fa-cog fa-spin me-2"></i>ƒ∞≈üleniyor...
                        </div>
                    </div>
                </div>
            </div>
        `;

        container.appendChild(overlay);
        console.log('‚úÖ AI Modal-style inline overlay g√∂sterildi');
    }

    function showInlineLoadingOverlayRecommendations() {
        console.log(`üéØ showInlineLoadingOverlayRecommendations √ßaƒüƒ±rƒ±ldƒ±`);

        // Container'ƒ± bul - artƒ±k her zaman orada olmalƒ±
        const container = document.getElementById('aiRecommendationsContainer');
        if (!container) {
            console.error('‚ùå aiRecommendationsContainer bulunamadƒ±! Blade template\'te olmalƒ±.');
            return;
        }

        // √ñnce eski i√ßerikleri temizle
        cleanupExistingSeoAreas('ai-recommendations');

        // AI Modal tarzƒ±nda overlay olu≈ütur
        const overlay = document.createElement('div');
        overlay.className = 'inline-overlay-wrapper';
        overlay.innerHTML = `
            <div class="card mt-3" style="border: 1px solid #e6e7e9; box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);">
                <div class="card-body text-center py-5">
                    <div class="overlay-content">
                        <div class="mb-4 text-center">
                            <h4 class="fw-normal mb-2">ü§ñ AI SEO √ñnerileri</h4>
                            <p class="text-muted mb-0">Ki≈üiselle≈ütirilmi≈ü SEO √∂nerileri yapay zeka tarafƒ±ndan olu≈üturuluyor</p>
                        </div>
                        <div class="progress mb-2" style="height: 6px;">
                            <div class="progress-bar progress-bar-indeterminate bg-primary progress-bar-animated"></div>
                        </div>
                        <div class="text-center text-muted small">
                            <i class="fas fa-cog fa-spin me-2"></i>ƒ∞≈üleniyor...
                        </div>
                    </div>
                </div>
            </div>
        `;

        container.appendChild(overlay);
        console.log('‚úÖ AI Recommendations Modal-style inline overlay g√∂sterildi');
    }

    function hideInlineLoading(containerId) {
        const container = document.getElementById(containerId);
        if (container) {
            // Sadece overlay wrapper'ƒ± kaldƒ±r, container'ƒ± bƒ±rak
            const overlay = container.querySelector('.inline-overlay-wrapper');
            if (overlay) {
                overlay.remove();
                console.log('‚úÖ Inline loading overlay kaldƒ±rƒ±ldƒ±');
            }
        }
    }

    // ===== AUTO-APPLY FIRST ALTERNATIVES FUNCTION =====
    window.autoApplyFirstAlternatives = function(recommendations) {
        console.log('üéØ Auto-applying first alternatives for each recommendation type');

        if (!recommendations || !recommendations.recommendations || !Array.isArray(recommendations.recommendations)) {
            console.warn('‚ùå No valid recommendations data for auto-apply');
            return;
        }

        let appliedCount = 0;
        recommendations.recommendations.forEach((recommendation) => {
            // Her recommendation i√ßin ilk alternatifi al
            if (recommendation.alternatives && Array.isArray(recommendation.alternatives) && recommendation.alternatives.length > 0) {
                const firstAlternative = recommendation.alternatives[0];
                const fieldTarget = recommendation.field_target;

                if (fieldTarget && firstAlternative && firstAlternative.value) {
                    console.log(`üìù Auto-applying: ${fieldTarget} = "${firstAlternative.value}"`);

                    // applyAlternativeDirectly fonksiyonunu kullan
                    if (window.applyAlternativeDirectly) {
                        window.applyAlternativeDirectly(fieldTarget, firstAlternative.value);
                        appliedCount++;

                        // OG alanlarƒ±na veri yazƒ±ldƒ±ƒüƒ±nda toggle'ƒ± otomatik a√ß
                        if (fieldTarget && (fieldTarget.includes('og_') || fieldTarget.includes('social'))) {
                            const language = extractLanguageFromFieldTarget(fieldTarget);
                            console.log(`üéØ OG field detected (${fieldTarget}), enabling custom fields for ${language}`);
                            enableOgCustomFields(language);
                        }
                    } else {
                        console.error('‚ùå window.applyAlternativeDirectly function not found');
                    }
                }
            }
        });

        if (appliedCount > 0) {
            showSuccess(`‚ú® ${appliedCount} AI √∂nerisi otomatik olarak uygulandƒ±! Dilediƒüiniz alternatife tƒ±klayarak deƒüi≈ütirebilirsiniz.`);
        }
    }

    // üéØ TEMPLATE-BASED AUTO-APPLY: DOM'dan 1. sƒ±ra √∂nerilerini al ve uygula
    window.applyFirstAlternativesFromTemplate = function() {
        console.log('üîç Template-based auto-apply ba≈ülƒ±yor...');

        // Template'deki .active olan list-group-item'leri bul
        const activeItems = document.querySelectorAll('.list-group-item.active[onclick]');
        console.log('üîç Bulunan aktif √∂neri sayƒ±sƒ±: ' + activeItems.length);

        let appliedCount = 0;

        activeItems.forEach((item, index) => {
            const onclickAttr = item.getAttribute('onclick');
            console.log('üìù Item ' + (index + 1) + ' onclick:', onclickAttr);

            // onclick'ten field ve value'yu parse et
            // Format: applyAlternativeDirectly('seoDataCache.tr.seo_title', 'Hikayemizi ve Bizi Tanƒ±yƒ±n', this);
            const match = onclickAttr.match(/applyAlternativeDirectly\('([^']+)',\s*'([^']+)'/);

            if (match) {
                const fieldTarget = match[1];
                const value = match[2];

                console.log('‚úÖ Parse ba≈üarƒ±lƒ±: ' + fieldTarget + ' = "' + value + '"');

                // applyAlternativeDirectly fonksiyonunu √ßaƒüƒ±r
                if (window.applyAlternativeDirectly) {
                    window.applyAlternativeDirectly(fieldTarget, value);
                    appliedCount++;
                    console.log('üìù Uygulandƒ±: ' + fieldTarget);

                    // OG alanlarƒ± dolduysa checkbox'ƒ± otomatik i≈üaretle
                    if (fieldTarget.includes('.og_title') || fieldTarget.includes('.og_description')) {
                        const lang = fieldTarget.split('.')[1]; // seoDataCache.tr.og_title -> tr

                        // Biraz bekle ve checkbox'ƒ± kontrol et (DOM g√ºncellenmesi i√ßin)
                        setTimeout(() => {
                            // √ñnce switch'in varlƒ±ƒüƒ±nƒ± kontrol et ve yoksa olu≈ütur
                            if (window.checkAndEnableSocialMedia) {
                                window.checkAndEnableSocialMedia(lang);
                            } else {
                                // Fallback
                                const checkbox = document.getElementById(`og_custom_${lang}`);
                                const fieldsContainer = document.getElementById(`og_custom_fields_${lang}`);
                                if (checkbox && !checkbox.checked) {
                                    checkbox.checked = true;
                                    checkbox.dispatchEvent(new Event('change'));
                                    if (fieldsContainer) {
                                        fieldsContainer.style.display = 'block';
                                    }
                                    console.log('‚úÖ Social media checkbox otomatik i≈üaretlendi (fallback):', lang);
                                }
                            }
                        }, 500); // Timeout'u artƒ±rdƒ±k DOM'un tamamen g√ºncellenmesi i√ßin
                    }
                } else {
                    console.error('‚ùå window.applyAlternativeDirectly function not found');
                }
            } else {
                console.error('‚ùå onclick parse edilemedi:', onclickAttr);
            }
        });

        if (appliedCount > 0) {
            console.log('‚úÖ Template-based auto-apply tamamlandƒ±: ' + appliedCount + ' √∂neri uygulandƒ±');
            showSuccess(`‚ú® ${appliedCount} AI √∂nerisi otomatik olarak uygulandƒ±! Dilediƒüiniz alternatife tƒ±klayarak deƒüi≈ütirebilirsiniz.`);
        } else {
            console.warn('‚ö†Ô∏è Hi√ßbir √∂neri uygulanamadƒ±');
        }
    };

    // Start the system
    init();

})();
