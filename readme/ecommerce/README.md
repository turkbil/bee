# üõí E-COMMERCE MODULE - PHASE 1

## üìã GENEL BAKI≈û

Bu d√∂k√ºman E-Commerce mod√ºl√ºn√ºn **Phase 1** (Faz 1) yapƒ±sƒ±nƒ± detaylƒ± olarak a√ßƒ±klar.

**Phase 1 Hedefi:**
- ‚úÖ √úr√ºn Kataloƒüu (Kategori, Marka, √úr√ºn, Varyant, √ñzellikler)
- ‚úÖ √úyelik Satƒ±≈üƒ± (Subscription-based monetization)
- ‚úÖ Kupon ve Promosyon Sistemi
- ‚úÖ Sipari≈ü Y√∂netimi (Order, Payment, Cart)
- ‚úÖ Stok Y√∂netimi (Warehouse, Inventory, Stock Movements)
- ‚úÖ Universal Sistemler (Favorites, Search Logs)

---

## üóÑÔ∏è VERƒ∞TABANI Mƒ∞MARƒ∞Sƒ∞

### Toplam Tablo Sayƒ±sƒ±: 28

#### üåê Universal Tables (2)
T√ºm mod√ºller i√ßin ortak tablolar (Shop, Blog, Portfolio, etc.)

| # | Tablo | A√ßƒ±klama | Trait |
|---|-------|----------|-------|
| 1 | `favorites` | Polymorphic favoriler (√ºr√ºn, blog, portfolyo) | `HasFavorites`, `Favoritable` |
| 2 | `search_logs` | T√ºm mod√ºller i√ßin arama analitikleri | `Searchable` |

#### üõçÔ∏è Shop Module Tables (26)

##### **KATALOG (6 tablo)**
| # | Tablo | A√ßƒ±klama | ƒ∞li≈ükiler |
|---|-------|----------|-----------|
| 1 | `shop_categories` | Kategoriler (nested, unlimited depth) | parent, children, products |
| 2 | `shop_brands` | Markalar | products |
| 3 | `shop_products` | √úr√ºnler (catalog products) | category, brand, variants, reviews, carts, favorites |
| 4 | `shop_product_variants` | √úr√ºn varyantlarƒ± (renk, beden vs.) | product, attribute_values, cart_items, order_items |
| 5 | `shop_attributes` | √ñzellikler (Renk, Beden, Materyal) | values |
| 6 | `shop_attribute_values` | √ñzellik deƒüerleri (Kƒ±rmƒ±zƒ±, XL, Pamuk) | attribute, product_variants |

##### **√úYELƒ∞K (2 tablo)**
| # | Tablo | A√ßƒ±klama | Model |
|---|-------|----------|-------|
| 7 | `shop_subscription_plans` | √úyelik paketleri (Bronze, Premium) | SubscriptionPlan |
| 8 | `shop_subscriptions` | Aktif √ºyelikler (user ‚Üí plan) | Subscription |

##### **Sƒ∞PARƒ∞≈û (5 tablo)**
| # | Tablo | A√ßƒ±klama | ƒ∞li≈ükiler |
|---|-------|----------|-----------|
| 9 | `shop_orders` | Sipari≈üler | user, items, addresses, payments |
| 10 | `shop_order_items` | Sipari≈ü kalemleri | order, product_variant |
| 11 | `shop_order_addresses` | Sipari≈ü adresleri (billing, shipping) | order |
| 12 | `shop_payment_methods` | √ñdeme y√∂ntemleri (Kredi Kartƒ±, PayPal) | payments |
| 13 | `shop_payments` | √ñdeme kayƒ±tlarƒ± | order, payment_method |

##### **STOK (3 tablo)**
| # | Tablo | A√ßƒ±klama | ƒ∞li≈ükiler |
|---|-------|----------|-----------|
| 14 | `shop_warehouses` | Depolar | inventories |
| 15 | `shop_inventory` | Stok miktarlarƒ± | warehouse, product_variant |
| 16 | `shop_stock_movements` | Stok hareketleri (giri≈ü/√ßƒ±kƒ±≈ü) | warehouse, product_variant |

##### **SEPET (2 tablo)**
| # | Tablo | A√ßƒ±klama | ƒ∞li≈ükiler |
|---|-------|----------|-----------|
| 17 | `shop_carts` | Sepetler | user, items |
| 18 | `shop_cart_items` | Sepet kalemleri | cart, product_variant |

##### **VERGƒ∞ (2 tablo)**
| # | Tablo | A√ßƒ±klama | ƒ∞li≈ükiler |
|---|-------|----------|-----------|
| 19 | `shop_taxes` | Vergi tanƒ±mlarƒ± (KDV, √ñTV) | rates |
| 20 | `shop_tax_rates` | Vergi oranlarƒ± (country/region based) | tax |

##### **PROMOSYON (3 tablo)**
| # | Tablo | A√ßƒ±klama | ƒ∞li≈ükiler |
|---|-------|----------|-----------|
| 21 | `shop_coupons` | Kupon kodlarƒ± (SUMMER2025) | usages |
| 22 | `shop_coupon_usages` | Kupon kullanƒ±m kayƒ±tlarƒ± | coupon, user, order |
| 23 | `shop_campaigns` | Kampanyalar (Yƒ±lba≈üƒ± ƒ∞ndirimi) | products (JSON) |

##### **Dƒ∞ƒûER (3 tablo)**
| # | Tablo | A√ßƒ±klama | ƒ∞li≈ükiler |
|---|-------|----------|-----------|
| 24 | `shop_reviews` | √úr√ºn deƒüerlendirmeleri | product, user |
| 25 | `shop_customer_addresses` | M√º≈üteri adresleri (saved addresses) | user |
| 26 | `shop_settings` | Mod√ºl ayarlarƒ± (JSON key-value) | - |

---

## üéØ √ñZELLƒ∞KLER

### ‚ú® Phase 1'de Gelen √ñzellikler

#### üì¶ Katalog Y√∂netimi
- ‚úÖ Sƒ±nƒ±rsƒ±z derinlikte kategori aƒüacƒ±
- ‚úÖ Marka y√∂netimi
- ‚úÖ √úr√ºn varyantlarƒ± (renk, beden, vs.)
- ‚úÖ Dinamik √∂zellikler sistemi (attributes)
- ‚úÖ √áoklu dil desteƒüi (JSON fields: `title`, `slug`, `description`)

#### üí≥ √úyelik Sistemi (Subscription-based)
- ‚úÖ Paket bazlƒ± √ºyelik (Bronze, Premium)
- ‚úÖ Aylƒ±k/yƒ±llƒ±k √∂deme se√ßenekleri
- ‚úÖ Otomatik yenileme (cron jobs)
- ‚úÖ ƒ∞√ßerik kilitleme (middleware)
- ‚úÖ E-posta bildirimleri (activated, renewed, expiring)

#### üõí Sepet & Sipari≈ü
- ‚úÖ Misafir ve √ºye sepeti
- ‚úÖ √áoklu √∂deme y√∂ntemi
- ‚úÖ Sipari≈ü durumu takibi
- ‚úÖ Fatura/kargo adresleri
- ‚úÖ √ñdeme entegrasyonu (hazƒ±r)

#### üìä Stok Y√∂netimi
- ‚úÖ √áoklu depo desteƒüi
- ‚úÖ Stok hareketleri (giri≈ü/√ßƒ±kƒ±≈ü/transfer)
- ‚úÖ D√º≈ü√ºk stok uyarƒ±larƒ±
- ‚úÖ Varyant bazlƒ± stok takibi

#### üéÅ Promosyon & Kupon
- ‚úÖ Kupon kodlarƒ± (miktar/y√ºzde indirim)
- ‚úÖ Minimum sepet tutarƒ±
- ‚úÖ Kullanƒ±m limitleri (toplam/kullanƒ±cƒ± ba≈üƒ±)
- ‚úÖ Kampanya y√∂netimi
- ‚úÖ √úr√ºn bazlƒ± indirimler

#### üåê Universal Sistemler
- ‚úÖ **Favorites**: √úr√ºn, blog, portfolyo favorileme (polymorphic)
- ‚úÖ **Search Logs**: T√ºm mod√ºller i√ßin arama analitikleri
- ‚úÖ **SEO Management**: Universal SEO mod√ºl√º entegrasyonu
- ‚úÖ **Tags**: Evrensel etiket sistemi

#### ‚≠ê Deƒüerlendirme & Yorum
- ‚úÖ 5 yƒ±ldƒ±z puanlama
- ‚úÖ Yorum onay sistemi
- ‚úÖ Admin yanƒ±tlama

---

## üìÅ DOSYA YAPISI

```
readme/ecommerce/
‚îú‚îÄ‚îÄ migrations/
‚îÇ   ‚îú‚îÄ‚îÄ universal/                    # 2 dosya
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 2025_01_10_000001_create_favorites_table.php
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 2025_01_10_000002_create_search_logs_table.php
‚îÇ   ‚îî‚îÄ‚îÄ phase-1/                      # 26 dosya
‚îÇ       ‚îú‚îÄ‚îÄ 001_create_shop_categories_table.php
‚îÇ       ‚îú‚îÄ‚îÄ 002_create_shop_brands_table.php
‚îÇ       ‚îú‚îÄ‚îÄ 003_create_shop_products_table.php
‚îÇ       ‚îú‚îÄ‚îÄ ... (23 more files)
‚îÇ       ‚îî‚îÄ‚îÄ 026_create_shop_settings_table.php
‚îÇ
‚îú‚îÄ‚îÄ archive/
‚îÇ   ‚îú‚îÄ‚îÄ migrations-backup-20251009/   # Orijinal 66 migration
‚îÇ   ‚îî‚îÄ‚îÄ docs-backup-20251009/         # Eski d√∂k√ºmanlar
‚îÇ
‚îú‚îÄ‚îÄ TODO.md                           # Detaylƒ± g√∂rev listesi
‚îú‚îÄ‚îÄ README.md                         # Bu dosya
‚îî‚îÄ‚îÄ [diƒüer d√∂k√ºmanlar]
```

---

## üöÄ KURULUM

### 1Ô∏è‚É£ Migration Deployment

```bash
# Universal migration'larƒ± ta≈üƒ±
cp migrations/universal/* ../../database/migrations/

# Shop migration'larƒ±nƒ± ta≈üƒ±
mkdir -p ../../Modules/Shop/Database/Migrations
cp migrations/phase-1/* ../../Modules/Shop/Database/Migrations/

# Migration'larƒ± √ßalƒ±≈ütƒ±r
php artisan migrate

# Doƒürulama
php artisan migrate:status
```

### 2Ô∏è‚É£ Model & Repository Olu≈üturma

```bash
# Model olu≈üturma (√∂rnek)
php artisan make:model Shop/Product -m

# Repository olu≈üturma (manual - Page pattern'i kopyala)
# Modules/Page/app/Repositories/PageRepository.php
```

### 3Ô∏è‚É£ Trait Implementation

**Universal Traits:**
- `app/Traits/HasFavorites.php` ‚Üí User model
- `app/Traits/Favoritable.php` ‚Üí Product, Post, Portfolio models
- `app/Traits/Searchable.php` ‚Üí All searchable models

**Shop Traits:**
- `Modules/Shop/app/Traits/HasViewCounter.php`
- `Modules/Shop/app/Traits/Reviewable.php`

---

## üí° KULLANIM √ñRNEKLERƒ∞

### Kategori Aƒüacƒ±

```php
// K√∂k kategorileri al
$rootCategories = Category::whereNull('parent_id')
    ->where('is_active', true)
    ->orderBy('sort_order')
    ->get();

// Alt kategorileri al (eager loading)
$categories = Category::with('children')->get();
```

### √úr√ºn Varyantlarƒ±

```php
// √úr√ºn ve varyantlarƒ±
$product = Product::with('variants.attributeValues')->find($id);

// Varyant stok kontrol√º
$variant = ProductVariant::find($variantId);
if ($variant->hasStock(5)) {
    // Sepete ekle
}
```

### Favoriler (Universal)

```php
// User model
use HasFavorites;

// Favorilere ekle
$user->addFavorite($product);
$user->addFavorite($blogPost);
$user->addFavorite($portfolioItem);

// Favori mi?
if ($user->hasFavorited($product)) {
    // Kalp ikonu dolu g√∂ster
}

// T√ºm favorileri al
$favorites = $user->favorites; // Polymorphic collection
```

### Arama Logu (Universal)

```php
use App\Models\SearchLog;

// Arama kaydƒ± olu≈ütur
SearchLog::create([
    'query' => 'laptop',
    'module' => 'shop',
    'filters' => ['category' => 'electronics', 'price_range' => [1000, 5000]],
    'results_count' => 42,
    'user_id' => auth()->id(),
    'session_id' => session()->getId(),
    'ip_address' => request()->ip(),
]);

// Tƒ±klama kaydƒ±
$searchLog->update([
    'clicked_result_type' => 'Product',
    'clicked_result_id' => $product->id,
    'clicked_position' => 3,
]);
```

### √úyelik Kontrol√º

```php
// User model
if ($user->hasActiveSubscription()) {
    // Premium i√ßerik g√∂ster
}

// Middleware
Route::middleware(['subscription:premium'])->group(function () {
    // Premium rotalar
});
```

### Kupon Kullanƒ±mƒ±

```php
$coupon = Coupon::where('code', 'SUMMER2025')
    ->where('is_active', true)
    ->first();

if ($coupon->isValid() && $coupon->canUseBy($user)) {
    $discount = $coupon->calculateDiscount($cartTotal);
}
```

---

## üèóÔ∏è Mƒ∞MARƒ∞ KARARLAR

### Portfolio Pattern Kullanƒ±mƒ±

Phase 1 migration'larƒ± **Portfolio mod√ºl√º pattern'i** baz alƒ±narak olu≈üturuldu:

**Standartlar:**
- ‚úÖ Meaningful primary keys: `id('category_id')` not `id()`
- ‚úÖ JSON multilingual fields: `title`, `slug`, `description`
- ‚úÖ Foreign keys reference meaningful IDs: `->references('category_id')`
- ‚úÖ JSON slug indexes for performance (MySQL 8.0+)
- ‚úÖ Timestamp indexes: `$table->index('created_at')`
- ‚úÖ Schema existence checks: `if (Schema::hasTable('...'))`

### Universal vs Module-Specific

**Universal Sistemler (T√ºm mod√ºller i√ßin ortak):**
- Favorites (polymorphic)
- Search Logs
- SEO Management (SeoManagement module)
- Tags (polymorphic)
- Activity Logs

**Module-Specific Sistemler (Sadece Shop i√ßin):**
- Categories (shop_categories)
- Products (shop_products)
- Orders (shop_orders)
- Subscriptions (shop_subscriptions)
- Reviews (shop_reviews - product-specific)

### Neden 28 Tablo?

Orijinal planda 66 tablo vardƒ±, Phase 1'de **28 tablo'ya indirgendi**:

**Kaldƒ±rƒ±lanlar (38 tablo):**
- 10 tablo ‚Üí Universal sistemlere ta≈üƒ±ndƒ± (favorites, search_logs, tags, seo)
- 6 tablo ‚Üí JSON field'lara ta≈üƒ±ndƒ± (translations, metas)
- 10 tablo ‚Üí Phase 2'ye ertelendi (analytics, affiliates, etc.)
- 12 tablo ‚Üí Gereksiz/duplicate (product_images, product_views, etc.)

**Kalanlar (28 tablo):**
- 26 Shop tablosu (core functionality)
- 2 Universal tablo (favorites, search_logs)

---

## üìä SONRAKI FAZLAR

### Phase 2 (Planlama A≈üamasƒ±nda)
- Multi-vendor (√ßoklu satƒ±cƒ±)
- Affiliate sistemi
- Advanced analytics
- Product comparison
- Wishlist sharing
- Gift cards

### Phase 3 (ƒ∞leri D√ºzey)
- B2B features
- Multi-currency
- Multi-warehouse advanced
- Subscription management dashboard
- Advanced reporting

---

## üîó ƒ∞LGƒ∞Lƒ∞ D√ñK√úMANTASYON

- **TODO.md** - Detaylƒ± g√∂rev listesi ve ilerleme takibi
- **STANDARDIZATION-PATTERN.md** - Migration standardizasyon kurallarƒ±
- **PHASE-1-ABSOLUTE-FINAL.md** - Phase 1 tablo detaylarƒ±
- **UNIVERSAL-SYSTEMS-REVIEW.md** - Universal sistem kararlarƒ±
- **TABLE-ANALYSIS.md** - 66 tablodan 28'e indirgeme analizi

---

## üìù NOTLAR

### √ñnemli Hatƒ±rlatmalar

1. **SEO Y√∂netimi**: Tablo bazlƒ± deƒüil, `SeoManagement` mod√ºl√º √ºzerinden
2. **Media Y√∂netimi**: `media` tablosu ile (Spatie Media Library)
3. **Multilingual**: JSON fields kullanƒ±lƒ±yor (`title`, `slug`, `description`)
4. **Primary Keys**: Anlamlƒ± isimler (`category_id`, `product_id`)
5. **Foreign Keys**: Anlamlƒ± primary key'lere referans veriyor

### JSON Field Syntax

```php
// Migration
$table->json('title')->comment('Ba≈ülƒ±k: {"tr": "Elektronik", "en": "Electronics", "vs.": "..."}');
$table->json('slug')->comment('Slug: {"tr": "elektronik", "en": "electronics", "vs.": "..."}');

// Model cast
protected $casts = [
    'title' => 'array',
    'slug' => 'array',
];

// Accessor
public function getTitleAttribute($value)
{
    $titles = json_decode($value, true);
    return $titles[app()->getLocale()] ?? $titles['tr'] ?? '';
}
```

### JSON Slug Indexing (MySQL 8.0+ / MariaDB 10.5+)

```php
// Migration'da index ekleme
DB::statement("ALTER TABLE shop_categories ADD INDEX idx_slug_tr ((CAST(slug->'$.tr' AS CHAR(255)) COLLATE utf8mb4_bin))");
```

---

## ‚úÖ DURUM

**Migration A≈üamasƒ±**: ‚úÖ %100 Tamamlandƒ± (28/28)
**Model A≈üamasƒ±**: ‚è≥ Bekliyor (0/28)
**Repository A≈üamasƒ±**: ‚è≥ Bekliyor (0/20)
**Controller A≈üamasƒ±**: ‚è≥ Bekliyor (0/15)

**Sonraki Adƒ±m**: Model olu≈üturma (TODO.md'de detaylƒ± liste)

---

**Hazƒ±rlayan**: Claude AI
**Tarih**: 2025-01-10
**Versiyon**: Phase 1 - v1.0
