<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Muzibu Premium v4 - Backend GÃ¼venlikli</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
            color: #e2e8f0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            line-height: 1.7;
            padding: 40px 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            margin-bottom: 50px;
            padding-bottom: 30px;
            border-bottom: 2px solid #334155;
            text-align: center;
        }

        h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .version-badge {
            display: inline-block;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            padding: 10px 25px;
            border-radius: 20px;
            font-size: 1rem;
            font-weight: 700;
            margin-top: 10px;
        }

        .security-badge {
            display: inline-block;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 6px 15px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-left: 10px;
        }

        .meta {
            color: #94a3b8;
            font-size: 1rem;
            margin-top: 20px;
        }

        .tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 40px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .tab-btn {
            background: rgba(239, 68, 68, 0.1);
            border: 2px solid #ef4444;
            color: #f87171;
            padding: 12px 30px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .tab-btn:hover {
            background: rgba(239, 68, 68, 0.2);
            transform: translateY(-2px);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            box-shadow: 0 10px 30px rgba(239, 68, 68, 0.3);
        }

        .mockup-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .mockup-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .mockup-card {
            background: rgba(30, 41, 59, 0.5);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 40px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .mockup-title {
            font-size: 2rem;
            color: #f87171;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .mockup-description {
            color: #cbd5e1;
            margin-bottom: 30px;
            font-size: 1.1rem;
            line-height: 1.8;
        }

        .success-box {
            background: rgba(16, 185, 129, 0.1);
            border-left: 4px solid #10b981;
            padding: 25px;
            border-radius: 12px;
            margin: 30px 0;
        }

        .success-box h3 {
            color: #10b981;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .success-box p, .success-box ul {
            color: #cbd5e1;
            line-height: 1.8;
        }

        .success-box ul {
            margin-top: 15px;
            padding-left: 20px;
        }

        .success-box li {
            margin: 8px 0;
        }

        .warning-box {
            background: rgba(239, 68, 68, 0.1);
            border-left: 4px solid #ef4444;
            padding: 25px;
            border-radius: 12px;
            margin: 30px 0;
        }

        .warning-box h3 {
            color: #ef4444;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .warning-box p, .warning-box ul {
            color: #cbd5e1;
            line-height: 1.8;
        }

        .warning-box ul {
            margin-top: 15px;
            padding-left: 20px;
        }

        .code-box {
            background: rgba(0, 0, 0, 0.4);
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .code-box pre {
            color: #cbd5e1;
            font-size: 0.95rem;
            overflow-x: auto;
            line-height: 1.6;
        }

        .comparison-table {
            width: 100%;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 12px;
            overflow: hidden;
            margin: 30px 0;
        }

        .comparison-table th {
            background: rgba(239, 68, 68, 0.2);
            padding: 20px;
            text-align: left;
            color: #f87171;
            font-weight: 600;
        }

        .comparison-table td {
            padding: 20px;
            color: #cbd5e1;
            border-bottom: 1px solid rgba(100, 116, 139, 0.2);
        }

        .comparison-table tr:hover {
            background: rgba(239, 68, 68, 0.05);
        }

        .flow-diagram {
            background: rgba(30, 41, 59, 0.5);
            padding: 30px;
            border-radius: 16px;
            margin: 30px 0;
        }

        .flow-step {
            background: rgba(16, 185, 129, 0.1);
            padding: 20px;
            border-radius: 12px;
            margin: 15px 0;
            border-left: 4px solid #10b981;
        }

        .flow-step h4 {
            color: #10b981;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .flow-step p {
            color: #cbd5e1;
            line-height: 1.6;
        }

        .arrow {
            text-align: center;
            color: #94a3b8;
            font-size: 1.5rem;
            margin: 10px 0;
        }

        footer {
            margin-top: 80px;
            padding-top: 40px;
            border-top: 1px solid #334155;
            text-align: center;
            color: #64748b;
        }

        @media (max-width: 768px) {
            h1 { font-size: 2rem; }
            .tabs { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ”’ Muzibu Premium v4</h1>
            <div class="version-badge">
                MEVCUT TABLO + BACKEND GÃœVENLÄ°K
                <span class="security-badge">ğŸ” Secure</span>
            </div>
            <h2 style="color: #f87171; font-size: 1.5rem; margin-top: 15px;">JS ManipÃ¼lasyonu Ä°mkansÄ±z</h2>
            <div class="meta">
                ğŸ“… 26 KasÄ±m 2025 | ğŸ¯ Tenant 1001 | ğŸ”’ Backend Validated
            </div>
        </header>

        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('overview')">ğŸ”’ GÃ¼venlik</button>
            <button class="tab-btn" onclick="showTab('database')">ğŸ’¾ Database</button>
            <button class="tab-btn" onclick="showTab('backend')">âš™ï¸ Backend Logic</button>
            <button class="tab-btn" onclick="showTab('flow')">ğŸ”„ Ä°ÅŸleyiÅŸ AkÄ±ÅŸÄ±</button>
        </div>

        <!-- OVERVIEW -->
        <div id="overview" class="mockup-section active">
            <div class="mockup-card">
                <div class="mockup-title">
                    ğŸ”’ GÃ¼venlik Ã–ncelikli Sistem
                </div>

                <div class="warning-box">
                    <h3>âš ï¸ SORUN: Frontend GÃ¼venilmez</h3>
                    <ul>
                        <li>âŒ JavaScript manipÃ¼le edilebilir (DevTools, extension)</li>
                        <li>âŒ LocalStorage/Cookie hacklenebilir</li>
                        <li>âŒ API call'larÄ± sahte veri gÃ¶nderebilir</li>
                        <li>âŒ ZamanlayÄ±cÄ±lar atlanabilir</li>
                    </ul>
                </div>

                <div class="success-box">
                    <h3>âœ… Ã‡Ã–ZÃœM: Backend Validation</h3>
                    <ul>
                        <li>âœ… <strong>Mevcut tablo kullan:</strong> muzibu_song_plays (zaten var!)</li>
                        <li>âœ… <strong>Backend kontrol:</strong> Her API call'da limit check</li>
                        <li>âœ… <strong>30 saniye kuralÄ±:</strong> Backend'de validate</li>
                        <li>âœ… <strong>SÄ±fÄ±r JS gÃ¼ven:</strong> TÃ¼m logic server-side</li>
                    </ul>
                </div>

                <div class="success-box">
                    <h3>ğŸ¯ Sistem KurallarÄ±</h3>
                    <table class="comparison-table">
                        <tr>
                            <th>KullanÄ±cÄ±</th>
                            <th>Kural</th>
                            <th>Kontrol</th>
                        </tr>
                        <tr>
                            <td><strong>ğŸš« Guest</strong></td>
                            <td>Her ÅŸarkÄ±nÄ±n 30 saniyesi</td>
                            <td>Frontend fade-out (gÃ¼venlik gereksiz)</td>
                        </tr>
                        <tr>
                            <td><strong>ğŸ‘¤ Normal Ãœye</strong></td>
                            <td>GÃ¼nde <strong>5 ÅŸarkÄ±</strong> (30+ saniye dinlenen)</td>
                            <td><strong>Backend API:</strong> muzibu_song_plays tablosundan count</td>
                        </tr>
                        <tr>
                            <td><strong>â­ Premium/Deneme</strong></td>
                            <td>SÄ±nÄ±rsÄ±z</td>
                            <td>Backend: user.isPremium() check</td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>

        <!-- DATABASE -->
        <div id="database" class="mockup-section">
            <div class="mockup-card">
                <div class="mockup-title">
                    ğŸ’¾ Mevcut Tablo Kullan - SÄ±fÄ±r Yeni Tablo!
                </div>

                <div class="success-box">
                    <h3>âœ… MEVCUT: muzibu_song_plays</h3>
                    <div class="code-box">
                        <pre>muzibu_song_plays (ZATEN VAR!)
â”œâ”€â”€ id
â”œâ”€â”€ song_id
â”œâ”€â”€ user_id
â”œâ”€â”€ ip_address
â”œâ”€â”€ user_agent
â”œâ”€â”€ device_type
â”œâ”€â”€ created_at
â””â”€â”€ updated_at</pre>
                    </div>
                </div>

                <div class="warning-box">
                    <h3>ğŸ”§ TEK EKSÄ°K: duration_listened</h3>
                    <p><strong>Migration ekle:</strong></p>
                    <div class="code-box">
                        <pre>// 2025_11_26_add_duration_to_song_plays.php

Schema::table('muzibu_song_plays', function (Blueprint $table) {
    $table->integer('duration_listened')->default(0)
          ->after('user_id')
          ->comment('KaÃ§ saniye dinlendi (30+ = tam dinleme)');

    // Index ekle (performans iÃ§in)
    $table->index(['user_id', 'created_at', 'duration_listened'],
                  'user_daily_plays_idx');
});</pre>
                    </div>
                </div>

                <div class="success-box">
                    <h3>âœ… Bu Kadar!</h3>
                    <p>
                        - âŒ Yeni tablo YOK<br>
                        - âŒ users tablosuna alan ekleme YOK<br>
                        - âœ… Sadece 1 kolon ekle: <code>duration_listened</code><br>
                        - âœ… Mevcut song_plays mekanizmasÄ± Ã§alÄ±ÅŸÄ±yor zaten
                    </p>
                </div>
            </div>
        </div>

        <!-- BACKEND -->
        <div id="backend" class="mockup-section">
            <div class="mockup-card">
                <div class="mockup-title">
                    âš™ï¸ Backend Logic - GÃ¼venli Kod
                </div>

                <div class="success-box">
                    <h3>1ï¸âƒ£ User Model - Helper Methods</h3>
                    <div class="code-box">
                        <pre>// app/Models/User.php

/**
 * KullanÄ±cÄ± bugÃ¼n kaÃ§ ÅŸarkÄ± dinledi? (30+ saniye)
 */
public function getTodayPlayedCount(): int
{
    return DB::table('muzibu_song_plays')
        ->where('user_id', $this->id)
        ->where('duration_listened', '>=', 30)
        ->whereDate('created_at', today())
        ->count();
}

/**
 * ÅarkÄ± Ã§alabilir mi?
 */
public function canPlaySong(): bool
{
    // Premium/Trial â†’ SÄ±nÄ±rsÄ±z
    if ($this->isPremium() || $this->isTrialActive()) {
        return true;
    }

    // Normal Ã¼ye â†’ GÃ¼nde 5 ÅŸarkÄ±
    return $this->getTodayPlayedCount() < 5;
}

/**
 * Kalan ÅŸarkÄ± hakkÄ±
 */
public function getRemainingPlays(): int
{
    if ($this->isPremium() || $this->isTrialActive()) {
        return -1; // SÄ±nÄ±rsÄ±z
    }

    return max(0, 5 - $this->getTodayPlayedCount());
}</pre>
                    </div>
                </div>

                <div class="success-box">
                    <h3>2ï¸âƒ£ API Controller - Stream Endpoint</h3>
                    <div class="code-box">
                        <pre>// Modules/Muzibu/app/Http/Controllers/Api/SongStreamController.php

public function stream(int $songId): JsonResponse
{
    $user = auth()->user();

    // Guest â†’ 30 saniye preview (frontend'de fade-out)
    if (!$user) {
        return response()->json([
            'status' => 'preview',
            'stream_url' => $song->getStreamUrl(),
            'preview_duration' => 30,
            'message' => 'KayÄ±t olun, tam dinleyin'
        ]);
    }

    // Limit kontrolÃ¼ (BACKEND'DE!)
    if (!$user->canPlaySong()) {
        return response()->json([
            'status' => 'limit_exceeded',
            'played_today' => $user->getTodayPlayedCount(),
            'limit' => 5,
            'message' => 'GÃ¼nlÃ¼k 5 ÅŸarkÄ± limitiniz doldu'
        ], 403);
    }

    // OK â†’ Stream ver
    return response()->json([
        'status' => 'ok',
        'stream_url' => $song->getStreamUrl(),
        'remaining' => $user->getRemainingPlays()
    ]);
}</pre>
                    </div>
                </div>

                <div class="success-box">
                    <h3>3ï¸âƒ£ Track Play - ÅarkÄ± Dinleme KaydÄ±</h3>
                    <div class="code-box">
                        <pre>// Frontend her 5 saniyede progress rapor eder
// Backend son raporu saklar

public function trackPlay(Request $request, int $songId): JsonResponse
{
    $durationListened = $request->input('duration', 0);

    // GÃ¼venlik: Maximum ÅŸarkÄ± sÃ¼resi
    $song = Song::findOrFail($songId);
    if ($durationListened > $song->duration_seconds + 10) {
        return response()->json(['error' => 'invalid_duration'], 400);
    }

    // Insert/Update
    DB::table('muzibu_song_plays')->updateOrInsert(
        [
            'user_id' => auth()->id(),
            'song_id' => $songId,
            'created_at' => now() // AynÄ± gÃ¼n, aynÄ± ÅŸarkÄ±
        ],
        [
            'duration_listened' => $durationListened,
            'ip_address' => $request->ip(),
            'user_agent' => $request->userAgent(),
            'device_type' => $this->detectDevice(),
            'updated_at' => now()
        ]
    );

    return response()->json([
        'success' => true,
        'remaining' => auth()->user()->getRemainingPlays()
    ]);
}</pre>
                    </div>
                </div>

                <div class="warning-box">
                    <h3>ğŸ”’ GÃ¼venlik Ã–nlemleri</h3>
                    <ul>
                        <li>âœ… <strong>Duration validation:</strong> ÅarkÄ± sÃ¼resinden fazla rapor edilemez</li>
                        <li>âœ… <strong>Rate limiting:</strong> AynÄ± kullanÄ±cÄ± saniyede 1'den fazla rapor edemez</li>
                        <li>âœ… <strong>User ID check:</strong> Auth middleware ile garanti</li>
                        <li>âœ… <strong>30 saniye backend:</strong> Frontend deÄŸil, backend karar verir</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- FLOW -->
        <div id="flow" class="mockup-section">
            <div class="mockup-card">
                <div class="mockup-title">
                    ğŸ”„ Sistem Ä°ÅŸleyiÅŸ AkÄ±ÅŸÄ±
                </div>

                <div class="flow-diagram">
                    <div class="flow-step">
                        <h4>1ï¸âƒ£ KullanÄ±cÄ± ÅarkÄ±ya TÄ±klar</h4>
                        <p>Frontend: <code>API.stream(songId)</code> Ã§aÄŸrÄ±sÄ± yapar</p>
                    </div>

                    <div class="arrow">â¬‡ï¸</div>

                    <div class="flow-step">
                        <h4>2ï¸âƒ£ Backend Limit KontrolÃ¼</h4>
                        <p>
                            <strong>Query:</strong><br>
                            <code>SELECT COUNT(*) FROM muzibu_song_plays WHERE user_id = ? AND created_at >= TODAY() AND duration_listened >= 30</code>
                        </p>
                    </div>

                    <div class="arrow">â¬‡ï¸</div>

                    <div class="flow-step" style="background: rgba(239, 68, 68, 0.1); border-color: #ef4444;">
                        <h4>âŒ Limit Doldu (5/5)?</h4>
                        <p>
                            <strong>Response 403:</strong><br>
                            <code>{ "error": "limit_exceeded", "played_today": 5 }</code><br>
                            Frontend modal gÃ¶sterir, ÅŸarkÄ± Ã§almaz
                        </p>
                    </div>

                    <div class="arrow">VEYA</div>

                    <div class="flow-step" style="background: rgba(16, 185, 129, 0.1); border-color: #10b981;">
                        <h4>âœ… Limit OK (3/5)?</h4>
                        <p>
                            <strong>Response 200:</strong><br>
                            <code>{ "stream_url": "...", "remaining": 2 }</code><br>
                            Frontend ÅŸarkÄ±yÄ± Ã§alar
                        </p>
                    </div>

                    <div class="arrow">â¬‡ï¸</div>

                    <div class="flow-step">
                        <h4>3ï¸âƒ£ Frontend Progress Raporu</h4>
                        <p>
                            Her 5 saniyede: <code>API.trackPlay(songId, currentTime)</code><br>
                            <strong>Ã–rnek:</strong> 10s, 15s, 20s, 25s, 30s, 35s...
                        </p>
                    </div>

                    <div class="arrow">â¬‡ï¸</div>

                    <div class="flow-step">
                        <h4>4ï¸âƒ£ Backend KayÄ±t</h4>
                        <p>
                            <code>duration_listened</code> gÃ¼ncellenir<br>
                            30+ saniye olduÄŸunda â†’ "Tam dinleme" sayÄ±lÄ±r<br>
                            Bir sonraki API call'da limit'e sayÄ±lÄ±r
                        </p>
                    </div>

                    <div class="arrow">â¬‡ï¸</div>

                    <div class="flow-step">
                        <h4>5ï¸âƒ£ ÅarkÄ± Biter</h4>
                        <p>
                            Son progress raporu: <code>duration_listened = son_pozisyon</code><br>
                            Frontend sidebar'Ä± gÃ¼nceller: "4/5 ÅŸarkÄ±"
                        </p>
                    </div>
                </div>

                <div class="success-box">
                    <h3>âœ… Neden GÃ¼venli?</h3>
                    <ul>
                        <li>ğŸ”’ <strong>Her ÅŸarkÄ± stream:</strong> Backend kontrol eder</li>
                        <li>ğŸ”’ <strong>30 saniye:</strong> Backend DB'den okur, JS deÄŸil</li>
                        <li>ğŸ”’ <strong>ManipÃ¼lasyon:</strong> Frontend'i hack'lesen bile limit backend'de</li>
                        <li>ğŸ”’ <strong>Progress raporu:</strong> Duration validation var, sÄ±nÄ±r aÅŸamaz</li>
                    </ul>
                </div>
            </div>
        </div>

        <footer>
            <p>ğŸ”’ Muzibu Premium v4 - Backend GÃ¼venlikli Sistem</p>
            <p style="margin-top: 10px;">âœ… Mevcut Tablo | ğŸ” Backend Validation | âš¡ PerformanslÄ±</p>
            <p style="margin-top: 10px; color: #64748b;">Claude AI - 26 KasÄ±m 2025</p>
        </footer>
    </div>

    <script>
        function showTab(tabId) {
            document.querySelectorAll('.mockup-section').forEach(section => {
                section.classList.remove('active');
            });

            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
        }
    </script>
</body>
</html>
