<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abuse Detection - Interactive Timeline (v7)</title>

    <!-- Vis.js Timeline Library -->
    <script src="https://unpkg.com/vis-timeline@7.7.3/standalone/umd/vis-timeline-graph2d.min.js"></script>
    <link href="https://unpkg.com/vis-timeline@7.7.3/styles/vis-timeline-graph2d.min.css" rel="stylesheet">

    <!-- Tailwind & FontAwesome -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body { background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%); }
        .card { background: rgba(30, 41, 59, 0.9); backdrop-filter: blur(10px); }

        /* Vis.js Timeline Custom Styles */
        .vis-timeline {
            border: none !important;
            background: transparent !important;
        }
        .vis-panel.vis-center, .vis-panel.vis-left, .vis-panel.vis-right {
            border: none !important;
        }
        .vis-time-axis .vis-text {
            color: #94a3b8 !important;
            font-size: 11px !important;
        }
        .vis-time-axis .vis-grid.vis-minor {
            border-color: rgba(148, 163, 184, 0.1) !important;
        }
        .vis-time-axis .vis-grid.vis-major {
            border-color: rgba(148, 163, 184, 0.2) !important;
        }
        .vis-labelset .vis-label {
            color: #e2e8f0 !important;
            background: rgba(30, 41, 59, 0.8) !important;
            border-bottom: 1px solid rgba(255,255,255,0.1) !important;
        }
        .vis-foreground .vis-group {
            border-bottom: 1px solid rgba(255,255,255,0.05) !important;
        }

        /* Custom item styles */
        .vis-item {
            border-radius: 6px !important;
            border: none !important;
            font-size: 11px !important;
            color: white !important;
        }
        .vis-item.vis-selected {
            box-shadow: 0 0 0 3px rgba(255,255,255,0.3) !important;
        }
        .vis-item.desktop {
            background: linear-gradient(135deg, #3b82f6, #2563eb) !important;
        }
        .vis-item.mobile {
            background: linear-gradient(135deg, #10b981, #059669) !important;
        }
        .vis-item.overlap {
            border: 2px solid #ef4444 !important;
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.5) !important;
            animation: pulse-glow 1.5s infinite !important;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 5px rgba(239, 68, 68, 0.5); }
            50% { box-shadow: 0 0 20px rgba(239, 68, 68, 0.8); }
        }

        /* Overlap zone background */
        .vis-item.overlap-zone {
            background: rgba(239, 68, 68, 0.15) !important;
            border: none !important;
            border-left: 2px dashed #ef4444 !important;
            border-right: 2px dashed #ef4444 !important;
            z-index: 0 !important;
        }

        /* Current time indicator */
        .vis-current-time {
            background-color: #f59e0b !important;
            width: 2px !important;
        }

        /* Scrollbar */
        .vis-panel.vis-center::-webkit-scrollbar {
            height: 8px;
        }
        .vis-panel.vis-center::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
        }
        .vis-panel.vis-center::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
        }

        /* Legend badges */
        .legend-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
        .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 3px;
        }
    </style>
</head>
<body class="min-h-screen text-white">
    <!-- Header -->
    <header class="border-b border-white/10 py-6 bg-slate-900/50">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <div>
                    <div class="flex items-center gap-3 mb-2">
                        <span class="px-3 py-1 bg-purple-500/20 text-purple-400 text-xs font-bold rounded-full border border-purple-500/30">
                            <i class="fas fa-chart-gantt mr-1"></i> VIS.JS TIMELINE
                        </span>
                        <span class="px-3 py-1 bg-red-500/20 text-red-400 text-xs font-bold rounded-full border border-red-500/30">
                            ABUSE DETECTION v7
                        </span>
                    </div>
                    <h1 class="text-3xl font-bold bg-gradient-to-r from-white to-gray-400 bg-clip-text text-transparent">
                        User #1 - Interactive Timeline
                    </h1>
                    <p class="text-gray-400 mt-1">Zoom, scroll ve tikla - cakismalari gorsel incele</p>
                </div>
                <div class="flex flex-wrap gap-2">
                    <div class="legend-badge bg-blue-500/20 text-blue-400">
                        <div class="legend-dot" style="background: linear-gradient(135deg, #3b82f6, #2563eb);"></div>
                        <span>Desktop</span>
                    </div>
                    <div class="legend-badge bg-green-500/20 text-green-400">
                        <div class="legend-dot" style="background: linear-gradient(135deg, #10b981, #059669);"></div>
                        <span>Mobile</span>
                    </div>
                    <div class="legend-badge bg-red-500/20 text-red-400">
                        <div class="legend-dot" style="background: #ef4444; box-shadow: 0 0 8px #ef4444;"></div>
                        <span>Cakisma!</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Stats -->
    <div class="max-w-7xl mx-auto px-4 py-6">
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4" id="stats-cards"></div>
    </div>

    <!-- Day Tabs -->
    <div class="max-w-7xl mx-auto px-4 py-2">
        <div class="flex gap-2 flex-wrap items-center">
            <span class="text-gray-500 text-sm mr-2"><i class="fas fa-calendar mr-1"></i>Gun Sec:</span>
            <div id="day-tabs" class="flex gap-2 flex-wrap"></div>
        </div>
    </div>

    <!-- Timeline Container -->
    <div class="max-w-7xl mx-auto px-4 py-4">
        <div class="card rounded-2xl border border-white/10 overflow-hidden">
            <div class="p-4 border-b border-white/10 bg-gradient-to-r from-slate-800 to-slate-900 flex items-center justify-between">
                <div>
                    <h2 class="text-lg font-bold" id="timeline-title">Timeline</h2>
                    <p class="text-gray-400 text-sm" id="timeline-subtitle">Zoom: scroll | Pan: drag | Details: click</p>
                </div>
                <div class="flex gap-2">
                    <button onclick="zoomIn()" class="px-3 py-1 bg-white/10 hover:bg-white/20 rounded-lg text-sm transition">
                        <i class="fas fa-search-plus"></i>
                    </button>
                    <button onclick="zoomOut()" class="px-3 py-1 bg-white/10 hover:bg-white/20 rounded-lg text-sm transition">
                        <i class="fas fa-search-minus"></i>
                    </button>
                    <button onclick="fitAll()" class="px-3 py-1 bg-white/10 hover:bg-white/20 rounded-lg text-sm transition">
                        <i class="fas fa-expand"></i> Tumu
                    </button>
                </div>
            </div>
            <div id="timeline" style="height: 300px;"></div>
        </div>
    </div>

    <!-- Selected Item Details -->
    <div class="max-w-7xl mx-auto px-4 py-4">
        <div id="item-details" class="card rounded-xl border border-white/10 p-6 hidden">
            <!-- Filled by JS -->
        </div>
    </div>

    <!-- Overlap Alerts -->
    <div class="max-w-7xl mx-auto px-4 py-4">
        <div id="overlap-alerts"></div>
    </div>

    <!-- Footer -->
    <footer class="border-t border-white/10 py-6 mt-8">
        <div class="max-w-7xl mx-auto px-4 text-center text-gray-500 text-sm">
            <p>Muzibu B2B - Abuse Detection | Vis.js Timeline | v7.0</p>
        </div>
    </footer>

    <script>
    // =================================================================
    // RAW PLAY DATA
    // =================================================================
    const rawPlayData = [
        {"id":368,"title":"Cold Love","duration":123,"device":"desktop","time":"2025-12-22 20:46:59"},
        {"id":369,"title":"Don't You Worry","duration":190,"device":"desktop","time":"2025-12-22 20:48:27"},
        {"id":370,"title":"Bulk Upload Test","duration":175,"device":"desktop","time":"2025-12-22 20:51:35"},
        {"id":402,"title":"Go","duration":189,"device":"desktop","time":"2025-12-25 02:02:35"},
        {"id":403,"title":"Yalniz Kurt","duration":175,"device":"desktop","time":"2025-12-25 02:03:10"},
        {"id":412,"title":"A Bar Song","duration":210,"device":"desktop","time":"2025-12-25 04:35:33"},
        {"id":413,"title":"Go","duration":189,"device":"desktop","time":"2025-12-25 04:37:41"},
        {"id":430,"title":"A Bar Song","duration":210,"device":"desktop","time":"2025-12-26 00:24:32"},
        {"id":431,"title":"GOD","duration":142,"device":"desktop","time":"2025-12-26 00:25:43"},
        {"id":432,"title":"A Bar Song","duration":210,"device":"desktop","time":"2025-12-26 00:26:08"},
        {"id":445,"title":"Punchin Bag","duration":200,"device":"desktop","time":"2025-12-26 04:40:55"},
        {"id":446,"title":"Punchin Bag","duration":200,"device":"desktop","time":"2025-12-26 04:41:26"},
        {"id":450,"title":"ALMA","duration":124,"device":"desktop","time":"2025-12-26 04:48:46"},
        {"id":451,"title":"How Will I Know","duration":159,"device":"desktop","time":"2025-12-26 04:49:03"},
        {"id":494,"title":"Punchin Bag","duration":200,"device":"desktop","time":"2025-12-26 15:12:10"},
        {"id":495,"title":"Dark Days","duration":138,"device":"desktop","time":"2025-12-26 15:12:18"},
        {"id":523,"title":"Gestures","duration":179,"device":"desktop","time":"2025-12-27 03:41:30"},
        {"id":524,"title":"Gestures","duration":179,"device":"mobile","time":"2025-12-27 04:16:28"},
        {"id":531,"title":"All Again","duration":146,"device":"desktop","time":"2025-12-27 05:42:27"},
        {"id":532,"title":"Cold Love","duration":123,"device":"desktop","time":"2025-12-27 05:43:09"},
        {"id":571,"title":"Cold Love","duration":123,"device":"desktop","time":"2025-12-28 00:43:27"},
        {"id":572,"title":"After Hours","duration":167,"device":"desktop","time":"2025-12-28 00:44:08"},
        {"id":581,"title":"Cold Love","duration":123,"device":"mobile","time":"2025-12-28 02:36:14"},
        {"id":582,"title":"Saksidaki Cicekler","duration":157,"device":"mobile","time":"2025-12-28 02:36:58"},
        {"id":607,"title":"All Night Long","duration":120,"device":"mobile","time":"2025-12-28 04:45:42"},
        {"id":608,"title":"After Hours","duration":167,"device":"mobile","time":"2025-12-28 04:45:53"},
        {"id":640,"title":"Afterimage","duration":192,"device":"mobile","time":"2025-12-29 15:52:42"},
        {"id":641,"title":"Afterimage","duration":192,"device":"mobile","time":"2025-12-29 15:55:49"},
        {"id":642,"title":"Afterimage","duration":192,"device":"desktop","time":"2025-12-29 15:56:53"},
        {"id":643,"title":"Cold Love","duration":123,"device":"mobile","time":"2025-12-29 15:58:59"},
        {"id":655,"title":"Yalniz Kurt","duration":175,"device":"mobile","time":"2025-12-29 16:21:13"},
        {"id":656,"title":"Kar Tanesi","duration":146,"device":"desktop","time":"2025-12-29 16:21:35"},
        {"id":657,"title":"Cold Love","duration":123,"device":"mobile","time":"2025-12-29 16:22:04"},
        {"id":671,"title":"You Are Not a Soldier","duration":203,"device":"mobile","time":"2025-12-29 17:00:57"},
        {"id":672,"title":"ALONE","duration":175,"device":"mobile","time":"2025-12-29 17:02:41"},
        {"id":673,"title":"Amen","duration":157,"device":"mobile","time":"2025-12-29 17:05:36"},
        {"id":674,"title":"Angels","duration":148,"device":"mobile","time":"2025-12-29 17:08:14"},
        {"id":675,"title":"ASHES & BLOOM","duration":160,"device":"mobile","time":"2025-12-29 17:10:11"},
        {"id":676,"title":"Gestures","duration":179,"device":"mobile","time":"2025-12-29 17:12:43"},
        {"id":677,"title":"Give Me the Power","duration":156,"device":"mobile","time":"2025-12-29 17:15:41"},
        {"id":678,"title":"Give Me the Power","duration":156,"device":"desktop","time":"2025-12-29 17:18:09"},
        {"id":679,"title":"Give the People","duration":131,"device":"mobile","time":"2025-12-29 17:18:20"},
        {"id":680,"title":"Cold Love","duration":123,"device":"mobile","time":"2025-12-29 17:20:28"},
        {"id":681,"title":"Yalniz Kurt","duration":175,"device":"mobile","time":"2025-12-29 17:22:31"},
        {"id":682,"title":"After Hours","duration":167,"device":"mobile","time":"2025-12-29 17:25:26"},
        {"id":683,"title":"Afterimage","duration":192,"device":"mobile","time":"2025-12-29 17:28:14"},
        {"id":684,"title":"Afterimage","duration":192,"device":"desktop","time":"2025-12-29 17:34:21"},
        {"id":687,"title":"You Are Not a Soldier","duration":203,"device":"mobile","time":"2025-12-29 17:47:46"},
        {"id":688,"title":"Afterimage","duration":192,"device":"desktop","time":"2025-12-29 17:49:18"},
        {"id":689,"title":"ALMA","duration":124,"device":"mobile","time":"2025-12-29 17:51:08"},
        {"id":690,"title":"ALONE","duration":175,"device":"mobile","time":"2025-12-29 17:53:13"},
        {"id":691,"title":"Afterimage","duration":192,"device":"desktop","time":"2025-12-29 17:54:12"},
        {"id":692,"title":"All Again","duration":146,"device":"desktop","time":"2025-12-29 18:04:44"},
        {"id":693,"title":"Angels","duration":148,"device":"mobile","time":"2025-12-29 18:07:26"}
    ];

    // =================================================================
    // TIMELINE SETUP
    // =================================================================
    let timeline = null;
    let items = null;
    let groups = null;
    let selectedDate = null;

    // Groups (lanes)
    groups = new vis.DataSet([
        { id: 'desktop', content: '<i class="fas fa-desktop"></i> Desktop', className: 'desktop-group' },
        { id: 'mobile', content: '<i class="fas fa-mobile-alt"></i> Mobile', className: 'mobile-group' }
    ]);

    // Parse dates
    function getDate(timeStr) {
        return timeStr.split(' ')[0];
    }

    function parseTime(timeStr) {
        return new Date(timeStr.replace(' ', 'T'));
    }

    // Detect overlaps (different devices only)
    function detectOverlaps(plays) {
        const overlaps = [];
        const sortedPlays = [...plays].sort((a, b) => parseTime(a.time) - parseTime(b.time));

        for (let i = 0; i < sortedPlays.length - 1; i++) {
            const p1 = sortedPlays[i];
            const p2 = sortedPlays[i + 1];

            const p1Start = parseTime(p1.time);
            const p1End = new Date(p1Start.getTime() + p1.duration * 1000);
            const p2Start = parseTime(p2.time);

            if (p1End > p2Start && p1.device !== p2.device) {
                overlaps.push({
                    play1: p1,
                    play2: p2,
                    seconds: Math.floor((p1End - p2Start) / 1000),
                    overlapStart: p2Start,
                    overlapEnd: p1End
                });
            }
        }
        return overlaps;
    }

    const allOverlaps = detectOverlaps(rawPlayData);

    // Group by date
    function groupByDate(plays) {
        const grouped = {};
        plays.forEach(p => {
            const d = getDate(p.time);
            if (!grouped[d]) grouped[d] = [];
            grouped[d].push(p);
        });
        return grouped;
    }

    const groupedPlays = groupByDate(rawPlayData);
    const dates = Object.keys(groupedPlays).sort().reverse();

    // =================================================================
    // RENDER FUNCTIONS
    // =================================================================

    function renderStats() {
        const totalPlays = rawPlayData.length;
        const desktopPlays = rawPlayData.filter(p => p.device === 'desktop').length;
        const mobilePlays = rawPlayData.filter(p => p.device === 'mobile').length;
        const totalAbuseScore = allOverlaps.reduce((s, o) => s + o.seconds, 0);

        document.getElementById('stats-cards').innerHTML = `
            <div class="card rounded-xl p-4 border border-white/10 text-center">
                <div class="text-2xl font-bold text-white">${totalPlays}</div>
                <div class="text-xs text-gray-400">Toplam Play</div>
            </div>
            <div class="card rounded-xl p-4 border border-white/10 text-center">
                <div class="text-2xl font-bold text-blue-400">${desktopPlays}</div>
                <div class="text-xs text-gray-400">Desktop</div>
            </div>
            <div class="card rounded-xl p-4 border border-white/10 text-center">
                <div class="text-2xl font-bold text-green-400">${mobilePlays}</div>
                <div class="text-xs text-gray-400">Mobile</div>
            </div>
            <div class="card rounded-xl p-4 border border-white/10 text-center">
                <div class="text-2xl font-bold text-yellow-400">${allOverlaps.length}</div>
                <div class="text-xs text-gray-400">Cakisma</div>
            </div>
            <div class="card rounded-xl p-4 border border-red-500/30 text-center ${totalAbuseScore > 100 ? 'bg-red-500/10' : ''}">
                <div class="text-2xl font-bold text-red-400">${totalAbuseScore}s</div>
                <div class="text-xs text-gray-400">Abuse Score</div>
            </div>
        `;
    }

    function renderDayTabs() {
        let html = '';
        dates.forEach(date => {
            const dayOverlaps = allOverlaps.filter(o => getDate(o.play1.time) === date);
            const hasOverlap = dayOverlaps.length > 0;
            const playCount = groupedPlays[date].length;

            html += `
                <button onclick="selectDate('${date}')"
                    class="day-tab px-4 py-2 rounded-lg text-sm font-medium transition-all border
                    ${hasOverlap ? 'border-red-500/50 hover:border-red-500' : 'border-white/10 hover:border-white/30'}
                    hover:bg-white/10"
                    data-date="${date}">
                    ${date.slice(5).replace('-', '/')}
                    <span class="text-gray-500 ml-1">(${playCount})</span>
                    ${hasOverlap ? '<i class="fas fa-exclamation-circle text-red-400 ml-1"></i>' : ''}
                </button>
            `;
        });
        document.getElementById('day-tabs').innerHTML = html;
    }

    function selectDate(date) {
        selectedDate = date;

        // Update tab styles
        document.querySelectorAll('.day-tab').forEach(tab => {
            if (tab.dataset.date === date) {
                tab.classList.add('bg-blue-500/30', 'border-blue-500');
            } else {
                tab.classList.remove('bg-blue-500/30', 'border-blue-500');
            }
        });

        renderTimeline(date);
        renderOverlapAlerts(date);

        // Update title
        document.getElementById('timeline-title').textContent = `Timeline - ${date}`;
        document.getElementById('timeline-subtitle').textContent = `${groupedPlays[date].length} play | Zoom: scroll | Pan: drag`;
    }

    function renderTimeline(date) {
        const plays = groupedPlays[date] || [];
        const dayOverlaps = allOverlaps.filter(o => getDate(o.play1.time) === date);

        // Create overlap play IDs set
        const overlapIds = new Set();
        dayOverlaps.forEach(o => {
            overlapIds.add(o.play1.id);
            overlapIds.add(o.play2.id);
        });

        // Build items
        const itemsArray = [];

        // Add play items
        plays.forEach(p => {
            const start = parseTime(p.time);
            const end = new Date(start.getTime() + p.duration * 1000);
            const isOverlap = overlapIds.has(p.id);

            itemsArray.push({
                id: p.id,
                group: p.device,
                content: `<span title="${p.title}">${p.title}</span>`,
                start: start,
                end: end,
                className: `${p.device} ${isOverlap ? 'overlap' : ''}`,
                title: `${p.title}<br>ID: #${p.id}<br>Duration: ${Math.floor(p.duration/60)}:${(p.duration%60).toString().padStart(2,'0')}<br>${p.time}${isOverlap ? '<br><b style="color:#ef4444">âš  CAKISMA!</b>' : ''}`,
                data: p
            });
        });

        // Add overlap zone markers (background items)
        dayOverlaps.forEach((o, idx) => {
            itemsArray.push({
                id: `overlap-${idx}`,
                group: 'desktop', // Span both groups visually
                content: `<span style="color:#ef4444;font-weight:bold;">${o.seconds}s</span>`,
                start: o.overlapStart,
                end: o.overlapEnd,
                className: 'overlap-zone',
                type: 'background',
                title: `Cakisma Bolge<br>${o.seconds} saniye`
            });
        });

        items = new vis.DataSet(itemsArray);

        // Timeline options
        const options = {
            groupOrder: 'id',
            stack: true,
            stackSubgroups: true,
            showCurrentTime: false,
            zoomMin: 1000 * 60, // 1 minute
            zoomMax: 1000 * 60 * 60 * 24, // 24 hours
            orientation: 'top',
            margin: { item: 5 },
            tooltip: {
                followMouse: true,
                overflowMethod: 'cap'
            },
            format: {
                minorLabels: {
                    minute: 'HH:mm',
                    hour: 'HH:mm'
                },
                majorLabels: {
                    hour: 'D MMMM HH:mm',
                    day: 'D MMMM'
                }
            }
        };

        // Create or update timeline
        const container = document.getElementById('timeline');
        if (timeline) {
            timeline.setItems(items);
            timeline.fit();
        } else {
            timeline = new vis.Timeline(container, items, groups, options);

            // Click event
            timeline.on('select', function(properties) {
                if (properties.items.length > 0) {
                    const itemId = properties.items[0];
                    if (typeof itemId === 'number') {
                        const item = items.get(itemId);
                        showItemDetails(item);
                    }
                }
            });
        }

        // Fit to content
        setTimeout(() => timeline.fit(), 100);
    }

    function showItemDetails(item) {
        if (!item || !item.data) return;

        const p = item.data;
        const isOverlap = item.className.includes('overlap');

        document.getElementById('item-details').classList.remove('hidden');
        document.getElementById('item-details').innerHTML = `
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 rounded-xl flex items-center justify-center ${p.device === 'desktop' ? 'bg-blue-500/20' : 'bg-green-500/20'}">
                        <i class="fas fa-${p.device === 'desktop' ? 'desktop text-blue-400' : 'mobile-alt text-green-400'} text-xl"></i>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold">${p.title}</h3>
                        <p class="text-gray-400">Play ID: #${p.id}</p>
                    </div>
                </div>
                ${isOverlap ? '<span class="px-3 py-1 bg-red-500/20 text-red-400 rounded-full text-sm font-bold"><i class="fas fa-exclamation-triangle mr-1"></i>CAKISMA</span>' : ''}
            </div>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                <div class="bg-slate-800/50 rounded-lg p-3">
                    <div class="text-gray-400 mb-1">Cihaz</div>
                    <div class="font-medium capitalize">${p.device}</div>
                </div>
                <div class="bg-slate-800/50 rounded-lg p-3">
                    <div class="text-gray-400 mb-1">Sure</div>
                    <div class="font-medium">${Math.floor(p.duration/60)}:${(p.duration%60).toString().padStart(2,'0')}</div>
                </div>
                <div class="bg-slate-800/50 rounded-lg p-3">
                    <div class="text-gray-400 mb-1">Baslangic</div>
                    <div class="font-medium">${p.time.split(' ')[1]}</div>
                </div>
                <div class="bg-slate-800/50 rounded-lg p-3">
                    <div class="text-gray-400 mb-1">Tarih</div>
                    <div class="font-medium">${p.time.split(' ')[0]}</div>
                </div>
            </div>
        `;
    }

    function renderOverlapAlerts(date) {
        const dayOverlaps = allOverlaps.filter(o => getDate(o.play1.time) === date);

        if (dayOverlaps.length === 0) {
            document.getElementById('overlap-alerts').innerHTML = `
                <div class="card rounded-xl p-4 border border-green-500/30 bg-green-500/5 flex items-center gap-3">
                    <i class="fas fa-check-circle text-2xl text-green-400"></i>
                    <div>
                        <div class="font-bold text-green-400">Bu gunde es zamanli cakisma yok</div>
                        <div class="text-gray-400 text-sm">Farkli cihazlarda ayni anda dinleme tespit edilmedi.</div>
                    </div>
                </div>
            `;
            return;
        }

        let html = `
            <div class="card rounded-xl border border-red-500/30 overflow-hidden">
                <div class="p-4 bg-red-500/10 border-b border-red-500/30 flex items-center gap-3">
                    <i class="fas fa-exclamation-triangle text-2xl text-red-400"></i>
                    <div>
                        <div class="font-bold text-red-400">${dayOverlaps.length} Es Zamanli Cakisma!</div>
                        <div class="text-gray-400 text-sm">Desktop ve Mobile ayni anda aktif</div>
                    </div>
                </div>
                <div class="p-4 space-y-3">
        `;

        dayOverlaps.forEach((o, idx) => {
            const severity = o.seconds > 60 ? 'high' : o.seconds > 30 ? 'medium' : 'low';
            const colors = { high: 'red', medium: 'yellow', low: 'green' };
            const color = colors[severity];

            html += `
                <div class="bg-slate-800/50 rounded-lg p-4 border-l-4 border-${color}-500">
                    <div class="flex items-center justify-between mb-2">
                        <span class="font-bold text-${color}-400">Cakisma #${idx + 1}</span>
                        <span class="px-2 py-1 bg-${color}-500/20 text-${color}-400 rounded text-sm font-bold">${o.seconds} saniye</span>
                    </div>
                    <div class="grid grid-cols-2 gap-3 text-sm">
                        <div class="flex items-center gap-2">
                            <i class="fas fa-desktop text-blue-400"></i>
                            <span>${o.play1.title}</span>
                            <span class="text-gray-500">#${o.play1.id}</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <i class="fas fa-mobile-alt text-green-400"></i>
                            <span>${o.play2.title}</span>
                            <span class="text-gray-500">#${o.play2.id}</span>
                        </div>
                    </div>
                </div>
            `;
        });

        html += '</div></div>';
        document.getElementById('overlap-alerts').innerHTML = html;
    }

    // Zoom controls
    function zoomIn() {
        if (timeline) timeline.zoomIn(0.5);
    }
    function zoomOut() {
        if (timeline) timeline.zoomOut(0.5);
    }
    function fitAll() {
        if (timeline) timeline.fit();
    }

    // =================================================================
    // INIT
    // =================================================================
    document.addEventListener('DOMContentLoaded', () => {
        renderStats();
        renderDayTabs();
        selectDate(dates[0]); // Select most recent day
    });
    </script>
</body>
</html>
