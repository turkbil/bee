<div wire:id="qwGJf7o6Sw35HfZBMKaC" x-data="{
        open: false,
        itemCount: 6,
        cartId: 41,
        loadFromLocalStorage() {
            // localStorage'dan cart count ve cart_id oku
            const stored = localStorage.getItem('cart_item_count');
            const storedCartId = localStorage.getItem('cart_id');
            if (stored) {
                const count = parseInt(stored);
                if (count &gt; 0) {
                    this.itemCount = count;
                    console.log('ðŸ’¾ CartWidget: Loaded from localStorage:', this.itemCount);
                }
            }
            if (storedCartId) {
                this.cartId = parseInt(storedCartId);
                console.log('ðŸ’¾ CartWidget: Cart ID from localStorage:', this.cartId);
            }
        },
        async fetchCartCount() {
            try {
                // cart_id varsa parametreyle gÃ¶nder
                const url = this.cartId
                    ? `/api/cart/count?cart_id=${this.cartId}`
                    : '/api/cart/count';

                const response = await fetch(url);
                const data = await response.json();
                if (data.success) {
                    this.itemCount = data.data.item_count || 0;

                    // localStorage'Ä± gÃ¼ncelle
                    localStorage.setItem('cart_item_count', this.itemCount);
                    console.log('ðŸ”„ CartWidget: Count updated from API:', this.itemCount);

                    // cart_id varsa gÃ¼ncelle
                    if (data.data.cart_id) {
                        this.cartId = data.data.cart_id;
                        localStorage.setItem('cart_id', this.cartId);
                    }

                    // cart_id'yi Livewire'a gÃ¶nder
                    if (this.cartId) {
                        $wire.refreshCart(this.cartId);
                    }
                }
            } catch (error) {
                console.error('âŒ CartWidget: fetchCartCount error', error);
            }
        }
     }" x-init="loadFromLocalStorage(); fetchCartCount()" @cart-updated.window="console.log('ðŸ”„ CartWidget: cart-updated event received', $event.detail); itemCount = $event.detail.itemCount || 0; if ($event.detail.cartId) { cartId = $event.detail.cartId; localStorage.setItem('cart_id', cartId); localStorage.setItem('cart_item_count', itemCount); $wire.refreshCart(cartId); }" class="relative" data-has-alpine-state="true">
    
    <button @click="open = !open" type="button" class="relative flex items-center gap-2 px-3 py-2 text-gray-700 dark:text-gray-200 hover:text-primary-600 dark:hover:text-primary-400 transition-colors">
        <i class="fas fa-shopping-cart text-xl"></i>
        <span x-show="itemCount &gt; 0" x-text="itemCount" class="absolute -top-1 -right-1 flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-primary-600 rounded-full">5</span>
    </button>

    
    <div x-show="open" @click.away="open = false" x-transition:enter="transition ease-out duration-200" x-transition:enter-start="opacity-0 scale-95" x-transition:enter-end="opacity-100 scale-100" x-transition:leave="transition ease-in duration-150" x-transition:leave-start="opacity-100 scale-100" x-transition:leave-end="opacity-0 scale-95" class="absolute right-0 z-50 mt-2 w-80 bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700">

        <div class="p-4">
            <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-3">
                AlÄ±ÅŸveriÅŸ Sepeti
            </h3>

            <!--[if BLOCK]><![endif]-->                
                <div class="space-y-3 max-h-96 overflow-y-auto">
                    <!--[if BLOCK]><![endif]-->                        <div wire:key="cart-item-53" class="flex gap-3 p-2 hover:bg-gray-50 dark:hover:bg-gray-700/50 rounded-lg transition-colors">
                            
                            <!--[if BLOCK]><![endif]-->                                <div class="w-16 h-16 bg-gray-200 dark:bg-gray-700 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-box text-gray-400"></i>
                                </div>
                            <!--[if ENDBLOCK]><![endif]-->

                            
                            <div class="flex-1 min-w-0">
                                <h4 class="text-sm font-medium text-gray-900 dark:text-white truncate">
                                    Ä°XTÄ°F EPT20-15ET2H - 1.5 Ton Elektrikli Transpalet (AGM, YÃ¼ksek Åžasi BoÅŸluÄŸu)
                                </h4>
                                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">
                                                                        <!--[if BLOCK]><![endif]-->                                        2.350 TL
                                    <!--[if ENDBLOCK]><![endif]-->
                                </p>

                                
                                <div class="flex items-center gap-2 mt-2">
                                    <button wire:click="decreaseQuantity(53)" class="w-6 h-6 flex items-center justify-center bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 rounded transition-colors">
                                        <i class="fas fa-minus text-xs"></i>
                                    </button>
                                    <span class="text-sm font-medium text-gray-900 dark:text-white px-2">
                                        2
                                    </span>
                                    <button wire:click="increaseQuantity(53)" class="w-6 h-6 flex items-center justify-center bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 rounded transition-colors">
                                        <i class="fas fa-plus text-xs"></i>
                                    </button>
                                    <button wire:click="removeItem(53)" class="ml-auto text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300">
                                        <i class="fas fa-trash text-sm"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                                            <div wire:key="cart-item-54" class="flex gap-3 p-2 hover:bg-gray-50 dark:hover:bg-gray-700/50 rounded-lg transition-colors">
                            
                            <!--[if BLOCK]><![endif]-->                                <div class="w-16 h-16 bg-gray-200 dark:bg-gray-700 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-box text-gray-400"></i>
                                </div>
                            <!--[if ENDBLOCK]><![endif]-->

                            
                            <div class="flex-1 min-w-0">
                                <h4 class="text-sm font-medium text-gray-900 dark:text-white truncate">
                                    Ä°XTÄ°F F4 201 - 2.0 Ton Li-Ion Transpalet
                                </h4>
                                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">
                                                                        <!--[if BLOCK]><![endif]-->                                        2.350 TL
                                    <!--[if ENDBLOCK]><![endif]-->
                                </p>

                                
                                <div class="flex items-center gap-2 mt-2">
                                    <button wire:click="decreaseQuantity(54)" class="w-6 h-6 flex items-center justify-center bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 rounded transition-colors">
                                        <i class="fas fa-minus text-xs"></i>
                                    </button>
                                    <span class="text-sm font-medium text-gray-900 dark:text-white px-2">
                                        2
                                    </span>
                                    <button wire:click="increaseQuantity(54)" class="w-6 h-6 flex items-center justify-center bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 rounded transition-colors">
                                        <i class="fas fa-plus text-xs"></i>
                                    </button>
                                    <button wire:click="removeItem(54)" class="ml-auto text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300">
                                        <i class="fas fa-trash text-sm"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                                            <div wire:key="cart-item-55" class="flex gap-3 p-2 hover:bg-gray-50 dark:hover:bg-gray-700/50 rounded-lg transition-colors">
                            
                            <!--[if BLOCK]><![endif]-->                                <div class="w-16 h-16 bg-gray-200 dark:bg-gray-700 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-box text-gray-400"></i>
                                </div>
                            <!--[if ENDBLOCK]><![endif]-->

                            
                            <div class="flex-1 min-w-0">
                                <h4 class="text-sm font-medium text-gray-900 dark:text-white truncate">
                                    Ä°XTÄ°F F4 - 1.5 Ton Li-Ion Transpalet
                                </h4>
                                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">
                                                                        <!--[if BLOCK]><![endif]-->                                        1.250 TL
                                    <!--[if ENDBLOCK]><![endif]-->
                                </p>

                                
                                <div class="flex items-center gap-2 mt-2">
                                    <button wire:click="decreaseQuantity(55)" class="w-6 h-6 flex items-center justify-center bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 rounded transition-colors">
                                        <i class="fas fa-minus text-xs"></i>
                                    </button>
                                    <span class="text-sm font-medium text-gray-900 dark:text-white px-2">
                                        1
                                    </span>
                                    <button wire:click="increaseQuantity(55)" class="w-6 h-6 flex items-center justify-center bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 rounded transition-colors">
                                        <i class="fas fa-plus text-xs"></i>
                                    </button>
                                    <button wire:click="removeItem(55)" class="ml-auto text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300">
                                        <i class="fas fa-trash text-sm"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                                            <div wire:key="cart-item-56" class="flex gap-3 p-2 hover:bg-gray-50 dark:hover:bg-gray-700/50 rounded-lg transition-colors">
                            
                            <!--[if BLOCK]><![endif]-->                                <div class="w-16 h-16 bg-gray-200 dark:bg-gray-700 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-box text-gray-400"></i>
                                </div>
                            <!--[if ENDBLOCK]><![endif]-->

                            
                            <div class="flex-1 min-w-0">
                                <h4 class="text-sm font-medium text-gray-900 dark:text-white truncate">
                                    Ä°XTÄ°F EPT20-20ETC - 2.0 Ton SoÄŸuk Depo Transpalet
                                </h4>
                                <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">
                                                                        <!--[if BLOCK]><![endif]-->                                        3.100 TL
                                    <!--[if ENDBLOCK]><![endif]-->
                                </p>

                                
                                <div class="flex items-center gap-2 mt-2">
                                    <button wire:click="decreaseQuantity(56)" class="w-6 h-6 flex items-center justify-center bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 rounded transition-colors">
                                        <i class="fas fa-minus text-xs"></i>
                                    </button>
                                    <span class="text-sm font-medium text-gray-900 dark:text-white px-2">
                                        1
                                    </span>
                                    <button wire:click="increaseQuantity(56)" class="w-6 h-6 flex items-center justify-center bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 rounded transition-colors">
                                        <i class="fas fa-plus text-xs"></i>
                                    </button>
                                    <button wire:click="removeItem(56)" class="ml-auto text-red-600 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300">
                                        <i class="fas fa-trash text-sm"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    <!--[if ENDBLOCK]><![endif]-->
                </div>

                
                <div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
                    <div class="flex justify-between items-center mb-3">
                        <span class="text-sm font-medium text-gray-600 dark:text-gray-400">
                            Toplam:
                        </span>
                        <span class="text-lg font-bold text-gray-900 dark:text-white">
                                                        <!--[if BLOCK]><![endif]-->                                16.500 TL
                            <!--[if ENDBLOCK]><![endif]-->
                        </span>
                    </div>
                    <a href="https://ixtif.com/cart" class="block w-full py-2 px-4 bg-primary-600 hover:bg-primary-700 text-white text-center rounded-lg font-medium transition-colors">
                        Sepeti GÃ¶rÃ¼ntÃ¼le
                    </a>
                </div>
            <!--[if ENDBLOCK]><![endif]-->
        </div>
    </div>
</div>