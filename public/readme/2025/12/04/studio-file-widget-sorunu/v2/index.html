<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Studio FILE Widget Sorunu - Dinamik vs Statik</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            line-height: 1.7;
            padding: 40px 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            margin-bottom: 50px;
            padding-bottom: 30px;
            border-bottom: 2px solid #334155;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #60a5fa, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .meta {
            color: #94a3b8;
            font-size: 0.95rem;
        }

        section {
            margin-bottom: 40px;
        }

        h2 {
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: #60a5fa;
        }

        h3 {
            font-size: 1.3rem;
            margin-bottom: 15px;
            margin-top: 30px;
            color: #93c5fd;
        }

        .flow-diagram {
            background: rgba(30, 41, 59, 0.5);
            padding: 30px;
            border-radius: 12px;
            margin: 30px 0;
        }

        .flow-step {
            background: rgba(59, 130, 246, 0.1);
            border-left: 4px solid #3b82f6;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
        }

        .flow-step h4 {
            color: #60a5fa;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .flow-arrow {
            text-align: center;
            color: #60a5fa;
            font-size: 2rem;
            margin: 10px 0;
        }

        .code-block {
            background: rgba(15, 23, 42, 0.8);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
        }

        .code-block code {
            color: #fbbf24;
        }

        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .comparison-item {
            padding: 20px;
            border-radius: 8px;
        }

        .dynamic {
            background: rgba(16, 185, 129, 0.1);
            border: 2px solid #10b981;
        }

        .static {
            background: rgba(59, 130, 246, 0.1);
            border: 2px solid #3b82f6;
        }

        .dynamic h5 {
            color: #10b981;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .static h5 {
            color: #60a5fa;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .problem-box {
            background: rgba(239, 68, 68, 0.1);
            border-left: 4px solid #ef4444;
            padding: 25px;
            margin: 20px 0;
            border-radius: 8px;
        }

        .problem-box h4 {
            color: #f87171;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .solution-box {
            background: rgba(30, 41, 59, 0.5);
            padding: 25px;
            margin-bottom: 20px;
            border-radius: 12px;
            border-left: 4px solid #10b981;
        }

        .solution-box h4 {
            color: #10b981;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        ul {
            margin-left: 20px;
            margin-top: 10px;
        }

        li {
            margin-bottom: 8px;
            color: #cbd5e1;
        }

        .highlight {
            background: rgba(251, 191, 36, 0.2);
            padding: 2px 8px;
            border-radius: 4px;
            color: #fbbf24;
            font-weight: 600;
        }

        .warning-box {
            background: rgba(245, 158, 11, 0.1);
            border: 2px solid #f59e0b;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
        }

        .warning-box strong {
            color: #fbbf24;
        }

        footer {
            margin-top: 60px;
            padding-top: 30px;
            border-top: 1px solid #334155;
            color: #64748b;
            font-size: 0.9rem;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¯ Studio FILE Widget Sorunu v2</h1>
            <div class="meta">
                ğŸ“… Tarih: 2025-12-04 |
                ğŸ¯ Konu: Dinamik vs Statik - Studio'nun GerÃ§ek MantÄ±ÄŸÄ± |
                âš¡ KRÄ°TÄ°K BÄ°LGÄ°
            </div>
        </header>

        <!-- STUDIO Ã‡ALIÅMA MANTIÄI -->
        <section>
            <h2>âš¡ Studio NasÄ±l Ã‡alÄ±ÅŸÄ±yor? (KRÄ°TÄ°K!)</h2>

            <div class="warning-box">
                <strong>EN Ã–NEMLÄ° BÄ°LGÄ°:</strong> Studio, widget'larÄ± AJAX/Livewire ile dinamik yÃ¼kler, ama kaydet deyince statik HTML'e Ã§evirir!
            </div>

            <div class="flow-diagram">
                <div class="flow-step">
                    <h4>1ï¸âƒ£ Studio EditÃ¶rde (Dinamik)</h4>
                    <ul>
                        <li>Widget AJAX/Livewire ile yÃ¼kleniyor</li>
                        <li>GerÃ§ek veriler gÃ¶steriliyor</li>
                        <li>KullanÄ±cÄ± dÃ¼zenliyor, deÄŸiÅŸtiriyor</li>
                        <li>Her deÄŸiÅŸiklikte widget yeniden render ediliyor</li>
                    </ul>
                    <div class="code-block">
<code>&lt;!-- Studio'da dinamik widget --&gt;
&lt;div class="widget-embed" data-tenant-widget-id="5"&gt;
    &lt;!-- AJAX ile yÃ¼kleniyor --&gt;
    &lt;script&gt;
        fetch('/admin/widgetmanagement/preview/embed/5')
            .then(html => container.innerHTML = html)
    &lt;/script&gt;
&lt;/div&gt;</code>
                    </div>
                </div>

                <div class="flow-arrow">â¬‡ï¸ KAYDET BUTONU â¬‡ï¸</div>

                <div class="flow-step">
                    <h4>2ï¸âƒ£ Kaydet (Dinamik â†’ Statik DÃ¶nÃ¼ÅŸÃ¼m)</h4>
                    <ul>
                        <li>Studio, sayfanÄ±n o anki HALÄ°NÄ° alÄ±yor</li>
                        <li>TÃ¼m widget'lar render edilmiÅŸ HTML olarak kaydediliyor</li>
                        <li>AJAX/Livewire kodlarÄ± kaldÄ±rÄ±lÄ±yor</li>
                        <li>Sadece statik HTML database'e yazÄ±lÄ±yor</li>
                    </ul>
                    <div class="code-block">
<code>&lt;!-- Kaydedilen statik HTML --&gt;
&lt;section class="hero"&gt;
    &lt;h1&gt;EndÃ¼striyel Ekipman Ã‡Ã¶zÃ¼mleri&lt;/h1&gt;
    &lt;p&gt;Forklift, transpalet ve endÃ¼striyel ekipman...&lt;/p&gt;
    &lt;a href="/urunler"&gt;Hemen KeÅŸfet&lt;/a&gt;
&lt;/section&gt;</code>
                    </div>
                </div>

                <div class="flow-arrow">â¬‡ï¸ SÄ°TE'DE GÃ–STER â¬‡ï¸</div>

                <div class="flow-step">
                    <h4>3ï¸âƒ£ Site'de (Statik HTML)</h4>
                    <ul>
                        <li>Database'den statik HTML Ã§ekiliyor</li>
                        <li>Direkt ekrana basÄ±lÄ±yor</li>
                        <li>ArtÄ±k AJAX/Livewire yok</li>
                        <li>Sabit, deÄŸiÅŸmez HTML</li>
                    </ul>
                    <div class="code-block">
<code>&lt;!-- Site'de gÃ¶sterilen --&gt;
{{ $page->content }}  &lt;!-- Statik HTML database'den --&gt;</code>
                    </div>
                </div>
            </div>
        </section>

        <!-- SORUN ANALÄ°ZÄ° -->
        <section>
            <h2>ğŸ”¥ FILE Widget Ä°Ã§in Sorun Ne?</h2>

            <div class="comparison">
                <div class="comparison-item dynamic">
                    <h5>âœ… MODULE Widget (Ã‡alÄ±ÅŸÄ±yor)</h5>
                    <ul>
                        <li>Studio'da: AJAX ile yÃ¼kleniyor</li>
                        <li>Backend'den gerÃ§ek veri Ã§ekiyor</li>
                        <li>Kaydet: Render edilmiÅŸ HTML kaydediliyor</li>
                        <li>Site'de: Statik HTML gÃ¶steriliyor</li>
                    </ul>
                </div>

                <div class="comparison-item static">
                    <h5>âŒ FILE Widget (Sorunlu)</h5>
                    <ul>
                        <li>Studio'da: BoÅŸ settings ile yÃ¼kleniyor</li>
                        <li>Widget iÃ§eriÄŸi boÅŸ gÃ¶rÃ¼nÃ¼yor</li>
                        <li>Kaydet: BOÅ HTML kaydediliyor</li>
                        <li>Site'de: BOÅ HTML gÃ¶steriliyor</li>
                    </ul>
                </div>
            </div>

            <div class="problem-box">
                <h4>Ana Sorun</h4>
                <p>FILE widget Studio'da yÃ¼klenirken <code>['settings' => []]</code> boÅŸ array ile render ediliyor.</p>
                <p style="margin-top: 10px;">Settings.json dosyasÄ± okunmuyor, default deÄŸerler yÃ¼klenmiyor.</p>
                <p style="margin-top: 10px;">SonuÃ§: Widget boÅŸ gÃ¶rÃ¼nÃ¼yor â†’ Kaydet deyince boÅŸ HTML kaydediliyor â†’ Site'de de boÅŸ gÃ¶steriliyor!</p>
            </div>
        </section>

        <!-- HERO Ã–RNEÄÄ° -->
        <section>
            <h2>ğŸ’¡ Hero Widget Ã–rneÄŸi - AdÄ±m AdÄ±m</h2>

            <h3>1ï¸âƒ£ Studio'da Hero Widget Ekleme</h3>
            <div class="code-block">
<code>&lt;!-- KullanÄ±cÄ± Studio'dan Hero widget'Ä± drag-drop ediyor --&gt;

// BlockService.php
case 'file':
    $viewPath = 'widgetmanagement::blocks.' . $widget->file_path;
    // âŒ SORUN: BoÅŸ settings!
    $content = View::make($viewPath, ['settings' => []])->render();

// Hero view.blade.php
&lt;h1&gt;
    @if(!empty($settings['title_line1']))  &lt;!-- BoÅŸ! --&gt;
        &lt;span&gt;{{ $settings['title_line1'] }}&lt;/span&gt;  &lt;!-- GÃ¶sterilmiyor --&gt;
    @endif
&lt;/h1&gt;

// SonuÃ§: BoÅŸ bir hero bloku gÃ¶steriliyor!</code>
            </div>

            <h3>2ï¸âƒ£ KullanÄ±cÄ± Kaydet Deyince</h3>
            <div class="code-block">
<code>// Studio, sayfanÄ±n HALÄ°NÄ° alÄ±yor:
&lt;section class="hero"&gt;
    &lt;!-- BoÅŸ! Ã‡Ã¼nkÃ¼ settings boÅŸtu --&gt;
&lt;/section&gt;

// Bu BOÅ HTML database'e kaydediliyor</code>
            </div>

            <h3>3ï¸âƒ£ Site'de GÃ¶sterim</h3>
            <div class="code-block">
<code>// Database'den Ã§ekilen:
&lt;section class="hero"&gt;
    &lt;!-- BoÅŸ! --&gt;
&lt;/section&gt;

// KullanÄ±cÄ± boÅŸ hero gÃ¶rÃ¼yor!</code>
            </div>
        </section>

        <!-- Ã‡Ã–ZÃœM -->
        <section>
            <h2>âœ… Ã‡Ã¶zÃ¼m: FILE Widget'Ä± NasÄ±l DÃ¼zeltmeliyiz?</h2>

            <div class="solution-box">
                <h4>Ã‡Ã¶zÃ¼m 1: BlockService'de Settings YÃ¼kle</h4>
                <p>FILE widget render edilirken settings.json'u oku ve default deÄŸerleri yÃ¼kle</p>
                <div class="code-block">
<code>case 'file':
    if (!empty($widget->file_path)) {
        $viewPath = 'widgetmanagement::blocks.' . $widget->file_path;

        // âœ… Settings.json dosyasÄ±nÄ± oku
        $settingsPath = base_path('Modules/WidgetManagement/resources/views/blocks/'
            . dirname($widget->file_path) . '/settings.json');

        $settings = [];
        if (file_exists($settingsPath)) {
            $settingsSchema = json_decode(file_get_contents($settingsPath), true);

            // Default deÄŸerleri al
            foreach ($settingsSchema as $key => $field) {
                $settings[$key] = $field['default'] ?? '';
            }
        }

        // âœ… GerÃ§ek settings ile render et
        if (View::exists($viewPath)) {
            $content = View::make($viewPath, ['settings' => $settings])->render();
        }
    }
    break;</code>
                </div>
                <p style="margin-top: 15px;"><strong>SonuÃ§:</strong> Studio'da hero widget default deÄŸerlerle gÃ¶sterilir!</p>
            </div>

            <div class="solution-box">
                <h4>Ã‡Ã¶zÃ¼m 2: Studio'da Settings DÃ¼zenleme</h4>
                <p>KullanÄ±cÄ± Studio'da widget'Ä± seÃ§ince â†’ Settings editor gÃ¶ster</p>
                <ul>
                    <li>GrapesJS trait panel kullan</li>
                    <li>Settings.json field'larÄ±nÄ± dinamik form olarak gÃ¶ster</li>
                    <li>KullanÄ±cÄ± deÄŸiÅŸtirince widget'Ä± yeniden render et</li>
                    <li>Kaydet deyince gÃ¼ncel deÄŸerlerle HTML oluÅŸtur</li>
                </ul>
                <div class="code-block">
<code>// GrapesJS Component tanÄ±mÄ±nda
editor.DomComponents.addType('file-widget', {
    model: {
        defaults: {
            traits: [
                {
                    type: 'text',
                    label: 'Ana BaÅŸlÄ±k (1. SatÄ±r)',
                    name: 'title_line1',
                    changeProp: 1
                },
                {
                    type: 'text',
                    label: 'Ana BaÅŸlÄ±k (2. SatÄ±r)',
                    name: 'title_line2',
                    changeProp: 1
                },
                // ... diÄŸer settings.json field'larÄ±
            ]
        }
    }
});</code>
                </div>
                <p style="margin-top: 15px;"><strong>SonuÃ§:</strong> KullanÄ±cÄ± Studio'da settings'leri dÃ¼zenleyebilir!</p>
            </div>

            <div class="solution-box">
                <h4>Ã‡Ã¶zÃ¼m 3: Kaydet SÄ±rasÄ±nda GÃ¼ncel DeÄŸerlerle Render</h4>
                <p>Save butonu tÄ±klanÄ±nca:</p>
                <ul>
                    <li>Widget'Ä±n trait deÄŸerlerini al</li>
                    <li>Bu deÄŸerlerle widget'Ä± yeniden render et</li>
                    <li>Render edilmiÅŸ HTML'i database'e kaydet</li>
                </ul>
                <div class="code-block">
<code>// Studio save sÄ±rasÄ±nda
const widgets = editor.getComponents().find('.file-widget');
widgets.forEach(widget => {
    const traits = widget.getAttributes();

    // Widget'Ä± traits ile yeniden render et
    fetch('/admin/studio/api/render-widget', {
        method: 'POST',
        body: JSON.stringify({
            widget_id: widget.get('widget-id'),
            settings: traits
        })
    })
    .then(html => {
        // Render edilmiÅŸ HTML'i widget'a yerleÅŸtir
        widget.components(html);
    });
});</code>
                </div>
                <p style="margin-top: 15px;"><strong>SonuÃ§:</strong> GÃ¼ncel deÄŸerlerle render edilmiÅŸ HTML kaydedilir!</p>
            </div>
        </section>

        <!-- AKIÅ ÅEMASI -->
        <section>
            <h2>ğŸ”„ DoÄŸru AkÄ±ÅŸ NasÄ±l OlmalÄ±?</h2>

            <div class="flow-diagram">
                <div class="flow-step">
                    <h4>1ï¸âƒ£ Studio'da Widget YÃ¼kleme</h4>
                    <ul>
                        <li>FILE widget drag-drop edilince</li>
                        <li>Settings.json dosyasÄ± okunur</li>
                        <li>Default deÄŸerler yÃ¼klenir</li>
                        <li>Widget dÃ¼zgÃ¼n gÃ¶rÃ¼nÃ¼r</li>
                    </ul>
                </div>

                <div class="flow-arrow">â¬‡ï¸</div>

                <div class="flow-step">
                    <h4>2ï¸âƒ£ KullanÄ±cÄ± Settings DÃ¼zenler</h4>
                    <ul>
                        <li>Widget seÃ§ilince trait panel aÃ§Ä±lÄ±r</li>
                        <li>Settings field'larÄ± form olarak gÃ¶sterilir</li>
                        <li>KullanÄ±cÄ± deÄŸerleri deÄŸiÅŸtirir</li>
                        <li>Widget anÄ±nda gÃ¼ncellenir</li>
                    </ul>
                </div>

                <div class="flow-arrow">â¬‡ï¸</div>

                <div class="flow-step">
                    <h4>3ï¸âƒ£ Kaydet</h4>
                    <ul>
                        <li>Widget'larÄ±n gÃ¼ncel trait deÄŸerleri alÄ±nÄ±r</li>
                        <li>Her widget bu deÄŸerlerle render edilir</li>
                        <li>Render edilmiÅŸ HTML database'e kaydedilir</li>
                    </ul>
                </div>

                <div class="flow-arrow">â¬‡ï¸</div>

                <div class="flow-step">
                    <h4>4ï¸âƒ£ Site'de GÃ¶sterim</h4>
                    <ul>
                        <li>Database'den statik HTML Ã§ekilir</li>
                        <li>GÃ¼ncel deÄŸerlerle render edilmiÅŸ iÃ§erik gÃ¶sterilir</li>
                        <li>KullanÄ±cÄ± doÄŸru iÃ§eriÄŸi gÃ¶rÃ¼r</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- SONUÃ‡ -->
        <section>
            <h2>ğŸ¯ Ã–zet</h2>

            <div class="warning-box">
                <strong>Kritik Bilgi:</strong> Studio, widget'larÄ± AJAX/Livewire ile dinamik yÃ¼kler ama kaydet deyince statik HTML'e Ã§evirir. FILE widget'lar iÃ§in settings.json mutlaka okunmalÄ± ve default deÄŸerlerle render edilmeli!
            </div>

            <h3>YapÄ±lacaklar:</h3>
            <div class="solution-box">
                <ul>
                    <li><strong>1. BlockService â†’ Settings YÃ¼kleme:</strong> FILE widget render edilirken settings.json oku</li>
                    <li><strong>2. Studio â†’ Settings Editor:</strong> GrapesJS trait panel ile settings dÃ¼zenleme ekle</li>
                    <li><strong>3. Save â†’ GÃ¼ncel Render:</strong> Kaydet sÄ±rasÄ±nda widget'Ä± gÃ¼ncel deÄŸerlerle render et</li>
                    <li><strong>4. BoÅŸ Widget'larÄ± Tamamla:</strong> Hero-1, simple, contact-form iÃ§in settings.json oluÅŸtur</li>
                </ul>
            </div>

            <p style="margin-top: 20px; color: #cbd5e1;">
                Bu ÅŸekilde hem Studio'da dÃ¼zgÃ¼n gÃ¶rÃ¼nÃ¼r, hem kullanÄ±cÄ± dÃ¼zenleyebilir, hem de site'de doÄŸru iÃ§erik gÃ¶sterilir.
            </p>
        </section>

        <footer>
            ğŸ¤– Claude AI tarafÄ±ndan oluÅŸturuldu | 2025-12-04 | v2 - Dinamik vs Statik
        </footer>
    </div>
</body>
</html>
