<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kurumsal Hesap Yapısı - Güncel Mimari (v2)</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            font-family: -apple-system, BlinkMacSystemFont, Segoe UI, system-ui, sans-serif;
            line-height: 1.7;
            padding: 40px 20px;
            min-height: 100vh;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        header { margin-bottom: 40px; padding-bottom: 30px; border-bottom: 2px solid #334155; }
        h1 { font-size: 2.2rem; font-weight: 700; margin-bottom: 15px; background: linear-gradient(135deg, #8b5cf6, #6366f1); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .meta { color: #94a3b8; font-size: 0.9rem; }
        h2 { font-size: 1.5rem; margin: 30px 0 20px; color: #60a5fa; }
        h3 { font-size: 1.2rem; color: #f59e0b; margin: 20px 0 15px; }

        .approach-box {
            background: rgba(30, 41, 59, 0.6);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid #334155;
        }
        .approach-box.recommended {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }
        .approach-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .badge-recommended { background: #10b981; color: white; }

        .schema-box {
            background: #1e293b;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: Monaco, Menlo, monospace;
            font-size: 0.85rem;
            overflow-x: auto;
        }
        .schema-box .table-name { color: #f472b6; font-weight: 600; }
        .schema-box .column { color: #a5f3fc; }
        .schema-box .comment { color: #64748b; }
        .schema-box .highlight { color: #fbbf24; }
        .schema-box .exists { color: #10b981; }

        .feature-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .feature-table th, .feature-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #334155;
        }
        .feature-table th {
            background: rgba(59, 130, 246, 0.1);
            color: #60a5fa;
            font-weight: 600;
        }
        .feature-table td { color: #cbd5e1; }

        .use-case {
            background: rgba(139, 92, 246, 0.1);
            border-left: 4px solid #8b5cf6;
            padding: 15px 20px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        .use-case h4 { color: #a78bfa; margin-bottom: 8px; }
        .use-case p { color: #cbd5e1; font-size: 0.9rem; margin: 0; }

        .info-box {
            background: rgba(59, 130, 246, 0.1);
            border: 2px solid #3b82f6;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .info-box h4 { color: #60a5fa; margin-bottom: 10px; }
        .info-box p { color: #cbd5e1; margin: 0; }

        .summary-box {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(16, 185, 129, 0.05));
            border: 2px solid #10b981;
            border-radius: 16px;
            padding: 30px;
            margin: 30px 0;
        }
        .summary-box h3 { color: #10b981; margin-top: 0; }

        .relation-diagram {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        footer {
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid #334155;
            color: #64748b;
            font-size: 0.85rem;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Kurumsal Hesap Yapısı - Güncel Mimari</h1>
            <div class="meta">
                Tarih: 2025-11-24 | Platform: Muzibu | v2 - Fatura Adresleri Ayrı Tablo
            </div>
        </header>

        <!-- GÜNCEL MİMARİ -->
        <div class="approach-box recommended">
            <div class="approach-title">
                <span class="badge badge-recommended">GÜNCEL MİMARİ</span>
                Self-Referencing + Mevcut Adres Sistemi
            </div>

            <p style="color: #cbd5e1; margin-bottom: 20px;">
                Fatura adresleri <strong style="color: #10b981;">cart_addresses</strong> tablosunda tutulacak.
                Bu tablo zaten sistemde mevcut ve tüm adres yönetimini karşılıyor.
            </p>

            <h4 style="color: #60a5fa; margin: 20px 0 10px;">1. Kurumsal Hesaplar Tablosu</h4>
            <div class="schema-box">
<pre style="margin: 0; font-family: inherit;"><span class="table-name">muzibu_corporate_accounts</span>
├── <span class="column">id</span> (PK)
├── <span class="column">user_id</span> <span class="comment">-- Bu kaydın sahibi user</span>
├── <span class="column highlight">parent_id</span> <span class="comment">-- NULL = kurum, değer = üst kuruma bağlı üye</span>
├── <span class="column">corporate_code</span> <span class="comment">-- Davet kodu (sadece kurum)</span>
├── <span class="column">company_name</span> <span class="comment">-- Şirket adı (sadece kurum)</span>
├── <span class="column">max_members</span> <span class="comment">-- Üye limiti (sadece kurum)</span>
└── <span class="column">is_active</span>

<span class="comment">-- users tablosu HİÇ DEĞİŞMEZ (universal)</span>
<span class="comment">-- Fatura bilgileri cart_addresses tablosunda</span></pre>
            </div>

            <h4 style="color: #60a5fa; margin: 20px 0 10px;">2. Adres Tablosu (Mevcut)</h4>
            <div class="schema-box">
<pre style="margin: 0; font-family: inherit;"><span class="table-name exists">cart_addresses</span> <span class="exists">✓ MEVCUT</span>
├── <span class="column">address_id</span> (PK)
├── <span class="column">user_id</span> <span class="comment">-- Adres sahibi (FK → users)</span>
├── <span class="column highlight">address_type</span> <span class="comment">-- billing, shipping, both</span>
├── <span class="column">title</span> <span class="comment">-- Ev, İş, Kurumsal vb.</span>
├── <span class="column">first_name</span>, <span class="column">last_name</span>
├── <span class="column">company_name</span> <span class="comment">-- Şirket adı</span>
├── <span class="column highlight">tax_office</span> <span class="comment">-- Vergi dairesi</span>
├── <span class="column highlight">tax_number</span> <span class="comment">-- Vergi numarası</span>
├── <span class="column">phone</span>, <span class="column">email</span>
├── <span class="column">address_line_1</span>, <span class="column">address_line_2</span>
├── <span class="column">neighborhood</span>, <span class="column">district</span>, <span class="column">city</span>
├── <span class="column">postal_code</span>, <span class="column">country_code</span>
├── <span class="column">is_default_billing</span> <span class="comment">-- Varsayılan fatura adresi</span>
├── <span class="column">is_default_shipping</span> <span class="comment">-- Varsayılan teslimat adresi</span>
└── <span class="column">delivery_notes</span></pre>
            </div>
        </div>

        <!-- İLİŞKİ DİYAGRAMI -->
        <h2>İlişki Yapısı</h2>

        <div class="relation-diagram">
            <div class="schema-box">
<pre style="margin: 0; font-family: inherit;"><span class="comment">┌─────────────────────────────────────────────────────┐</span>
<span class="comment">│</span>  <span class="table-name">users</span> <span class="comment">(Universal - değişmez)</span>                      <span class="comment">│</span>
<span class="comment">│</span>  ├── id, name, email...                            <span class="comment">│</span>
<span class="comment">│</span>  └── subscription_id (abonelik)                    <span class="comment">│</span>
<span class="comment">└──────────────┬──────────────────────────────────────┘</span>
               │
      ┌────────┴────────┐
      ▼                 ▼
<span class="comment">┌──────────────┐    ┌────────────────────┐</span>
<span class="comment">│</span> <span class="table-name">cart_addresses</span> <span class="comment">│    │</span> <span class="table-name">muzibu_corporate</span>    <span class="comment">│</span>
<span class="comment">│</span> (Fatura/Adres) <span class="comment">│    │</span> <span class="table-name">_accounts</span>           <span class="comment">│</span>
<span class="comment">│</span>              <span class="comment">│    │</span>                    <span class="comment">│</span>
<span class="comment">│</span> user_id (FK) <span class="comment">│    │</span> user_id (FK)       <span class="comment">│</span>
<span class="comment">│</span> address_type <span class="comment">│    │</span> <span class="highlight">parent_id</span> (Self)  <span class="comment">│</span>
<span class="comment">│</span> tax_office   <span class="comment">│    │</span> corporate_code     <span class="comment">│</span>
<span class="comment">│</span> tax_number   <span class="comment">│    │</span> company_name       <span class="comment">│</span>
<span class="comment">│</span> company_name <span class="comment">│    │</span> max_members        <span class="comment">│</span>
<span class="comment">└──────────────┘    └────────────────────┘</span>

<span class="comment">Kurum Sahibi:</span>
  <span class="exists">→ parent_id = NULL</span>
  <span class="exists">→ Kendi user_id si ile cart_addresses de fatura adresi var</span>

<span class="comment">Kurumsal Üye:</span>
  <span class="highlight">→ parent_id = kurum_id</span>
  <span class="highlight">→ Fatura için parent ın owner user ının adresi kullanılır</span></pre>
            </div>
        </div>

        <!-- ÖRNEK VERİ -->
        <h2>Örnek Veri Akışı</h2>

        <table class="feature-table">
            <tr>
                <th colspan="6" style="background: rgba(139, 92, 246, 0.2); color: #a78bfa;">
                    muzibu_corporate_accounts
                </th>
            </tr>
            <tr>
                <th>id</th>
                <th>user_id</th>
                <th>parent_id</th>
                <th>corporate_code</th>
                <th>company_name</th>
                <th>Tip</th>
            </tr>
            <tr>
                <td>1</td>
                <td>5</td>
                <td>NULL</td>
                <td>ABC123</td>
                <td>Acme Ltd</td>
                <td style="color: #10b981;">Kurum Sahibi</td>
            </tr>
            <tr>
                <td>2</td>
                <td>10</td>
                <td>1</td>
                <td>NULL</td>
                <td>NULL</td>
                <td style="color: #60a5fa;">Üye</td>
            </tr>
            <tr>
                <td>3</td>
                <td>12</td>
                <td>1</td>
                <td>NULL</td>
                <td>NULL</td>
                <td style="color: #60a5fa;">Üye</td>
            </tr>
        </table>

        <table class="feature-table">
            <tr>
                <th colspan="5" style="background: rgba(16, 185, 129, 0.2); color: #10b981;">
                    cart_addresses (Kurum sahibinin fatura adresi)
                </th>
            </tr>
            <tr>
                <th>user_id</th>
                <th>address_type</th>
                <th>company_name</th>
                <th>tax_office</th>
                <th>tax_number</th>
            </tr>
            <tr>
                <td>5</td>
                <td>billing</td>
                <td>Acme Ltd</td>
                <td>Kadıköy VD</td>
                <td>1234567890</td>
            </tr>
        </table>

        <!-- KULLANIM SENARYOLARI -->
        <h2>Kullanım Senaryoları</h2>

        <div class="use-case">
            <h4>1. Kurum Sahibinin Fatura Bilgilerini Al</h4>
            <p>
                Kurum kaydını bul (parent_id = NULL) → user_id yi al →
                cart_addresses tablosundan address_type = billing olan kaydı çek
            </p>
        </div>

        <div class="use-case">
            <h4>2. Üyenin Kurumsal Fatura Bilgilerini Al</h4>
            <p>
                Üyenin kaydını bul → parent_id ile kurumu bul →
                Kurumun user_id si ile cart_addresses ten fatura adresini çek
            </p>
        </div>

        <div class="use-case">
            <h4>3. Toplu Fatura Listesi (Tüm Kurumlar)</h4>
            <p>
                parent_id = NULL olan kurumları çek → Her birinin user_id si ile
                cart_addresses JOIN yaparak fatura bilgilerini listele
            </p>
        </div>

        <div class="use-case">
            <h4>4. Kurum Sahibi Fatura Adresini Günceller</h4>
            <p>
                cart_addresses tablosunda kendi user_id si ile günceller →
                Tüm üyeler otomatik olarak bu adresi kullanır
            </p>
        </div>

        <!-- AVANTAJLAR -->
        <h2>Bu Mimarinin Avantajları</h2>

        <div class="info-box">
            <h4>✓ Mevcut Sistemi Kullanır</h4>
            <p>cart_addresses zaten var, yeni tablo oluşturmaya gerek yok. Tax_office, tax_number gibi alanlar hazır.</p>
        </div>

        <div class="info-box">
            <h4>✓ Tek Noktadan Güncelleme</h4>
            <p>Kurum sahibi fatura adresini güncellediğinde tüm üyeler için geçerli olur. Tutarsızlık riski yok.</p>
        </div>

        <div class="info-box">
            <h4>✓ Sipariş Sistemiyle Uyumlu</h4>
            <p>cart_orders tablosu zaten cart_addresses ile çalışıyor. Kurumsal siparişlerde aynı altyapı kullanılır.</p>
        </div>

        <div class="info-box">
            <h4>✓ users Tablosu Universal</h4>
            <p>Hiçbir tenant-specific kolon eklenmez. Diğer tenantlar etkilenmez.</p>
        </div>

        <!-- ÖZET -->
        <div class="summary-box">
            <h3>Sonuç</h3>
            <ul style="color: #cbd5e1; padding-left: 20px; line-height: 2;">
                <li><strong>Kurum bilgileri:</strong> muzibu_corporate_accounts (parent_id mimarisi)</li>
                <li><strong>Fatura adresleri:</strong> cart_addresses (mevcut tablo)</li>
                <li><strong>Üye için fatura:</strong> Parent kurumun sahibinin adresi kullanılır</li>
                <li><strong>users tablosu:</strong> Hiç değişmez (universal)</li>
            </ul>
        </div>

        <!-- SONRAKI ADIMLAR -->
        <h2>Sonraki Adımlar</h2>
        <div style="background: rgba(59, 130, 246, 0.1); border: 2px solid #3b82f6; border-radius: 12px; padding: 20px;">
            <ol style="color: #cbd5e1; padding-left: 20px; line-height: 2;">
                <li>CorporateService güncelle - getBillingAddress() metodu ekle</li>
                <li>Model güncelle - billingAddress() relationship ekle</li>
                <li>Admin UI - Kurum sahibi için fatura adresi yönetimi</li>
                <li>Sipariş akışı - Kurumsal üye siparişinde otomatik adres seçimi</li>
            </ol>
        </div>

        <footer>Claude AI | Kurumsal Hesap Mimarisi v2 | 2025-11-24</footer>
    </div>
</body>
</html>
