-- ================================================
-- TENANT DB SEED DATA - Conversation Flows
-- ================================================
-- AMAÃ‡: Tenant-specific AI conversation flows (tenant DB'de)
-- DURUM: ONAYLANDI - FINAL KARAR (2025-11-08)
-- NOT: Her tenant BAGIMSIZ, farklÄ± sektÃ¶r, farklÄ± akÄ±ÅŸ!
-- ================================================

/*!40101 SET @saved_cs_client     = @@character_set_client */;
/*!50503 SET character_set_client = utf8mb4 */;
CREATE TABLE IF NOT EXISTS `tenant_conversation_flows` (
  `id` bigint unsigned NOT NULL AUTO_INCREMENT COMMENT 'AkÄ±ÅŸ ID - Benzersiz tanÄ±mlayÄ±cÄ±',
  `tenant_id` int unsigned NOT NULL COMMENT 'Hangi tenant (Ã¶rn: 2=ixtif.com, 3=diÄŸer)',
  `flow_name` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'AkÄ±ÅŸ adÄ± - Admin panelde gÃ¶rÃ¼nen isim (Ã¶rn: "E-Ticaret SatÄ±ÅŸ AkÄ±ÅŸÄ±")',
  `flow_description` text COLLATE utf8mb4_unicode_ci COMMENT 'AkÄ±ÅŸ aÃ§Ä±klamasÄ± - Admin iÃ§in bilgi notu, kullanÄ±cÄ± gÃ¶rmez',
  `flow_data` json NOT NULL COMMENT 'TÃ¼m akÄ±ÅŸ yapÄ±sÄ±: nodes (kutucuklar), edges (baÄŸlantÄ±lar), positions - Drawflow JSON',
  `start_node_id` varchar(50) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'Ä°lk Ã§alÄ±ÅŸacak node ID - AkÄ±ÅŸ buradan baÅŸlar (Ã¶rn: "node_greeting_1")',
  `is_active` tinyint(1) NOT NULL DEFAULT '1' COMMENT 'Aktif mi? 1=kullanÄ±mda, 0=devre dÄ±ÅŸÄ± (sadece aktif olanlar Ã§alÄ±ÅŸÄ±r)',
  `priority` int NOT NULL DEFAULT '0' COMMENT 'Ã–ncelik - Birden fazla aktif flow varsa en dÃ¼ÅŸÃ¼k sayÄ± Ã§alÄ±ÅŸÄ±r (0 en yÃ¼ksek Ã¶ncelik)',
  `created_by` bigint unsigned DEFAULT NULL COMMENT 'AkÄ±ÅŸÄ± oluÅŸturan admin user ID - users tablosundan',
  `updated_by` bigint unsigned DEFAULT NULL COMMENT 'Son gÃ¼ncelleyen admin user ID - users tablosundan',
  `created_at` timestamp NULL DEFAULT NULL,
  `updated_at` timestamp NULL DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `tenant_conversation_flows_tenant_id_is_active_index` (`tenant_id`,`is_active`),
  KEY `tenant_conversation_flows_tenant_id_priority_index` (`tenant_id`,`priority`)
) ENGINE=InnoDB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;
/*!40101 SET character_set_client = @saved_cs_client */;

-- ================================================
-- Ä°XTÄ°F.COM AI CONVERSATION FLOW
-- ================================================
-- AÃ‡IKLAMA: Ä°xtif Ã¶zel AI asistan akÄ±ÅŸÄ±
-- - Global kurallar + Ä°xtif satÄ±ÅŸ tonu (coÅŸkulu, SÄ°Z hitabÄ±, Ã¶nce Ã¼rÃ¼n gÃ¶ster)
-- - 14 node, 18 edge - Tam Ã§alÄ±ÅŸan production akÄ±ÅŸÄ±
-- ================================================

INSERT INTO `tenant_conversation_flows` VALUES
(6,2,'Ä°xtif AI Assistant','Ä°xtif Ã¶zel AI asistan - Global kurallar + Ä°xtif satÄ±ÅŸ tonu (coÅŸkulu, SÄ°Z hitabÄ±, Ã¶nce Ã¼rÃ¼n gÃ¶ster)','{\"edges\": [{\"id\": \"edge_1_2\", \"source\": \"node_1\", \"target\": \"node_2\"}, {\"id\": \"edge_2_3\", \"source\": \"node_2\", \"target\": \"node_3\"}, {\"id\": \"edge_3_4\", \"source\": \"node_3\", \"target\": \"node_4\"}, {\"id\": \"edge_3_4\", \"source\": \"node_3\", \"target\": \"node_4\"}, {\"id\": \"edge_3_9\", \"source\": \"node_3\", \"target\": \"node_9\"}, {\"id\": \"edge_3_11\", \"source\": \"node_3\", \"target\": \"node_11\"}, {\"id\": \"edge_3_9\", \"source\": \"node_3\", \"target\": \"node_9\"}, {\"id\": \"edge_4_5\", \"source\": \"node_4\", \"target\": \"node_5\"}, {\"id\": \"edge_5_6\", \"source\": \"node_5\", \"target\": \"node_6\"}, {\"id\": \"edge_5_7\", \"source\": \"node_5\", \"target\": \"node_7\"}, {\"id\": \"edge_6_8\", \"source\": \"node_6\", \"target\": \"node_8\"}, {\"id\": \"edge_7_8\", \"source\": \"node_7\", \"target\": \"node_8\"}, {\"id\": \"edge_8_9\", \"source\": \"node_8\", \"target\": \"node_9\"}, {\"id\": \"edge_9_10\", \"source\": \"node_9\", \"target\": \"node_10\"}, {\"id\": \"edge_10_12\", \"source\": \"node_10\", \"target\": \"node_12\"}, {\"id\": \"edge_11_10\", \"source\": \"node_11\", \"target\": \"node_10\"}, {\"id\": \"edge_12_13\", \"source\": \"node_12\", \"target\": \"node_13\"}, {\"id\": \"edge_13_14\", \"source\": \"node_13\", \"target\": \"node_14\"}], \"nodes\": [{\"id\": \"node_1\", \"name\": \"KarÅŸÄ±lama\", \"type\": \"welcome\", \"class\": \"\", \"config\": {\"next_node\": \"node_2\", \"suggestions\": [\"ÃœrÃ¼n ara\", \"Fiyat bilgisi\", \"Ä°letiÅŸim\"], \"welcome_message\": \"Merhaba! Size nasÄ±l yardÄ±mcÄ± olabilirim?\", \"show_suggestions\": true}, \"position\": {\"x\": 91, \"y\": 62}}, {\"id\": \"node_2\", \"name\": \"GeÃ§miÅŸ YÃ¼kle\", \"type\": \"history_loader\", \"class\": \"\", \"config\": {\"limit\": 10, \"order\": \"asc\", \"next_node\": \"node_3\", \"include_system_messages\": false}, \"position\": {\"x\": 95, \"y\": 185}}, {\"id\": \"node_3\", \"name\": \"Niyet Analizi\", \"type\": \"sentiment_detection\", \"class\": \"\", \"config\": {\"next_node\": \"node_4\", \"sentiment_routes\": {\"browsing\": \"node_9\", \"question\": \"node_9\", \"comparison\": \"node_4\", \"purchase_intent\": \"node_4\", \"support_request\": \"node_11\"}, \"default_next_node\": \"node_9\"}, \"position\": {\"x\": 100, \"y\": 300}}, {\"id\": \"node_4\", \"name\": \"Kategori Tespit\", \"type\": \"category_detection\", \"class\": \"\", \"config\": {\"next_node\": \"node_5\", \"category_questions\": {\"forklift\": [{\"key\": \"capacity\", \"options\": [\"2 ton\", \"3 ton\", \"5 ton\"], \"question\": \"Hangi kapasite forklift arÄ±yorsunuz?\"}, {\"key\": \"fuel\", \"options\": [\"Dizel\", \"Elektrikli\", \"LPG\"], \"question\": \"YakÄ±t tipi?\"}], \"transpalet\": [{\"key\": \"capacity\", \"options\": [\"1.5 ton\", \"2 ton\", \"2.5 ton\", \"3 ton\"], \"question\": \"Hangi kapasite transpalet arÄ±yorsunuz?\"}, {\"key\": \"type\", \"options\": [\"Manuel\", \"Elektrikli\"], \"question\": \"Manuel mi elektrikli mi?\"}]}, \"no_category_next_node\": \"node_6\"}, \"position\": {\"x\": 351, \"y\": 212}}, {\"id\": \"node_5\", \"name\": \"Fiyat Sorgusu mu?\", \"type\": \"condition\", \"class\": \"\", \"config\": {\"keywords\": [\"fiyat\", \"kaÃ§ para\", \"ne kadar\", \"en ucuz\", \"en pahalÄ±\"], \"true_node\": \"node_6\", \"false_node\": \"node_7\", \"condition_type\": \"contains_keywords\"}, \"position\": {\"x\": 619, \"y\": 218}}, {\"id\": \"node_6\", \"name\": \"Fiyat Sorgusu\", \"type\": \"price_query\", \"class\": \"\", \"config\": {\"limit\": 5, \"show_vat\": false, \"vat_rate\": 20, \"next_node\": \"node_8\", \"exclude_categories\": [44], \"no_products_next_node\": \"node_11\"}, \"position\": {\"x\": 916, \"y\": 209}}, {\"id\": \"node_7\", \"name\": \"ÃœrÃ¼n Ara\", \"type\": \"product_search\", \"class\": \"\", \"config\": {\"next_node\": \"node_8\", \"search_limit\": 3, \"sort_by_stock\": true, \"use_meilisearch\": true, \"no_products_next_node\": \"node_11\"}, \"position\": {\"x\": 919, \"y\": 420}}, {\"id\": \"node_8\", \"name\": \"Stok SÄ±rala\", \"type\": \"stock_sorter\", \"class\": \"\", \"config\": {\"next_node\": \"node_9\", \"exclude_out_of_stock\": false, \"high_stock_threshold\": 10}, \"position\": {\"x\": 1239.6666666666667, \"y\": 215}}, {\"id\": \"node_9\", \"name\": \"Context HazÄ±rla\", \"type\": \"context_builder\", \"class\": \"\", \"config\": {\"next_node\": \"node_10\", \"history_limit\": 10, \"include_tenant_directives\": true, \"include_conversation_context\": true, \"include_conversation_history\": true}, \"position\": {\"x\": 1407, \"y\": 338.3333333333333}}, {\"id\": \"node_10\", \"name\": \"AI Cevap Ãœret\", \"type\": \"ai_response\", \"class\": \"\", \"config\": {\"next_node\": \"node_12\", \"max_tokens\": 500, \"temperature\": 0.7, \"system_prompt\": \"Sen Ä°xtif.com satÄ±ÅŸ danÄ±ÅŸmanÄ±sÄ±n. Forklift, transpalet ve istif makineleri satÄ±yorsun.\\n\\nğŸ¯ ANA Ä°ÅÄ°MÄ°Z (EN Ã–NEMLÄ°!):\\nâœ… TAM ÃœRÃœN SATIÅI (Forklift, Transpalet, Ä°stif Makinesi)\\nâœ… EndÃ¼striyel ekipman tanÄ±tÄ±mÄ± ve satÄ±ÅŸÄ±\\nâœ… YEDEK PARÃ‡A: En dÃ¼ÅŸÃ¼k Ã¶ncelik (sadece mÃ¼ÅŸteri isterse)\\n\\nğŸš¨ GÃœVENLÄ°K KURALLARI\\n\\nâŒ ÃœRÃœN UYDURMA YASAÄI:\\n- ASLA Ã¼rÃ¼n/bilgi uydurma!\\n- SADECE veritabanÄ±ndan gelen Ã¼rÃ¼nleri gÃ¶ster\\n- ASLA internetten bilgi alma!\\n\\nâŒ Ä°LETÄ°ÅÄ°M UYDURMA YASAÄI:\\n- ASLA kendi iletiÅŸim bilgisi uyduramazsÄ±n!\\n- SADECE verilen iletiÅŸim bilgilerini kullan\\n- AYNEN KOPYALA!\\n\\nğŸ”— ÃœRÃœN LÄ°NK FORMATI:\\n**{{ÃœRÃœN ADI}}** [LINK:shop:{{slug}}]\\n\\nMUTLAKA:\\n- Ã–nce ** ile Ã¼rÃ¼n adÄ±nÄ± sar\\n- Sonra boÅŸluk\\n- Sonra [LINK:shop:slug]\\n- Slug\'u AYNEN kullan!\\n\\nğŸ“ FORMATLAMA:\\n- Nokta kullanÄ±mÄ±: \\\"3 ton\\\" (3. ton YASAK!)\\n- Liste: Her madde YENÄ° SATIRDA\\n- Title: AYNEN kullan, deÄŸiÅŸtirme!\\n\\nğŸŒŸ SATIÅ TONU (Ä°XTÄ°F Ã–ZEL!):\\n- COÅKULU ve Ã–VÃœCÃœ konuÅŸ!\\n- \'Harika\', \'MÃ¼kemmel\', \'En popÃ¼ler\', \'MuhteÅŸem performans\'\\n- Link vermekten Ã§ekinme, coÅŸkuyla Ã¶ner!\\n- DAIMA **SÄ°Z** kullan (asla \'sen\' deme)\\n- Emoji kullan! (4-5 emoji per mesaj) ğŸ˜Š ğŸ‰ ğŸ’ª âš¡ ğŸ”¥ âœ¨\\n\\nğŸ—£ï¸ SAMÄ°MÄ° KONUÅMA:\\n- \\\"NasÄ±lsÄ±n?\\\" â†’ \\\"Ä°yiyim teÅŸekkÃ¼rler! ğŸ˜Š Size nasÄ±l yardÄ±mcÄ± olabilirim?\\\"\\n- \\\"Merhaba\\\" â†’ \\\"Merhaba! ğŸ‰ Size yardÄ±mcÄ± olmaktan mutluluk duyarÄ±m!\\\"\\n- \\\"NasÄ±l\\\" â†’ BaÄŸlama gÃ¶re yanÄ±t ver (Ã¼rÃ¼n mÃ¼ soru mu?)\\n- ROBOT GÄ°BÄ° KONUÅMA! Samimi ve arkadaÅŸÃ§a ol!\\n\\nğŸš¨ MEGA KRÄ°TÄ°K: Ã–NCE ÃœRÃœN GÃ–STER!\\nâŒ ASLA Ã¶nce soru sor, sonra Ã¼rÃ¼n gÃ¶ster!\\nâœ… DAIMA Ã¶nce 3-5 Ã¼rÃ¼n gÃ¶ster, SONRA soru sor!\\n\\nZORUNLU SIRALAMA:\\n1. MÃ¼ÅŸteri \'transpalet\', \'forklift\' sÃ¶yler\\n2. SEN HEMEN 3-5 ÃœRÃœN LÄ°NKÄ° GÃ–STER!\\n3. ÃœrÃ¼nleri Ã–VER! (Harika!, MÃ¼kemmel!)\\n4. FiyatlarÄ± gÃ¶ster!\\n5. ANCAK SONRA soru sor: \'Hangi kapasite?\'\\n\\nğŸ“ SORU FORMAT:\\nBirden fazla soru sorarken HTML liste kullan:\\n<ul>\\n<li>KaÃ§ ton taÅŸÄ±ma kapasitesi?</li>\\n<li>Manuel mi elektrikli mi?</li>\\n</ul>\\n\\nğŸš¨ KATEGORÄ° KARIÅTIRMA YASAK!\\nMÃ¼ÅŸteri hangi kategoriyi sÃ¶ylerse SADECE O kategoriden Ã¼rÃ¼n Ã¶ner!\\n\\nKATEGORLER:\\n1. TRANSPALET: Zemin seviyesi, palet taÅŸÄ±ma\\n2. FORKLIFT: YÃ¼ksek kaldÄ±rma, dikey istifleme\\n3. Ä°STÄ°F MAKÄ°NESÄ°: Sadece dikey istifleme\\n4. REACH TRUCK: Ã‡ok yÃ¼ksek kaldÄ±rma, teleskopik\\n5. PLATFORM: OperatÃ¶r + yÃ¼k yÃ¼kselir\\n6. TOW TRACTOR: RÃ¶mork Ã§ekme\\n7. YEDEK PARÃ‡A: Sadece mÃ¼ÅŸteri isterse (EN DÃœÅÃœK Ã–NCELÄ°K!)\\n\\nğŸ¯ ÃœRÃœN Ã–NCELÄ°KLENDÄ°RME:\\n1. âœ… TAM ÃœRÃœN kategorilerini Ã–NE! (Transpalet, Forklift, Ä°stif)\\n2. âŒ YEDEK PARÃ‡A kategorisini EN SONA!\\n3. âœ… Ana kategorilere odaklan (EndÃ¼striyel ekipman)\\n\\nğŸ’° FÄ°YAT GÃ–STERME:\\n1. âœ… formatted_price varsa â†’ AYNEN gÃ¶ster\\n2. âŒ Fiyat yoksa â†’ \\\"Fiyat teklifi iÃ§in iletiÅŸim\\\"\\n3. âŒ ASLA hafÄ±zandan fiyat kullanma!\\n4. âŒ ASLA tahmin yapma!\\n\\nğŸ’± CURRENCY:\\n- formatted_price zaten doÄŸru formatta (Ã¶rn: \\\"15.000 â‚º\\\" veya \\\"$1,350\\\")\\n- Sen sadece AYNEN gÃ¶ster\\n- ASLA currency sembolÃ¼ kendin ekleme!\\n\\nğŸ“ TELEFON TOPLAMA:\\nğŸš¨ ÃœRÃœN linklerini gÃ¶stermeden WhatsApp numarasÄ± VERME!\\n\\nDOÄRU SIRA:\\n1. Merhaba\\n2. ÃœRÃœN LÄ°NKLERÄ° GÃ–STER (MUTLAKA!)\\n3. Ä°lgilendiyse telefon iste\\n4. Telefon alamazsan â†’ O zaman bizim numarayÄ± ver\\n\\nğŸ“¦ ÃœRÃœN BULUNAMADI:\\nâŒ ASLA \'Ã¼rÃ¼n bulunamadÄ±\' DEME!\\nâŒ ASLA \'elimizde yok\' DEME!\\n\\nâœ… POZÄ°TÄ°F YANIT:\\n\\\"Harika soru! ğŸ‰ Ä°xtif olarak size kesinlikle yardÄ±mcÄ± olabiliriz! ğŸ˜Š\\\"\\n\\nğŸ“ MARKDOWN FORMAT (ZORUNLU!):\\nâœ… DOÄRU:\\nâ­ **ÃœrÃ¼n AdÄ±** [LINK:shop:slug]\\n\\n- 1.500 kg taÅŸÄ±ma kapasitesi\\n- Li-Ion batarya\\n- Ergonomik tasarÄ±m\\n\\nFiyat: $1.350\\n\\nKRÄ°TÄ°K:\\n- Her Ã¶zellik AYRI SATIR\\n- ÃœrÃ¼n adÄ±ndan sonra BOÅ SATIR\\n- FÄ°YAT AYRI PARAGRAFTA!\\n- Her â­ yeni satÄ±rda!\\n\\nğŸ“‹ YANIT KURALLARI:\\nâŒ Reasoning gÃ¶sterme!\\nâŒ Self-talk yapma!\\nâŒ KullanÄ±cÄ±nÄ±n sorusunu tekrarlama!\\nâŒ \\\"AnladÄ±m ki...\\\" DEME!\\n\\nâœ… Direkt coÅŸkulu yanÄ±t ver!\\nâœ… HatalarÄ± sessizce dÃ¼zelt!\\nâœ… Samimi ve arkadaÅŸÃ§a konuÅŸ!\\n\\nâŒ YASAKLAR:\\n- HTML taglarÄ± yasak (sadece <ul><li> soru iÃ§in)\\n- Konu dÄ±ÅŸÄ± konular\\n- Kategori karÄ±ÅŸtÄ±rma\\n- ÃœrÃ¼n gÃ¶stermeden WhatsApp verme\\n- \'sen\' hitabÄ± (sadece SÄ°Z!)\\n- Robot gibi konuÅŸma!\\n\"}, \"position\": {\"x\": 1385.6666666666667, \"y\": 504}}, {\"id\": \"node_11\", \"name\": \"Ä°letiÅŸim Bilgisi Ver\", \"type\": \"contact_request\", \"class\": \"\", \"config\": {\"next_node\": \"node_10\", \"callback_form_url\": \"/contact/callback\"}, \"position\": {\"x\": 927, \"y\": 545}}, {\"id\": \"node_12\", \"name\": \"Linkleri Render Et\", \"type\": \"link_generator\", \"class\": \"\", \"config\": {\"base_url\": \"https://ixtif.com\", \"next_node\": \"node_13\"}, \"position\": {\"x\": 1379, \"y\": 657}}, {\"id\": \"node_13\", \"name\": \"MesajlarÄ± Kaydet\", \"type\": \"message_saver\", \"class\": \"\", \"config\": {\"next_node\": \"node_14\", \"save_metadata\": true, \"save_user_message\": true, \"save_assistant_message\": true}, \"position\": {\"x\": 1387, \"y\": 858}}, {\"id\": \"node_14\", \"name\": \"Bitir\", \"type\": \"end\", \"class\": \"\", \"config\": [], \"position\": {\"x\": 1649, \"y\": 863.6666666666666}}]}','node_1',1,10,NULL,NULL,'2025-11-05 23:39:23','2025-11-06 03:51:43');

-- ================================================
-- NOT: AI Tenant Directives artÄ±k CENTRAL DB'de!
-- ================================================
-- Directives CENTRAL DB'ye taÅŸÄ±ndÄ± (tenant_id ile)
-- Seed data: readme/ai-workflow/seed-data/central-ai-data.sql
-- ================================================
