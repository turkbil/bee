<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Connection Leak Analizi - Muzibu Too Many Connections HatasÄ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%); }
        .badge { @apply inline-block px-3 py-1 text-xs font-semibold rounded-full; }
        .badge-critical { @apply bg-red-600 text-white; }
        .badge-warning { @apply bg-yellow-600 text-white; }
        .badge-success { @apply bg-green-600 text-white; }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen">

    <!-- Header -->
    <header class="gradient-bg shadow-2xl mb-8">
        <div class="container mx-auto px-6 py-12">
            <div class="flex items-center gap-3 mb-4">
                <span class="badge badge-critical">ğŸš¨ KRÄ°TÄ°K SORUN</span>
                <span class="badge badge-warning">Production</span>
                <span class="text-slate-200 text-sm">9 Ocak 2026 - 14:50</span>
            </div>
            <h1 class="text-4xl font-bold text-white mb-3">Database Connection Leak Analizi</h1>
            <p class="text-xl text-red-100">MySQL "Too Many Connections" HatasÄ± - Production Site Ã‡Ã¶kÃ¼yor</p>
            <div class="mt-6 flex gap-4 text-sm">
                <div class="bg-white/10 backdrop-blur-sm px-4 py-2 rounded-lg">
                    <span class="text-red-300">Max Connections:</span>
                    <span class="text-white font-bold ml-2">151</span>
                </div>
                <div class="bg-white/10 backdrop-blur-sm px-4 py-2 rounded-lg">
                    <span class="text-red-300">Max KullanÄ±lan:</span>
                    <span class="text-white font-bold ml-2">152 âš ï¸</span>
                </div>
                <div class="bg-white/10 backdrop-blur-sm px-4 py-2 rounded-lg">
                    <span class="text-red-300">Toplam Hata:</span>
                    <span class="text-white font-bold ml-2">251 kez</span>
                </div>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-6 pb-16 max-w-6xl space-y-8">

        <!-- Basit AnlatÄ±m -->
        <section class="bg-gradient-to-br from-green-900/30 to-emerald-900/20 border border-green-800/50 rounded-2xl p-8 shadow-xl">
            <h2 class="text-2xl font-bold text-green-400 mb-6 flex items-center gap-3">
                <span class="text-3xl">ğŸ“</span>
                Basit AnlatÄ±m (Herkes Ä°Ã§in)
            </h2>

            <div class="space-y-6 text-slate-200 leading-relaxed">
                <div>
                    <h3 class="text-lg font-semibold text-white mb-3">ğŸ”´ Ne Oluyor?</h3>
                    <p class="mb-3">
                        Muzibu.com.tr sitesi bazen "Internal Server Error" veriyor ve sayfa aÃ§Ä±lmÄ±yor.
                        KullanÄ±cÄ± sayfayÄ± yenilediÄŸinde tekrar Ã§alÄ±ÅŸÄ±yor. Bu durum site gÃ¼venilirliÄŸini olumsuz etkiliyor.
                    </p>
                    <p class="bg-red-900/30 border border-red-800/50 rounded-lg p-4 text-red-100">
                        <strong>Hata MesajÄ±:</strong> "SQLSTATE[HY000] [1040] Too many connections"
                        <br><strong>AnlamÄ±:</strong> VeritabanÄ± "Ã‡ok fazla baÄŸlantÄ± var, yeni baÄŸlantÄ± kabul edemiyorum" diyor.
                    </p>
                </div>

                <div>
                    <h3 class="text-lg font-semibold text-white mb-3">ğŸ¯ Sorunun Basit AÃ§Ä±klamasÄ±</h3>
                    <p class="mb-3">
                        VeritabanÄ±nÄ± bir <strong>restoran</strong> gibi dÃ¼ÅŸÃ¼nÃ¼n:
                    </p>
                    <ul class="list-disc list-inside space-y-2 ml-4">
                        <li><strong>151 masa</strong> var (max_connections = 151)</li>
                        <li>Her kullanÄ±cÄ± bir masa tutuyor (her HTTP request = 1 baÄŸlantÄ±)</li>
                        <li>51 garson sÃ¼rekli Ã§alÄ±ÅŸÄ±yor (Horizon worker'lar)</li>
                        <li>BazÄ± masalar <strong>kullanÄ±lmadÄ±ÄŸÄ± halde boÅŸaltÄ±lmÄ±yor</strong> (connection leak!)</li>
                        <li>Yeni mÃ¼ÅŸteri geldiÄŸinde "masamÄ±z kalmadÄ±" deniyor (too many connections)</li>
                    </ul>
                </div>

                <div>
                    <h3 class="text-lg font-semibold text-white mb-3">ğŸ’¡ Neden Ã–nemli?</h3>
                    <ul class="list-disc list-inside space-y-2 ml-4">
                        <li><strong>KullanÄ±cÄ± Deneyimi:</strong> Site Ã§Ã¶kÃ¼yor, mÃ¼ÅŸteri kaybÄ± yaÅŸanÄ±yor</li>
                        <li><strong>SEO Sorunu:</strong> Google error sayfalarÄ± gÃ¶rÃ¼rse sÄ±ralama dÃ¼ÅŸer</li>
                        <li><strong>Gelir KaybÄ±:</strong> Premium Ã¼yelik satÄ±ÅŸlarÄ± etkileniyor</li>
                        <li><strong>Ä°tibar ZararÄ±:</strong> "Muzibu aÃ§Ä±lmÄ±yor" yorumlarÄ± gelebilir</li>
                    </ul>
                </div>

                <div>
                    <h3 class="text-lg font-semibold text-white mb-3">âœ… Ã‡Ã¶zÃ¼m Nedir?</h3>
                    <p class="mb-3">
                        ÃœÃ§ ana aksiyonla sorun Ã§Ã¶zÃ¼lecek:
                    </p>
                    <ol class="list-decimal list-inside space-y-2 ml-4">
                        <li><strong>Gereksiz baÄŸlantÄ±larÄ± kaldÄ±r</strong> - Her sayfa yÃ¼klendiÄŸinde veritabanÄ±na giden gereksiz sorgularÄ± durduracaÄŸÄ±z</li>
                        <li><strong>Ã‡ift Ã§alÄ±ÅŸan sistem kapat</strong> - Ä°ki adet aynÄ± servis Ã§alÄ±ÅŸÄ±yor (Horizon duplicate), birini kapatacaÄŸÄ±z</li>
                        <li><strong>Masa sayÄ±sÄ±nÄ± artÄ±r</strong> - VeritabanÄ± baÄŸlantÄ± limitini 151'den 300'e Ã§Ä±karacaÄŸÄ±z</li>
                    </ol>
                </div>

                <div class="bg-yellow-900/30 border border-yellow-800/50 rounded-lg p-4">
                    <h3 class="text-lg font-semibold text-yellow-400 mb-2">â±ï¸ SÃ¼reÃ§</h3>
                    <p>
                        Bu dÃ¼zeltmeler yapÄ±ldÄ±ktan sonra site <strong>kesintisiz</strong> Ã§alÄ±ÅŸacak.
                        KullanÄ±cÄ±lar "Too many connections" hatasÄ± almayacak.
                    </p>
                </div>
            </div>
        </section>

        <!-- Teknik Detaylar -->
        <section class="bg-gradient-to-br from-blue-900/30 to-indigo-900/20 border border-blue-800/50 rounded-2xl p-8 shadow-xl">
            <h2 class="text-2xl font-bold text-blue-400 mb-6 flex items-center gap-3">
                <span class="text-3xl">ğŸ”§</span>
                Teknik Detaylar (GeliÅŸtiriciler Ä°Ã§in)
            </h2>

            <div class="space-y-6">
                <!-- Kritik Bulgular -->
                <div>
                    <h3 class="text-lg font-semibold text-white mb-4">ğŸš¨ Kritik Bulgular</h3>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div class="bg-red-950/50 border border-red-800/50 rounded-lg p-4">
                            <div class="text-red-400 text-sm font-semibold mb-1">MySQL Stats</div>
                            <pre class="text-xs text-slate-300 overflow-x-auto">max_connections: 151
Threads_connected: 53
Max_used_connections: 152 âš ï¸
Connection_errors_max: 251
Max_used_time: 2026-01-09 11:15:28</pre>
                        </div>
                        <div class="bg-orange-950/50 border border-orange-800/50 rounded-lg p-4">
                            <div class="text-orange-400 text-sm font-semibold mb-1">Process Stats</div>
                            <pre class="text-xs text-slate-300 overflow-x-auto">Horizon Master: 2 (duplicate! âš ï¸)
Horizon Workers: 51
PHP-FPM Pools: ?
Nginx Workers: ?
Total Potential Conn: ~104</pre>
                        </div>
                    </div>
                </div>

                <!-- Sorun KaynaklarÄ± -->
                <div>
                    <h3 class="text-lg font-semibold text-white mb-4">ğŸ” Sorun KaynaklarÄ±</h3>

                    <!-- Kaynak 1 -->
                    <div class="bg-slate-800/50 border border-slate-700 rounded-lg p-5 mb-4">
                        <div class="flex items-start gap-3 mb-3">
                            <span class="badge badge-critical">KRÄ°TÄ°K #1</span>
                            <h4 class="text-white font-semibold">routes/web.php:157 - Her Request'te DB Query</h4>
                        </div>
                        <div class="space-y-3 text-sm">
                            <p class="text-slate-300">
                                <strong>Dosya:</strong> <code class="bg-slate-900 px-2 py-1 rounded text-blue-400">routes/web.php:155-158</code>
                            </p>
                            <p class="text-slate-300">
                                Route dosyasÄ± her HTTP request'te yÃ¼klendiÄŸi iÃ§in, bu sorgu <strong>her sayfa yÃ¼kleniÅŸinde</strong> Ã§alÄ±ÅŸÄ±yor:
                            </p>
                            <pre class="bg-slate-900 p-3 rounded text-blue-300 text-xs overflow-x-auto">$muzibuDomains = \Illuminate\Support\Facades\DB::table('domains')
    ->where('tenant_id', 1001)
    ->pluck('domain')
    ->toArray();</pre>
                            <p class="text-red-300 mt-2">
                                <strong>Etki:</strong> Anasayfa 1000 kez ziyaret edildi â†’ 1000 DB connection aÃ§Ä±ldÄ± â†’ Limit aÅŸÄ±ldÄ±!
                            </p>
                        </div>
                    </div>

                    <!-- Kaynak 2 -->
                    <div class="bg-slate-800/50 border border-slate-700 rounded-lg p-5 mb-4">
                        <div class="flex items-start gap-3 mb-3">
                            <span class="badge badge-warning">ORTA #2</span>
                            <h4 class="text-white font-semibold">Duplicate Horizon Master Process</h4>
                        </div>
                        <div class="space-y-3 text-sm">
                            <p class="text-slate-300">
                                Ä°ki adet Horizon master process Ã§alÄ±ÅŸÄ±yor (aynÄ± supervisor config'i yÃ¼klÃ¼yor):
                            </p>
                            <pre class="bg-slate-900 p-3 rounded text-yellow-300 text-xs overflow-x-auto">PID 1354897: /opt/plesk/php/8.5/bin/php artisan horizon
PID 1359267: /opt/plesk/php/8.5/bin/php artisan horizon

Her master 4 supervisor spawn ediyor:
- ai-supervisor (max 2 worker)
- tenant-supervisor (max 2 worker)
- muzibu-supervisor (max 3 worker)
- background-supervisor (max 1 worker)

Toplam: 2 master Ã— (2+2+3+1) = 16 supervisor
GerÃ§ek worker: 51 (her supervisor multiple worker spawn etmiÅŸ)</pre>
                            <p class="text-yellow-300 mt-2">
                                <strong>Etki:</strong> Gereksiz process â†’ Gereksiz DB connection â†’ CPU ve Memory yÃ¼kÃ¼
                            </p>
                        </div>
                    </div>

                    <!-- Kaynak 3 -->
                    <div class="bg-slate-800/50 border border-slate-700 rounded-lg p-5">
                        <div class="flex items-start gap-3 mb-3">
                            <span class="badge badge-warning">ORTA #3</span>
                            <h4 class="text-white font-semibold">DÃ¼ÅŸÃ¼k max_connections Limiti</h4>
                        </div>
                        <div class="space-y-3 text-sm">
                            <p class="text-slate-300">
                                <strong>Mevcut Limit:</strong> <code class="bg-slate-900 px-2 py-1 rounded text-blue-400">max_connections = 151</code>
                            </p>
                            <p class="text-slate-300">
                                <strong>Gereksinim HesabÄ±:</strong>
                            </p>
                            <pre class="bg-slate-900 p-3 rounded text-slate-300 text-xs overflow-x-auto">Horizon Workers:        51
PHP-FPM pm.max_children: 50 (tahmini)
Nginx Connections:      20 (tahmini)
System/Admin:           10
Buffer:                 20
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TOPLAM:                ~151 (tam limit!)

YoÄŸun saatlerde trafik artÄ±nca: 151+ â†’ "Too many connections"</pre>
                            <p class="text-orange-300 mt-2">
                                <strong>Etki:</strong> YÃ¼ksek trafikte sistem limit aÅŸÄ±mÄ± â†’ Site Ã§Ã¶kÃ¼yor
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Stack Trace Analizi -->
                <div>
                    <h3 class="text-lg font-semibold text-white mb-4">ğŸ“Š Stack Trace Analizi</h3>
                    <div class="bg-slate-900/50 border border-slate-700 rounded-lg p-5">
                        <p class="text-slate-300 text-sm mb-3">
                            <strong>Hata ZamanÄ±:</strong> GET <code class="text-blue-400">https://muzibu.com.tr/</code> (Anasayfa)
                        </p>
                        <pre class="text-xs text-red-300 overflow-x-auto">Illuminate\Database\QueryException
SQLSTATE[HY000] [1040] Too many connections
Connection: mysql
SQL: select `domain` from `domains` where `tenant_id` = 1001

routes/web.php:157
â†’ \Illuminate\Support\Facades\DB::table('domains')
â†’ ->where('tenant_id', 1001)
â†’ ->pluck('domain')</pre>
                        <p class="text-yellow-300 text-sm mt-3">
                            âš ï¸ Hata routes yÃ¼klenirken oluÅŸuyor, yani <strong>middleware'lerden Ã¶nce</strong>!
                        </p>
                    </div>
                </div>

                <!-- Config DetaylarÄ± -->
                <div>
                    <h3 class="text-lg font-semibold text-white mb-4">âš™ï¸ Mevcut Database Config</h3>
                    <div class="bg-slate-900/50 border border-slate-700 rounded-lg p-5">
                        <p class="text-slate-300 text-sm mb-3">
                            <strong>Dosya:</strong> <code class="text-blue-400">config/database.php:45-68</code>
                        </p>
                        <pre class="text-xs text-slate-300 overflow-x-auto">'mysql' => [
    'driver' => 'mysql',
    'host' => env('DB_HOST', '127.0.0.1'),
    'database' => env('DB_DATABASE', 'tuufi_4ekim'),
    'username' => env('DB_USERNAME', 'tuufi_4ekim'),
    'charset' => 'utf8mb4',
    'options' => [
        PDO::ATTR_TIMEOUT => 30,
        PDO::ATTR_EMULATE_PREPARES => false,
        PDO::MYSQL_ATTR_USE_BUFFERED_QUERY => true,
        PDO::ATTR_PERSISTENT => false,  â† Connection pooling KAPALI!
    ],
]</pre>
                        <p class="text-yellow-300 text-sm mt-3">
                            âš ï¸ <code>ATTR_PERSISTENT => false</code> her request yeni connection aÃ§Ä±yor!
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Ã‡Ã¶zÃ¼m PlanÄ± -->
        <section class="bg-gradient-to-br from-green-900/30 to-teal-900/20 border border-green-800/50 rounded-2xl p-8 shadow-xl">
            <h2 class="text-2xl font-bold text-green-400 mb-6 flex items-center gap-3">
                <span class="text-3xl">âœ…</span>
                Ã‡Ã¶zÃ¼m PlanÄ± (AdÄ±m AdÄ±m)
            </h2>

            <div class="space-y-6">
                <!-- Ã‡Ã¶zÃ¼m 1 -->
                <div class="bg-green-950/30 border border-green-800/50 rounded-lg p-6">
                    <div class="flex items-start gap-3 mb-4">
                        <span class="text-2xl">1ï¸âƒ£</span>
                        <div>
                            <h3 class="text-lg font-semibold text-white">routes/web.php - Domain Query Cache Sistemi</h3>
                            <span class="badge badge-critical mt-2">EN Ã–NCELÄ°KLÄ°</span>
                        </div>
                    </div>

                    <div class="space-y-3 text-sm">
                        <p class="text-slate-300">
                            <strong>Sorun:</strong> Her HTTP request'te <code>DB::table('domains')</code> query'si Ã§alÄ±ÅŸÄ±yor.
                        </p>
                        <p class="text-green-300">
                            <strong>Ã‡Ã¶zÃ¼m:</strong> Domain listesini Redis cache'e al, TTL: 3600 saniye (1 saat).
                        </p>

                        <div class="bg-slate-900 p-4 rounded">
                            <p class="text-blue-400 text-xs mb-2">Strateji:</p>
                            <ul class="list-disc list-inside space-y-1 text-slate-300 text-xs ml-4">
                                <li>Cache key: <code>muzibu_domains_list</code></li>
                                <li>TTL: 3600 saniye (1 saat)</li>
                                <li>Cache miss â†’ DB query â†’ Cache'e yaz</li>
                                <li>Cache hit â†’ Direkt kullan (DB query YOK)</li>
                                <li>Tenant deÄŸiÅŸikliÄŸinde cache invalidation</li>
                            </ul>
                        </div>

                        <div class="bg-blue-900/20 border border-blue-800/50 rounded p-3 mt-3">
                            <p class="text-blue-300 text-xs mb-1"><strong>Beklenen SonuÃ§:</strong></p>
                            <p class="text-slate-300 text-xs">
                                1000 request â†’ 1000 DB query (eski) | 1000 request â†’ 1 DB query (yeni)
                                <br><strong>KazanÃ§:</strong> 999 DB connection azalma!
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Ã‡Ã¶zÃ¼m 2 -->
                <div class="bg-yellow-950/30 border border-yellow-800/50 rounded-lg p-6">
                    <div class="flex items-start gap-3 mb-4">
                        <span class="text-2xl">2ï¸âƒ£</span>
                        <div>
                            <h3 class="text-lg font-semibold text-white">Duplicate Horizon Process Temizleme</h3>
                            <span class="badge badge-warning mt-2">Ã–NEMLÄ°</span>
                        </div>
                    </div>

                    <div class="space-y-3 text-sm">
                        <p class="text-slate-300">
                            <strong>Sorun:</strong> Ä°ki adet Horizon master process Ã§alÄ±ÅŸÄ±yor (PID: 1354897, 1359267).
                        </p>
                        <p class="text-yellow-300">
                            <strong>Ã‡Ã¶zÃ¼m:</strong> TÃ¼m Horizon process'lerini temizle, Supervisor config kontrol et, tek master baÅŸlat.
                        </p>

                        <div class="bg-slate-900 p-4 rounded">
                            <p class="text-yellow-400 text-xs mb-2">Aksiyon:</p>
                            <ol class="list-decimal list-inside space-y-1 text-slate-300 text-xs ml-4">
                                <li><code>php artisan horizon:terminate</code> (graceful shutdown)</li>
                                <li><code>pkill -9 -f "artisan horizon"</code> (zorla temizle)</li>
                                <li>Supervisor config kontrol: <code>/etc/supervisor/conf.d/</code></li>
                                <li>Tek Horizon master baÅŸlat: <code>php artisan horizon</code></li>
                                <li>Process kontrolÃ¼: <code>ps aux | grep horizon</code></li>
                            </ol>
                        </div>

                        <div class="bg-yellow-900/20 border border-yellow-800/50 rounded p-3 mt-3">
                            <p class="text-yellow-300 text-xs mb-1"><strong>Beklenen SonuÃ§:</strong></p>
                            <p class="text-slate-300 text-xs">
                                51 worker â†’ ~25 worker (yarÄ± yarÄ±ya azalma)
                                <br><strong>KazanÃ§:</strong> ~26 DB connection azalma + CPU/Memory rahatlamasÄ±
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Ã‡Ã¶zÃ¼m 3 -->
                <div class="bg-blue-950/30 border border-blue-800/50 rounded-lg p-6">
                    <div class="flex items-start gap-3 mb-4">
                        <span class="text-2xl">3ï¸âƒ£</span>
                        <div>
                            <h3 class="text-lg font-semibold text-white">MySQL max_connections ArtÄ±rma (Opsiyonel)</h3>
                            <span class="badge badge-success mt-2">GÃœVENLÄ°K BUFFER</span>
                        </div>
                    </div>

                    <div class="space-y-3 text-sm">
                        <p class="text-slate-300">
                            <strong>Durum:</strong> YukarÄ±daki dÃ¼zeltmelerle sorun Ã§Ã¶zÃ¼lecek, ancak gÃ¼venlik iÃ§in limit artÄ±rÄ±labilir.
                        </p>
                        <p class="text-blue-300">
                            <strong>Ã–neri:</strong> max_connections = 151 â†’ 300 (2x artÄ±ÅŸ)
                        </p>

                        <div class="bg-slate-900 p-4 rounded">
                            <p class="text-blue-400 text-xs mb-2">KonfigÃ¼rasyon (Plesk MySQL):</p>
                            <pre class="text-slate-300 text-xs overflow-x-auto"># /etc/my.cnf.d/server.cnf
[mysqld]
max_connections = 300

# Restart gerekli
sudo systemctl restart mariadb</pre>
                        </div>

                        <div class="bg-blue-900/20 border border-blue-800/50 rounded p-3 mt-3">
                            <p class="text-blue-300 text-xs mb-1"><strong>Beklenen SonuÃ§:</strong></p>
                            <p class="text-slate-300 text-xs">
                                151 limit â†’ 300 limit (yÃ¼ksek trafik buffer)
                                <br><strong>KazanÃ§:</strong> Peak zamanlarda sistem Ã§Ã¶kmez
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Ã–ncelik SÄ±rasÄ± -->
        <section class="bg-gradient-to-br from-purple-900/30 to-pink-900/20 border border-purple-800/50 rounded-2xl p-8 shadow-xl">
            <h2 class="text-2xl font-bold text-purple-400 mb-6 flex items-center gap-3">
                <span class="text-3xl">ğŸ¯</span>
                Uygulama Ã–nceliÄŸi
            </h2>

            <div class="space-y-4">
                <div class="flex items-start gap-4 bg-red-950/30 border border-red-800/50 rounded-lg p-4">
                    <span class="text-3xl">ğŸ”¥</span>
                    <div>
                        <h3 class="text-white font-semibold mb-1">1. routes/web.php Cache Sistemi</h3>
                        <p class="text-sm text-slate-300">En bÃ¼yÃ¼k etki, hemen uygula! (999 DB query azalacak)</p>
                    </div>
                </div>

                <div class="flex items-start gap-4 bg-yellow-950/30 border border-yellow-800/50 rounded-lg p-4">
                    <span class="text-3xl">âš ï¸</span>
                    <div>
                        <h3 class="text-white font-semibold mb-1">2. Horizon Duplicate Temizleme</h3>
                        <p class="text-sm text-slate-300">Orta etki, sistem performansÄ± artacak (~26 process azalacak)</p>
                    </div>
                </div>

                <div class="flex items-start gap-4 bg-blue-950/30 border border-blue-800/50 rounded-lg p-4">
                    <span class="text-3xl">ğŸ›¡ï¸</span>
                    <div>
                        <h3 class="text-white font-semibold mb-1">3. max_connections ArtÄ±rma</h3>
                        <p class="text-sm text-slate-300">GÃ¼venlik buffer, yukarÄ±daki dÃ¼zeltmeler yeterli ama ekstra koruma</p>
                    </div>
                </div>
            </div>

            <div class="mt-6 bg-green-900/20 border border-green-800/50 rounded-lg p-4">
                <p class="text-green-300 text-sm">
                    âœ… <strong>Tahmini Toplam SÃ¼re:</strong> 15-20 dakika
                    <br>âœ… <strong>Downtime:</strong> YOK (Horizon restart hariÃ§, ~30 saniye)
                    <br>âœ… <strong>Risk Seviyesi:</strong> DÃ¼ÅŸÃ¼k (cache ve process yÃ¶netimi)
                </p>
            </div>
        </section>

        <!-- Test PlanÄ± -->
        <section class="bg-gradient-to-br from-indigo-900/30 to-blue-900/20 border border-indigo-800/50 rounded-2xl p-8 shadow-xl">
            <h2 class="text-2xl font-bold text-indigo-400 mb-6 flex items-center gap-3">
                <span class="text-3xl">ğŸ§ª</span>
                DÃ¼zeltme SonrasÄ± Test PlanÄ±
            </h2>

            <div class="space-y-4 text-sm">
                <div class="bg-slate-800/50 border border-slate-700 rounded-lg p-4">
                    <h3 class="text-white font-semibold mb-3">1. DB Connection Monitoring</h3>
                    <pre class="bg-slate-900 p-3 rounded text-blue-300 text-xs overflow-x-auto">mysql -u tuufi_4ekim -p'XZ9Lhb%u8jp9#njf' -e "SHOW STATUS LIKE 'Threads_connected';"
mysql -u tuufi_4ekim -p'XZ9Lhb%u8jp9#njf' -e "SHOW STATUS LIKE 'Max_used_connections';"

# Beklenen: Threads_connected < 80 (151'in yarÄ±sÄ±ndan az)</pre>
                </div>

                <div class="bg-slate-800/50 border border-slate-700 rounded-lg p-4">
                    <h3 class="text-white font-semibold mb-3">2. Horizon Process Count</h3>
                    <pre class="bg-slate-900 p-3 rounded text-green-300 text-xs overflow-x-auto">ps aux | grep -E "(horizon|queue)" | grep -v grep | wc -l

# Beklenen: ~25-30 (51'den azalmalÄ±)</pre>
                </div>

                <div class="bg-slate-800/50 border border-slate-700 rounded-lg p-4">
                    <h3 class="text-white font-semibold mb-3">3. Cache Test</h3>
                    <pre class="bg-slate-900 p-3 rounded text-yellow-300 text-xs overflow-x-auto">php artisan tinker
>>> Cache::get('muzibu_domains_list');  // Domain listesi dÃ¶nmeli
>>> Cache::has('muzibu_domains_list');  // true olmalÄ±</pre>
                </div>

                <div class="bg-slate-800/50 border border-slate-700 rounded-lg p-4">
                    <h3 class="text-white font-semibold mb-3">4. Production Test</h3>
                    <ul class="list-disc list-inside space-y-2 text-slate-300 ml-4">
                        <li>AnasayfayÄ± 20 kez yenile (F5) â†’ Error olmamalÄ±</li>
                        <li>FarklÄ± sayfalara git (artist, playlist, song) â†’ Error olmamalÄ±</li>
                        <li>GiriÅŸ yap, Ã§Ä±kÄ±ÅŸ yap â†’ Error olmamalÄ±</li>
                        <li>Logs kontrol: <code>tail -f storage/logs/laravel.log</code></li>
                    </ul>
                </div>
            </div>
        </section>

    </div>

    <!-- Footer -->
    <footer class="border-t border-slate-800 mt-16 py-8">
        <div class="container mx-auto px-6 text-center text-slate-400 text-sm">
            <p>ğŸ¤– Bu analiz <strong>Claude AI</strong> tarafÄ±ndan otomatik oluÅŸturulmuÅŸtur.</p>
            <p class="mt-2">ğŸ“… 9 Ocak 2026 - 14:50 | ğŸ¢ Muzibu Production Environment</p>
        </div>
    </footer>

</body>
</html>
