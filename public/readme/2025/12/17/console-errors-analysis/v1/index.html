<!DOCTYPE html>
<html lang="tr" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Console HatalarÄ± Analiz - Muzibu Player</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio"></script>
</head>
<body class="bg-slate-950 text-slate-100 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-5xl">
        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-slate-100 mb-2">ğŸ” Console HatalarÄ± Analiz</h1>
            <p class="text-slate-400">Muzibu Player - Console'daki hatalarÄ±n sebepleri ve Ã§Ã¶zÃ¼mleri</p>
            <div class="mt-4 text-sm text-slate-500">
                ğŸ“… 17 AralÄ±k 2025 â€¢ ğŸ¯ Hata Analizi
            </div>
        </div>

        <!-- Summary -->
        <div class="bg-slate-900 border border-slate-800 rounded-lg p-6 mb-8">
            <h2 class="text-xl font-semibold text-slate-100 mb-4">ğŸ“Š Ã–zet</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-slate-800/50 rounded-lg p-4">
                    <div class="text-3xl font-bold text-red-400">2</div>
                    <div class="text-sm text-slate-400">Ana Hata Tipi</div>
                </div>
                <div class="bg-slate-800/50 rounded-lg p-4">
                    <div class="text-3xl font-bold text-yellow-400">1</div>
                    <div class="text-sm text-slate-400">Kritik Hata</div>
                </div>
                <div class="bg-slate-800/50 rounded-lg p-4">
                    <div class="text-3xl font-bold text-green-400">1</div>
                    <div class="text-sm text-slate-400">Fallback Ã‡alÄ±ÅŸÄ±yor</div>
                </div>
            </div>
        </div>

        <!-- Error 1: Autoplay Policy -->
        <div class="bg-slate-900 border border-red-900/50 rounded-lg p-6 mb-6">
            <div class="flex items-start gap-4 mb-4">
                <div class="text-3xl">ğŸš«</div>
                <div class="flex-1">
                    <h3 class="text-xl font-semibold text-red-400 mb-2">HATA #1: NotAllowedError - Autoplay Policy</h3>
                    <div class="bg-slate-950 rounded p-3 mb-4 font-mono text-sm text-red-300 overflow-x-auto">
                        HLS play error: NotAllowedError: play() failed because the user didn't interact with the document first.
                    </div>
                </div>
            </div>

            <div class="space-y-4 ml-16">
                <div>
                    <h4 class="font-semibold text-slate-200 mb-2">ğŸ” Sebep:</h4>
                    <ul class="list-disc list-inside space-y-1 text-slate-300">
                        <li><strong>Browser Autoplay Policy:</strong> Modern tarayÄ±cÄ±lar kullanÄ±cÄ± etkileÅŸimi olmadan ses Ã§almaya izin vermiyor</li>
                        <li><strong>Preload Attempt:</strong> Sayfa yÃ¼klenirken son Ã§alÄ±nan ÅŸarkÄ±yÄ± otomatik yÃ¼klemeye Ã§alÄ±ÅŸÄ±yor</li>
                        <li><strong>HLS Audio Element:</strong> <code>audio.play()</code> Ã§aÄŸrÄ±sÄ± kullanÄ±cÄ± etkileÅŸimi olmadan yapÄ±lÄ±yor</li>
                    </ul>
                </div>

                <div>
                    <h4 class="font-semibold text-slate-200 mb-2">ğŸ“ Kod Konumu:</h4>
                    <div class="bg-slate-950 rounded p-3 font-mono text-sm text-slate-300">
                        player-core.js:2102 â†’ playHlsStream()<br>
                        â†“<br>
                        preloadLastPlayedSong() â†’ init()
                    </div>
                </div>

                <div>
                    <h4 class="font-semibold text-slate-200 mb-2">âš ï¸ Etki:</h4>
                    <div class="bg-yellow-900/20 border border-yellow-900/50 rounded p-3">
                        <p class="text-yellow-200"><strong>DÃœ ÅÃœK Ã–NCELÄ°K</strong> - Bu hata beklenen bir davranÄ±ÅŸtÄ±r!</p>
                        <ul class="list-disc list-inside mt-2 text-slate-300 space-y-1">
                            <li>ÅarkÄ± yine de yÃ¼klenir (PAUSE modunda)</li>
                            <li>KullanÄ±cÄ± play butonuna bastÄ±ÄŸÄ±nda Ã§alar</li>
                            <li>Sistem doÄŸru Ã§alÄ±ÅŸÄ±yor, sadece tarayÄ±cÄ± uyarÄ±sÄ±</li>
                        </ul>
                    </div>
                </div>

                <div>
                    <h4 class="font-semibold text-slate-200 mb-2">âœ… Ã‡Ã¶zÃ¼m:</h4>
                    <div class="bg-green-900/20 border border-green-900/50 rounded p-3">
                        <p class="text-green-200 mb-2"><strong>MEVCUT:</strong> Sistem zaten doÄŸru Ã§alÄ±ÅŸÄ±yor!</p>
                        <ul class="list-disc list-inside text-slate-300 space-y-1">
                            <li>âœ… <code>autoplay: false</code> parametresi kullanÄ±lÄ±yor</li>
                            <li>âœ… ÅarkÄ± PAUSE modunda bekliyor</li>
                            <li>âœ… KullanÄ±cÄ± play basÄ±nca Ã§alÄ±yor</li>
                        </ul>
                        <p class="text-slate-400 mt-3 text-sm"><em>Bu hatayÄ± tamamen kaldÄ±rmak iÃ§in:</em></p>
                        <ul class="list-disc list-inside text-slate-400 space-y-1 text-sm">
                            <li>Opsiyonel: <code>audio.play()</code> Ã§aÄŸrÄ±sÄ±nÄ± try-catch iÃ§ine al ve hatayi sessizce yakala</li>
                            <li>Opsiyonel: Preload'u tamamen kaldÄ±r (ama bu UX'i kÃ¶tÃ¼leÅŸtirir)</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Error 2: HLS Key Load Error -->
        <div class="bg-slate-900 border border-orange-900/50 rounded-lg p-6 mb-6">
            <div class="flex items-start gap-4 mb-4">
                <div class="text-3xl">ğŸ”‘</div>
                <div class="flex-1">
                    <h3 class="text-xl font-semibold text-orange-400 mb-2">HATA #2: keyLoadError - HLS Encryption Key</h3>
                    <div class="bg-slate-950 rounded p-3 mb-4 font-mono text-sm text-orange-300 overflow-x-auto">
                        âš ï¸ HLS error (fallback to MP3): keyLoadError
                    </div>
                </div>
            </div>

            <div class="space-y-4 ml-16">
                <div>
                    <h4 class="font-semibold text-slate-200 mb-2">ğŸ” Sebep:</h4>
                    <ul class="list-disc list-inside space-y-1 text-slate-300">
                        <li><strong>Deleted Song:</strong> Son Ã§alÄ±nan ÅŸarkÄ± (ID: 323) database'den silinmiÅŸ</li>
                        <li><strong>Missing Key File:</strong> HLS encryption key dosyasÄ± bulunamÄ±yor</li>
                        <li><strong>404 Response:</strong> <code>/api/muzibu/songs/323/key</code> endpoint 404 dÃ¶ndÃ¼rÃ¼yor</li>
                    </ul>
                </div>

                <div>
                    <h4 class="font-semibold text-slate-200 mb-2">ğŸ“ Kod Konumu:</h4>
                    <div class="bg-slate-950 rounded p-3 font-mono text-sm text-slate-300">
                        player-core.js:2116 â†’ HLS.Events.ERROR<br>
                        â†“<br>
                        keyLoadError â†’ Fallback to MP3
                    </div>
                </div>

                <div>
                    <h4 class="font-semibold text-slate-200 mb-2">âš ï¸ Etki:</h4>
                    <div class="bg-orange-900/20 border border-orange-900/50 rounded p-3">
                        <p class="text-orange-200"><strong>ORTA Ã–NCELÄ°K</strong> - Fallback sistemi Ã§alÄ±ÅŸÄ±yor ama hata gÃ¶steriyor</p>
                        <ul class="list-disc list-inside mt-2 text-slate-300 space-y-1">
                            <li>HLS stream baÅŸarÄ±sÄ±z olunca MP3 fallback devreye giriyor</li>
                            <li>ÅarkÄ± yine de Ã§alÄ±ÅŸÄ±yor (MP3 formatÄ±nda)</li>
                            <li>Console'da hata mesajÄ± gÃ¶rÃ¼nÃ¼yor</li>
                        </ul>
                    </div>
                </div>

                <div>
                    <h4 class="font-semibold text-slate-200 mb-2">âœ… Ã‡Ã¶zÃ¼m SeÃ§enekleri:</h4>
                    <div class="space-y-3">
                        <!-- Option 1 -->
                        <div class="bg-green-900/20 border border-green-900/50 rounded p-3">
                            <p class="text-green-200 mb-2"><strong>Ã‡Ã–ZÃœM 1:</strong> Preload'da 404 KontrolÃ¼ (Ã–nerilen)</p>
                            <div class="bg-slate-950 rounded p-3 font-mono text-xs text-slate-300 overflow-x-auto">
async preloadLastPlayedSong() {
    const response = await fetch(`/api/muzibu/songs/${song.song_id}/stream`);

    // ğŸ—‘ï¸ Skip if song deleted (404/500)
    if (!response.ok) {
        console.warn('Last played song not available');
        return; // â† MEVCUT: Zaten var!
    }

    // Continue with preload...
}
                            </div>
                            <p class="text-slate-400 mt-2 text-sm">âœ… Bu kontrol zaten mevcut! Ama yine de HLS key hatasÄ± geliyor Ã§Ã¼nkÃ¼ HLS.js kendi isteÄŸi yapÄ±yor.</p>
                        </div>

                        <!-- Option 2 -->
                        <div class="bg-blue-900/20 border border-blue-900/50 rounded p-3">
                            <p class="text-blue-200 mb-2"><strong>Ã‡Ã–ZÃœM 2:</strong> HLS Error'u Sessizce Yakala</p>
                            <div class="bg-slate-950 rounded p-3 font-mono text-xs text-slate-300 overflow-x-auto">
this.hls.on(Hls.Events.ERROR, (event, data) => {
    if (data.details === 'keyLoadError' && !data.fatal) {
        // âš ï¸ Sessizce yakala, console'a yazma
        this.fallbackToMP3(); // Fallback yap
        return;
    }
    // DiÄŸer hatalar iÃ§in warning gÃ¶ster
});
                            </div>
                            <p class="text-slate-400 mt-2 text-sm">âš ï¸ Bu hata zaten fallback tetikliyor, ek aksiyona gerek yok.</p>
                        </div>

                        <!-- Option 3 -->
                        <div class="bg-purple-900/20 border border-purple-900/50 rounded p-3">
                            <p class="text-purple-200 mb-2"><strong>Ã‡Ã–ZÃœM 3:</strong> LocalStorage TemizliÄŸi (En Kolay)</p>
                            <div class="bg-slate-950 rounded p-3 font-mono text-xs text-slate-300 overflow-x-auto">
// Browser console'da Ã§alÄ±ÅŸtÄ±r:
localStorage.removeItem('muzibu_queue_state');
localStorage.removeItem('muzibu_full_state');
                            </div>
                            <p class="text-slate-400 mt-2 text-sm">âœ… En hÄ±zlÄ± Ã§Ã¶zÃ¼m: KullanÄ±cÄ± hard refresh yaptÄ±ÄŸÄ±nda eski ÅŸarkÄ± bilgisi temizlenecek.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Plan -->
        <div class="bg-slate-900 border border-slate-800 rounded-lg p-6">
            <h2 class="text-xl font-semibold text-slate-100 mb-4">ğŸ¯ Aksiy on PlanÄ±</h2>
            <div class="space-y-3">
                <div class="flex items-start gap-3">
                    <span class="text-2xl">1ï¸âƒ£</span>
                    <div class="flex-1">
                        <h3 class="font-semibold text-slate-200 mb-1">Autoplay Error â†’ GEREKSÄ°Z</h3>
                        <p class="text-slate-400 text-sm">Bu hata beklenen bir davranÄ±ÅŸ. Sistem doÄŸru Ã§alÄ±ÅŸÄ±yor. Try-catch ile sessizce yakalanabilir ama gerekli deÄŸil.</p>
                    </div>
                </div>
                <div class="flex items-start gap-3">
                    <span class="text-2xl">2ï¸âƒ£</span>
                    <div class="flex-1">
                        <h3 class="font-semibold text-slate-200 mb-1">HLS Key Error â†’ LocalStorage Temizle</h3>
                        <p class="text-slate-400 text-sm">Deleted song (ID: 323) localStorage'da kalmÄ±ÅŸ. KullanÄ±cÄ± hard refresh yapÄ±nca temizlenecek. Opsiyonel: Preload'da extra 404 check eklenebilir.</p>
                    </div>
                </div>
                <div class="flex items-start gap-3">
                    <span class="text-2xl">3ï¸âƒ£</span>
                    <div class="flex-1">
                        <h3 class="font-semibold text-slate-200 mb-1">Ä°zleme â†’ Console Temiz KalmalÄ±</h3>
                        <p class="text-slate-400 text-sm">Hard refresh sonrasÄ± console'da sadece bu 2 hata gÃ¶rÃ¼necek. Yeni hatalar gelmemeli. console.log TAMAMEN temizlendi.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="mt-8 pt-6 border-t border-slate-800 text-center text-sm text-slate-500">
            <p>ğŸ¤– Bu rapor Claude Code tarafÄ±ndan otomatik oluÅŸturuldu</p>
            <p class="mt-1">Claude Sonnet 4.5 â€¢ 17 AralÄ±k 2025</p>
        </div>
    </div>
</body>
</html>