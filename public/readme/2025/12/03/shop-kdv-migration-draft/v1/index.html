<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop KDV Sistemi - Migration + TasarÄ±m Draft</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            line-height: 1.7;
            padding: 40px 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            margin-bottom: 50px;
            padding-bottom: 30px;
            border-bottom: 2px solid #334155;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #60a5fa, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .meta {
            color: #94a3b8;
            font-size: 0.95rem;
        }

        section {
            margin-bottom: 50px;
        }

        h2 {
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: #60a5fa;
        }

        h3 {
            font-size: 1.4rem;
            margin: 25px 0 15px;
            color: #93c5fd;
        }

        .alert-box {
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid #ef4444;
            padding: 25px;
            margin: 25px 0;
            border-radius: 12px;
        }

        .alert-box h4 {
            color: #ef4444;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .highlight-box {
            background: rgba(16, 185, 129, 0.2);
            border: 2px solid #10b981;
            padding: 25px;
            margin: 25px 0;
            border-radius: 12px;
        }

        .highlight-box h4 {
            color: #10b981;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .info-box {
            background: rgba(59, 130, 246, 0.2);
            border: 2px solid #3b82f6;
            padding: 25px;
            margin: 25px 0;
            border-radius: 12px;
        }

        .info-box h4 {
            color: #3b82f6;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .code-box {
            background: #1e293b;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #10b981;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            white-space: pre-wrap;
        }

        ul {
            margin-left: 25px;
            margin-top: 10px;
        }

        li {
            margin: 8px 0;
        }

        .design-mockup {
            background: white;
            color: #1f2937;
            padding: 30px;
            border-radius: 12px;
            margin: 25px 0;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #374151;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            font-size: 1rem;
            background: #f9fafb;
        }

        .form-checkbox {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: #f3f4f6;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .form-checkbox:hover {
            background: #e5e7eb;
        }

        .form-checkbox input {
            width: 20px;
            height: 20px;
        }

        .price-display {
            display: flex;
            gap: 20px;
            align-items: center;
            padding: 15px;
            background: #fef3c7;
            border-radius: 8px;
            margin-top: 10px;
        }

        .price-item {
            flex: 1;
        }

        .price-item strong {
            display: block;
            color: #92400e;
            margin-bottom: 5px;
        }

        .price-item span {
            font-size: 1.3rem;
            font-weight: 700;
            color: #1f2937;
        }

        .product-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
        }

        .product-card h4 {
            color: #1f2937;
            margin-bottom: 10px;
        }

        .product-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2563eb;
            margin: 10px 0;
        }

        .product-price-alt {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2563eb;
        }

        .product-price-alt small {
            font-size: 0.9rem;
            color: #6b7280;
            font-weight: 400;
        }

        footer {
            margin-top: 60px;
            padding-top: 30px;
            border-top: 1px solid #334155;
            color: #64748b;
            font-size: 0.9rem;
            text-align: center;
        }

        .step-number {
            display: inline-block;
            width: 35px;
            height: 35px;
            background: #3b82f6;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 35px;
            font-weight: 700;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ›’ Shop KDV Sistemi - DRAFT</h1>
            <div class="meta">
                ğŸ“… 2025-12-03 | ğŸ¯ Migration + Admin Panel + Frontend TasarÄ±m | ğŸ¢ Ä°xtif
            </div>
        </header>

        <!-- SORUN ANALÄ°ZÄ° -->
        <section>
            <h2>ğŸš¨ Bulunan Sorunlar</h2>

            <div class="alert-box">
                <h4>âŒ Sorun 1: tax_rate Migration YanlÄ±ÅŸ Yerde!</h4>
                <ul>
                    <li><strong>Dosya:</strong> database/migrations/2025_11_14_062442_add_tax_rate_to_shop_products.php</li>
                    <li><strong>Sorun:</strong> Central migrations klasÃ¶rÃ¼nde (database/migrations/)</li>
                    <li><strong>OlmasÄ± Gereken:</strong> Tenant migrations klasÃ¶rÃ¼nde (database/migrations/tenant/)</li>
                    <li><strong>SonuÃ§:</strong> Manuel olarak eklenmiÅŸe benziyor (ixtif.com'da mevcut)</li>
                </ul>
            </div>

            <div class="info-box">
                <h4>âœ… Mevcut Durum (Ä°xtif Database)</h4>
                <ul>
                    <li>âœ… <strong>tax_rate:</strong> VAR (decimal 5,2, default: 20.00)</li>
                    <li>âŒ <strong>price_without_tax:</strong> YOK (eklenecek)</li>
                    <li>âœ… <strong>currency:</strong> VAR</li>
                    <li>âœ… <strong>currency_id:</strong> VAR</li>
                    <li>ğŸ“¦ <strong>Toplam ÃœrÃ¼n:</strong> 1.021 adet</li>
                </ul>
            </div>
        </section>

        <!-- MÄ°GRATÄ°ON PLANI -->
        <section>
            <h2>ğŸ—„ï¸ Migration PlanÄ±</h2>

            <div class="highlight-box">
                <h4>ğŸ“‹ YapÄ±lacaklar</h4>
                <p><span class="step-number">1</span> Yeni migration dosyasÄ±: <strong>033_add_price_without_tax_to_shop_products.php</strong></p>
                <p><span class="step-number">2</span> Konum: <strong>Modules/Shop/database/migrations/tenant/</strong></p>
                <p><span class="step-number">3</span> Eklenecek alan: <strong>price_without_tax (decimal 12,2, nullable)</strong></p>
                <p><span class="step-number">4</span> Data migration: <strong>base_price â†’ price_without_tax kopyalanacak</strong></p>
            </div>

            <h3>Migration MantÄ±ÄŸÄ±</h3>
            <div class="code-box">// Tablo yapÄ±sÄ±na price_without_tax eklenir
// Alan Ã¶zellikleri:
//   - decimal(12, 2) formatÄ±nda (Ã¶rnek: 1234567890.12)
//   - nullable (boÅŸ olabilir)
//   - base_price alanÄ±ndan sonra gelecek
//   - AÃ§Ä±klama: "KDV hariÃ§ fiyat (runtime calculation iÃ§in kaynak veri)"

// Data Migration Stratejisi:
// AdÄ±m 1: Mevcut base_price deÄŸerleri price_without_tax'a kopyalanÄ±r
// AdÄ±m 2: tax_rate NULL ise 20.00 olarak ayarlanÄ±r
//
// VarsayÄ±m: Mevcut base_price deÄŸerleri KDV HARÄ°Ã‡ girilmiÅŸ
// (EÄŸer KDV dahil girildiyse kullanÄ±cÄ±ya sorulmalÄ±!)

// Geri alma (rollback):
// price_without_tax alanÄ± silinir</div>
        </section>

        <!-- RUNTIME HESAPLAMA -->
        <section>
            <h2>âš¡ Runtime Hesaplama MantÄ±ÄŸÄ±</h2>

            <div class="info-box">
                <h4>ğŸ¯ Temel Kural</h4>
                <p>Database'de SADECE <strong>price_without_tax</strong> ve <strong>tax_rate</strong> saklanÄ±r.</p>
                <p>KDV dahil fiyat â†’ Accessor ile runtime'da hesaplanÄ±r.</p>
            </div>

            <h3>FormÃ¼ller</h3>
            <div class="code-box">// KDV Dahil Fiyat Hesaplama (Accessor):
price_with_tax = price_without_tax Ã— (1 + tax_rate / 100)

// Ã–rnek 1: KDV %20
price_without_tax = 1.000 TL
tax_rate = 20
price_with_tax = 1.000 Ã— (1 + 20/100) = 1.000 Ã— 1.20 = 1.200 TL

// Ã–rnek 2: KDV %10
price_without_tax = 500 TL
tax_rate = 10
price_with_tax = 500 Ã— (1 + 10/100) = 500 Ã— 1.10 = 550 TL

// KDV TutarÄ±:
tax_amount = price_with_tax - price_without_tax
           = 1.200 - 1.000 = 200 TL</div>

            <h3>Neden Runtime?</h3>
            <ul>
                <li>âœ… KDV oranlarÄ± deÄŸiÅŸebilir (Ã¶rnek: %20 â†’ %18)</li>
                <li>âœ… Tek bir alanÄ± (tax_rate) gÃ¼ncelleyince tÃ¼m fiyatlar otomatik gÃ¼ncellenir</li>
                <li>âœ… Database'de gereksiz veri duplicasyonu Ã¶nlenir</li>
                <li>âœ… Her zaman tutarlÄ± hesaplama garantisi</li>
            </ul>
        </section>

        <!-- ADMIN PANEL TASARIMI -->
        <section>
            <h2>ğŸ¨ Admin Panel TasarÄ±mÄ±</h2>

            <div class="highlight-box">
                <h4>ğŸ“ Sayfa: /admin/shop/manage (ÃœrÃ¼n Ekle/DÃ¼zenle)</h4>
                <p>Livewire auto-calculation ile anlÄ±k hesaplama yapÄ±lacak.</p>
            </div>

            <div class="design-mockup">
                <h3 style="color: #1f2937; margin-bottom: 20px;">FiyatlandÄ±rma BÃ¶lÃ¼mÃ¼</h3>

                <!-- Setting Checkbox -->
                <div class="form-group">
                    <div class="form-checkbox">
                        <input type="checkbox" checked>
                        <label style="color: #1f2937; font-weight: 600;">
                            Fiyat giriÅŸi varsayÄ±lan: <strong>KDV Dahil</strong>
                        </label>
                    </div>
                    <small style="color: #6b7280; display: block; margin-top: 8px; margin-left: 30px;">
                        (Ayarlar â†’ shop_tax_default - KullanÄ±cÄ± isterse deÄŸiÅŸtirebilir)
                    </small>
                </div>

                <hr style="margin: 25px 0; border: 1px solid #e5e7eb;">

                <!-- shop_tax_default = AÃ‡IK (KDV Dahil) -->
                <h4 style="color: #1f2937; margin-bottom: 15px;">ğŸ“¥ Senaryo 1: KDV Dahil Fiyat GiriÅŸi</h4>

                <div class="form-group">
                    <label class="form-label">KDV Dahil Fiyat (Ana GiriÅŸ)</label>
                    <input type="text" class="form-input" value="1.200,00 TL" placeholder="Buraya giriÅŸ yapÄ±lÄ±r">
                </div>

                <div class="form-group">
                    <label class="form-label">KDV OranÄ± (%)</label>
                    <input type="text" class="form-input" value="20" readonly style="background: #e5e7eb;">
                </div>

                <div class="price-display">
                    <div class="price-item">
                        <strong>ğŸ”¢ Otomatik Hesaplanan (KDV HariÃ§):</strong>
                        <span>1.000,00 TL</span>
                    </div>
                    <div class="price-item">
                        <strong>ğŸ’° KDV TutarÄ±:</strong>
                        <span>200,00 TL</span>
                    </div>
                </div>

                <hr style="margin: 35px 0; border: 1px solid #e5e7eb;">

                <!-- shop_tax_default = KAPALI (KDV HariÃ§) -->
                <h4 style="color: #1f2937; margin-bottom: 15px;">ğŸ“¥ Senaryo 2: KDV HariÃ§ Fiyat GiriÅŸi</h4>
                <small style="color: #6b7280; display: block; margin-bottom: 15px;">
                    (KullanÄ±cÄ± checkbox'Ä± deÄŸiÅŸtirdi â†’ KDV HariÃ§ varsayÄ±lan oldu)
                </small>

                <div class="form-group">
                    <label class="form-label">KDV HariÃ§ Fiyat (Ana GiriÅŸ)</label>
                    <input type="text" class="form-input" value="1.000,00 TL" placeholder="Buraya giriÅŸ yapÄ±lÄ±r">
                </div>

                <div class="form-group">
                    <label class="form-label">KDV OranÄ± (%)</label>
                    <input type="text" class="form-input" value="20" readonly style="background: #e5e7eb;">
                </div>

                <div class="price-display">
                    <div class="price-item">
                        <strong>ğŸ”¢ Otomatik Hesaplanan (KDV Dahil):</strong>
                        <span>1.200,00 TL</span>
                    </div>
                    <div class="price-item">
                        <strong>ğŸ’° KDV TutarÄ±:</strong>
                        <span>200,00 TL</span>
                    </div>
                </div>
            </div>

            <div class="info-box">
                <h4>âš™ï¸ Teknik Detay: Livewire Auto-Calculation</h4>
                <ul>
                    <li>wire:model.live ile anlÄ±k hesaplama</li>
                    <li>updatedPriceWithTax() â†’ KDV hariÃ§ hesapla</li>
                    <li>updatedPriceWithoutTax() â†’ KDV dahil hesapla</li>
                    <li>Setting shop_tax_default'a gÃ¶re hangi alan disabled olacaÄŸÄ±nÄ± belirle</li>
                </ul>
            </div>
        </section>

        <!-- FRONTEND TASARIMI -->
        <section>
            <h2>ğŸ¨ Frontend TasarÄ±mÄ± (ÃœrÃ¼n KartlarÄ±)</h2>

            <div class="highlight-box">
                <h4>ğŸ“ Sayfalar: Homepage, Category, Shop Index</h4>
                <p>Setting <strong>shop_product_tax</strong> deÄŸerine gÃ¶re gÃ¶rÃ¼nÃ¼m deÄŸiÅŸir.</p>
            </div>

            <h3>Senaryo 1: shop_product_tax = AÃ‡IK (KDV Dahil GÃ¶ster)</h3>
            <div class="product-card">
                <h4>ğŸ—ï¸ Forklift 3 Ton AkÃ¼lÃ¼</h4>
                <p style="color: #6b7280; margin: 10px 0;">Elektrikli forklift, 3000 kg kaldÄ±rma kapasitesi</p>
                <div class="product-price">1.200,00 TL</div>
                <small style="color: #10b981; font-weight: 600;">KDV Dahil</small>
            </div>

            <h3>Senaryo 2: shop_product_tax = KAPALI (KDV HariÃ§ GÃ¶ster)</h3>
            <div class="product-card">
                <h4>ğŸ—ï¸ Forklift 3 Ton AkÃ¼lÃ¼</h4>
                <p style="color: #6b7280; margin: 10px 0;">Elektrikli forklift, 3000 kg kaldÄ±rma kapasitesi</p>
                <div class="product-price-alt">
                    1.000,00 TL <small>+ KDV</small>
                </div>
            </div>

            <div class="info-box">
                <h4>âš ï¸ Ã–nemli: Cart + Checkout HER ZAMAN KDV Dahil!</h4>
                <p>ÃœrÃ¼n kartlarÄ±nda hangi gÃ¶sterim seÃ§ilirse seÃ§ilsin, <strong>sepet ve Ã¶deme sayfalarÄ±nda HER ZAMAN KDV dahil fiyat gÃ¶sterilir.</strong></p>
                <p>Sebep: KullanÄ±cÄ±yÄ± son adÄ±mda yanÄ±ltmamak, net fiyat gÃ¶stermek.</p>
            </div>
        </section>

        <!-- Ã–ZET -->
        <section>
            <h2>âœ… Ã–zet & Onay Sorusu</h2>

            <div class="highlight-box">
                <h4>ğŸ“‹ TÃ¼m YapÄ±lacaklar</h4>
                <ol style="margin-left: 20px;">
                    <li><strong>Migration:</strong> price_without_tax ekle (033_add_price_without_tax_to_shop_products.php)</li>
                    <li><strong>Model:</strong> getPriceWithTaxAttribute() accessor ekle (ShopProduct.php)</li>
                    <li><strong>Admin Livewire:</strong> Auto-calculation ekle (ProductManageComponent.php)</li>
                    <li><strong>Frontend Blade:</strong> shop_product_tax setting'e gÃ¶re gÃ¶sterim (product-card.blade.php)</li>
                    <li><strong>CartService:</strong> Runtime calculation kullan (accessor Ã§aÄŸÄ±r)</li>
                    <li><strong>Subscription:</strong> AynÄ± mantÄ±ÄŸÄ± uygula (billing_cycles JSON'a tax ekle)</li>
                </ol>
            </div>

            <div class="alert-box">
                <h4>âš ï¸ Kritik Soru: Mevcut base_price DeÄŸerleri?</h4>
                <p><strong>Sorun:</strong> 1.021 Ã¼rÃ¼n var, bunlarÄ±n base_price deÄŸerleri KDV dahil mi hariÃ§ mi girilmiÅŸ?</p>
                <ul>
                    <li>âœ… KDV HARÄ°Ã‡ girildiyse â†’ Direkt price_without_tax'a kopyala</li>
                    <li>âŒ KDV DAHÄ°L girildiyse â†’ Ã–nce KDV'yi Ã§Ä±kar, sonra price_without_tax'a yaz</li>
                </ul>
                <p><strong>VarsayÄ±mÄ±m:</strong> KDV hariÃ§ girilmiÅŸ (Ã§Ã¼nkÃ¼ tax_rate alanÄ± var ve default 20.00)</p>
                <p><strong>OnayÄ±nÄ±z?</strong> Bu varsayÄ±m doÄŸru mu? Yoksa bir Ã¶rnek Ã¼rÃ¼ne bakayÄ±m mÄ±?</p>
            </div>
        </section>

        <footer>
            ğŸ¤– Claude AI - 2025-12-03
        </footer>
    </div>
</body>
</html>