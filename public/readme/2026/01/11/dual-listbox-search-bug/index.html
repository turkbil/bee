<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dual Listbox Arama Sorunu - Kritik Bug Analizi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', system-ui, -apple-system, sans-serif; }
        .code-block { background: #1e293b; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; }
        .code-block code { color: #e2e8f0; font-family: 'Fira Code', monospace; font-size: 0.875rem; }
        .highlight { background: #fef3c7; padding: 0.125rem 0.375rem; border-radius: 0.25rem; }
    </style>
</head>
<body class="bg-slate-900 text-white">
    <div class="max-w-6xl mx-auto px-6 py-12">

        <!-- Header -->
        <header class="mb-12">
            <div class="flex items-center gap-3 mb-4">
                <span class="px-3 py-1 bg-red-600 text-white text-sm font-semibold rounded-full">ğŸ› KRÄ°TÄ°K BUG</span>
                <span class="px-3 py-1 bg-slate-800 text-slate-300 text-sm rounded-full">11 Ocak 2026</span>
            </div>
            <h1 class="text-4xl font-bold mb-4 bg-gradient-to-r from-red-400 to-orange-400 bg-clip-text text-transparent">
                Dual Listbox Arama Sorunu
            </h1>
            <p class="text-xl text-slate-400">
                Soldan saÄŸa taÅŸÄ±nan item'lar arama yapÄ±lÄ±nca kayboluyor
            </p>
        </header>

        <!-- Basit AnlatÄ±m -->
        <div class="bg-green-900/20 border border-green-800 rounded-lg p-6 mb-8">
            <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                ğŸ“ Basit AnlatÄ±m (Herkes Ä°Ã§in)
            </h3>
            <div class="space-y-4 text-slate-300">
                <p class="text-lg leading-relaxed">
                    <strong class="text-green-400">Sorun nedir?</strong><br>
                    Admin panelde radyo, playlist, sektÃ¶r gibi yerlerde "soldan saÄŸa seÃ§im yapma" sistemi var.
                    KullanÄ±cÄ± sol taraftan bir ÅŸey seÃ§ip saÄŸ tarafa taÅŸÄ±yor. Sonra baÅŸka bir ÅŸey aramak iÃ§in
                    arama kutusuna yazÄ±yor. <span class="highlight text-slate-900">O anda daha Ã¶nce seÃ§tiÄŸi ÅŸeyler
                    kayboluyor!</span>
                </p>

                <p class="text-lg leading-relaxed">
                    <strong class="text-green-400">Ã–rnek senaryo:</strong><br>
                    Radyo oluÅŸtururken 5 tane playlist seÃ§tin â†’ SaÄŸ tarafa taÅŸÄ±dÄ±n â†’ Tamam gÃ¼zel!<br>
                    Sonra 6. playlist'i bulmak iÃ§in arama yaptÄ±n â†’ <span class="text-red-400 font-bold">
                    Ä°lk 5 playlist kayboldu!</span>
                </p>

                <p class="text-lg leading-relaxed">
                    <strong class="text-green-400">Neden Ã¶nemli?</strong><br>
                    KullanÄ±cÄ± radyo oluÅŸtururken 20 tane playlist seÃ§miÅŸ olabilir. Aramak istediÄŸinde
                    hepsi uÃ§uyor ve baÅŸtan seÃ§mek zorunda kalÄ±yor. Bu <strong>kullanÄ±lamaz</strong> bir deneyim.
                </p>

                <div class="bg-slate-800/50 rounded-lg p-4 mt-4">
                    <p class="text-sm text-slate-400 mb-2"><strong>Etkilenen Sayfalar:</strong></p>
                    <ul class="list-disc list-inside space-y-1 text-sm">
                        <li><code class="text-blue-400">admin/muzibu/radio/manage</code> - Radyo yÃ¶netimi (playlist seÃ§imi)</li>
                        <li><code class="text-blue-400">admin/muzibu/playlist/manage</code> - Playlist yÃ¶netimi (sektÃ¶r, radyo, tÃ¼r, kurum seÃ§imi)</li>
                        <li><code class="text-blue-400">admin/muzibu/song/manage</code> - ÅarkÄ± yÃ¶netimi (muhtemelen varsa)</li>
                        <li><code class="text-blue-400">admin/muzibu/sector/manage</code> - SektÃ¶r yÃ¶netimi (muhtemelen varsa)</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Teknik Detaylar -->
        <div class="bg-blue-900/20 border border-blue-800 rounded-lg p-6 mb-8">
            <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                ğŸ”§ Teknik Detaylar (GeliÅŸtiriciler Ä°Ã§in)
            </h3>

            <div class="space-y-6">
                <!-- Sorunun KÃ¶k Nedeni -->
                <div>
                    <h4 class="text-lg font-semibold text-blue-400 mb-3">ğŸ¯ Sorunun KÃ¶k Nedeni</h4>
                    <div class="bg-slate-800/50 rounded-lg p-4 space-y-3">
                        <p class="text-slate-300 leading-relaxed">
                            Dual listbox sistemi <strong>hybrid</strong> bir yapÄ±:
                        </p>
                        <ul class="list-disc list-inside space-y-2 text-slate-300 ml-4">
                            <li><strong class="text-yellow-400">Livewire (Backend):</strong> VeritabanÄ±ndan data Ã§ekiyor, arama yapÄ±yor</li>
                            <li><strong class="text-yellow-400">JavaScript (Frontend):</strong> DOM manipÃ¼lasyonu yapÄ±yor (soldan saÄŸa taÅŸÄ±ma)</li>
                            <li><strong class="text-red-400">SORUN:</strong> Ä°ki sistem senkronize deÄŸil!</li>
                        </ul>
                    </div>
                </div>

                <!-- AkÄ±ÅŸ DiyagramÄ± -->
                <div>
                    <h4 class="text-lg font-semibold text-blue-400 mb-3">ğŸ“Š HatalÄ± AkÄ±ÅŸ</h4>
                    <div class="bg-slate-800/50 rounded-lg p-4">
                        <pre class="text-sm text-slate-300"><code>1ï¸âƒ£ KullanÄ±cÄ± "Playlist A" seÃ§ti
   â†’ JavaScript: DOM'da soldan saÄŸa taÅŸÄ±dÄ± âœ…
   â†’ JavaScript: @this.set('inputs.playlist_ids', [1]) gÃ¶nderdi âœ…
   â†’ Livewire: $inputs['playlist_ids'] = [1] âœ…

2ï¸âƒ£ KullanÄ±cÄ± "Playlist B"yi aramak iÃ§in "search" yazdÄ±
   â†’ Livewire: $playlistSearch = "search" deÄŸiÅŸti
   â†’ Livewire: activePlaylists() computed property tetiklendi
   â†’ Livewire: Sadece "search" iÃ§eren playlist'leri getir
   â†’ Livewire: RENDER! (Blade yeniden render edildi)

3ï¸âƒ£ Blade Render SÄ±rasÄ±nda:
   @foreach($this->activePlaylists as $playlist)
       // activePlaylists() sadece arama sonuÃ§larÄ±nÄ± dÃ¶ndÃ¼rÃ¼yor
       // "Playlist A" arama sonucunda YOK!
       // Blade "Playlist A"yÄ± gÃ¶rmÃ¼yor
       // SaÄŸ tarafta render edilemiyor
   @endforeach

4ï¸âƒ£ SONUÃ‡:
   âŒ "Playlist A" kayboldu! (Arama sonucunda olmadÄ±ÄŸÄ± iÃ§in render edilmedi)
   âŒ KullanÄ±cÄ± "Playlist A"yÄ± gÃ¶rmÃ¼yor
   âŒ Tekrar aramak zorunda kalÄ±yor</code></pre>
                    </div>
                </div>

                <!-- Mevcut Kod -->
                <div>
                    <h4 class="text-lg font-semibold text-blue-400 mb-3">ğŸ“„ Mevcut Kod (HatalÄ±)</h4>

                    <p class="text-sm text-slate-400 mb-2">
                        <strong>Dosya:</strong> <code>RadioManageComponent.php</code>
                    </p>
                    <div class="code-block">
                        <code>#[Computed]
public function activePlaylists()
{
    $query = \Modules\Muzibu\App\Models\Playlist::where('is_active', true);

    // âŒ SORUN: Sadece arama sonuÃ§larÄ±nÄ± dÃ¶ndÃ¼rÃ¼yor
    if (!empty($this->playlistSearch)) {
        $locale = app()->getLocale();
        $search = strtolower($this->playlistSearch);

        $query->where(function($q) use ($search, $locale) {
            $q->whereRaw("LOWER(JSON_UNQUOTE(JSON_EXTRACT(title, ?))) LIKE ?",
                ["$.{$locale}", "%{$search}%"]);
        });
    }

    return $query->orderBy('title->tr')->get();
    // âŒ SeÃ§ili item'lar arama sonucunda yoksa render edilmiyor!
}</code>
                    </div>

                    <p class="text-sm text-slate-400 mb-2 mt-4">
                        <strong>Dosya:</strong> <code>radio-manage-component.blade.php</code>
                    </p>
                    <div class="code-block">
                        <code>&lt;!-- Sol Taraf: Mevcut Listeler --&gt;
&lt;div class="listbox" id="available-playlists"&gt;
    @foreach($this->activePlaylists as $playlist)
        @if(!in_array($playlist->playlist_id, $inputs['playlist_ids'] ?? []))
            &lt;div class="listbox-item"&gt;{{ $playlist->title }}&lt;/div&gt;
        @endif
    @endforeach
&lt;/div&gt;

&lt;!-- SaÄŸ Taraf: SeÃ§ilen Listeler --&gt;
&lt;div class="listbox" id="selected-playlists"&gt;
    @foreach($this->activePlaylists as $playlist)
        @if(in_array($playlist->playlist_id, $inputs['playlist_ids'] ?? []))
            &lt;!-- âŒ SORUN: activePlaylists'te yoksa burasÄ± boÅŸ kalÄ±yor! --&gt;
            &lt;div class="listbox-item"&gt;{{ $playlist->title }}&lt;/div&gt;
        @endif
    @endforeach
&lt;/div&gt;</code>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ã‡Ã¶zÃ¼m -->
        <div class="bg-purple-900/20 border border-purple-800 rounded-lg p-6 mb-8">
            <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                âœ¨ Ã‡Ã¶zÃ¼m Stratejisi
            </h3>

            <div class="space-y-6">
                <!-- Ana Ã‡Ã¶zÃ¼m -->
                <div>
                    <h4 class="text-lg font-semibold text-purple-400 mb-3">ğŸ¯ Ana Ã‡Ã¶zÃ¼m</h4>
                    <div class="bg-slate-800/50 rounded-lg p-4">
                        <p class="text-slate-300 mb-3">
                            <code>activePlaylists()</code> computed property'sini <strong>iki ayrÄ± property'ye</strong> bÃ¶l:
                        </p>
                        <ul class="list-disc list-inside space-y-2 text-slate-300 ml-4">
                            <li><code class="text-green-400">availablePlaylists()</code> â†’ Arama sonuÃ§larÄ± (seÃ§ilmemiÅŸ olanlar)</li>
                            <li><code class="text-green-400">selectedPlaylists()</code> â†’ SeÃ§ili olanlar (her zaman render et)</li>
                        </ul>
                    </div>
                </div>

                <!-- Yeni Kod -->
                <div>
                    <h4 class="text-lg font-semibold text-purple-400 mb-3">ğŸ“ Yeni Kod (DÃ¼zeltilmiÅŸ)</h4>

                    <p class="text-sm text-slate-400 mb-2">
                        <strong>Backend:</strong> <code>RadioManageComponent.php</code>
                    </p>
                    <div class="code-block">
                        <code>// âœ… Ã‡Ã–ZÃœM 1: SeÃ§ilmemiÅŸ olanlar (arama sonuÃ§larÄ±)
#[Computed]
public function availablePlaylists()
{
    $query = \Modules\Muzibu\App\Models\Playlist::where('is_active', true);

    // SeÃ§ilenleri hariÃ§ tut
    if (!empty($this->inputs['playlist_ids'])) {
        $query->whereNotIn('playlist_id', $this->inputs['playlist_ids']);
    }

    // Arama filtresi
    if (!empty($this->playlistSearch)) {
        $locale = app()->getLocale();
        $search = strtolower($this->playlistSearch);

        $query->where(function($q) use ($search, $locale) {
            $q->whereRaw("LOWER(JSON_UNQUOTE(JSON_EXTRACT(title, ?))) LIKE ?",
                ["$.{$locale}", "%{$search}%"]);
        });
    }

    return $query->orderBy('title->tr')->get();
}

// âœ… Ã‡Ã–ZÃœM 2: SeÃ§ili olanlar (her zaman gÃ¶ster)
#[Computed]
public function selectedPlaylists()
{
    if (empty($this->inputs['playlist_ids'])) {
        return collect([]);
    }

    // SeÃ§ili playlist'leri ID'ye gÃ¶re getir
    return \Modules\Muzibu\App\Models\Playlist::whereIn('playlist_id', $this->inputs['playlist_ids'])
        ->orderBy('title->tr')
        ->get();
}</code>
                    </div>

                    <p class="text-sm text-slate-400 mb-2 mt-4">
                        <strong>Frontend:</strong> <code>radio-manage-component.blade.php</code>
                    </p>
                    <div class="code-block">
                        <code>&lt;!-- Sol Taraf: Mevcut Listeler (SeÃ§ilmemiÅŸ + Arama SonuÃ§larÄ±) --&gt;
&lt;div class="listbox" id="available-playlists"&gt;
    @foreach($this->availablePlaylists as $playlist)
        &lt;div class="listbox-item"
            data-value="{{ $playlist->playlist_id }}"&gt;
            {{ $playlist->getTranslated('title', app()->getLocale()) }}
        &lt;/div&gt;
    @endforeach
&lt;/div&gt;

&lt;!-- SaÄŸ Taraf: SeÃ§ilen Listeler (Her Zaman GÃ¶ster) --&gt;
&lt;div class="listbox" id="selected-playlists"&gt;
    @foreach($this->selectedPlaylists as $playlist)
        &lt;!-- âœ… Ã‡Ã–ZÃœM: SeÃ§ililer her zaman render ediliyor --&gt;
        &lt;div class="listbox-item"
            data-value="{{ $playlist->playlist_id }}"&gt;
            {{ $playlist->getTranslated('title', app()->getLocale()) }}
        &lt;/div&gt;
    @endforeach
&lt;/div&gt;</code>
                    </div>
                </div>

                <!-- Avantajlar -->
                <div>
                    <h4 class="text-lg font-semibold text-purple-400 mb-3">ğŸ Ã‡Ã¶zÃ¼mÃ¼n AvantajlarÄ±</h4>
                    <div class="bg-slate-800/50 rounded-lg p-4">
                        <ul class="list-disc list-inside space-y-2 text-slate-300 ml-4">
                            <li><strong class="text-green-400">âœ… SeÃ§ililer kaybolmaz:</strong> Her zaman saÄŸ tarafta render edilir</li>
                            <li><strong class="text-green-400">âœ… Arama Ã§alÄ±ÅŸÄ±r:</strong> Sol taraf sadece arama sonuÃ§larÄ±nÄ± gÃ¶sterir</li>
                            <li><strong class="text-green-400">âœ… Performans:</strong> SeÃ§ilmemiÅŸler filtrelenir, gereksiz data yok</li>
                            <li><strong class="text-green-400">âœ… UX:</strong> KullanÄ±cÄ± istediÄŸi kadar arama yapabilir, seÃ§imleri korunur</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Etkilenen Dosyalar -->
        <div class="bg-orange-900/20 border border-orange-800 rounded-lg p-6 mb-8">
            <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                ğŸ“ DÃ¼zeltilmesi Gereken Dosyalar
            </h3>

            <div class="space-y-4">
                <!-- Radio -->
                <div class="bg-slate-800/50 rounded-lg p-4">
                    <h4 class="text-lg font-semibold text-orange-400 mb-3">
                        ğŸµ Radio ModÃ¼lÃ¼
                    </h4>
                    <ul class="space-y-2 text-sm text-slate-300">
                        <li>
                            <code class="text-blue-400">Modules/Muzibu/App/Http/Livewire/Admin/RadioManageComponent.php</code>
                            <ul class="ml-6 mt-1 space-y-1 text-xs text-slate-400">
                                <li>â€¢ <code>activePlaylists()</code> â†’ <code>availablePlaylists()</code> + <code>selectedPlaylists()</code></li>
                            </ul>
                        </li>
                        <li>
                            <code class="text-blue-400">Modules/Muzibu/resources/views/admin/livewire/radio-manage-component.blade.php</code>
                            <ul class="ml-6 mt-1 space-y-1 text-xs text-slate-400">
                                <li>â€¢ <code>$this->activePlaylists</code> â†’ <code>$this->availablePlaylists</code> ve <code>$this->selectedPlaylists</code></li>
                            </ul>
                        </li>
                    </ul>
                </div>

                <!-- Playlist -->
                <div class="bg-slate-800/50 rounded-lg p-4">
                    <h4 class="text-lg font-semibold text-orange-400 mb-3">
                        ğŸ“‹ Playlist ModÃ¼lÃ¼
                    </h4>
                    <ul class="space-y-2 text-sm text-slate-300">
                        <li>
                            <code class="text-blue-400">Modules/Muzibu/App/Http/Livewire/Admin/PlaylistManageComponent.php</code>
                            <ul class="ml-6 mt-1 space-y-1 text-xs text-slate-400">
                                <li>â€¢ <code>activeSectors()</code> â†’ <code>availableSectors()</code> + <code>selectedSectors()</code></li>
                                <li>â€¢ <code>activeRadios()</code> â†’ <code>availableRadios()</code> + <code>selectedRadios()</code></li>
                                <li>â€¢ <code>activeGenres()</code> â†’ <code>availableGenres()</code> + <code>selectedGenres()</code></li>
                                <li>â€¢ <code>activeCorporates()</code> â†’ <code>availableCorporates()</code> + <code>selectedCorporates()</code></li>
                            </ul>
                        </li>
                        <li>
                            <code class="text-blue-400">Modules/Muzibu/resources/views/admin/livewire/playlist-manage-component.blade.php</code>
                            <ul class="ml-6 mt-1 space-y-1 text-xs text-slate-400">
                                <li>â€¢ TÃ¼m <code>$this->active*</code> referanslarÄ±nÄ± <code>$this->available*</code> ve <code>$this->selected*</code> olarak ayÄ±r</li>
                            </ul>
                        </li>
                    </ul>
                </div>

                <!-- DiÄŸer ModÃ¼ller -->
                <div class="bg-slate-800/50 rounded-lg p-4">
                    <h4 class="text-lg font-semibold text-orange-400 mb-3">
                        ğŸ” Kontrol Edilmesi Gereken DiÄŸer ModÃ¼ller
                    </h4>
                    <ul class="space-y-2 text-sm text-slate-300">
                        <li>
                            <code class="text-blue-400">SongManageComponent.php</code>
                            <span class="text-slate-400 text-xs ml-2">(varsa playlist/album/artist seÃ§imi)</span>
                        </li>
                        <li>
                            <code class="text-blue-400">SectorManageComponent.php</code>
                            <span class="text-slate-400 text-xs ml-2">(varsa playlist seÃ§imi)</span>
                        </li>
                        <li>
                            <code class="text-blue-400">AlbumManageComponent.php</code>
                            <span class="text-slate-400 text-xs ml-2">(varsa song seÃ§imi)</span>
                        </li>
                    </ul>
                    <p class="text-xs text-slate-400 mt-3">
                        ğŸ’¡ TÃ¼m dual listbox kullanan component'lerde aynÄ± pattern uygulanmalÄ±!
                    </p>
                </div>
            </div>
        </div>

        <!-- Test Senaryosu -->
        <div class="bg-cyan-900/20 border border-cyan-800 rounded-lg p-6 mb-8">
            <h3 class="text-xl font-bold mb-4 flex items-center gap-2">
                ğŸ§ª Test Senaryosu
            </h3>

            <div class="space-y-4">
                <div class="bg-slate-800/50 rounded-lg p-4">
                    <h4 class="text-lg font-semibold text-cyan-400 mb-3">1ï¸âƒ£ Test AdÄ±mlarÄ±</h4>
                    <ol class="list-decimal list-inside space-y-2 text-slate-300 ml-4">
                        <li>Admin panel â†’ Radyo oluÅŸtur sayfasÄ±na git</li>
                        <li>Sol taraftan 5 playlist seÃ§ â†’ SaÄŸ tarafa taÅŸÄ±</li>
                        <li>Arama kutusuna "test" yaz</li>
                        <li><strong class="text-green-400">âœ… BEKLENEN:</strong> SaÄŸ tarafta 5 playlist hala gÃ¶rÃ¼nÃ¼yor</li>
                        <li><strong class="text-red-400">âŒ MEVCUT:</strong> SaÄŸ taraf boÅŸaldÄ± (5 playlist kayboldu)</li>
                        <li>AramayÄ± temizle</li>
                        <li><strong class="text-green-400">âœ… BEKLENEN:</strong> Sol tarafta tÃ¼m playlist'ler, saÄŸ tarafta 5 seÃ§ili</li>
                    </ol>
                </div>

                <div class="bg-slate-800/50 rounded-lg p-4">
                    <h4 class="text-lg font-semibold text-cyan-400 mb-3">2ï¸âƒ£ Test SayfalarÄ±</h4>
                    <ul class="list-disc list-inside space-y-2 text-slate-300 ml-4">
                        <li><code class="text-blue-400">muzibu.com/admin/muzibu/radio/manage</code></li>
                        <li><code class="text-blue-400">muzibu.com/admin/muzibu/playlist/manage</code></li>
                        <li><code class="text-blue-400">muzibu.com/admin/muzibu/song/manage</code> (varsa)</li>
                    </ul>
                </div>

                <div class="bg-slate-800/50 rounded-lg p-4">
                    <h4 class="text-lg font-semibold text-cyan-400 mb-3">3ï¸âƒ£ BaÅŸarÄ± Kriterleri</h4>
                    <ul class="list-disc list-inside space-y-2 text-slate-300 ml-4">
                        <li><strong class="text-green-400">âœ…</strong> Arama yapÄ±lÄ±nca seÃ§ili item'lar kaybolmamalÄ±</li>
                        <li><strong class="text-green-400">âœ…</strong> Sol taraf sadece seÃ§ilmemiÅŸ item'larÄ± gÃ¶stermeli</li>
                        <li><strong class="text-green-400">âœ…</strong> SaÄŸ taraf her zaman seÃ§ili item'larÄ± gÃ¶stermeli</li>
                        <li><strong class="text-green-400">âœ…</strong> Kaydet butonuna basÄ±nca seÃ§ili item'lar database'e yazÄ±lmalÄ±</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="text-center text-slate-500 text-sm pt-8 border-t border-slate-800">
            <p>ğŸ¤– Claude AI tarafÄ±ndan oluÅŸturuldu - 11 Ocak 2026</p>
        </footer>

    </div>
</body>
</html>
