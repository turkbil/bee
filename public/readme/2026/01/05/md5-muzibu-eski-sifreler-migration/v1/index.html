<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MD5 Muzibu Eski Åifreler - Laravel Migration Rehberi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .code-block { background: #1e293b; border-radius: 8px; padding: 16px; overflow-x: auto; }
        .code-block code { color: #e2e8f0; font-family: 'Fira Code', monospace; font-size: 14px; }
        .step-number { width: 32px; height: 32px; background: #3b82f6; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0; }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen">
    <div class="max-w-5xl mx-auto px-4 py-8">

        <!-- Header -->
        <header class="text-center mb-12">
            <div class="inline-flex items-center gap-2 bg-amber-500/20 text-amber-400 px-4 py-2 rounded-full text-sm mb-4">
                <span>ğŸ”</span>
                <span>GeÃ§ici Servis - Ä°leride KaldÄ±rÄ±lacak</span>
            </div>
            <h1 class="text-4xl font-bold mb-4">MD5 Muzibu Eski Åifreler</h1>
            <h2 class="text-xl text-slate-400">Laravel Password Migration Rehberi</h2>
            <p class="text-slate-500 mt-4">5 Ocak 2026 - Tenant 1001 (Muzibu)</p>

            <div class="flex justify-center gap-4 mt-6">
                <span class="bg-blue-500/20 text-blue-400 px-3 py-1 rounded text-sm">md5</span>
                <span class="bg-purple-500/20 text-purple-400 px-3 py-1 rounded text-sm">bcrypt</span>
                <span class="bg-green-500/20 text-green-400 px-3 py-1 rounded text-sm">tenant-1001</span>
                <span class="bg-orange-500/20 text-orange-400 px-3 py-1 rounded text-sm">muzibu</span>
            </div>
        </header>

        <!-- Basit AnlatÄ±m -->
        <section class="bg-green-900/20 border border-green-800 rounded-lg p-6 mb-8">
            <h3 class="text-xl font-bold text-green-400 mb-4">ğŸ“ Basit AnlatÄ±m (Herkes Ä°Ã§in)</h3>
            <div class="space-y-4 text-slate-300">
                <p>
                    <strong>Problem:</strong> Muzibu'nun eski sisteminde kullanÄ±cÄ± ÅŸifreleri MD5 ile saklanÄ±yordu.
                    MD5 artÄ±k gÃ¼venli deÄŸil ve Laravel bcrypt kullanÄ±yor.
                </p>
                <p>
                    <strong>Ã‡Ã¶zÃ¼m:</strong> KullanÄ±cÄ± giriÅŸ yaptÄ±ÄŸÄ±nda, eski ÅŸifresi otomatik olarak yeni gÃ¼venli formata
                    Ã§evriliyor. KullanÄ±cÄ± hiÃ§bir ÅŸey fark etmiyor, ÅŸifre deÄŸiÅŸtirmek zorunda kalmÄ±yor.
                </p>
                <p>
                    <strong>SonuÃ§:</strong> Zamanla tÃ¼m kullanÄ±cÄ±lar en az bir kez giriÅŸ yapacak ve ÅŸifreleri
                    otomatik gÃ¼ncellenecek. Herkes geÃ§iÅŸ yapÄ±nca bu sistemi kaldÄ±racaÄŸÄ±z.
                </p>
            </div>
        </section>

        <!-- Teknik Detaylar -->
        <section class="bg-blue-900/20 border border-blue-800 rounded-lg p-6 mb-8">
            <h3 class="text-xl font-bold text-blue-400 mb-4">ğŸ”§ Teknik Detaylar (GeliÅŸtiriciler Ä°Ã§in)</h3>
            <div class="grid md:grid-cols-2 gap-4 text-sm">
                <div class="bg-slate-800/50 rounded p-4">
                    <h4 class="font-bold text-slate-300 mb-2">ğŸ“ Dosyalar</h4>
                    <ul class="space-y-1 text-slate-400">
                        <li>â€¢ app/Services/Auth/LegacyPasswordMigrationService.php</li>
                        <li>â€¢ app/Auth/LegacyUserProvider.php</li>
                        <li>â€¢ app/Providers/AuthServiceProvider.php</li>
                        <li>â€¢ config/auth.php</li>
                    </ul>
                </div>
                <div class="bg-slate-800/50 rounded p-4">
                    <h4 class="font-bold text-slate-300 mb-2">âš™ï¸ Teknoloji</h4>
                    <ul class="space-y-1 text-slate-400">
                        <li>â€¢ MD5 â†’ 32 karakter hex string</li>
                        <li>â€¢ bcrypt â†’ 60 karakter ($2y$ prefix)</li>
                        <li>â€¢ Tenant-aware kontrol</li>
                        <li>â€¢ Laravel Log entegrasyonu</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- BÃ–LÃœM 1: OLUÅTURMA -->
        <section class="mb-12">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center text-xl">ğŸ› ï¸</div>
                <h2 class="text-2xl font-bold text-green-400">OLUÅTURMA (4 AdÄ±m)</h2>
            </div>

            <!-- AdÄ±m 1 -->
            <div class="bg-slate-800 rounded-lg p-6 mb-4">
                <div class="flex items-start gap-4">
                    <div class="step-number text-white">1</div>
                    <div class="flex-1">
                        <h4 class="font-bold text-lg mb-2">Service DosyasÄ±nÄ± OluÅŸtur</h4>
                        <p class="text-slate-400 mb-3">Ana migration servisi - tÃ¼m mantÄ±k burada</p>
                        <div class="bg-slate-900 rounded p-2 text-sm text-slate-400 mb-3">
                            ğŸ“ app/Services/Auth/LegacyPasswordMigrationService.php
                        </div>
                        <details class="bg-slate-900/50 rounded p-4">
                            <summary class="cursor-pointer text-blue-400 font-medium">Kodu GÃ¶ster</summary>
                            <pre class="mt-4 text-xs text-slate-300 overflow-x-auto"><code>&lt;?php

namespace App\Services\Auth;

use Illuminate\Contracts\Auth\Authenticatable;
use Illuminate\Support\Facades\Hash;
use Illuminate\Support\Facades\Log;

/**
 * Legacy MD5 Password Migration Service
 *
 * âš ï¸ GEÃ‡Ä°CÄ° SERVÄ°S - TÃ¼m kullanÄ±cÄ±lar migrate olunca kaldÄ±rÄ±lacak!
 *
 * Arama: md5 muzibu eski ÅŸifreler migration
 */
class LegacyPasswordMigrationService
{
    /**
     * Migration aktif olan tenant'lar
     */
    protected array $enabledTenants = [1001]; // Sadece Muzibu

    /**
     * Bu tenant iÃ§in legacy migration aktif mi?
     */
    public function isEnabled(): bool
    {
        return tenant() && in_array(tenant()-&gt;id, $this-&gt;enabledTenants);
    }

    /**
     * MD5 hash mi kontrol et (32 karakter hex)
     */
    public function isLegacyHash(string $hash): bool
    {
        return strlen($hash) === 32 && ctype_xdigit($hash);
    }

    /**
     * Legacy ÅŸifre doÄŸrula ve migrate et
     *
     * @return bool|null  true=baÅŸarÄ±lÄ±, false=yanlÄ±ÅŸ ÅŸifre, null=legacy deÄŸil
     */
    public function validateAndMigrate(Authenticatable $user, string $plainPassword): ?bool
    {
        // Tenant kontrolÃ¼
        if (!$this-&gt;isEnabled()) {
            return null;
        }

        $storedHash = $user-&gt;getAuthPassword();

        // Legacy hash deÄŸilse normal auth'a bÄ±rak
        if (!$this-&gt;isLegacyHash($storedHash)) {
            return null;
        }

        // MD5 kontrolÃ¼
        if (md5($plainPassword) !== $storedHash) {
            return false;
        }

        // âœ… Åifreyi bcrypt'e migrate et
        $user-&gt;password = Hash::make($plainPassword);
        $user-&gt;save();

        // Log tut (takip iÃ§in)
        Log::channel('single')-&gt;info('Legacy MD5 password migrated to bcrypt', [
            'tenant_id' =&gt; tenant()-&gt;id,
            'user_id' =&gt; $user-&gt;getAuthIdentifier(),
            'user_email' =&gt; $user-&gt;email ?? 'N/A',
        ]);

        return true;
    }

    /**
     * KaÃ§ kullanÄ±cÄ± hala MD5 kullanÄ±yor? (Ä°statistik)
     */
    public function getRemainingLegacyCount(): int
    {
        if (!$this-&gt;isEnabled()) {
            return 0;
        }

        return \App\Models\User::whereRaw('LENGTH(password) = 32')-&gt;count();
    }
}</code></pre>
                        </details>
                    </div>
                </div>
            </div>

            <!-- AdÄ±m 2 -->
            <div class="bg-slate-800 rounded-lg p-6 mb-4">
                <div class="flex items-start gap-4">
                    <div class="step-number text-white">2</div>
                    <div class="flex-1">
                        <h4 class="font-bold text-lg mb-2">Custom User Provider OluÅŸtur</h4>
                        <p class="text-slate-400 mb-3">Laravel auth sistemine baÄŸlanÄ±r</p>
                        <div class="bg-slate-900 rounded p-2 text-sm text-slate-400 mb-3">
                            ğŸ“ app/Auth/LegacyUserProvider.php
                        </div>
                        <details class="bg-slate-900/50 rounded p-4">
                            <summary class="cursor-pointer text-blue-400 font-medium">Kodu GÃ¶ster</summary>
                            <pre class="mt-4 text-xs text-slate-300 overflow-x-auto"><code>&lt;?php

namespace App\Auth;

use App\Services\Auth\LegacyPasswordMigrationService;
use Illuminate\Auth\EloquentUserProvider;
use Illuminate\Contracts\Auth\Authenticatable;
use Illuminate\Support\Facades\Hash;

/**
 * Legacy User Provider
 *
 * âš ï¸ GEÃ‡Ä°CÄ° - MD5 migration tamamlanÄ±nca kaldÄ±rÄ±lacak!
 */
class LegacyUserProvider extends EloquentUserProvider
{
    public function validateCredentials(Authenticatable $user, array $credentials): bool
    {
        $plainPassword = $credentials['password'];

        // Legacy migration servisini Ã§aÄŸÄ±r
        $migrationService = app(LegacyPasswordMigrationService::class);
        $result = $migrationService-&gt;validateAndMigrate($user, $plainPassword);

        // null deÄŸilse sonucu dÃ¶ndÃ¼r (true veya false)
        if ($result !== null) {
            return $result;
        }

        // Legacy deÄŸil â†’ Normal Laravel auth
        return Hash::check($plainPassword, $user-&gt;getAuthPassword());
    }
}</code></pre>
                        </details>
                    </div>
                </div>
            </div>

            <!-- AdÄ±m 3 -->
            <div class="bg-slate-800 rounded-lg p-6 mb-4">
                <div class="flex items-start gap-4">
                    <div class="step-number text-white">3</div>
                    <div class="flex-1">
                        <h4 class="font-bold text-lg mb-2">AuthServiceProvider'a Kaydet</h4>
                        <p class="text-slate-400 mb-3">Provider'Ä± Laravel'e tanÄ±t</p>
                        <div class="bg-slate-900 rounded p-2 text-sm text-slate-400 mb-3">
                            ğŸ“ app/Providers/AuthServiceProvider.php â†’ boot() metoduna ekle
                        </div>
                        <details class="bg-slate-900/50 rounded p-4">
                            <summary class="cursor-pointer text-blue-400 font-medium">Eklenecek Kodu GÃ¶ster</summary>
                            <pre class="mt-4 text-xs text-slate-300 overflow-x-auto"><code>use App\Auth\LegacyUserProvider;
use Illuminate\Support\Facades\Auth;

public function boot(): void
{
    // ... mevcut kodlar ...

    // âš ï¸ GEÃ‡Ä°CÄ°: MD5 Legacy Password Migration (Tenant 1001)
    // TÃ¼m kullanÄ±cÄ±lar migrate olunca kaldÄ±rÄ±lacak!
    Auth::provider('legacy', function ($app, array $config) {
        return new LegacyUserProvider(
            $app['hash'],
            $config['model']
        );
    });
}</code></pre>
                        </details>
                    </div>
                </div>
            </div>

            <!-- AdÄ±m 4 -->
            <div class="bg-slate-800 rounded-lg p-6 mb-4">
                <div class="flex items-start gap-4">
                    <div class="step-number text-white">4</div>
                    <div class="flex-1">
                        <h4 class="font-bold text-lg mb-2">Config'de Driver'Ä± DeÄŸiÅŸtir</h4>
                        <p class="text-slate-400 mb-3">Auth driver'Ä± legacy olarak ayarla</p>
                        <div class="bg-slate-900 rounded p-2 text-sm text-slate-400 mb-3">
                            ğŸ“ config/auth.php â†’ providers.users.driver
                        </div>
                        <details class="bg-slate-900/50 rounded p-4">
                            <summary class="cursor-pointer text-blue-400 font-medium">DeÄŸiÅŸikliÄŸi GÃ¶ster</summary>
                            <pre class="mt-4 text-xs text-slate-300 overflow-x-auto"><code>'providers' => [
    'users' => [
        'driver' => 'legacy',  // âš ï¸ 'eloquent' â†’ 'legacy' (GEÃ‡Ä°CÄ°)
        'model' => App\Models\User::class,
    ],
],</code></pre>
                        </details>
                    </div>
                </div>
            </div>

            <!-- Test -->
            <div class="bg-green-900/30 border border-green-700 rounded-lg p-6">
                <h4 class="font-bold text-green-400 mb-3">âœ… Test Etme</h4>
                <div class="space-y-2 text-sm text-slate-300">
                    <p>1. Muzibu'da MD5 ÅŸifreli bir kullanÄ±cÄ± ile giriÅŸ yap</p>
                    <p>2. GiriÅŸ baÅŸarÄ±lÄ± olmalÄ±</p>
                    <p>3. Log kontrolÃ¼:</p>
                    <div class="bg-slate-900 rounded p-3 mt-2 font-mono text-xs">
                        grep "Legacy MD5 password migrated" storage/logs/laravel.log
                    </div>
                    <p class="mt-2">4. Database kontrolÃ¼ (ÅŸifre 60 karakter olmalÄ±):</p>
                    <div class="bg-slate-900 rounded p-3 mt-2 font-mono text-xs">
                        SELECT id, email, LENGTH(password) FROM users WHERE id = X;
                    </div>
                </div>
            </div>
        </section>

        <!-- BÃ–LÃœM 2: KALDIRMA -->
        <section class="mb-12">
            <div class="flex items-center gap-3 mb-6">
                <div class="w-10 h-10 bg-red-500 rounded-lg flex items-center justify-center text-xl">ğŸ—‘ï¸</div>
                <h2 class="text-2xl font-bold text-red-400">KALDIRMA (3 AdÄ±m)</h2>
            </div>

            <div class="bg-amber-900/20 border border-amber-700 rounded-lg p-4 mb-6">
                <p class="text-amber-400">
                    <strong>âš ï¸ Ne Zaman KaldÄ±rÄ±lÄ±r?</strong><br>
                    TÃ¼m kullanÄ±cÄ±lar en az bir kez giriÅŸ yaptÄ±ÄŸÄ±nda. Kontrol komutu:
                </p>
                <div class="bg-slate-900 rounded p-3 mt-2 font-mono text-xs text-slate-300">
                    SELECT COUNT(*) FROM users WHERE LENGTH(password) = 32;
                    <br>-- SonuÃ§ 0 olmalÄ±
                </div>
            </div>

            <!-- KaldÄ±rma AdÄ±m 1 -->
            <div class="bg-slate-800 rounded-lg p-6 mb-4">
                <div class="flex items-start gap-4">
                    <div class="step-number bg-red-500 text-white">1</div>
                    <div class="flex-1">
                        <h4 class="font-bold text-lg mb-2">Config'i Geri Al</h4>
                        <div class="bg-slate-900 rounded p-2 text-sm text-slate-400 mb-3">
                            ğŸ“ config/auth.php
                        </div>
                        <div class="bg-slate-900/50 rounded p-4 text-xs">
                            <code class="text-red-400">'driver' => 'legacy',</code>
                            <span class="text-slate-500 mx-2">â†’</span>
                            <code class="text-green-400">'driver' => 'eloquent',</code>
                        </div>
                    </div>
                </div>
            </div>

            <!-- KaldÄ±rma AdÄ±m 2 -->
            <div class="bg-slate-800 rounded-lg p-6 mb-4">
                <div class="flex items-start gap-4">
                    <div class="step-number bg-red-500 text-white">2</div>
                    <div class="flex-1">
                        <h4 class="font-bold text-lg mb-2">AuthServiceProvider'dan KaldÄ±r</h4>
                        <div class="bg-slate-900 rounded p-2 text-sm text-slate-400 mb-3">
                            ğŸ“ app/Providers/AuthServiceProvider.php
                        </div>
                        <p class="text-slate-400 text-sm">boot() metodundan ÅŸu bloÄŸu sil:</p>
                        <div class="bg-slate-900/50 rounded p-4 text-xs mt-2">
                            <code class="text-red-400">Auth::provider('legacy', function ($app, array $config) { ... });</code>
                        </div>
                    </div>
                </div>
            </div>

            <!-- KaldÄ±rma AdÄ±m 3 -->
            <div class="bg-slate-800 rounded-lg p-6 mb-4">
                <div class="flex items-start gap-4">
                    <div class="step-number bg-red-500 text-white">3</div>
                    <div class="flex-1">
                        <h4 class="font-bold text-lg mb-2">DosyalarÄ± Sil</h4>
                        <div class="bg-slate-900 rounded p-3 font-mono text-xs text-slate-300">
                            rm app/Services/Auth/LegacyPasswordMigrationService.php<br>
                            rm app/Auth/LegacyUserProvider.php
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cache Temizle -->
            <div class="bg-slate-800 rounded-lg p-6">
                <div class="flex items-start gap-4">
                    <div class="step-number bg-slate-600 text-white">âœ“</div>
                    <div class="flex-1">
                        <h4 class="font-bold text-lg mb-2">Cache Temizle</h4>
                        <div class="bg-slate-900 rounded p-3 font-mono text-xs text-slate-300">
                            php artisan config:clear<br>
                            php artisan cache:clear
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Ä°statistik Takibi -->
        <section class="bg-purple-900/20 border border-purple-800 rounded-lg p-6 mb-8">
            <h3 class="text-xl font-bold text-purple-400 mb-4">ğŸ“Š Migration Ä°statistik Takibi</h3>
            <div class="space-y-4 text-sm">
                <div>
                    <p class="text-slate-400 mb-2">KaÃ§ kullanÄ±cÄ± migrate oldu?</p>
                    <div class="bg-slate-900 rounded p-3 font-mono text-xs text-slate-300">
                        grep "Legacy MD5 password migrated" storage/logs/laravel.log | wc -l
                    </div>
                </div>
                <div>
                    <p class="text-slate-400 mb-2">KaÃ§ kullanÄ±cÄ± hala MD5 kullanÄ±yor?</p>
                    <div class="bg-slate-900 rounded p-3 font-mono text-xs text-slate-300">
                        SELECT COUNT(*) as remaining FROM users WHERE LENGTH(password) = 32;
                    </div>
                </div>
                <div>
                    <p class="text-slate-400 mb-2">Migration yÃ¼zdesi?</p>
                    <div class="bg-slate-900 rounded p-3 font-mono text-xs text-slate-300">
                        SELECT <br>
                        &nbsp;&nbsp;COUNT(CASE WHEN LENGTH(password) > 32 THEN 1 END) as migrated,<br>
                        &nbsp;&nbsp;COUNT(CASE WHEN LENGTH(password) = 32 THEN 1 END) as pending,<br>
                        &nbsp;&nbsp;ROUND(COUNT(CASE WHEN LENGTH(password) > 32 THEN 1 END) * 100.0 / COUNT(*), 2) as percentage<br>
                        FROM users;
                    </div>
                </div>
            </div>
        </section>

        <!-- Ã–zet Tablo -->
        <section class="bg-slate-800 rounded-lg p-6 mb-8">
            <h3 class="text-xl font-bold mb-4">ğŸ“‹ Ã–zet</h3>
            <table class="w-full text-sm">
                <thead>
                    <tr class="text-left text-slate-400 border-b border-slate-700">
                        <th class="pb-3">Ã–zellik</th>
                        <th class="pb-3">DeÄŸer</th>
                    </tr>
                </thead>
                <tbody class="text-slate-300">
                    <tr class="border-b border-slate-700/50">
                        <td class="py-3">Etkilenen Tenant</td>
                        <td class="py-3">Sadece 1001 (Muzibu)</td>
                    </tr>
                    <tr class="border-b border-slate-700/50">
                        <td class="py-3">Eski Hash</td>
                        <td class="py-3">MD5 (32 karakter)</td>
                    </tr>
                    <tr class="border-b border-slate-700/50">
                        <td class="py-3">Yeni Hash</td>
                        <td class="py-3">bcrypt (60 karakter)</td>
                    </tr>
                    <tr class="border-b border-slate-700/50">
                        <td class="py-3">KullanÄ±cÄ± Fark Eder mi?</td>
                        <td class="py-3">HayÄ±r âœ…</td>
                    </tr>
                    <tr class="border-b border-slate-700/50">
                        <td class="py-3">DiÄŸer Tenant'lar Etkilenir mi?</td>
                        <td class="py-3">HayÄ±r âœ…</td>
                    </tr>
                    <tr>
                        <td class="py-3">GeÃ§ici mi?</td>
                        <td class="py-3">Evet - Ä°leride kaldÄ±rÄ±lacak</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Footer -->
        <footer class="text-center text-slate-500 text-sm border-t border-slate-800 pt-8">
            <p>ğŸ¤– Claude AI tarafÄ±ndan oluÅŸturuldu</p>
            <p class="mt-2">5 Ocak 2026 - v1</p>
            <p class="mt-4 text-xs">
                Arama Terimleri: md5, muzibu, eski ÅŸifreler, password migration, bcrypt, tenant 1001, legacy auth
            </p>
        </footer>
    </div>
</body>
</html>
