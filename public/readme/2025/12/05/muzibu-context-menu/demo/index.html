<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Muzibu Context Menu - CanlÄ± Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        [x-cloak] { display: none !important; }

        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.2);
        }

        .play-button-hover {
            transition: all 0.3s ease;
        }

        .card-hover:hover .play-button-hover {
            opacity: 1;
            transform: scale(1);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in-up {
            animation: fadeInUp 0.3s ease-out;
        }

        /* Long Press Feedback */
        .long-press-active {
            animation: pulse 0.5s ease-in-out;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(0.95); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white min-h-screen">

    <!-- Alpine Data -->
    <div x-data="muzibuDemo()" x-init="initContextMenu()">

        <!-- Top Bar -->
        <div class="bg-gray-800/50 border-b border-white/10 backdrop-blur-lg sticky top-0 z-40">
            <div class="max-w-7xl mx-auto px-4 py-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <i class="fas fa-music text-orange-500 text-2xl"></i>
                        <h1 class="text-2xl font-bold">Muzibu Context Menu Demo</h1>
                    </div>
                    <div class="flex items-center gap-4 text-sm text-gray-400">
                        <span><i class="fas fa-mouse-pointer"></i> SaÄŸ tÄ±k yapÄ±n</span>
                        <span><i class="fas fa-hand-pointer"></i> Hover yapÄ±n</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="max-w-7xl mx-auto px-4 py-8">

            <!-- Instructions -->
            <div class="bg-gradient-to-r from-orange-900/20 to-red-900/20 border border-orange-700/50 rounded-lg p-6 mb-8">
                <h2 class="text-xl font-bold text-orange-300 mb-2 flex items-center gap-2">
                    <i class="fas fa-info-circle"></i>
                    NasÄ±l KullanÄ±lÄ±r?
                </h2>
                <ul class="text-gray-300 space-y-2">
                    <li><i class="fas fa-check text-orange-500"></i> <strong>Desktop:</strong> Kartlara saÄŸ tÄ±k yapÄ±n</li>
                    <li><i class="fas fa-check text-orange-500"></i> <strong>Mobil:</strong> KartlarÄ± 500ms basÄ±lÄ± tutun (long press)</li>
                    <li><i class="fas fa-check text-orange-500"></i> KartlarÄ±n Ã¼zerine hover yapÄ±n (play butonu Ã§Ä±kar)</li>
                    <li><i class="fas fa-check text-orange-500"></i> Context menu'den action seÃ§in (console'da gÃ¶rÃ¼rsÃ¼nÃ¼z)</li>
                </ul>
            </div>

            <!-- ÅžarkÄ±lar -->
            <section class="mb-12">
                <h2 class="text-2xl font-bold mb-6 flex items-center gap-3">
                    <i class="fas fa-music text-pink-500"></i>
                    ÅžarkÄ±lar
                </h2>
                <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                    <template x-for="song in songs" :key="song.id">
                        <div @contextmenu.prevent.stop="openContextMenu($event, 'song', song)"
                             @touchstart="handleTouchStart($event, 'song', song)"
                             @touchend="handleTouchEnd($event)"
                             @touchmove="handleTouchMove($event)"
                             class="card-hover bg-gray-800 rounded-lg p-4 cursor-pointer relative group">
                            <div class="relative mb-3">
                                <div class="aspect-square bg-gradient-to-br from-pink-500 to-purple-600 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-music text-white text-3xl opacity-60"></i>
                                </div>
                                <!-- Play Button (Hover) -->
                                <button @click="playSong(song)"
                                        class="play-button-hover absolute bottom-2 right-2 bg-orange-500 text-white rounded-full w-10 h-10 flex items-center justify-center shadow-lg opacity-0 scale-75">
                                    <i class="fas fa-play ml-0.5"></i>
                                </button>
                            </div>
                            <h3 class="font-semibold text-white truncate" x-text="song.title"></h3>
                            <p class="text-xs text-gray-400 truncate" x-text="song.artist"></p>
                        </div>
                    </template>
                </div>
            </section>

            <!-- AlbÃ¼mler -->
            <section class="mb-12">
                <h2 class="text-2xl font-bold mb-6 flex items-center gap-3">
                    <i class="fas fa-compact-disc text-blue-500"></i>
                    AlbÃ¼mler
                </h2>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                    <template x-for="album in albums" :key="album.id">
                        <div @contextmenu.prevent.stop="openContextMenu($event, 'album', album)"
                             @touchstart="handleTouchStart($event, 'album', album)"
                             @touchend="handleTouchEnd($event)"
                             @touchmove="handleTouchMove($event)"
                             class="card-hover bg-gray-800 rounded-lg p-4 cursor-pointer relative group">
                            <div class="relative mb-3">
                                <div class="aspect-square bg-gradient-to-br from-blue-500 to-cyan-600 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-compact-disc text-white text-4xl opacity-60"></i>
                                </div>
                                <!-- Play Button (Hover) -->
                                <button @click="playAlbum(album)"
                                        class="play-button-hover absolute bottom-2 right-2 bg-orange-500 text-white rounded-full w-12 h-12 flex items-center justify-center shadow-lg opacity-0 scale-75">
                                    <i class="fas fa-play ml-0.5 text-lg"></i>
                                </button>
                            </div>
                            <h3 class="font-semibold text-white truncate" x-text="album.title"></h3>
                            <p class="text-xs text-gray-400 truncate" x-text="album.artist"></p>
                            <p class="text-xs text-gray-500 mt-1" x-text="album.year"></p>
                        </div>
                    </template>
                </div>
            </section>

            <!-- Playlistler -->
            <section>
                <h2 class="text-2xl font-bold mb-6 flex items-center gap-3">
                    <i class="fas fa-list text-purple-500"></i>
                    Playlistler
                </h2>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                    <template x-for="playlist in playlists" :key="playlist.id">
                        <div @contextmenu.prevent.stop="openContextMenu($event, 'playlist', playlist)"
                             @touchstart="handleTouchStart($event, 'playlist', playlist)"
                             @touchend="handleTouchEnd($event)"
                             @touchmove="handleTouchMove($event)"
                             class="card-hover bg-gray-800 rounded-lg p-4 cursor-pointer relative group">
                            <div class="relative mb-3">
                                <div class="aspect-square bg-gradient-to-br from-purple-500 to-indigo-600 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-list text-white text-4xl opacity-60"></i>
                                </div>
                                <!-- Play Button (Hover) -->
                                <button @click="playPlaylist(playlist)"
                                        class="play-button-hover absolute bottom-2 right-2 bg-orange-500 text-white rounded-full w-12 h-12 flex items-center justify-center shadow-lg opacity-0 scale-75">
                                    <i class="fas fa-play ml-0.5 text-lg"></i>
                                </button>
                                <!-- Badge -->
                                <div x-show="playlist.isMine" class="absolute top-2 right-2 bg-green-500 text-white text-xs px-2 py-1 rounded-full flex items-center gap-1">
                                    <i class="fas fa-user"></i>
                                    <span>Benim</span>
                                </div>
                                <div x-show="!playlist.isMine" class="absolute top-2 right-2 bg-blue-500 text-white text-xs px-2 py-1 rounded-full flex items-center gap-1">
                                    <i class="fas fa-globe"></i>
                                    <span>Sistem</span>
                                </div>
                            </div>
                            <h3 class="font-semibold text-white truncate" x-text="playlist.title"></h3>
                            <p class="text-xs text-gray-400" x-text="playlist.songCount + ' ÅŸarkÄ±'"></p>
                        </div>
                    </template>
                </div>
            </section>
        </div>

        <!-- Context Menu -->
        <div x-show="contextMenu.visible"
             x-cloak
             @click.outside="contextMenu.visible = false"
             @keydown.escape.window="contextMenu.visible = false"
             x-transition:enter="transition ease-out duration-200"
             x-transition:enter-start="opacity-0 scale-95"
             x-transition:enter-end="opacity-100 scale-100"
             x-transition:leave="transition ease-in duration-150"
             x-transition:leave-start="opacity-100 scale-100"
             x-transition:leave-end="opacity-0 scale-95"
             :style="`position: fixed; left: ${contextMenu.x}px; top: ${contextMenu.y}px; z-index: 9999;`"
             class="bg-gray-800 rounded-lg shadow-2xl border border-white/20 py-1 min-w-[280px] max-h-[500px] overflow-y-auto animate-fade-in-up">

            <!-- Context Menu Header (Kompakt) -->
            <div class="px-3 py-1.5 border-b border-white/10">
                <p class="text-xs text-gray-400 uppercase font-semibold" x-text="contextMenu.type"></p>
                <p class="text-sm text-white font-semibold truncate" x-text="contextMenu.data?.title"></p>
            </div>

            <!-- Actions -->
            <template x-for="(action, index) in contextMenu.actions" :key="index">
                <div>
                    <!-- Divider -->
                    <div x-show="action.divider" class="border-t border-white/10 my-1"></div>

                    <!-- Row (2 buttons side by side) -->
                    <div x-show="!action.divider && action.row"
                         class="grid grid-cols-2 gap-1 px-1">
                        <template x-for="btn in action.buttons" :key="btn.action">
                            <button @click="executeAction(btn.action); contextMenu.visible = false"
                                    :class="btn.debug ? 'bg-orange-900/20 hover:bg-orange-900/40' : 'hover:bg-white/10'"
                                    class="px-2 py-1.5 rounded transition-all duration-200 flex items-center justify-start gap-2 text-white text-xs group">
                                <i :class="`fas ${btn.icon} transition-colors text-xs`"
                                   :class="btn.debug ? 'text-orange-500' : 'text-gray-400 group-hover:text-orange-500'"></i>
                                <span class="group-hover:translate-x-0.5 transition-transform truncate"
                                      :class="btn.debug ? 'text-orange-300 font-mono text-[10px]' : ''"
                                      x-text="btn.label"></span>
                            </button>
                        </template>
                    </div>

                    <!-- Single Action Button -->
                    <button x-show="!action.divider && !action.row"
                            @click="executeAction(action.action); contextMenu.visible = false"
                            :class="action.debug ? 'bg-orange-900/20 hover:bg-orange-900/40' : 'hover:bg-white/10'"
                            class="w-full px-3 py-1.5 text-left transition-all duration-200 flex items-center gap-2 text-white text-xs group">
                        <i :class="`fas ${action.icon} transition-colors text-xs`"
                           :class="action.debug ? 'text-orange-500' : 'text-gray-400 group-hover:text-orange-500'"></i>
                        <span class="group-hover:translate-x-0.5 transition-transform"
                              :class="action.debug ? 'text-orange-300 font-mono text-[10px]' : ''"
                              x-text="action.label"></span>
                        <i x-show="action.submenu" class="fas fa-chevron-right ml-auto text-[10px] text-gray-500"></i>
                    </button>
                </div>
            </template>
        </div>

        <!-- Toast Notifications -->
        <div class="fixed bottom-4 right-4 z-50 space-y-2">
            <template x-for="toast in toasts" :key="toast.id">
                <div x-show="toast.visible"
                     x-transition:enter="transition ease-out duration-300"
                     x-transition:enter-start="opacity-0 translate-y-2"
                     x-transition:enter-end="opacity-100 translate-y-0"
                     x-transition:leave="transition ease-in duration-200"
                     x-transition:leave-start="opacity-100"
                     x-transition:leave-end="opacity-0"
                     :class="toast.type === 'success' ? 'bg-green-600' : 'bg-orange-600'"
                     class="px-6 py-4 rounded-lg shadow-2xl text-white max-w-sm">
                    <div class="flex items-center gap-3">
                        <i :class="toast.type === 'success' ? 'fa-check-circle' : 'fa-info-circle'" class="fas text-xl"></i>
                        <p x-text="toast.message"></p>
                    </div>
                </div>
            </template>
        </div>

        <!-- Rating Modal -->
        <div x-show="ratingModal.open"
             x-cloak
             class="fixed inset-0 z-50 flex items-center justify-center p-4">
            <div @click="ratingModal.open = false" class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>

            <div class="relative bg-gray-800 rounded-lg shadow-2xl border border-white/20 max-w-md w-full p-6">
                <!-- Content Info Header -->
                <div class="mb-6 pb-6 border-b border-white/20">
                    <div class="flex items-center gap-4">
                        <!-- Icon/Cover -->
                        <div class="flex-shrink-0">
                            <div :class="{
                                'bg-gradient-to-br from-pink-500 to-purple-600': contextMenu.type === 'song',
                                'bg-gradient-to-br from-blue-500 to-cyan-600': contextMenu.type === 'album',
                                'bg-gradient-to-br from-purple-500 to-indigo-600': contextMenu.type === 'playlist'
                            }" class="w-16 h-16 rounded-lg flex items-center justify-center">
                                <i :class="{
                                    'fa-music': contextMenu.type === 'song',
                                    'fa-compact-disc': contextMenu.type === 'album',
                                    'fa-list': contextMenu.type === 'playlist'
                                }" class="fas text-white text-2xl opacity-80"></i>
                            </div>
                        </div>

                        <!-- Info -->
                        <div class="flex-1 min-w-0">
                            <p class="text-xs uppercase font-semibold mb-1" :class="{
                                'text-pink-400': contextMenu.type === 'song',
                                'text-blue-400': contextMenu.type === 'album',
                                'text-purple-400': contextMenu.type === 'playlist'
                            }">
                                <i :class="{
                                    'fa-music': contextMenu.type === 'song',
                                    'fa-compact-disc': contextMenu.type === 'album',
                                    'fa-list': contextMenu.type === 'playlist'
                                }" class="fas mr-1"></i>
                                <span x-text="{
                                    'song': 'ÅžarkÄ±ya Puan Ver',
                                    'album': 'AlbÃ¼me Puan Ver',
                                    'playlist': 'Playliste Puan Ver'
                                }[contextMenu.type]"></span>
                            </p>
                            <h3 class="text-lg font-bold text-white truncate" x-text="contextMenu.data?.title"></h3>
                            <p class="text-sm text-gray-400 truncate" x-text="contextMenu.data?.artist || (contextMenu.data?.songCount + ' ÅŸarkÄ±')"></p>
                        </div>
                    </div>
                </div>

                <h3 class="text-xl font-bold text-white mb-6 text-center">PuanÄ±nÄ±zÄ± Verin</h3>

                <!-- Stars -->
                <div class="flex items-center justify-center gap-2 mb-6">
                    <template x-for="star in [1,2,3,4,5]" :key="star">
                        <button @click="ratingModal.rating = star"
                                @mouseover="ratingModal.hoverRating = star"
                                @mouseleave="ratingModal.hoverRating = 0"
                                type="button"
                                class="text-4xl transition-all duration-200 hover:scale-110">
                            <i :class="star <= (ratingModal.hoverRating || ratingModal.rating) ? 'fas fa-star text-yellow-400' : 'far fa-star text-gray-500'"></i>
                        </button>
                    </template>
                </div>

                <p class="text-center text-gray-300 mb-6" x-show="ratingModal.rating > 0">
                    <span x-text="ratingModal.rating"></span> yÄ±ldÄ±z seÃ§tiniz
                </p>

                <!-- Comment -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-300 mb-2">Yorumunuz (opsiyonel)</label>
                    <textarea x-model="ratingModal.comment"
                              rows="4"
                              class="w-full bg-gray-900 border border-white/20 rounded-lg px-4 py-3 text-white focus:outline-none focus:border-orange-500 transition-colors"
                              placeholder="Bu iÃ§erik hakkÄ±nda dÃ¼ÅŸÃ¼nceleriniz..."></textarea>
                </div>

                <!-- Actions -->
                <div class="flex gap-3">
                    <button @click="ratingModal.open = false"
                            type="button"
                            class="flex-1 px-4 py-3 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors">
                        Ä°ptal
                    </button>
                    <button @click="submitRating()"
                            :disabled="ratingModal.rating === 0"
                            :class="ratingModal.rating === 0 ? 'opacity-50 cursor-not-allowed' : ''"
                            type="button"
                            class="flex-1 px-4 py-3 bg-orange-500 hover:bg-orange-600 text-white rounded-lg transition-colors font-semibold">
                        PuanÄ± GÃ¶nder
                    </button>
                </div>
            </div>
        </div>

        <!-- Playlist Select Modal -->
        <div x-show="playlistModal.open"
             x-cloak
             class="fixed inset-0 z-50 flex items-center justify-center p-4">
            <div @click="playlistModal.open = false" class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>

            <div class="relative bg-gray-800 rounded-lg shadow-2xl border border-white/20 max-w-2xl w-full p-6">
                <!-- Content Info Header -->
                <div class="mb-6 pb-4 border-b border-white/20">
                    <div class="flex items-center gap-3">
                        <div :class="{
                            'bg-gradient-to-br from-pink-500 to-purple-600': contextMenu.type === 'song',
                            'bg-gradient-to-br from-blue-500 to-cyan-600': contextMenu.type === 'album'
                        }" class="w-12 h-12 rounded-lg flex items-center justify-center flex-shrink-0">
                            <i :class="{
                                'fa-music': contextMenu.type === 'song',
                                'fa-compact-disc': contextMenu.type === 'album',
                                'fa-list': contextMenu.type === 'playlist'
                            }" class="fas text-white text-xl opacity-80"></i>
                        </div>
                        <div class="flex-1 min-w-0">
                            <h3 class="text-lg font-bold text-white truncate" x-text="contextMenu.data?.title"></h3>
                            <p class="text-sm text-gray-400 truncate" x-text="contextMenu.data?.artist"></p>
                        </div>
                    </div>
                </div>

                <h3 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                    <i class="fas fa-list text-orange-500"></i>
                    Hangi Playliste Eklemek Ä°stersiniz?
                </h3>

                <!-- Create New -->
                <button @click="createNewPlaylist()"
                        class="w-full mb-4 px-4 py-3 bg-orange-500 hover:bg-orange-600 text-white rounded-lg transition-colors font-semibold flex items-center justify-center gap-2">
                    <i class="fas fa-plus"></i>
                    Yeni Playlist OluÅŸtur
                </button>

                <!-- Playlists (List View) -->
                <div class="max-h-96 overflow-y-auto bg-gray-900 rounded-lg">
                    <template x-for="playlist in playlists" :key="playlist.id">
                        <button @click="addToPlaylist(playlist)"
                                class="w-full flex items-center gap-3 px-4 py-3 hover:bg-gray-700 transition-colors text-left border-b border-white/5 last:border-0">
                            <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-indigo-600 rounded flex items-center justify-center flex-shrink-0">
                                <i class="fas fa-list text-white text-sm opacity-80"></i>
                            </div>
                            <div class="flex-1 min-w-0">
                                <h4 class="text-white font-semibold truncate" x-text="playlist.title"></h4>
                                <p class="text-xs text-gray-400" x-text="playlist.songCount + ' ÅŸarkÄ±'"></p>
                            </div>
                            <i class="fas fa-chevron-right text-gray-500 text-xs"></i>
                        </button>
                    </template>
                </div>

                <button @click="playlistModal.open = false"
                        class="mt-6 w-full px-4 py-3 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors">
                    Kapat
                </button>
            </div>
        </div>

    </div>

    <script>
        function muzibuDemo() {
            return {
                // Demo Data
                songs: [
                    { id: 1, title: 'YalnÄ±zlÄ±k', artist: 'Sezen Aksu', album: 'Klasikler', isFavorite: false },
                    { id: 2, title: 'Gel Ey Seher', artist: 'Cem Adrian', album: 'Emir', isFavorite: true },
                    { id: 3, title: 'Ä°stanbul Ä°stanbul', artist: 'Ferhat GÃ¶Ã§er', album: 'ÅžarkÄ±lar', isFavorite: false },
                    { id: 4, title: 'Yaz Yaz Yaz', artist: 'Edis', album: 'Benim Ä°Ã§in ÃœzÃ¼lme', isFavorite: false },
                    { id: 5, title: 'ParamparÃ§a', artist: 'BengÃ¼', album: 'HoÅŸgeldin', isFavorite: true },
                    { id: 6, title: 'AÅŸkÄ±n AteÅŸi', artist: 'Ajda Pekkan', album: 'SÃ¼perstar', isFavorite: false },
                ],

                albums: [
                    { id: 1, title: 'Klasikler', artist: 'Sezen Aksu', year: 2010, songCount: 14 },
                    { id: 2, title: 'Emir', artist: 'Cem Adrian', year: 2015, songCount: 12 },
                    { id: 3, title: 'ÅžarkÄ±lar', artist: 'Ferhat GÃ¶Ã§er', year: 2018, songCount: 10 },
                    { id: 4, title: 'SÃ¼perstar', artist: 'Ajda Pekkan', year: 2005, songCount: 16 },
                ],

                playlists: [
                    { id: 1, title: 'Ã‡alÄ±ÅŸÄ±rken Dinlenenler', songCount: 45, isMine: true },
                    { id: 2, title: 'Romantik ÅžarkÄ±lar', songCount: 32, isMine: true },
                    { id: 3, title: 'Yolculuk Mix', songCount: 28, isMine: false },
                    { id: 4, title: 'Sabah Motivasyonu', songCount: 19, isMine: true },
                    { id: 5, title: 'AkÅŸam Dinleti', songCount: 67, isMine: true },
                    { id: 6, title: 'Spor MÃ¼zikleri', songCount: 54, isMine: true },
                    { id: 7, title: 'TÃ¼rkÃ§e Pop Hits', songCount: 89, isMine: false },
                    { id: 8, title: 'Nostalji 90\'lar', songCount: 103, isMine: true },
                    { id: 9, title: 'Chill Vibes', songCount: 41, isMine: true },
                    { id: 10, title: 'Konsantrasyon', songCount: 25, isMine: true },
                ],

                // Context Menu State
                contextMenu: {
                    visible: false,
                    x: 0,
                    y: 0,
                    type: null,
                    data: null,
                    actions: []
                },

                // Rating Modal
                ratingModal: {
                    open: false,
                    rating: 0,
                    hoverRating: 0,
                    comment: ''
                },

                // Playlist Modal
                playlistModal: {
                    open: false
                },

                // Toast
                toasts: [],
                toastId: 0,

                // Touch/Long Press
                touchTimer: null,
                touchStartPos: { x: 0, y: 0 },

                // Methods
                initContextMenu() {
                    // Context menu sadece kartlarda engellensin
                    // DiÄŸer yerlerde (boÅŸ alan, header, footer) Chrome'un "Ä°ncele" Ã§alÄ±ÅŸsÄ±n
                    // @contextmenu.prevent.stop zaten kartlara eklendi, buradan global engeli kaldÄ±rÄ±yoruz
                },

                handleTouchStart(event, type, data) {
                    // Store touch position
                    const touch = event.touches[0];
                    this.touchStartPos = { x: touch.clientX, y: touch.clientY };

                    // Clear any existing timer
                    if (this.touchTimer) {
                        clearTimeout(this.touchTimer);
                    }

                    // Add visual feedback
                    event.currentTarget.classList.add('long-press-active');

                    // Start timer for long press (500ms)
                    this.touchTimer = setTimeout(() => {
                        // Trigger context menu (clientX/clientY kullan, position: fixed iÃ§in)
                        const fakeEvent = {
                            clientX: touch.clientX,
                            clientY: touch.clientY,
                            preventDefault: () => {}
                        };
                        this.openContextMenu(fakeEvent, type, data);

                        // Vibrate if supported (mobil feedback)
                        if ('vibrate' in navigator) {
                            navigator.vibrate(50);
                        }

                        // Remove visual feedback
                        event.currentTarget.classList.remove('long-press-active');
                    }, 500);
                },

                handleTouchEnd(event) {
                    // Clear timer if touch ends before 500ms
                    if (this.touchTimer) {
                        clearTimeout(this.touchTimer);
                        this.touchTimer = null;
                    }

                    // Remove visual feedback
                    event.currentTarget.classList.remove('long-press-active');
                },

                handleTouchMove(event) {
                    // If user moves finger, cancel long press
                    const touch = event.touches[0];
                    const deltaX = Math.abs(touch.clientX - this.touchStartPos.x);
                    const deltaY = Math.abs(touch.clientY - this.touchStartPos.y);

                    // If moved more than 10px, cancel
                    if (deltaX > 10 || deltaY > 10) {
                        if (this.touchTimer) {
                            clearTimeout(this.touchTimer);
                            this.touchTimer = null;
                        }
                        event.currentTarget.classList.remove('long-press-active');
                    }
                },

                openContextMenu(event, type, data) {
                    const menuWidth = 250;
                    const menuHeight = 400;

                    // position: fixed kullanÄ±ldÄ±ÄŸÄ± iÃ§in clientX/clientY kullan (viewport bazlÄ±)
                    const x = event.clientX || event.pageX;
                    const y = event.clientY || event.pageY;

                    // Viewport sÄ±nÄ±rlarÄ±nÄ± kontrol et (saÄŸ/alt taÅŸma Ã¶nle)
                    this.contextMenu.x = (x + menuWidth > window.innerWidth)
                        ? window.innerWidth - menuWidth - 10
                        : x;

                    this.contextMenu.y = (y + menuHeight > window.innerHeight)
                        ? window.innerHeight - menuHeight - 10
                        : y;

                    this.contextMenu.type = type;
                    this.contextMenu.data = data;
                    this.contextMenu.actions = this.getActionsForType(type, data);
                    this.contextMenu.visible = true;
                },

                getActionsForType(type, data) {
                    const actions = {
                        song: [
                            // Row 1: Ã‡al + SÄ±raya Ekle (yanyana)
                            { row: true, buttons: [
                                { icon: 'fa-play', label: 'Ã‡al', action: 'play' },
                                { icon: 'fa-plus-circle', label: 'SÄ±raya Ekle', action: 'addToQueue' }
                            ]},
                            // Row 2: Favori + Puan Ver (yanyana)
                            { row: true, buttons: [
                                { icon: 'fa-heart', label: data.isFavorite ? 'Ã‡Ä±kar' : 'Favori', action: 'toggleFavorite' },
                                { icon: 'fa-star', label: 'Puan Ver', action: 'rate' }
                            ]},
                            { divider: true },
                            { icon: 'fa-list', label: 'Playliste Ekle', action: 'addToPlaylist', submenu: true },
                            { icon: 'fa-compact-disc', label: 'AlbÃ¼me Git', action: 'goToAlbum' }
                        ],
                        album: [
                            // Row 1: Ã‡al + SÄ±raya Ekle
                            { row: true, buttons: [
                                { icon: 'fa-play', label: 'Ã‡al', action: 'play' },
                                { icon: 'fa-plus-circle', label: 'SÄ±raya Ekle', action: 'addToQueue' }
                            ]},
                            // Row 2: Favori + Puan Ver
                            { row: true, buttons: [
                                { icon: 'fa-heart', label: 'Favori', action: 'toggleFavorite' },
                                { icon: 'fa-star', label: 'Puan Ver', action: 'rate' }
                            ]},
                            { divider: true },
                            { icon: 'fa-list', label: 'Playliste Ekle (TÃ¼m)', action: 'addToPlaylist' }
                        ],
                        playlist: [
                            // Row 1: Ã‡al + SÄ±raya Ekle
                            { row: true, buttons: [
                                { icon: 'fa-play', label: 'Ã‡al', action: 'play' },
                                { icon: 'fa-plus-circle', label: 'SÄ±raya Ekle', action: 'addToQueue' }
                            ]},
                            // Row 2: Favori + Puan Ver
                            { row: true, buttons: [
                                { icon: 'fa-heart', label: 'Favori', action: 'toggleFavorite' },
                                { icon: 'fa-star', label: 'Puan Ver', action: 'rate' }
                            ]},
                            { divider: true },
                            ...(data.isMine ? [
                                // KullanÄ±cÄ±nÄ±n playlistinde: DÃ¼zenle + Sil
                                { icon: 'fa-edit', label: 'DÃ¼zenle', action: 'edit' },
                                { icon: 'fa-trash-alt', label: 'Sil', action: 'delete' }
                            ] : [
                                // Sistem playlistinde: Kopyala
                                { icon: 'fa-copy', label: 'Playlistimi Kopyala', action: 'copy' }
                            ])
                        ]
                    };

                    return actions[type] || [];
                },

                executeAction(action) {
                    const { type, data } = this.contextMenu;

                    console.log(`ðŸŽ¯ Action: ${action} | Type: ${type} | Data:`, data);

                    switch(action) {
                        case 'play':
                            this.showToast(`â–¶ï¸ Ã‡alÄ±yor: ${data.title}`, 'success');
                            break;
                        case 'addToQueue':
                            this.showToast(`âž• SÄ±raya eklendi: ${data.title}`, 'success');
                            break;
                        case 'toggleFavorite':
                            const isFav = data.isFavorite;
                            data.isFavorite = !isFav;
                            this.showToast(isFav ? 'ðŸ’” Favorilerden Ã§Ä±karÄ±ldÄ±' : 'â¤ï¸ Favorilere eklendi', 'success');
                            break;
                        case 'rate':
                            this.ratingModal.open = true;
                            this.ratingModal.rating = 0;
                            this.ratingModal.comment = '';
                            break;
                        case 'addToPlaylist':
                            this.playlistModal.open = true;
                            break;
                        case 'goToAlbum':
                            this.showToast(`ðŸ’¿ AlbÃ¼me gidiliyor: ${data.album}`, 'info');
                            break;
                        case 'edit':
                            this.showToast(`âœï¸ DÃ¼zenleme sayfasÄ± aÃ§Ä±lÄ±yor`, 'info');
                            break;
                        case 'delete':
                            // Onay uyarÄ±sÄ± gÃ¶ster
                            if (confirm(`"${data.title}" playlistini silmek istediÄŸinize emin misiniz?\n\nBu iÅŸlem geri alÄ±namaz!`)) {
                                this.showToast(`ðŸ—‘ï¸ Silindi: ${data.title}`, 'success');
                                console.log('ðŸ—‘ï¸ Playlist deleted:', data);
                            } else {
                                this.showToast('âŒ Silme iÅŸlemi iptal edildi', 'info');
                            }
                            break;
                        case 'copy':
                            this.showToast(`ðŸ“‹ "${data.title}" playlistinize kopyalandÄ±`, 'success');
                            console.log('ðŸ“‹ Playlist copied to user playlists:', data);
                            break;
                    }
                },

                playSong(song) {
                    this.showToast(`â–¶ï¸ Ã‡alÄ±yor: ${song.title}`, 'success');
                    console.log('ðŸŽµ Playing song:', song);
                },

                playAlbum(album) {
                    this.showToast(`â–¶ï¸ AlbÃ¼m Ã§alÄ±yor: ${album.title}`, 'success');
                    console.log('ðŸ’¿ Playing album:', album);
                },

                playPlaylist(playlist) {
                    this.showToast(`â–¶ï¸ Playlist Ã§alÄ±yor: ${playlist.title}`, 'success');
                    console.log('ðŸŽµ Playing playlist:', playlist);
                },

                submitRating() {
                    const { rating, comment } = this.ratingModal;
                    console.log('â­ Rating submitted:', { rating, comment, item: this.contextMenu.data });
                    this.showToast(`â­ ${rating} yÄ±ldÄ±z puanÄ±nÄ±z kaydedildi!`, 'success');
                    this.ratingModal.open = false;
                },

                createNewPlaylist() {
                    console.log('âž• Creating new playlist...');
                    this.showToast('âž• Yeni playlist oluÅŸtur modal aÃ§Ä±ldÄ±', 'info');
                },

                addToPlaylist(playlist) {
                    console.log('ðŸ“‹ Adding to playlist:', playlist, 'Item:', this.contextMenu.data);
                    this.showToast(`ðŸ“‹ "${this.contextMenu.data.title}" playliste eklendi: ${playlist.title}`, 'success');
                    this.playlistModal.open = false;
                },

                showToast(message, type = 'info') {
                    const id = this.toastId++;
                    const toast = { id, message, type, visible: true };
                    this.toasts.push(toast);

                    setTimeout(() => {
                        toast.visible = false;
                        setTimeout(() => {
                            this.toasts = this.toasts.filter(t => t.id !== id);
                        }, 200);
                    }, 3000);
                }
            }
        }
    </script>
</body>
</html>
