<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš¨ Homepage Performans Krizi - Session Sorunu</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            line-height: 1.7;
            padding: 40px 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            margin-bottom: 50px;
            padding-bottom: 30px;
            border-bottom: 2px solid #334155;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 15px;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .meta {
            color: #94a3b8;
            font-size: 0.95rem;
        }

        .alert {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 40px;
            border-left: 6px solid #fef2f2;
        }

        .alert h2 {
            color: #fef2f2;
            font-size: 1.8rem;
            margin-bottom: 15px;
        }

        .alert p {
            color: #fecaca;
            font-size: 1.1rem;
            line-height: 1.8;
        }

        section {
            margin-bottom: 40px;
        }

        h2 {
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: #60a5fa;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        h3 {
            color: #60a5fa;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .problem-box {
            background: rgba(220, 38, 38, 0.15);
            padding: 25px;
            margin-bottom: 20px;
            border-radius: 12px;
            border-left: 4px solid #dc2626;
            backdrop-filter: blur(10px);
        }

        .solution-box {
            background: rgba(34, 197, 94, 0.15);
            padding: 25px;
            margin-bottom: 20px;
            border-radius: 12px;
            border-left: 4px solid #22c55e;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .solution-box:hover {
            transform: translateX(5px);
            background: rgba(34, 197, 94, 0.25);
        }

        .info-box {
            background: rgba(59, 130, 246, 0.15);
            padding: 25px;
            margin-bottom: 20px;
            border-radius: 12px;
            border-left: 4px solid #3b82f6;
            backdrop-filter: blur(10px);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-card {
            background: rgba(30, 41, 59, 0.5);
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .stat-value.bad { color: #ef4444; }
        .stat-value.warning { color: #f59e0b; }
        .stat-value.good { color: #22c55e; }

        .stat-label {
            color: #94a3b8;
            font-size: 0.9rem;
        }

        .code-block {
            background: #1e293b;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            overflow-x: auto;
            border: 1px solid #334155;
        }

        .code-block code {
            color: #e2e8f0;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .priority {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-left: 10px;
        }

        .priority-critical { background: #dc2626; color: white; }
        .priority-high { background: #f59e0b; color: white; }
        .priority-medium { background: #3b82f6; color: white; }

        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .comparison-item {
            padding: 20px;
            border-radius: 8px;
        }

        .comparison-item.before {
            background: rgba(220, 38, 38, 0.15);
            border: 2px solid #dc2626;
        }

        .comparison-item.after {
            background: rgba(34, 197, 94, 0.15);
            border: 2px solid #22c55e;
        }

        .tech-term {
            color: #fbbf24;
            font-weight: 500;
        }

        .explanation {
            display: inline-block;
            margin-left: 5px;
            color: #94a3b8;
            font-size: 0.9rem;
        }

        ul {
            list-style: none;
            padding-left: 0;
        }

        ul li {
            padding: 10px 0;
            padding-left: 30px;
            position: relative;
        }

        ul li:before {
            content: "â†’";
            position: absolute;
            left: 0;
            color: #60a5fa;
            font-weight: bold;
        }

        footer {
            margin-top: 60px;
            padding-top: 30px;
            border-top: 1px solid #334155;
            color: #64748b;
            font-size: 0.9rem;
            text-align: center;
        }

        @media (max-width: 768px) {
            .comparison {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸš¨ Homepage Performans Krizi</h1>
            <div class="meta">
                ğŸ“… Tarih: 2025-11-30 16:55 |
                ğŸ¯ Tenant: ixtif.com (Tenant 2) |
                ğŸ‘¤ Kaynak: a-html.txt debug Ã§Ä±ktÄ±sÄ± |
                ğŸŒ URL: /
            </div>
        </header>

        <div class="alert">
            <h2>âš ï¸ KRÄ°TÄ°K DURUM</h2>
            <p>
                Homepage <strong>23.3 saniyede</strong> yÃ¼kleniyor! Hedef 2-3 saniye olmalÄ±ydÄ±.
                Bu <strong>10 kat daha yavaÅŸ</strong> demektir. Sorun acilen Ã§Ã¶zÃ¼lmeli!
            </p>
        </div>

        <section>
            <h2>ğŸ“Š Performans Metrikleri</h2>

            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value bad">23.3s</div>
                    <div class="stat-label">Toplam YÃ¼kleme SÃ¼resi</div>
                </div>

                <div class="stat-card">
                    <div class="stat-value bad">21.8s</div>
                    <div class="stat-label">Query SÃ¼resi (Total)</div>
                </div>

                <div class="stat-card">
                    <div class="stat-value bad">%93</div>
                    <div class="stat-label">Query OranÄ±</div>
                </div>

                <div class="stat-card">
                    <div class="stat-value warning">6</div>
                    <div class="stat-label">Query SayÄ±sÄ±</div>
                </div>
            </div>
        </section>

        <section>
            <h2>ğŸ” Sorun Analizi</h2>

            <div class="problem-box">
                <h3>1. Session Delete Sorunu <span class="priority priority-critical">KRÄ°TÄ°K</span></h3>
                <p>
                    <span class="tech-term">Session garbage collection</span>
                    <span class="explanation">(Eski oturum kayÄ±tlarÄ±nÄ± temizleme iÅŸlemi)</span>
                    her request'te Ã§alÄ±ÅŸÄ±yor!
                </p>

                <div class="code-block">
                    <code>delete from sessions where last_activity <= 1764503683
Duration: 16806.76ms (16.8 saniye!)</code>
                </div>

                <ul>
                    <li><strong>SÃ¼re:</strong> 16.8 saniye (toplam sÃ¼renin %72'si)</li>
                    <li><strong>Sebep:</strong> Sessions tablosu Ã§ok bÃ¼yÃ¼k ve index yok</li>
                    <li><strong>Sorun:</strong> Her sayfa yÃ¼kleniÅŸinde temizleme Ã§alÄ±ÅŸÄ±yor</li>
                    <li><strong>Etki:</strong> KullanÄ±cÄ± bekliyor, site donuyor</li>
                </ul>
            </div>

            <div class="problem-box">
                <h3>2. Session Update Sorunu <span class="priority priority-high">YÃœKSEK</span></h3>
                <p>
                    Her request'te session verisi gÃ¼ncelleniyor ama Ã§ok yavaÅŸ.
                </p>

                <div class="code-block">
                    <code>update sessions set payload = ...
Duration: 4965.75ms (5 saniye!)</code>
                </div>

                <ul>
                    <li><strong>SÃ¼re:</strong> 5 saniye (toplam sÃ¼renin %21'i)</li>
                    <li><strong>Sebep:</strong> Payload Ã§ok bÃ¼yÃ¼k veya tablo index'siz</li>
                    <li><strong>Sorun:</strong> Database session driver yavaÅŸ</li>
                </ul>
            </div>

            <div class="info-box">
                <h3>3. DiÄŸer Query'ler Normal âœ…</h3>
                <ul>
                    <li>Tenant sorgusu: 24.07ms âœ…</li>
                    <li>Domain sorgusu: 0.59ms âœ…</li>
                    <li>Schema kontrolÃ¼: 2.26ms âœ…</li>
                </ul>
                <p>
                    Tenant ve domain sorgularÄ± gayet hÄ±zlÄ±. Sorun sadece <span class="tech-term">session sistemi</span>nde.
                </p>
            </div>
        </section>

        <section>
            <h2>ğŸ’¡ KÃ¶k Neden</h2>

            <div class="info-box">
                <h3>Laravel Session Garbage Collection MekanizmasÄ±</h3>
                <p>
                    Laravel, <span class="tech-term">session garbage collection</span>
                    <span class="explanation">(eski session kayÄ±tlarÄ±nÄ± temizleme)</span>
                    iÅŸlemini varsayÄ±lan olarak <strong>lottery sistemi</strong> ile yapar:
                </p>

                <div class="code-block">
                    <code>'lottery' => [2, 100]  // %2 ihtimalle temizle</code>
                </div>

                <p>
                    Ancak bu ayar <strong>yetersiz</strong> kalabilir:
                </p>

                <ul>
                    <li>Sessions tablosu Ã§ok bÃ¼yÃ¼dÃ¼ÄŸÃ¼nde temizleme Ã§ok uzun sÃ¼rer</li>
                    <li>Lottery her request'te kontrol edilir (overhead)</li>
                    <li>Database session driver Redis'e gÃ¶re 10-20x daha yavaÅŸ</li>
                    <li>Index yoksa DELETE sorgusu tÃ¼m tabloyu tarar</li>
                </ul>
            </div>
        </section>

        <section>
            <h2>âœ… Ã‡Ã¶zÃ¼m Ã–nerileri</h2>

            <div class="solution-box">
                <h3>1. Session Driver DeÄŸiÅŸtir (Redis) <span class="priority priority-critical">KRÄ°TÄ°K</span></h3>
                <p>
                    <span class="tech-term">Database driver</span> yerine
                    <span class="tech-term">Redis driver</span> kullan.
                    Redis bellekte Ã§alÄ±ÅŸtÄ±ÄŸÄ± iÃ§in 10-20x daha hÄ±zlÄ±dÄ±r.
                </p>

                <p><strong>Avantajlar:</strong></p>
                <ul>
                    <li>Session okuma/yazma milisaniye seviyesine iner</li>
                    <li>Redis otomatik expire ile eski session'larÄ± temizler</li>
                    <li>Database'e yÃ¼k binmez</li>
                    <li>Garbage collection sorunu ortadan kalkar</li>
                </ul>

                <p><strong>YapÄ±lacaklar:</strong></p>
                <ul>
                    <li>config/session.php â†’ driver = 'redis' yap</li>
                    <li>Redis baÄŸlantÄ±sÄ±nÄ± test et</li>
                    <li>Cache temizle ve test et</li>
                </ul>

                <p><strong>Beklenen SonuÃ§:</strong></p>
                <div class="comparison">
                    <div class="comparison-item before">
                        <strong>âŒ ÅÄ°MDÄ° (Database):</strong><br>
                        Session update: 5s<br>
                        Session delete: 16.8s<br>
                        <strong>Total: 21.8s</strong>
                    </div>
                    <div class="comparison-item after">
                        <strong>âœ… SONRA (Redis):</strong><br>
                        Session update: ~5ms<br>
                        Session delete: 0ms<br>
                        <strong>Total: ~5ms</strong>
                    </div>
                </div>
            </div>

            <div class="solution-box">
                <h3>2. Session Garbage Collection Devre DÄ±ÅŸÄ± <span class="priority priority-high">YÃœKSEK</span></h3>
                <p>
                    EÄŸer database driver kullanmaya devam edeceksen, garbage collection'Ä±
                    request-time'dan Ã§Ä±kar, <span class="tech-term">scheduled task</span>
                    <span class="explanation">(zamanlanmÄ±ÅŸ gÃ¶rev)</span> yap.
                </p>

                <p><strong>YapÄ±lacaklar:</strong></p>
                <ul>
                    <li>config/session.php â†’ lottery = [0, 100] (devre dÄ±ÅŸÄ±)</li>
                    <li>app/Console/Kernel.php â†’ Gece 3'te session temizleme task'Ä± ekle</li>
                    <li>Cron ile otomatik temizleme</li>
                </ul>

                <p><strong>Avantaj:</strong></p>
                <ul>
                    <li>KullanÄ±cÄ± request'leri hÄ±zlÄ± olur (temizleme yok)</li>
                    <li>Temizleme gece yapÄ±lÄ±r (site trafiÄŸi azken)</li>
                </ul>

                <p><strong>Dezavantaj:</strong></p>
                <ul>
                    <li>Session tablosu gece temizlenene kadar bÃ¼yÃ¼r</li>
                    <li>Database hala session iÃ§in kullanÄ±lÄ±r (Redis kadar hÄ±zlÄ± deÄŸil)</li>
                </ul>
            </div>

            <div class="solution-box">
                <h3>3. Session Tablosu Index Ekle <span class="priority priority-high">YÃœKSEK</span></h3>
                <p>
                    EÄŸer database driver kullanmaya devam edeceksen, session tablosuna
                    <span class="tech-term">index</span> ekle. DELETE sorgusu Ã§ok daha hÄ±zlÄ± olur.
                </p>

                <p><strong>YapÄ±lacaklar:</strong></p>
                <ul>
                    <li>sessions tablosuna last_activity index'i ekle</li>
                    <li>Migration oluÅŸtur</li>
                    <li>Test et</li>
                </ul>

                <p><strong>Beklenen SonuÃ§:</strong></p>
                <ul>
                    <li>DELETE sorgusu 16.8s â†’ ~100-500ms (30-150x hÄ±zlanma)</li>
                    <li>Yine de Redis kadar hÄ±zlÄ± olmaz</li>
                </ul>
            </div>

            <div class="solution-box">
                <h3>4. Session Lifetime Azalt <span class="priority priority-medium">ORTA</span></h3>
                <p>
                    Session Ã¶mrÃ¼nÃ¼ azaltarak session tablosunun ÅŸiÅŸmesini Ã¶nle.
                </p>

                <p><strong>YapÄ±lacaklar:</strong></p>
                <ul>
                    <li>config/session.php â†’ lifetime = 120 (2 saat)</li>
                    <li>Eski session'lar daha erken expire olur</li>
                    <li>Tablo daha kÃ¼Ã§Ã¼k kalÄ±r</li>
                </ul>
            </div>
        </section>

        <section>
            <h2>ğŸ¯ Ã–nerilen Strateji</h2>

            <div class="info-box">
                <h3>Ã‡Ã¶zÃ¼m 1: Redis Driver (EN Ä°YÄ°) â­â­â­â­â­</h3>
                <p>
                    <strong>Neden en iyi:</strong>
                </p>
                <ul>
                    <li>KalÄ±cÄ± Ã§Ã¶zÃ¼m (sorun kÃ¶kten hallolur)</li>
                    <li>Ã‡ok hÄ±zlÄ± (Redis bellekte Ã§alÄ±ÅŸÄ±r)</li>
                    <li>Database'e yÃ¼k bindirmez</li>
                    <li>Garbage collection otomatik (Redis expire)</li>
                    <li>Uygulama kolay (sadece config deÄŸiÅŸikliÄŸi)</li>
                </ul>

                <p>
                    <strong>Risk:</strong> Yok (Redis zaten sistemde var, kullanÄ±lÄ±yor)
                </p>

                <p>
                    <strong>Tavsiye:</strong> âœ… HEMEN UYGULA!
                </p>
            </div>

            <div class="info-box">
                <h3>Ã‡Ã¶zÃ¼m 2: Garbage Collection + Index (YEDEK) â­â­â­</h3>
                <p>
                    <strong>Ne zaman kullanÄ±lÄ±r:</strong>
                </p>
                <ul>
                    <li>Redis kullanmak istemiyorsan</li>
                    <li>Database session zorunluysa</li>
                </ul>

                <p>
                    <strong>Dezavantaj:</strong> Redis kadar hÄ±zlÄ± olmaz
                </p>
            </div>
        </section>

        <section>
            <h2>ğŸ“ˆ Beklenen SonuÃ§</h2>

            <div class="comparison">
                <div class="comparison-item before">
                    <h3>âŒ ÅÄ°MDÄ°</h3>
                    <ul>
                        <li>Toplam: <strong>23.3s</strong></li>
                        <li>Query: <strong>21.8s</strong></li>
                        <li>Session delete: <strong>16.8s</strong></li>
                        <li>Session update: <strong>5s</strong></li>
                    </ul>
                </div>

                <div class="comparison-item after">
                    <h3>âœ… REDIS SONRASI</h3>
                    <ul>
                        <li>Toplam: <strong>~2-3s</strong></li>
                        <li>Query: <strong>~50ms</strong></li>
                        <li>Session delete: <strong>0ms</strong></li>
                        <li>Session update: <strong>~5ms</strong></li>
                    </ul>
                </div>
            </div>

            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value good">8-10x</div>
                    <div class="stat-label">HÄ±zlanma Beklentisi</div>
                </div>

                <div class="stat-card">
                    <div class="stat-value good">~21.8s</div>
                    <div class="stat-label">KazanÄ±lan SÃ¼re</div>
                </div>

                <div class="stat-card">
                    <div class="stat-value good">%93</div>
                    <div class="stat-label">Ä°yileÅŸme OranÄ±</div>
                </div>
            </div>
        </section>

        <section>
            <h2>âš¡ Uygulama AdÄ±mlarÄ±</h2>

            <div class="solution-box">
                <h3>AdÄ±m 1: Redis Session Driver Aktif Et</h3>
                <ul>
                    <li>config/session.php dosyasÄ±nÄ± aÃ§</li>
                    <li>'driver' => 'database' â†’ 'redis' deÄŸiÅŸtir</li>
                    <li>Redis baÄŸlantÄ± ayarlarÄ±nÄ± kontrol et</li>
                </ul>
            </div>

            <div class="solution-box">
                <h3>AdÄ±m 2: Cache Temizle</h3>
                <ul>
                    <li>php artisan config:clear</li>
                    <li>php artisan cache:clear</li>
                    <li>php artisan view:clear</li>
                </ul>
            </div>

            <div class="solution-box">
                <h3>AdÄ±m 3: Test Et</h3>
                <ul>
                    <li>Homepage'i yenile</li>
                    <li>a-html.txt Ã§Ä±ktÄ±sÄ±nÄ± kontrol et</li>
                    <li>Session query'lerinin kaybolduÄŸunu doÄŸrula</li>
                    <li>YÃ¼kleme sÃ¼resinin 2-3s'ye dÃ¼ÅŸtÃ¼ÄŸÃ¼nÃ¼ onayla</li>
                </ul>
            </div>

            <div class="solution-box">
                <h3>AdÄ±m 4: Eski Session KayÄ±tlarÄ±nÄ± Temizle (Opsiyonel)</h3>
                <ul>
                    <li>ArtÄ±k database session kullanmÄ±yorsun</li>
                    <li>Eski kayÄ±tlar silinebilir (boÅŸ disk kazanÄ±rsÄ±n)</li>
                    <li>TRUNCATE sessions (dikkatli ol!)</li>
                </ul>
            </div>
        </section>

        <footer>
            ğŸ¤– Claude AI tarafÄ±ndan oluÅŸturuldu | 2025-11-30
        </footer>
    </div>
</body>
</html>
