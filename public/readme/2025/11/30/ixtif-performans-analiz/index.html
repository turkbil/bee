<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ixtif.com Performans Analizi - Rapor</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #e2e8f0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            line-height: 1.7;
            padding: 40px 20px;
        }
        .container { max-width: 1100px; margin: 0 auto; }
        header { margin-bottom: 40px; padding-bottom: 24px; border-bottom: 2px solid #334155; }
        h1 { font-size: 2.4rem; font-weight: 700; margin-bottom: 12px; background: linear-gradient(135deg, #60a5fa, #3b82f6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .meta { color: #94a3b8; font-size: 0.95rem; }
        section { margin-bottom: 36px; }
        h2 { font-size: 1.6rem; margin-bottom: 18px; color: #60a5fa; display: flex; align-items: center; gap: 10px; }
        .panel { background: rgba(30, 41, 59, 0.6); border: 1px solid #334155; border-radius: 14px; padding: 20px; margin-bottom: 16px; backdrop-filter: blur(10px); }
        .plan-item { background: rgba(30, 41, 59, 0.6); padding: 22px; margin-bottom: 14px; border-radius: 12px; border-left: 4px solid #3b82f6; transition: all 0.25s ease; }
        .plan-item:hover { transform: translateX(4px); background: rgba(30, 41, 59, 0.75); }
        .plan-item h3 { color: #60a5fa; margin-bottom: 10px; font-size: 1.2rem; display: flex; align-items: center; gap: 10px; }
        .plan-item p { color: #cbd5e1; margin-bottom: 8px; }
        .priority { display: inline-block; padding: 4px 12px; border-radius: 999px; font-size: 0.82rem; font-weight: 700; }
        .priority-high { background: #dc2626; color: #fff; }
        .priority-medium { background: #f59e0b; color: #fff; }
        .priority-low { background: #10b981; color: #fff; }
        ul { margin-left: 18px; color: #cbd5e1; }
        li { margin-bottom: 6px; }
        .badge { display: inline-block; padding: 4px 10px; border-radius: 10px; font-size: 0.78rem; background: #1f2937; color: #93c5fd; border: 1px solid #334155; }
        footer { margin-top: 50px; padding-top: 24px; border-top: 1px solid #334155; color: #64748b; font-size: 0.9rem; text-align: center; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“Š ixtif.com Performans Analizi</h1>
            <div class="meta">ğŸ“… Tarih: 2025-11-30 03:38 | ğŸ¯ Tenant: ixtif.com | ğŸ‘¤ Talep: CanlÄ± ortam aÅŸÄ±rÄ± yavaÅŸ, kaynak analiz ve aksiyon planÄ±</div>
        </header>

        <section>
            <h2>ğŸš¦ Durum Ã–zeti</h2>
            <div class="panel">
                <ul>
                    <li><span class="badge">Sunucu yÃ¼kÃ¼</span> load average 16.95 / 15.14 / 14.92 (yÃ¼ksek) â€“ Ã§ok sayÄ±da PHP/Horizon prosesi CPU tÃ¼ketiyor.</li>
                    <li><span class="badge">Horizon</span> birden fazla master ve onlarca worker aynÄ± anda Ã§alÄ±ÅŸÄ±yor; ps Ã§Ä±ktÄ±sÄ± 6+ master seti (ZkT3, yZ59, rwGp, 6KJ6, heML, HKPJ, OLr0) gÃ¶steriyor.</li>
                    <li><span class="badge">DB baÄŸlantÄ±larÄ±</span> tenant-resource-tracking logunda "Too many connections" hatasÄ±; baÄŸlantÄ± ÅŸiÅŸmesi yaÅŸanÄ±yor.</li>
                    <li><span class="badge">Debug araÃ§larÄ±</span> APP_DEBUG ve APP_DEBUG_TOOLS prod\'da aÃ§Ä±k; Debugbar storage 1.6 GB, Pulse/Telescope kayÄ±t yapÄ±yor.</li>
                    <li><span class="badge">Loglar</span> queue health check her dakikada Horizon\'Ä± nohup ile baÅŸlatmaya Ã§alÄ±ÅŸÄ±yor (tekrarlÄ± "Horizon otomatik baÅŸlatÄ±ldÄ±" loglarÄ±); Pulse kayÄ±tlarÄ± 111 ms yazÄ±m ve modÃ¼l sorgusu 145 ms olarak iÅŸaretlenmiÅŸ.</li>
                </ul>
            </div>
        </section>

        <section>
            <h2>ğŸ¯ Ã–ncelikli Aksiyonlar</h2>

            <div class="plan-item">
                <h3>1. Horizon sÃ¼reÃ§ patlamasÄ±nÄ± durdur <span class="priority priority-high">YÃ¼ksek</span></h3>
                <p>Horizon iÃ§in 6'dan fazla master ve Ã§ok sayÄ±da worker aynÄ± anda koÅŸuyor; her biri 10-16% CPU kullanÄ±yor. Bu yoÄŸunluk load average'Ä± 15+ seviyesine Ã§ekiyor ve MySQL baÄŸlantÄ± sÄ±nÄ±rÄ±nÄ± zorluyor.</p>
                <p><strong>KÃ¶k neden:</strong> queue:health-check komutu her dakika runInBackground Ã§alÄ±ÅŸÄ±yor, QueueHealthService iÃ§inde nohup ile yeni Horizon baÅŸlatÄ±yor; AutoQueueHealthCheck middleware admin trafikte de tetikliyor; mevcut sÃ¼reÃ§ler terminate edilmediÄŸi iÃ§in katlanarak artÄ±yor.</p>
                <p><strong>Aksiyon:</strong> Tek bir supervisor/systemd ile Horizon'Ä± yÃ¶netecek yapÄ±landÄ±rmaya geÃ§; queue:health-check iÃ§indeki otomatik Horizon baÅŸlatmayÄ± kapat ve tek seferlik horizon:terminate ile fazlalÄ±klarÄ± temizle; cron'da queue:ensure-workers/health-check frekansÄ±nÄ± dÃ¼ÅŸÃ¼r veya devre dÄ±ÅŸÄ± bÄ±rak.</p>
                <p><strong>Beklenen sonuÃ§:</strong> CPU yÃ¼kÃ¼ ve DB baÄŸlantÄ± sayÄ±sÄ± dÃ¼ÅŸer, ixtif.com yanÄ±t sÃ¼releri stabil hale gelir.</p>
            </div>

            <div class="plan-item">
                <h3>2. Prod ortamda debug araÃ§larÄ±nÄ± kapat <span class="priority priority-high">YÃ¼ksek</span></h3>
                <p>APP_DEBUG ve APP_DEBUG_TOOLS Ã¼retimde true; Debugbar tÃ¼m kolektÃ¶rlerle aktif ve storage/debugbar klasÃ¶rÃ¼ 1.6 GB. Pulse ve Telescope da aÃ§Ä±k, her istekte veritabanÄ±na pulse_entries vb. yazÄ±yor.</p>
                <p><strong>Risk:</strong> Dosya I/O ve DB yazÄ±mlarÄ± sayfa yanÄ±tlarÄ±nÄ± geciktiriyor, disk tÃ¼ketimi artÄ±yor.</p>
                <p><strong>Aksiyon:</strong> APP_DEBUG ve APP_DEBUG_TOOLS deÄŸerlerini prod iÃ§in false'a Ã§ek; Debugbar/Telescope/Pulse'Ä± sadece lokal iÃ§in aÃ§; storage/debugbar iÃ§eriÄŸini ve Pulse/Telescope kayÄ±tlarÄ±nÄ± temizle; log seviyesini INFO altÄ±na dÃ¼ÅŸÃ¼r.</p>
                <p><strong>Beklenen sonuÃ§:</strong> I/O yÃ¼kÃ¼nde ve sorgu sayÄ±sÄ±nda belirgin azalma, Ã¶nbellek hit oranÄ±nda artÄ±ÅŸ.</p>
            </div>

            <div class="plan-item">
                <h3>3. VeritabanÄ± baÄŸlantÄ± saÄŸlÄ±ÄŸÄ±nÄ± toparla <span class="priority priority-medium">Orta</span></h3>
                <p>"Too many connections" hatalarÄ± merkezi DB'yi kilitlemiÅŸ; Horizon sÃ¼reÃ§ fazlalÄ±ÄŸÄ± baÄŸlantÄ± havuzunu tÃ¼ketiyor. Pulse ve Debugbar da ek yazÄ±mlarla baÄŸlantÄ± sÃ¼resini uzatÄ±yor.</p>
                <p><strong>Aksiyon:</strong> Horizon Ã§oÄŸalmasÄ±nÄ± durdurduktan sonra MySQL max_connections ile PHP-FPM/Horizon worker sayÄ±sÄ±nÄ± hizala; uzun yaÅŸayan iÅŸlemleri (AI, HLS) timeout ve maxJobs limitleriyle izleyip erken sonlandÄ±r; DB baÄŸlantÄ± reuse/pooling ayarlarÄ±nÄ± gÃ¶zden geÃ§ir.</p>
                <p><strong>Beklenen sonuÃ§:</strong> BaÄŸlantÄ± satÃ¼rasyonu kalkar, 500/1040 hata riski dÃ¼ÅŸer.</p>
            </div>

            <div class="plan-item">
                <h3>4. Cron ve health-check yoÄŸunluÄŸunu sadeleÅŸtir <span class="priority priority-medium">Orta</span></h3>
                <p>queue:health-check her dakika runInBackground Ã§alÄ±ÅŸÄ±yor; queue:ensure-workers komutu her 5 dakikada docker inspect/restart deniyor; AutoQueueHealthCheck middleware her admin trafiÄŸinde job dispatch ediyor.</p>
                <p><strong>Aksiyon:</strong> Tek bir saÄŸlam Supervisor/Systemd izleme hattÄ± bÄ±rakÄ±p diÄŸer otomatik restart mekanizmalarÄ±nÄ± kapat; middleware tetiklemesini kaldÄ±r veya per-request'ten Ã§Ä±kar; docker tabanlÄ± ensure-workers komutunu canlÄ± ortamda devre dÄ±ÅŸÄ± bÄ±rak.</p>
                <p><strong>Beklenen sonuÃ§:</strong> Gereksiz proses aÃ§Ä±lÄ±ÅŸlarÄ± durur, cron kuyruk yoÄŸunluÄŸu ve log gÃ¼rÃ¼ltÃ¼sÃ¼ azalÄ±r.</p>
            </div>

            <div class="plan-item">
                <h3>5. Uygulama katmanÄ± optimizasyonlarÄ± <span class="priority priority-low">DÃ¼ÅŸÃ¼k</span></h3>
                <p>PULSE slow request kaydÄ± 111 ms (pulse_entries yazÄ±mÄ±) ve module_tenants join'i 145 ms gÃ¶rÃ¼nÃ¼yor. Åu anki ana sorun CPU/IO olduÄŸundan, altyapÄ± sakinleÅŸtirildikten sonra sorgu planlarÄ±nÄ± ve index'leri (module_tenants tenant_id/module_id/is_active) gÃ¶zden geÃ§irmek faydalÄ±.</p>
                <p><strong>Beklenen sonuÃ§:</strong> AltyapÄ± stabilize olduktan sonra istek baÅŸÄ±na DB sÃ¼resi dÃ¼ÅŸer, responsecache etkisi artar.</p>
            </div>
        </section>

        <section>
            <h2>ğŸ§­ Sonraki AdÄ±m NotlarÄ±</h2>
            <div class="panel">
                <ul>
                    <li>Ã–nce Horizon Ã§oÄŸalmasÄ±nÄ± durdurup tek instance'a dÃ¼ÅŸÃ¼r; ardÄ±ndan load average ve MySQL baÄŸlantÄ± sayÄ±sÄ±nÄ± takip et.</li>
                    <li>Debug araÃ§larÄ±nÄ± kapattÄ±ktan sonra storage/debugbar ve Telescope/Pulse verisini temizleyip disk alanÄ±nÄ± geri kazan.</li>
                    <li>Cron ve middleware'lerdeki otomatik queue restart/start kurgusunu sadeleÅŸtir; izleme iÃ§in Supervisor veya systemd yeterli olacak.</li>
                    <li>AltyapÄ± normale dÃ¶ndÃ¼ÄŸÃ¼nde Pulse'Ä± sadece gÃ¶zlem aracÄ± olarak dÃ¼ÅŸÃ¼k Ã¶rnekleme ile tut veya tamamen kapat.</li>
                </ul>
            </div>
        </section>

        <footer>
            ğŸ¤– Claude AI tarafÄ±ndan oluÅŸturuldu | ixtif.com performans analizi
        </footer>
    </div>
</body>
</html>
